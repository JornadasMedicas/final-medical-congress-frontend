import{aq as lR,ar as cR,as as uR,r as it,i as Ep,$ as Qg,l as Gg,O as mp,at as j0,j as Ae,a as ts,b as is,s as dn,u as Cs,au as hR,d as Tr,av as F2,m as bs,e as Fr,f as ns,aw as VS,y as Ra,P as y_,A as jS,ax as B2,D as U0,c as xs,ay as dR,az as fR,aA as Wh,n as uc,h as x_,aB as Nx,o as US,ab as pR,aC as mR,k as gR,B as $S,p as GS,al as e_,U as _R,aD as N2,aE as yR,aF as Vx,aG as jx,a3 as hl,aH as xR,a5 as zn,T as Jn,a8 as HS,a9 as Tu,a6 as nr,a7 as h0,a1 as Kh,g as vR,a0 as qS,Z as bR,aI as V2,aJ as wR,aK as TR,aL as v_}from"./index-L5eYlgrl.js";function SR({props:a,name:h}){return lR({props:a,name:h,defaultTheme:cR,themeId:uR})}function j2(a){const{controlled:h,default:_,name:w,state:M="value"}=a,{current:O}=it.useRef(h!==void 0),[k,s]=it.useState(_),W=O?h:k,X=it.useCallback(Y=>{O||s(Y)},[]);return[W,X]}function Fg(a){return parseInt(a,10)||0}const ER={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function AR(a){for(const h in a)return!1;return!0}function U2(a){return AR(a)||a.outerHeightStyle===0&&!a.overflowing}const IR=it.forwardRef(function(h,_){const{onChange:w,maxRows:M,minRows:O=1,style:k,value:s,...W}=h,{current:X}=it.useRef(s!=null),Y=it.useRef(null),fe=Ep(_,Y),Ie=it.useRef(null),je=it.useRef(null),He=it.useCallback(()=>{const ot=Y.current,Ct=je.current;if(!ot||!Ct)return;const Vt=Qg(ot).getComputedStyle(ot);if(Vt.width==="0px")return{outerHeightStyle:0,overflowing:!1};Ct.style.width=Vt.width,Ct.value=ot.value||h.placeholder||"x",Ct.value.slice(-1)===`
`&&(Ct.value+=" ");const hi=Vt.boxSizing,Kt=Fg(Vt.paddingBottom)+Fg(Vt.paddingTop),Ei=Fg(Vt.borderBottomWidth)+Fg(Vt.borderTopWidth),gi=Ct.scrollHeight;Ct.value="x";const _i=Ct.scrollHeight;let an=gi;O&&(an=Math.max(Number(O)*_i,an)),M&&(an=Math.min(Number(M)*_i,an)),an=Math.max(an,_i);const yi=an+(hi==="border-box"?Kt+Ei:0),Jt=Math.abs(an-gi)<=1;return{outerHeightStyle:yi,overflowing:Jt}},[M,O,h.placeholder]),Re=Gg(()=>{const ot=Y.current,Ct=He();if(!ot||!Ct||U2(Ct))return!1;const Dt=Ct.outerHeightStyle;return Ie.current!=null&&Ie.current!==Dt}),Ue=it.useCallback(()=>{const ot=Y.current,Ct=He();if(!ot||!Ct||U2(Ct))return;const Dt=Ct.outerHeightStyle;Ie.current!==Dt&&(Ie.current=Dt,ot.style.height=`${Dt}px`),ot.style.overflow=Ct.overflowing?"hidden":""},[He]),et=it.useRef(-1);mp(()=>{const ot=j0(Ue),Ct=Y==null?void 0:Y.current;if(!Ct)return;const Dt=Qg(Ct);Dt.addEventListener("resize",ot);let Vt;return typeof ResizeObserver<"u"&&(Vt=new ResizeObserver(()=>{Re()&&(Vt.unobserve(Ct),cancelAnimationFrame(et.current),Ue(),et.current=requestAnimationFrame(()=>{Vt.observe(Ct)}))}),Vt.observe(Ct)),()=>{ot.clear(),cancelAnimationFrame(et.current),Dt.removeEventListener("resize",ot),Vt&&Vt.disconnect()}},[He,Ue,Re]),mp(()=>{Ue()});const vt=ot=>{X||Ue();const Ct=ot.target,Dt=Ct.value.length,Vt=Ct.value.endsWith(`
`),hi=Ct.selectionStart===Dt;Vt&&hi&&Ct.setSelectionRange(Dt,Dt),w&&w(ot)};return Ae.jsxs(it.Fragment,{children:[Ae.jsx("textarea",{value:s,onChange:vt,ref:fe,rows:O,style:k,...W}),Ae.jsx("textarea",{"aria-hidden":!0,className:h.className,readOnly:!0,ref:je,tabIndex:-1,style:{...ER.shadow,...k,paddingTop:0,paddingBottom:0}})]})});function id({props:a,states:h,muiFormControl:_}){return h.reduce((w,M)=>(w[M]=a[M],_&&typeof a[M]>"u"&&(w[M]=_[M]),w),{})}const $0=it.createContext(void 0);function nd(){return it.useContext($0)}function $2(a){return a!=null&&!(Array.isArray(a)&&a.length===0)}function t_(a,h=!1){return a&&($2(a.value)&&a.value!==""||h&&$2(a.defaultValue)&&a.defaultValue!=="")}function CR(a){return a.startAdornment}function MR(a){return is("MuiInputBase",a)}const Yh=ts("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var G2;const b_=(a,h)=>{const{ownerState:_}=a;return[h.root,_.formControl&&h.formControl,_.startAdornment&&h.adornedStart,_.endAdornment&&h.adornedEnd,_.error&&h.error,_.size==="small"&&h.sizeSmall,_.multiline&&h.multiline,_.color&&h[`color${Fr(_.color)}`],_.fullWidth&&h.fullWidth,_.hiddenLabel&&h.hiddenLabel]},w_=(a,h)=>{const{ownerState:_}=a;return[h.input,_.size==="small"&&h.inputSizeSmall,_.multiline&&h.inputMultiline,_.type==="search"&&h.inputTypeSearch,_.startAdornment&&h.inputAdornedStart,_.endAdornment&&h.inputAdornedEnd,_.hiddenLabel&&h.inputHiddenLabel]},PR=a=>{const{classes:h,color:_,disabled:w,error:M,endAdornment:O,focused:k,formControl:s,fullWidth:W,hiddenLabel:X,multiline:Y,readOnly:fe,size:Ie,startAdornment:je,type:He}=a,Re={root:["root",`color${Fr(_)}`,w&&"disabled",M&&"error",W&&"fullWidth",k&&"focused",s&&"formControl",Ie&&Ie!=="medium"&&`size${Fr(Ie)}`,Y&&"multiline",je&&"adornedStart",O&&"adornedEnd",X&&"hiddenLabel",fe&&"readOnly"],input:["input",w&&"disabled",He==="search"&&"inputTypeSearch",Y&&"inputMultiline",Ie==="small"&&"inputSizeSmall",X&&"inputHiddenLabel",je&&"inputAdornedStart",O&&"inputAdornedEnd",fe&&"readOnly"]};return ns(Re,MR,h)},T_=dn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:b_})(bs(({theme:a})=>({...a.typography.body1,color:(a.vars||a).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${Yh.disabled}`]:{color:(a.vars||a).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:h})=>h.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:h,size:_})=>h.multiline&&_==="small",style:{paddingTop:1}},{props:({ownerState:h})=>h.fullWidth,style:{width:"100%"}}]}))),S_=dn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:w_})(bs(({theme:a})=>{const h=a.palette.mode==="light",_={color:"currentColor",...a.vars?{opacity:a.vars.opacity.inputPlaceholder}:{opacity:h?.42:.5},transition:a.transitions.create("opacity",{duration:a.transitions.duration.shorter})},w={opacity:"0 !important"},M=a.vars?{opacity:a.vars.opacity.inputPlaceholder}:{opacity:h?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":_,"&::-moz-placeholder":_,"&::-ms-input-placeholder":_,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${Yh.formControl} &`]:{"&::-webkit-input-placeholder":w,"&::-moz-placeholder":w,"&::-ms-input-placeholder":w,"&:focus::-webkit-input-placeholder":M,"&:focus::-moz-placeholder":M,"&:focus::-ms-input-placeholder":M},[`&.${Yh.disabled}`]:{opacity:1,WebkitTextFillColor:(a.vars||a).palette.text.disabled},variants:[{props:({ownerState:O})=>!O.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:O})=>O.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),H2=hR({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),G0=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiInputBase"}),{"aria-describedby":M,autoComplete:O,autoFocus:k,className:s,color:W,components:X={},componentsProps:Y={},defaultValue:fe,disabled:Ie,disableInjectingGlobalStyles:je,endAdornment:He,error:Re,fullWidth:Ue=!1,id:et,inputComponent:vt="input",inputProps:ot={},inputRef:Ct,margin:Dt,maxRows:Vt,minRows:hi,multiline:Kt=!1,name:Ei,onBlur:gi,onChange:_i,onClick:an,onFocus:yi,onKeyDown:Jt,onKeyUp:Pi,placeholder:Vi,readOnly:Ii,renderSuffix:Hi,rows:Ci,size:ti,slotProps:tn={},slots:rr={},startAdornment:Wn,type:Qn="text",value:xi,...Ai}=w,ji=ot.value!=null?ot.value:xi,{current:Br}=it.useRef(ji!=null),zi=it.useRef(),Sr=it.useCallback(Qi=>{},[]),Rr=Ep(zi,Ct,ot.ref,Sr),[Zn,Ui]=it.useState(!1),Un=nd(),lr=id({props:w,muiFormControl:Un,states:["color","disabled","error","hiddenLabel","size","required","filled"]});lr.focused=Un?Un.focused:Zn,it.useEffect(()=>{!Un&&Ie&&Zn&&(Ui(!1),gi&&gi())},[Un,Ie,Zn,gi]);const Kn=Un&&Un.onFilled,er=Un&&Un.onEmpty,sr=it.useCallback(Qi=>{t_(Qi)?Kn&&Kn():er&&er()},[Kn,er]);mp(()=>{Br&&sr({value:ji})},[ji,sr,Br]);const tr=Qi=>{yi&&yi(Qi),ot.onFocus&&ot.onFocus(Qi),Un&&Un.onFocus?Un.onFocus(Qi):Ui(!0)},dr=Qi=>{gi&&gi(Qi),ot.onBlur&&ot.onBlur(Qi),Un&&Un.onBlur?Un.onBlur(Qi):Ui(!1)},Dr=(Qi,...rs)=>{if(!Br){const cs=Qi.target||zi.current;if(cs==null)throw new Error(VS(1));sr({value:cs.value})}ot.onChange&&ot.onChange(Qi,...rs),_i&&_i(Qi,...rs)};it.useEffect(()=>{sr(zi.current)},[]);const fr=Qi=>{zi.current&&Qi.currentTarget===Qi.target&&zi.current.focus(),an&&an(Qi)};let Nr=vt,Sn=ot;Kt&&Nr==="input"&&(Ci?Sn={type:void 0,minRows:Ci,maxRows:Ci,...Sn}:Sn={type:void 0,maxRows:Vt,minRows:hi,...Sn},Nr=IR);const vr=Qi=>{sr(Qi.animationName==="mui-auto-fill-cancel"?zi.current:{value:"x"})};it.useEffect(()=>{Un&&Un.setAdornedStart(!!Wn)},[Un,Wn]);const js={...w,color:lr.color||"primary",disabled:lr.disabled,endAdornment:He,error:lr.error,focused:lr.focused,formControl:Un,fullWidth:Ue,hiddenLabel:lr.hiddenLabel,multiline:Kt,size:lr.size,startAdornment:Wn,type:Qn},ws=PR(js),Xr=rr.root||X.Root||T_,Vr=tn.root||Y.root||{},jr=rr.input||X.Input||S_;return Sn={...Sn,...tn.input??Y.input},Ae.jsxs(it.Fragment,{children:[!je&&typeof H2=="function"&&(G2||(G2=Ae.jsx(H2,{}))),Ae.jsxs(Xr,{...Vr,ref:_,onClick:fr,...Ai,...!F2(Xr)&&{ownerState:{...js,...Vr.ownerState}},className:Tr(ws.root,Vr.className,s,Ii&&"MuiInputBase-readOnly"),children:[Wn,Ae.jsx($0.Provider,{value:null,children:Ae.jsx(jr,{"aria-invalid":lr.error,"aria-describedby":M,autoComplete:O,autoFocus:k,defaultValue:fe,disabled:lr.disabled,id:et,onAnimationStart:vr,name:Ei,placeholder:Vi,readOnly:Ii,required:lr.required,rows:Ci,value:ji,onKeyDown:Jt,onKeyUp:Pi,type:Qn,...Sn,...!F2(jr)&&{as:Nr,ownerState:{...js,...Sn.ownerState}},ref:Rr,className:Tr(ws.input,Sn.className,Ii&&"MuiInputBase-readOnly"),onBlur:dr,onChange:Dr,onFocus:tr})}),He,Hi?Hi({...lr,startAdornment:Wn}):null]})]})});function RR(a){return is("MuiInput",a)}const np={...Yh,...ts("MuiInput",["root","underline","input"])};function DR(a){return is("MuiOutlinedInput",a)}const Sa={...Yh,...ts("MuiOutlinedInput",["root","notchedOutline","input"])};function zR(a){return is("MuiFilledInput",a)}const uu={...Yh,...ts("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},LR=Ra(Ae.jsx("path",{d:"M7 10l5 5 5-5z"}));function kR(a){return is("MuiCard",a)}ts("MuiCard",["root"]);const OR=a=>{const{classes:h}=a;return ns({root:["root"]},kR,h)},FR=dn(y_,{name:"MuiCard",slot:"Root"})({overflow:"hidden"}),BR=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiCard"}),{className:M,raised:O=!1,...k}=w,s={...w,raised:O},W=OR(s);return Ae.jsx(FR,{className:Tr(W.root,M),elevation:O?8:void 0,ref:_,ownerState:s,...k})});function NR(a){return is("MuiCardContent",a)}ts("MuiCardContent",["root"]);const VR=a=>{const{classes:h}=a;return ns({root:["root"]},NR,h)},jR=dn("div",{name:"MuiCardContent",slot:"Root"})({padding:16,"&:last-child":{paddingBottom:24}}),UR=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiCardContent"}),{className:M,component:O="div",...k}=w,s={...w,component:O},W=VR(s);return Ae.jsx(jR,{as:O,className:Tr(W.root,M),ownerState:s,ref:_,...k})});function $R(a){return is("MuiDialog",a)}const Ux=ts("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),GR=it.createContext({}),HR=dn(fR,{name:"MuiDialog",slot:"Backdrop",overrides:(a,h)=>h.backdrop})({zIndex:-1}),qR=a=>{const{classes:h,scroll:_,maxWidth:w,fullWidth:M,fullScreen:O}=a,k={root:["root"],container:["container",`scroll${Fr(_)}`],paper:["paper",`paperScroll${Fr(_)}`,`paperWidth${Fr(String(w))}`,M&&"paperFullWidth",O&&"paperFullScreen"]};return ns(k,$R,h)},WR=dn(dR,{name:"MuiDialog",slot:"Root"})({"@media print":{position:"absolute !important"}}),ZR=dn("div",{name:"MuiDialog",slot:"Container",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.container,h[`scroll${Fr(_.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),XR=dn(y_,{name:"MuiDialog",slot:"Paper",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.paper,h[`scrollPaper${Fr(_.scroll)}`],h[`paperWidth${Fr(String(_.maxWidth))}`],_.fullWidth&&h.paperFullWidth,_.fullScreen&&h.paperFullScreen]}})(bs(({theme:a})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:h})=>!h.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:a.breakpoints.unit==="px"?Math.max(a.breakpoints.values.xs,444):`max(${a.breakpoints.values.xs}${a.breakpoints.unit}, 444px)`,[`&.${Ux.paperScrollBody}`]:{[a.breakpoints.down(Math.max(a.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(a.breakpoints.values).filter(h=>h!=="xs").map(h=>({props:{maxWidth:h},style:{maxWidth:`${a.breakpoints.values[h]}${a.breakpoints.unit}`,[`&.${Ux.paperScrollBody}`]:{[a.breakpoints.down(a.breakpoints.values[h]+32*2)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:h})=>h.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:h})=>h.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${Ux.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),KR=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiDialog"}),M=jS(),O={enter:M.transitions.duration.enteringScreen,exit:M.transitions.duration.leavingScreen},{"aria-describedby":k,"aria-labelledby":s,"aria-modal":W=!0,BackdropComponent:X,BackdropProps:Y,children:fe,className:Ie,disableEscapeKeyDown:je=!1,fullScreen:He=!1,fullWidth:Re=!1,maxWidth:Ue="sm",onClick:et,onClose:vt,open:ot,PaperComponent:Ct=y_,PaperProps:Dt={},scroll:Vt="paper",slots:hi={},slotProps:Kt={},TransitionComponent:Ei=B2,transitionDuration:gi=O,TransitionProps:_i,...an}=w,yi={...w,disableEscapeKeyDown:je,fullScreen:He,fullWidth:Re,maxWidth:Ue,scroll:Vt},Jt=qR(yi),Pi=it.useRef(),Vi=Ui=>{Pi.current=Ui.target===Ui.currentTarget},Ii=Ui=>{et&&et(Ui),Pi.current&&(Pi.current=null,vt&&vt(Ui,"backdropClick"))},Hi=U0(s),Ci=it.useMemo(()=>({titleId:Hi}),[Hi]),ti={transition:Ei,...hi},tn={transition:_i,paper:Dt,backdrop:Y,...Kt},rr={slots:ti,slotProps:tn},[Wn,Qn]=xs("root",{elementType:WR,shouldForwardComponentProp:!0,externalForwardedProps:rr,ownerState:yi,className:Tr(Jt.root,Ie),ref:_}),[xi,Ai]=xs("backdrop",{elementType:HR,shouldForwardComponentProp:!0,externalForwardedProps:rr,ownerState:yi}),[ji,Br]=xs("paper",{elementType:XR,shouldForwardComponentProp:!0,externalForwardedProps:rr,ownerState:yi,className:Tr(Jt.paper,Dt.className)}),[zi,Sr]=xs("container",{elementType:ZR,externalForwardedProps:rr,ownerState:yi,className:Jt.container}),[Rr,Zn]=xs("transition",{elementType:B2,externalForwardedProps:rr,ownerState:yi,additionalProps:{appear:!0,in:ot,timeout:gi,role:"presentation"}});return Ae.jsx(Wn,{closeAfterTransition:!0,slots:{backdrop:xi},slotProps:{backdrop:{transitionDuration:gi,as:X,...Ai}},disableEscapeKeyDown:je,onClose:vt,open:ot,onClick:Ii,...Qn,...an,children:Ae.jsx(Rr,{...Zn,children:Ae.jsx(zi,{onMouseDown:Vi,...Sr,children:Ae.jsx(ji,{as:Ct,elevation:24,role:"dialog","aria-describedby":k,"aria-labelledby":Hi,"aria-modal":W,...Br,children:Ae.jsx(GR.Provider,{value:Ci,children:fe})})})})})});function YR(a){return is("MuiDialogContent",a)}ts("MuiDialogContent",["root","dividers"]);function cV(a){return is("MuiDialogTitle",a)}const JR=ts("MuiDialogTitle",["root"]),QR=a=>{const{classes:h,dividers:_}=a;return ns({root:["root",_&&"dividers"]},YR,h)},eD=dn("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,_.dividers&&h.dividers]}})(bs(({theme:a})=>({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px",variants:[{props:({ownerState:h})=>h.dividers,style:{padding:"16px 24px",borderTop:`1px solid ${(a.vars||a).palette.divider}`,borderBottom:`1px solid ${(a.vars||a).palette.divider}`}},{props:({ownerState:h})=>!h.dividers,style:{[`.${JR.root} + &`]:{paddingTop:0}}}]}))),tD=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiDialogContent"}),{className:M,dividers:O=!1,...k}=w,s={...w,dividers:O},W=QR(s);return Ae.jsx(eD,{className:Tr(W.root,M),ownerState:s,ref:_,...k})}),iD=a=>{const{classes:h,disableUnderline:_,startAdornment:w,endAdornment:M,size:O,hiddenLabel:k,multiline:s}=a,W={root:["root",!_&&"underline",w&&"adornedStart",M&&"adornedEnd",O==="small"&&`size${Fr(O)}`,k&&"hiddenLabel",s&&"multiline"],input:["input"]},X=ns(W,zR,h);return{...h,...X}},nD=dn(T_,{shouldForwardProp:a=>uc(a)||a==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[...b_(a,h),!_.disableUnderline&&h.underline]}})(bs(({theme:a})=>{const h=a.palette.mode==="light",_=h?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",w=h?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",M=h?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",O=h?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:a.vars?a.vars.palette.FilledInput.bg:w,borderTopLeftRadius:(a.vars||a).shape.borderRadius,borderTopRightRadius:(a.vars||a).shape.borderRadius,transition:a.transitions.create("background-color",{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut}),"&:hover":{backgroundColor:a.vars?a.vars.palette.FilledInput.hoverBg:M,"@media (hover: none)":{backgroundColor:a.vars?a.vars.palette.FilledInput.bg:w}},[`&.${uu.focused}`]:{backgroundColor:a.vars?a.vars.palette.FilledInput.bg:w},[`&.${uu.disabled}`]:{backgroundColor:a.vars?a.vars.palette.FilledInput.disabledBg:O},variants:[{props:({ownerState:k})=>!k.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:a.transitions.create("transform",{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${uu.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${uu.error}`]:{"&::before, &::after":{borderBottomColor:(a.vars||a).palette.error.main}},"&::before":{borderBottom:`1px solid ${a.vars?`rgba(${a.vars.palette.common.onBackgroundChannel} / ${a.vars.opacity.inputUnderline})`:_}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:a.transitions.create("border-bottom-color",{duration:a.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${uu.disabled}, .${uu.error}):before`]:{borderBottom:`1px solid ${(a.vars||a).palette.text.primary}`},[`&.${uu.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(a.palette).filter(x_()).map(([k])=>{var s;return{props:{disableUnderline:!1,color:k},style:{"&::after":{borderBottom:`2px solid ${(s=(a.vars||a).palette[k])==null?void 0:s.main}`}}}}),{props:({ownerState:k})=>k.startAdornment,style:{paddingLeft:12}},{props:({ownerState:k})=>k.endAdornment,style:{paddingRight:12}},{props:({ownerState:k})=>k.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:k,size:s})=>k.multiline&&s==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:k})=>k.multiline&&k.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:k})=>k.multiline&&k.hiddenLabel&&k.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),rD=dn(S_,{name:"MuiFilledInput",slot:"Input",overridesResolver:w_})(bs(({theme:a})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!a.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:a.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:a.palette.mode==="light"?null:"#fff",caretColor:a.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...a.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[a.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:h})=>h.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:h})=>h.startAdornment,style:{paddingLeft:0}},{props:({ownerState:h})=>h.endAdornment,style:{paddingRight:0}},{props:({ownerState:h})=>h.hiddenLabel&&h.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:h})=>h.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),H0=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiFilledInput"}),{disableUnderline:M=!1,components:O={},componentsProps:k,fullWidth:s=!1,hiddenLabel:W,inputComponent:X="input",multiline:Y=!1,slotProps:fe,slots:Ie={},type:je="text",...He}=w,Re={...w,disableUnderline:M,fullWidth:s,inputComponent:X,multiline:Y,type:je},Ue=iD(w),et={root:{ownerState:Re},input:{ownerState:Re}},vt=fe??k?Wh(et,fe??k):et,ot=Ie.root??O.Root??nD,Ct=Ie.input??O.Input??rD;return Ae.jsx(G0,{slots:{root:ot,input:Ct},slotProps:vt,fullWidth:s,inputComponent:X,multiline:Y,ref:_,type:je,...He,classes:Ue})});H0.muiName="Input";function sD(a){return is("MuiFormControl",a)}ts("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const oD=a=>{const{classes:h,margin:_,fullWidth:w}=a,M={root:["root",_!=="none"&&`margin${Fr(_)}`,w&&"fullWidth"]};return ns(M,sD,h)},aD=dn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,h[`margin${Fr(_.margin)}`],_.fullWidth&&h.fullWidth]}})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),lD=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiFormControl"}),{children:M,className:O,color:k="primary",component:s="div",disabled:W=!1,error:X=!1,focused:Y,fullWidth:fe=!1,hiddenLabel:Ie=!1,margin:je="none",required:He=!1,size:Re="medium",variant:Ue="outlined",...et}=w,vt={...w,color:k,component:s,disabled:W,error:X,fullWidth:fe,hiddenLabel:Ie,margin:je,required:He,size:Re,variant:Ue},ot=oD(vt),[Ct,Dt]=it.useState(()=>{let Pi=!1;return M&&it.Children.forEach(M,Vi=>{if(!Nx(Vi,["Input","Select"]))return;const Ii=Nx(Vi,["Select"])?Vi.props.input:Vi;Ii&&CR(Ii.props)&&(Pi=!0)}),Pi}),[Vt,hi]=it.useState(()=>{let Pi=!1;return M&&it.Children.forEach(M,Vi=>{Nx(Vi,["Input","Select"])&&(t_(Vi.props,!0)||t_(Vi.props.inputProps,!0))&&(Pi=!0)}),Pi}),[Kt,Ei]=it.useState(!1);W&&Kt&&Ei(!1);const gi=Y!==void 0&&!W?Y:Kt;let _i;it.useRef(!1);const an=it.useCallback(()=>{hi(!0)},[]),yi=it.useCallback(()=>{hi(!1)},[]),Jt=it.useMemo(()=>({adornedStart:Ct,setAdornedStart:Dt,color:k,disabled:W,error:X,filled:Vt,focused:gi,fullWidth:fe,hiddenLabel:Ie,size:Re,onBlur:()=>{Ei(!1)},onFocus:()=>{Ei(!0)},onEmpty:yi,onFilled:an,registerEffect:_i,required:He,variant:Ue}),[Ct,k,W,X,Vt,gi,fe,Ie,_i,yi,an,He,Re,Ue]);return Ae.jsx($0.Provider,{value:Jt,children:Ae.jsx(aD,{as:s,ownerState:vt,className:Tr(ot.root,O),ref:_,...et,children:M})})});function cD(a){return is("MuiFormHelperText",a)}const q2=ts("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var W2;const uD=a=>{const{classes:h,contained:_,size:w,disabled:M,error:O,filled:k,focused:s,required:W}=a,X={root:["root",M&&"disabled",O&&"error",w&&`size${Fr(w)}`,_&&"contained",s&&"focused",k&&"filled",W&&"required"]};return ns(X,cD,h)},hD=dn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,_.size&&h[`size${Fr(_.size)}`],_.contained&&h.contained,_.filled&&h.filled]}})(bs(({theme:a})=>({color:(a.vars||a).palette.text.secondary,...a.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${q2.disabled}`]:{color:(a.vars||a).palette.text.disabled},[`&.${q2.error}`]:{color:(a.vars||a).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:h})=>h.contained,style:{marginLeft:14,marginRight:14}}]}))),dD=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiFormHelperText"}),{children:M,className:O,component:k="p",disabled:s,error:W,filled:X,focused:Y,margin:fe,required:Ie,variant:je,...He}=w,Re=nd(),Ue=id({props:w,muiFormControl:Re,states:["variant","size","disabled","error","filled","focused","required"]}),et={...w,component:k,contained:Ue.variant==="filled"||Ue.variant==="outlined",variant:Ue.variant,size:Ue.size,disabled:Ue.disabled,error:Ue.error,filled:Ue.filled,focused:Ue.focused,required:Ue.required};delete et.ownerState;const vt=uD(et);return Ae.jsx(hD,{as:k,className:Tr(vt.root,O),ref:_,...He,ownerState:et,children:M===" "?W2||(W2=Ae.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):M})});function fD(a){return is("MuiFormLabel",a)}const cp=ts("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),pD=a=>{const{classes:h,color:_,focused:w,disabled:M,error:O,filled:k,required:s}=a,W={root:["root",`color${Fr(_)}`,M&&"disabled",O&&"error",k&&"filled",w&&"focused",s&&"required"],asterisk:["asterisk",O&&"error"]};return ns(W,fD,h)},mD=dn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,_.color==="secondary"&&h.colorSecondary,_.filled&&h.filled]}})(bs(({theme:a})=>({color:(a.vars||a).palette.text.secondary,...a.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(a.palette).filter(x_()).map(([h])=>({props:{color:h},style:{[`&.${cp.focused}`]:{color:(a.vars||a).palette[h].main}}})),{props:{},style:{[`&.${cp.disabled}`]:{color:(a.vars||a).palette.text.disabled},[`&.${cp.error}`]:{color:(a.vars||a).palette.error.main}}}]}))),gD=dn("span",{name:"MuiFormLabel",slot:"Asterisk"})(bs(({theme:a})=>({[`&.${cp.error}`]:{color:(a.vars||a).palette.error.main}}))),_D=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiFormLabel"}),{children:M,className:O,color:k,component:s="label",disabled:W,error:X,filled:Y,focused:fe,required:Ie,...je}=w,He=nd(),Re=id({props:w,muiFormControl:He,states:["color","required","focused","disabled","error","filled"]}),Ue={...w,color:Re.color||"primary",component:s,disabled:Re.disabled,error:Re.error,filled:Re.filled,focused:Re.focused,required:Re.required},et=pD(Ue);return Ae.jsxs(mD,{as:s,ownerState:Ue,className:Tr(et.root,O),ref:_,...je,children:[M,Re.required&&Ae.jsxs(gD,{ownerState:Ue,"aria-hidden":!0,className:et.asterisk,children:[" ","*"]})]})}),yD=a=>{const{classes:h,disableUnderline:_}=a,M=ns({root:["root",!_&&"underline"],input:["input"]},RR,h);return{...h,...M}},xD=dn(T_,{shouldForwardProp:a=>uc(a)||a==="classes",name:"MuiInput",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[...b_(a,h),!_.disableUnderline&&h.underline]}})(bs(({theme:a})=>{let _=a.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return a.vars&&(_=`rgba(${a.vars.palette.common.onBackgroundChannel} / ${a.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:w})=>w.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:w})=>!w.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:a.transitions.create("transform",{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${np.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${np.error}`]:{"&::before, &::after":{borderBottomColor:(a.vars||a).palette.error.main}},"&::before":{borderBottom:`1px solid ${_}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:a.transitions.create("border-bottom-color",{duration:a.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${np.disabled}, .${np.error}):before`]:{borderBottom:`2px solid ${(a.vars||a).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${_}`}},[`&.${np.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(a.palette).filter(x_()).map(([w])=>({props:{color:w,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(a.vars||a).palette[w].main}`}}}))]}})),vD=dn(S_,{name:"MuiInput",slot:"Input",overridesResolver:w_})({}),q0=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiInput"}),{disableUnderline:M=!1,components:O={},componentsProps:k,fullWidth:s=!1,inputComponent:W="input",multiline:X=!1,slotProps:Y,slots:fe={},type:Ie="text",...je}=w,He=yD(w),Ue={root:{ownerState:{disableUnderline:M}}},et=Y??k?Wh(Y??k,Ue):Ue,vt=fe.root??O.Root??xD,ot=fe.input??O.Input??vD;return Ae.jsx(G0,{slots:{root:vt,input:ot},slotProps:et,fullWidth:s,inputComponent:W,multiline:X,ref:_,type:Ie,...je,classes:He})});q0.muiName="Input";function bD(a){return is("MuiInputLabel",a)}ts("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const wD=a=>{const{classes:h,formControl:_,size:w,shrink:M,disableAnimation:O,variant:k,required:s}=a,W={root:["root",_&&"formControl",!O&&"animated",M&&"shrink",w&&w!=="medium"&&`size${Fr(w)}`,k],asterisk:[s&&"asterisk"]},X=ns(W,bD,h);return{...h,...X}},TD=dn(_D,{shouldForwardProp:a=>uc(a)||a==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[{[`& .${cp.asterisk}`]:h.asterisk},h.root,_.formControl&&h.formControl,_.size==="small"&&h.sizeSmall,_.shrink&&h.shrink,!_.disableAnimation&&h.animated,_.focused&&h.focused,h[_.variant]]}})(bs(({theme:a})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:h})=>h.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:h})=>h.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:h})=>!h.disableAnimation,style:{transition:a.transitions.create(["color","transform","max-width"],{duration:a.transitions.duration.shorter,easing:a.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:h,ownerState:_})=>h==="filled"&&_.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:h,ownerState:_,size:w})=>h==="filled"&&_.shrink&&w==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:h,ownerState:_})=>h==="outlined"&&_.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),SD=it.forwardRef(function(h,_){const w=Cs({name:"MuiInputLabel",props:h}),{disableAnimation:M=!1,margin:O,shrink:k,variant:s,className:W,...X}=w,Y=nd();let fe=k;typeof fe>"u"&&Y&&(fe=Y.filled||Y.focused||Y.adornedStart);const Ie=id({props:w,muiFormControl:Y,states:["size","variant","required","focused"]}),je={...w,disableAnimation:M,formControl:Y,shrink:fe,size:Ie.size,variant:Ie.variant,required:Ie.required,focused:Ie.focused},He=wD(je);return Ae.jsx(TD,{"data-shrink":fe,ref:_,className:Tr(He.root,W),...X,ownerState:je,classes:He})});function ED(a){return is("MuiNativeSelect",a)}const W0=ts("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),AD=a=>{const{classes:h,variant:_,disabled:w,multiple:M,open:O,error:k}=a,s={select:["select",_,w&&"disabled",M&&"multiple",k&&"error"],icon:["icon",`icon${Fr(_)}`,O&&"iconOpen",w&&"disabled"]};return ns(s,ED,h)},WS=dn("select")(({theme:a})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${W0.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(a.vars||a).palette.background.paper},variants:[{props:({ownerState:h})=>h.variant!=="filled"&&h.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(a.vars||a).shape.borderRadius,"&:focus":{borderRadius:(a.vars||a).shape.borderRadius},"&&&":{paddingRight:32}}}]})),ID=dn(WS,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:uc,overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.select,h[_.variant],_.error&&h.error,{[`&.${W0.multiple}`]:h.multiple}]}})({}),ZS=dn("svg")(({theme:a})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(a.vars||a).palette.action.active,[`&.${W0.disabled}`]:{color:(a.vars||a).palette.action.disabled},variants:[{props:({ownerState:h})=>h.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),CD=dn(ZS,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.icon,_.variant&&h[`icon${Fr(_.variant)}`],_.open&&h.iconOpen]}})({}),MD=it.forwardRef(function(h,_){const{className:w,disabled:M,error:O,IconComponent:k,inputRef:s,variant:W="standard",...X}=h,Y={...h,disabled:M,variant:W,error:O},fe=AD(Y);return Ae.jsxs(it.Fragment,{children:[Ae.jsx(ID,{ownerState:Y,className:Tr(fe.select,w),disabled:M,ref:s||_,...X}),h.multiple?null:Ae.jsx(CD,{as:k,ownerState:Y,className:fe.icon})]})});var Z2;const PD=dn("fieldset",{shouldForwardProp:uc})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),RD=dn("legend",{shouldForwardProp:uc})(bs(({theme:a})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:h})=>!h.withLabel,style:{padding:0,lineHeight:"11px",transition:a.transitions.create("width",{duration:150,easing:a.transitions.easing.easeOut})}},{props:({ownerState:h})=>h.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:a.transitions.create("max-width",{duration:50,easing:a.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:h})=>h.withLabel&&h.notched,style:{maxWidth:"100%",transition:a.transitions.create("max-width",{duration:100,easing:a.transitions.easing.easeOut,delay:50})}}]})));function DD(a){const{children:h,classes:_,className:w,label:M,notched:O,...k}=a,s=M!=null&&M!=="",W={...a,notched:O,withLabel:s};return Ae.jsx(PD,{"aria-hidden":!0,className:w,ownerState:W,...k,children:Ae.jsx(RD,{ownerState:W,children:s?Ae.jsx("span",{children:M}):Z2||(Z2=Ae.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"}))})})}const zD=a=>{const{classes:h}=a,w=ns({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},DR,h);return{...h,...w}},LD=dn(T_,{shouldForwardProp:a=>uc(a)||a==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:b_})(bs(({theme:a})=>{const h=a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(a.vars||a).shape.borderRadius,[`&:hover .${Sa.notchedOutline}`]:{borderColor:(a.vars||a).palette.text.primary},"@media (hover: none)":{[`&:hover .${Sa.notchedOutline}`]:{borderColor:a.vars?`rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:h}},[`&.${Sa.focused} .${Sa.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(a.palette).filter(x_()).map(([_])=>({props:{color:_},style:{[`&.${Sa.focused} .${Sa.notchedOutline}`]:{borderColor:(a.vars||a).palette[_].main}}})),{props:{},style:{[`&.${Sa.error} .${Sa.notchedOutline}`]:{borderColor:(a.vars||a).palette.error.main},[`&.${Sa.disabled} .${Sa.notchedOutline}`]:{borderColor:(a.vars||a).palette.action.disabled}}},{props:({ownerState:_})=>_.startAdornment,style:{paddingLeft:14}},{props:({ownerState:_})=>_.endAdornment,style:{paddingRight:14}},{props:({ownerState:_})=>_.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:_,size:w})=>_.multiline&&w==="small",style:{padding:"8.5px 14px"}}]}})),kD=dn(DD,{name:"MuiOutlinedInput",slot:"NotchedOutline"})(bs(({theme:a})=>{const h=a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:a.vars?`rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:h}})),OD=dn(S_,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:w_})(bs(({theme:a})=>({padding:"16.5px 14px",...!a.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:a.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:a.palette.mode==="light"?null:"#fff",caretColor:a.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...a.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[a.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:h})=>h.multiline,style:{padding:0}},{props:({ownerState:h})=>h.startAdornment,style:{paddingLeft:0}},{props:({ownerState:h})=>h.endAdornment,style:{paddingRight:0}}]}))),Z0=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiOutlinedInput"}),{components:M={},fullWidth:O=!1,inputComponent:k="input",label:s,multiline:W=!1,notched:X,slots:Y={},slotProps:fe={},type:Ie="text",...je}=w,He=zD(w),Re=nd(),Ue=id({props:w,muiFormControl:Re,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),et={...w,color:Ue.color||"primary",disabled:Ue.disabled,error:Ue.error,focused:Ue.focused,formControl:Re,fullWidth:O,hiddenLabel:Ue.hiddenLabel,multiline:W,size:Ue.size,type:Ie},vt=Y.root??M.Root??LD,ot=Y.input??M.Input??OD,[Ct,Dt]=xs("notchedOutline",{elementType:kD,className:He.notchedOutline,shouldForwardComponentProp:!0,ownerState:et,externalForwardedProps:{slots:Y,slotProps:fe},additionalProps:{label:s!=null&&s!==""&&Ue.required?Ae.jsxs(it.Fragment,{children:[s," ","*"]}):s}});return Ae.jsx(G0,{slots:{root:vt,input:ot},slotProps:fe,renderSuffix:Vt=>Ae.jsx(Ct,{...Dt,notched:typeof X<"u"?X:!!(Vt.startAdornment||Vt.filled||Vt.focused)}),fullWidth:O,inputComponent:k,multiline:W,ref:_,type:Ie,...je,classes:{...He,notchedOutline:null}})});Z0.muiName="Input";function XS(a){return is("MuiSelect",a)}const rp=ts("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var X2;const FD=dn(WS,{name:"MuiSelect",slot:"Select",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[{[`&.${rp.select}`]:h.select},{[`&.${rp.select}`]:h[_.variant]},{[`&.${rp.error}`]:h.error},{[`&.${rp.multiple}`]:h.multiple}]}})({[`&.${rp.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),BD=dn(ZS,{name:"MuiSelect",slot:"Icon",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.icon,_.variant&&h[`icon${Fr(_.variant)}`],_.open&&h.iconOpen]}})({}),ND=dn("input",{shouldForwardProp:a=>mR(a)&&a!=="classes",name:"MuiSelect",slot:"NativeInput"})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function K2(a,h){return typeof h=="object"&&h!==null?a===h:String(a)===String(h)}function VD(a){return a==null||typeof a=="string"&&!a.trim()}const jD=a=>{const{classes:h,variant:_,disabled:w,multiple:M,open:O,error:k}=a,s={select:["select",_,w&&"disabled",M&&"multiple",k&&"error"],icon:["icon",`icon${Fr(_)}`,O&&"iconOpen",w&&"disabled"],nativeInput:["nativeInput"]};return ns(s,XS,h)},UD=it.forwardRef(function(h,_){var us;const{"aria-describedby":w,"aria-label":M,autoFocus:O,autoWidth:k,children:s,className:W,defaultOpen:X,defaultValue:Y,disabled:fe,displayEmpty:Ie,error:je=!1,IconComponent:He,inputRef:Re,labelId:Ue,MenuProps:et={},multiple:vt,name:ot,onBlur:Ct,onChange:Dt,onClose:Vt,onFocus:hi,onOpen:Kt,open:Ei,readOnly:gi,renderValue:_i,required:an,SelectDisplayProps:yi={},tabIndex:Jt,type:Pi,value:Vi,variant:Ii="standard",...Hi}=h,[Ci,ti]=j2({controlled:Vi,default:Y,name:"Select"}),[tn,rr]=j2({controlled:Ei,default:X,name:"Select"}),Wn=it.useRef(null),Qn=it.useRef(null),[xi,Ai]=it.useState(null),{current:ji}=it.useRef(Ei!=null),[Br,zi]=it.useState(),Sr=Ep(_,Re),Rr=it.useCallback(fi=>{Qn.current=fi,fi&&Ai(fi)},[]),Zn=xi==null?void 0:xi.parentNode;it.useImperativeHandle(Sr,()=>({focus:()=>{Qn.current.focus()},node:Wn.current,value:Ci}),[Ci]),it.useEffect(()=>{X&&tn&&xi&&!ji&&(zi(k?null:Zn.clientWidth),Qn.current.focus())},[xi,k]),it.useEffect(()=>{O&&Qn.current.focus()},[O]),it.useEffect(()=>{if(!Ue)return;const fi=US(Qn.current).getElementById(Ue);if(fi){const Mn=()=>{getSelection().isCollapsed&&Qn.current.focus()};return fi.addEventListener("click",Mn),()=>{fi.removeEventListener("click",Mn)}}},[Ue]);const Ui=(fi,Mn)=>{fi?Kt&&Kt(Mn):Vt&&Vt(Mn),ji||(zi(k?null:Zn.clientWidth),rr(fi))},Un=fi=>{fi.button===0&&(fi.preventDefault(),Qn.current.focus(),Ui(!0,fi))},lr=fi=>{Ui(!1,fi)},Kn=it.Children.toArray(s),er=fi=>{const Mn=Kn.find(cr=>cr.props.value===fi.target.value);Mn!==void 0&&(ti(Mn.props.value),Dt&&Dt(fi,Mn))},sr=fi=>Mn=>{let cr;if(Mn.currentTarget.hasAttribute("tabindex")){if(vt){cr=Array.isArray(Ci)?Ci.slice():[];const Xi=Ci.indexOf(fi.props.value);Xi===-1?cr.push(fi.props.value):cr.splice(Xi,1)}else cr=fi.props.value;if(fi.props.onClick&&fi.props.onClick(Mn),Ci!==cr&&(ti(cr),Dt)){const Xi=Mn.nativeEvent||Mn,Kr=new Xi.constructor(Xi.type,Xi);Object.defineProperty(Kr,"target",{writable:!0,value:{value:cr,name:ot}}),Dt(Kr,fi)}vt||Ui(!1,Mn)}},tr=fi=>{gi||[" ","ArrowUp","ArrowDown","Enter"].includes(fi.key)&&(fi.preventDefault(),Ui(!0,fi))},dr=xi!==null&&tn,Dr=fi=>{!dr&&Ct&&(Object.defineProperty(fi,"target",{writable:!0,value:{value:Ci,name:ot}}),Ct(fi))};delete Hi["aria-invalid"];let fr,Nr;const Sn=[];let vr=!1;(t_({value:Ci})||Ie)&&(_i?fr=_i(Ci):vr=!0);const js=Kn.map(fi=>{if(!it.isValidElement(fi))return null;let Mn;if(vt){if(!Array.isArray(Ci))throw new Error(VS(2));Mn=Ci.some(cr=>K2(cr,fi.props.value)),Mn&&vr&&Sn.push(fi.props.children)}else Mn=K2(Ci,fi.props.value),Mn&&vr&&(Nr=fi.props.children);return it.cloneElement(fi,{"aria-selected":Mn?"true":"false",onClick:sr(fi),onKeyUp:cr=>{cr.key===" "&&cr.preventDefault(),fi.props.onKeyUp&&fi.props.onKeyUp(cr)},role:"option",selected:Mn,value:void 0,"data-value":fi.props.value})});vr&&(vt?Sn.length===0?fr=null:fr=Sn.reduce((fi,Mn,cr)=>(fi.push(Mn),cr<Sn.length-1&&fi.push(", "),fi),[]):fr=Nr);let ws=Br;!k&&ji&&xi&&(ws=Zn.clientWidth);let Xr;typeof Jt<"u"?Xr=Jt:Xr=fe?null:0;const Vr=yi.id||(ot?`mui-component-select-${ot}`:void 0),jr={...h,variant:Ii,value:Ci,open:dr,error:je},Qi=jD(jr),rs={...et.PaperProps,...(us=et.slotProps)==null?void 0:us.paper},cs=U0();return Ae.jsxs(it.Fragment,{children:[Ae.jsx(FD,{as:"div",ref:Rr,tabIndex:Xr,role:"combobox","aria-controls":dr?cs:void 0,"aria-disabled":fe?"true":void 0,"aria-expanded":dr?"true":"false","aria-haspopup":"listbox","aria-label":M,"aria-labelledby":[Ue,Vr].filter(Boolean).join(" ")||void 0,"aria-describedby":w,"aria-required":an?"true":void 0,"aria-invalid":je?"true":void 0,onKeyDown:tr,onMouseDown:fe||gi?null:Un,onBlur:Dr,onFocus:hi,...yi,ownerState:jr,className:Tr(yi.className,Qi.select,W),id:Vr,children:VD(fr)?X2||(X2=Ae.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):fr}),Ae.jsx(ND,{"aria-invalid":je,value:Array.isArray(Ci)?Ci.join(","):Ci,name:ot,ref:Wn,"aria-hidden":!0,onChange:er,tabIndex:-1,disabled:fe,className:Qi.nativeInput,autoFocus:O,required:an,...Hi,ownerState:jr}),Ae.jsx(BD,{as:He,className:Qi.icon,ownerState:jr}),Ae.jsx(pR,{id:`menu-${ot||""}`,anchorEl:Zn,open:dr,onClose:lr,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...et,slotProps:{...et.slotProps,list:{"aria-labelledby":Ue,role:"listbox","aria-multiselectable":vt?"true":void 0,disableListWrap:!0,id:cs,...et.MenuListProps},paper:{...rs,style:{minWidth:ws,...rs!=null?rs.style:null}}},children:js})]})}),$D=a=>{const{classes:h}=a,w=ns({root:["root"]},XS,h);return{...h,...w}},X0={name:"MuiSelect",slot:"Root",shouldForwardProp:a=>uc(a)&&a!=="variant"},GD=dn(q0,X0)(""),HD=dn(Z0,X0)(""),qD=dn(H0,X0)(""),KS=it.forwardRef(function(h,_){const w=Cs({name:"MuiSelect",props:h}),{autoWidth:M=!1,children:O,classes:k={},className:s,defaultOpen:W=!1,displayEmpty:X=!1,IconComponent:Y=LR,id:fe,input:Ie,inputProps:je,label:He,labelId:Re,MenuProps:Ue,multiple:et=!1,native:vt=!1,onClose:ot,onOpen:Ct,open:Dt,renderValue:Vt,SelectDisplayProps:hi,variant:Kt="outlined",...Ei}=w,gi=vt?MD:UD,_i=nd(),an=id({props:w,muiFormControl:_i,states:["variant","error"]}),yi=an.variant||Kt,Jt={...w,variant:yi,classes:k},Pi=$D(Jt),{root:Vi,...Ii}=Pi,Hi=Ie||{standard:Ae.jsx(GD,{ownerState:Jt}),outlined:Ae.jsx(HD,{label:He,ownerState:Jt}),filled:Ae.jsx(qD,{ownerState:Jt})}[yi],Ci=Ep(_,gR(Hi));return Ae.jsx(it.Fragment,{children:it.cloneElement(Hi,{inputComponent:gi,inputProps:{children:O,error:an.error,IconComponent:Y,variant:yi,type:void 0,multiple:et,...vt?{id:fe}:{autoWidth:M,defaultOpen:W,displayEmpty:X,labelId:Re,MenuProps:Ue,onClose:ot,onOpen:Ct,open:Dt,renderValue:Vt,SelectDisplayProps:{id:fe,...hi}},...je,classes:je?Wh(Ii,je.classes):Ii,...Ie?Ie.props.inputProps:{}},...(et&&vt||X)&&yi==="outlined"?{notched:!0}:{},ref:Ci,className:Tr(Hi.props.className,s,Pi.root),...!Ie&&{variant:yi},...Ei})})});KS.muiName="Select";function WD(a){return is("MuiTab",a)}const Do=ts("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper","icon"]),ZD=a=>{const{classes:h,textColor:_,fullWidth:w,wrapped:M,icon:O,label:k,selected:s,disabled:W}=a,X={root:["root",O&&k&&"labelIcon",`textColor${Fr(_)}`,w&&"fullWidth",M&&"wrapped",s&&"selected",W&&"disabled"],icon:["iconWrapper","icon"]};return ns(X,WD,h)},XD=dn($S,{name:"MuiTab",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,_.label&&_.icon&&h.labelIcon,h[`textColor${Fr(_.textColor)}`],_.fullWidth&&h.fullWidth,_.wrapped&&h.wrapped,{[`& .${Do.iconWrapper}`]:h.iconWrapper},{[`& .${Do.icon}`]:h.icon}]}})(bs(({theme:a})=>({...a.typography.button,maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center",lineHeight:1.25,variants:[{props:({ownerState:h})=>h.label&&(h.iconPosition==="top"||h.iconPosition==="bottom"),style:{flexDirection:"column"}},{props:({ownerState:h})=>h.label&&h.iconPosition!=="top"&&h.iconPosition!=="bottom",style:{flexDirection:"row"}},{props:({ownerState:h})=>h.icon&&h.label,style:{minHeight:72,paddingTop:9,paddingBottom:9}},{props:({ownerState:h,iconPosition:_})=>h.icon&&h.label&&_==="top",style:{[`& > .${Do.icon}`]:{marginBottom:6}}},{props:({ownerState:h,iconPosition:_})=>h.icon&&h.label&&_==="bottom",style:{[`& > .${Do.icon}`]:{marginTop:6}}},{props:({ownerState:h,iconPosition:_})=>h.icon&&h.label&&_==="start",style:{[`& > .${Do.icon}`]:{marginRight:a.spacing(1)}}},{props:({ownerState:h,iconPosition:_})=>h.icon&&h.label&&_==="end",style:{[`& > .${Do.icon}`]:{marginLeft:a.spacing(1)}}},{props:{textColor:"inherit"},style:{color:"inherit",opacity:.6,[`&.${Do.selected}`]:{opacity:1},[`&.${Do.disabled}`]:{opacity:(a.vars||a).palette.action.disabledOpacity}}},{props:{textColor:"primary"},style:{color:(a.vars||a).palette.text.secondary,[`&.${Do.selected}`]:{color:(a.vars||a).palette.primary.main},[`&.${Do.disabled}`]:{color:(a.vars||a).palette.text.disabled}}},{props:{textColor:"secondary"},style:{color:(a.vars||a).palette.text.secondary,[`&.${Do.selected}`]:{color:(a.vars||a).palette.secondary.main},[`&.${Do.disabled}`]:{color:(a.vars||a).palette.text.disabled}}},{props:({ownerState:h})=>h.fullWidth,style:{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"}},{props:({ownerState:h})=>h.wrapped,style:{fontSize:a.typography.pxToRem(12)}}]}))),KD=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiTab"}),{className:M,disabled:O=!1,disableFocusRipple:k=!1,fullWidth:s,icon:W,iconPosition:X="top",indicator:Y,label:fe,onChange:Ie,onClick:je,onFocus:He,selected:Re,selectionFollowsFocus:Ue,textColor:et="inherit",value:vt,wrapped:ot=!1,...Ct}=w,Dt={...w,disabled:O,disableFocusRipple:k,selected:Re,icon:!!W,iconPosition:X,label:!!fe,fullWidth:s,textColor:et,wrapped:ot},Vt=ZD(Dt),hi=W&&fe&&it.isValidElement(W)?it.cloneElement(W,{className:Tr(Vt.icon,W.props.className)}):W,Kt=gi=>{!Re&&Ie&&Ie(gi,vt),je&&je(gi)},Ei=gi=>{Ue&&!Re&&Ie&&Ie(gi,vt),He&&He(gi)};return Ae.jsxs(XD,{focusRipple:!k,className:Tr(Vt.root,M),ref:_,role:"tab","aria-selected":Re,disabled:O,onClick:Kt,onFocus:Ei,ownerState:Dt,tabIndex:Re?0:-1,...Ct,children:[X==="top"||X==="start"?Ae.jsxs(it.Fragment,{children:[hi,fe]}):Ae.jsxs(it.Fragment,{children:[fe,hi]}),Y]})}),YD=Ra(Ae.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"})),JD=Ra(Ae.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}));function QD(a){return(1+Math.sin(Math.PI*a-Math.PI/2))/2}function ez(a,h,_,w={},M=()=>{}){const{ease:O=QD,duration:k=300}=w;let s=null;const W=h[a];let X=!1;const Y=()=>{X=!0},fe=Ie=>{if(X){M(new Error("Animation cancelled"));return}s===null&&(s=Ie);const je=Math.min(1,(Ie-s)/k);if(h[a]=O(je)*(_-W)+W,je>=1){requestAnimationFrame(()=>{M(null)});return}requestAnimationFrame(fe)};return W===_?(M(new Error("Element already at target position")),Y):(requestAnimationFrame(fe),Y)}const tz={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function iz(a){const{onChange:h,..._}=a,w=it.useRef(),M=it.useRef(null),O=()=>{w.current=M.current.offsetHeight-M.current.clientHeight};return mp(()=>{const k=j0(()=>{const W=w.current;O(),W!==w.current&&h(w.current)}),s=Qg(M.current);return s.addEventListener("resize",k),()=>{k.clear(),s.removeEventListener("resize",k)}},[h]),it.useEffect(()=>{O(),h(w.current)},[h]),Ae.jsx("div",{style:tz,..._,ref:M})}function nz(a){return is("MuiTabScrollButton",a)}const rz=ts("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),sz=a=>{const{classes:h,orientation:_,disabled:w}=a;return ns({root:["root",_,w&&"disabled"]},nz,h)},oz=dn($S,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.root,_.orientation&&h[_.orientation]]}})({width:40,flexShrink:0,opacity:.8,[`&.${rz.disabled}`]:{opacity:0},variants:[{props:{orientation:"vertical"},style:{width:"100%",height:40,"& svg":{transform:"var(--TabScrollButton-svgRotate)"}}}]}),az=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiTabScrollButton"}),{className:M,slots:O={},slotProps:k={},direction:s,orientation:W,disabled:X,...Y}=w,fe=GS(),Ie={isRtl:fe,...w},je=sz(Ie),He=O.StartScrollButtonIcon??YD,Re=O.EndScrollButtonIcon??JD,Ue=e_({elementType:He,externalSlotProps:k.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:Ie}),et=e_({elementType:Re,externalSlotProps:k.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:Ie});return Ae.jsx(oz,{component:"div",className:Tr(je.root,M),ref:_,role:null,ownerState:Ie,tabIndex:null,...Y,style:{...Y.style,...W==="vertical"&&{"--TabScrollButton-svgRotate":`rotate(${fe?-90:90}deg)`}},children:s==="left"?Ae.jsx(He,{...Ue}):Ae.jsx(Re,{...et})})});function lz(a){return is("MuiTabs",a)}const $x=ts("MuiTabs",["root","vertical","list","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),Y2=(a,h)=>a===h?a.firstChild:h&&h.nextElementSibling?h.nextElementSibling:a.firstChild,J2=(a,h)=>a===h?a.lastChild:h&&h.previousElementSibling?h.previousElementSibling:a.lastChild,Bg=(a,h,_)=>{let w=!1,M=_(a,h);for(;M;){if(M===a.firstChild){if(w)return;w=!0}const O=M.disabled||M.getAttribute("aria-disabled")==="true";if(!M.hasAttribute("tabindex")||O)M=_(a,M);else{M.focus();return}}},cz=a=>{const{vertical:h,fixed:_,hideScrollbar:w,scrollableX:M,scrollableY:O,centered:k,scrollButtonsHideMobile:s,classes:W}=a;return ns({root:["root",h&&"vertical"],scroller:["scroller",_&&"fixed",w&&"hideScrollbar",M&&"scrollableX",O&&"scrollableY"],list:["list","flexContainer",h&&"flexContainerVertical",h&&"vertical",k&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",s&&"scrollButtonsHideMobile"],scrollableX:[M&&"scrollableX"],hideScrollbar:[w&&"hideScrollbar"]},lz,W)},uz=dn("div",{name:"MuiTabs",slot:"Root",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[{[`& .${$x.scrollButtons}`]:h.scrollButtons},{[`& .${$x.scrollButtons}`]:_.scrollButtonsHideMobile&&h.scrollButtonsHideMobile},h.root,_.vertical&&h.vertical]}})(bs(({theme:a})=>({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex",variants:[{props:({ownerState:h})=>h.vertical,style:{flexDirection:"column"}},{props:({ownerState:h})=>h.scrollButtonsHideMobile,style:{[`& .${$x.scrollButtons}`]:{[a.breakpoints.down("sm")]:{display:"none"}}}}]}))),hz=dn("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.scroller,_.fixed&&h.fixed,_.hideScrollbar&&h.hideScrollbar,_.scrollableX&&h.scrollableX,_.scrollableY&&h.scrollableY]}})({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap",variants:[{props:({ownerState:a})=>a.fixed,style:{overflowX:"hidden",width:"100%"}},{props:({ownerState:a})=>a.hideScrollbar,style:{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}},{props:({ownerState:a})=>a.scrollableX,style:{overflowX:"auto",overflowY:"hidden"}},{props:({ownerState:a})=>a.scrollableY,style:{overflowY:"auto",overflowX:"hidden"}}]}),dz=dn("div",{name:"MuiTabs",slot:"List",overridesResolver:(a,h)=>{const{ownerState:_}=a;return[h.list,h.flexContainer,_.vertical&&h.flexContainerVertical,_.centered&&h.centered]}})({display:"flex",variants:[{props:({ownerState:a})=>a.vertical,style:{flexDirection:"column"}},{props:({ownerState:a})=>a.centered,style:{justifyContent:"center"}}]}),fz=dn("span",{name:"MuiTabs",slot:"Indicator"})(bs(({theme:a})=>({position:"absolute",height:2,bottom:0,width:"100%",transition:a.transitions.create(),variants:[{props:{indicatorColor:"primary"},style:{backgroundColor:(a.vars||a).palette.primary.main}},{props:{indicatorColor:"secondary"},style:{backgroundColor:(a.vars||a).palette.secondary.main}},{props:({ownerState:h})=>h.vertical,style:{height:"100%",width:2,right:0}}]}))),pz=dn(iz)({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Q2={},mz=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiTabs"}),M=jS(),O=GS(),{"aria-label":k,"aria-labelledby":s,action:W,centered:X=!1,children:Y,className:fe,component:Ie="div",allowScrollButtonsMobile:je=!1,indicatorColor:He="primary",onChange:Re,orientation:Ue="horizontal",ScrollButtonComponent:et,scrollButtons:vt="auto",selectionFollowsFocus:ot,slots:Ct={},slotProps:Dt={},TabIndicatorProps:Vt={},TabScrollButtonProps:hi={},textColor:Kt="primary",value:Ei,variant:gi="standard",visibleScrollbar:_i=!1,...an}=w,yi=gi==="scrollable",Jt=Ue==="vertical",Pi=Jt?"scrollTop":"scrollLeft",Vi=Jt?"top":"left",Ii=Jt?"bottom":"right",Hi=Jt?"clientHeight":"clientWidth",Ci=Jt?"height":"width",ti={...w,component:Ie,allowScrollButtonsMobile:je,indicatorColor:He,orientation:Ue,vertical:Jt,scrollButtons:vt,textColor:Kt,variant:gi,visibleScrollbar:_i,fixed:!yi,hideScrollbar:yi&&!_i,scrollableX:yi&&!Jt,scrollableY:yi&&Jt,centered:X&&!yi,scrollButtonsHideMobile:!je},tn=cz(ti),rr=e_({elementType:Ct.StartScrollButtonIcon,externalSlotProps:Dt.startScrollButtonIcon,ownerState:ti}),Wn=e_({elementType:Ct.EndScrollButtonIcon,externalSlotProps:Dt.endScrollButtonIcon,ownerState:ti}),[Qn,xi]=it.useState(!1),[Ai,ji]=it.useState(Q2),[Br,zi]=it.useState(!1),[Sr,Rr]=it.useState(!1),[Zn,Ui]=it.useState(!1),[Un,lr]=it.useState({overflow:"hidden",scrollbarWidth:0}),Kn=new Map,er=it.useRef(null),sr=it.useRef(null),tr={slots:Ct,slotProps:{indicator:Vt,scrollButton:hi,...Dt}},dr=()=>{const B=er.current;let q;if(B){const he=B.getBoundingClientRect();q={clientWidth:B.clientWidth,scrollLeft:B.scrollLeft,scrollTop:B.scrollTop,scrollWidth:B.scrollWidth,top:he.top,bottom:he.bottom,left:he.left,right:he.right}}let ie;if(B&&Ei!==!1){const he=sr.current.children;if(he.length>0){const de=he[Kn.get(Ei)];ie=de?de.getBoundingClientRect():null}}return{tabsMeta:q,tabMeta:ie}},Dr=Gg(()=>{const{tabsMeta:B,tabMeta:q}=dr();let ie=0,he;Jt?(he="top",q&&B&&(ie=q.top-B.top+B.scrollTop)):(he=O?"right":"left",q&&B&&(ie=(O?-1:1)*(q[he]-B[he]+B.scrollLeft)));const de={[he]:ie,[Ci]:q?q[Ci]:0};if(typeof Ai[he]!="number"||typeof Ai[Ci]!="number")ji(de);else{const ye=Math.abs(Ai[he]-de[he]),ve=Math.abs(Ai[Ci]-de[Ci]);(ye>=1||ve>=1)&&ji(de)}}),fr=(B,{animation:q=!0}={})=>{q?ez(Pi,er.current,B,{duration:M.transitions.duration.standard}):er.current[Pi]=B},Nr=B=>{let q=er.current[Pi];Jt?q+=B:q+=B*(O?-1:1),fr(q)},Sn=()=>{const B=er.current[Hi];let q=0;const ie=Array.from(sr.current.children);for(let he=0;he<ie.length;he+=1){const de=ie[he];if(q+de[Hi]>B){he===0&&(q=B);break}q+=de[Hi]}return q},vr=()=>{Nr(-1*Sn())},js=()=>{Nr(Sn())},[ws,{onChange:Xr,...Vr}]=xs("scrollbar",{className:Tr(tn.scrollableX,tn.hideScrollbar),elementType:pz,shouldForwardComponentProp:!0,externalForwardedProps:tr,ownerState:ti}),jr=it.useCallback(B=>{Xr==null||Xr(B),lr({overflow:null,scrollbarWidth:B})},[Xr]),[Qi,rs]=xs("scrollButtons",{className:Tr(tn.scrollButtons,hi.className),elementType:az,externalForwardedProps:tr,ownerState:ti,additionalProps:{orientation:Ue,slots:{StartScrollButtonIcon:Ct.startScrollButtonIcon||Ct.StartScrollButtonIcon,EndScrollButtonIcon:Ct.endScrollButtonIcon||Ct.EndScrollButtonIcon},slotProps:{startScrollButtonIcon:rr,endScrollButtonIcon:Wn}}}),cs=()=>{const B={};B.scrollbarSizeListener=yi?Ae.jsx(ws,{...Vr,onChange:jr}):null;const ie=yi&&(vt==="auto"&&(Br||Sr)||vt===!0);return B.scrollButtonStart=ie?Ae.jsx(Qi,{direction:O?"right":"left",onClick:vr,disabled:!Br,...rs}):null,B.scrollButtonEnd=ie?Ae.jsx(Qi,{direction:O?"left":"right",onClick:js,disabled:!Sr,...rs}):null,B},us=Gg(B=>{const{tabsMeta:q,tabMeta:ie}=dr();if(!(!ie||!q)){if(ie[Vi]<q[Vi]){const he=q[Pi]+(ie[Vi]-q[Vi]);fr(he,{animation:B})}else if(ie[Ii]>q[Ii]){const he=q[Pi]+(ie[Ii]-q[Ii]);fr(he,{animation:B})}}}),fi=Gg(()=>{yi&&vt!==!1&&Ui(!Zn)});it.useEffect(()=>{const B=j0(()=>{er.current&&Dr()});let q;const ie=ye=>{ye.forEach(ve=>{ve.removedNodes.forEach(be=>{q==null||q.unobserve(be)}),ve.addedNodes.forEach(be=>{q==null||q.observe(be)})}),B(),fi()},he=Qg(er.current);he.addEventListener("resize",B);let de;return typeof ResizeObserver<"u"&&(q=new ResizeObserver(B),Array.from(sr.current.children).forEach(ye=>{q.observe(ye)})),typeof MutationObserver<"u"&&(de=new MutationObserver(ie),de.observe(sr.current,{childList:!0})),()=>{B.clear(),he.removeEventListener("resize",B),de==null||de.disconnect(),q==null||q.disconnect()}},[Dr,fi]),it.useEffect(()=>{const B=Array.from(sr.current.children),q=B.length;if(typeof IntersectionObserver<"u"&&q>0&&yi&&vt!==!1){const ie=B[0],he=B[q-1],de={root:er.current,threshold:.99},ye=Ge=>{zi(!Ge[0].isIntersecting)},ve=new IntersectionObserver(ye,de);ve.observe(ie);const be=Ge=>{Rr(!Ge[0].isIntersecting)},De=new IntersectionObserver(be,de);return De.observe(he),()=>{ve.disconnect(),De.disconnect()}}},[yi,vt,Zn,Y==null?void 0:Y.length]),it.useEffect(()=>{xi(!0)},[]),it.useEffect(()=>{Dr()}),it.useEffect(()=>{us(Q2!==Ai)},[us,Ai]),it.useImperativeHandle(W,()=>({updateIndicator:Dr,updateScrollButtons:fi}),[Dr,fi]);const[Mn,cr]=xs("indicator",{className:Tr(tn.indicator,Vt.className),elementType:fz,externalForwardedProps:tr,ownerState:ti,additionalProps:{style:Ai}}),Xi=Ae.jsx(Mn,{...cr});let Kr=0;const ta=it.Children.map(Y,B=>{if(!it.isValidElement(B))return null;const q=B.props.value===void 0?Kr:B.props.value;Kn.set(q,Kr);const ie=q===Ei;return Kr+=1,it.cloneElement(B,{fullWidth:gi==="fullWidth",indicator:ie&&!Qn&&Xi,selected:ie,selectionFollowsFocus:ot,onChange:Re,textColor:Kt,value:q,...Kr===1&&Ei===!1&&!B.props.tabIndex?{tabIndex:0}:{}})}),Ms=B=>{if(B.altKey||B.shiftKey||B.ctrlKey||B.metaKey)return;const q=sr.current,ie=US(q).activeElement;if(ie.getAttribute("role")!=="tab")return;let de=Ue==="horizontal"?"ArrowLeft":"ArrowUp",ye=Ue==="horizontal"?"ArrowRight":"ArrowDown";switch(Ue==="horizontal"&&O&&(de="ArrowRight",ye="ArrowLeft"),B.key){case de:B.preventDefault(),Bg(q,ie,J2);break;case ye:B.preventDefault(),Bg(q,ie,Y2);break;case"Home":B.preventDefault(),Bg(q,null,Y2);break;case"End":B.preventDefault(),Bg(q,null,J2);break}},Fo=cs(),[dl,Da]=xs("root",{ref:_,className:Tr(tn.root,fe),elementType:uz,externalForwardedProps:{...tr,...an,component:Ie},ownerState:ti}),[dt,ao]=xs("scroller",{ref:er,className:tn.scroller,elementType:hz,externalForwardedProps:tr,ownerState:ti,additionalProps:{style:{overflow:Un.overflow,[Jt?`margin${O?"Left":"Right"}`:"marginBottom"]:_i?void 0:-Un.scrollbarWidth}}}),[fl,Ne]=xs("list",{ref:sr,className:Tr(tn.list,tn.flexContainer),elementType:dz,externalForwardedProps:tr,ownerState:ti,getSlotProps:B=>({...B,onKeyDown:q=>{var ie;Ms(q),(ie=B.onKeyDown)==null||ie.call(B,q)}})});return Ae.jsxs(dl,{...Da,children:[Fo.scrollButtonStart,Fo.scrollbarSizeListener,Ae.jsxs(dt,{...ao,children:[Ae.jsx(fl,{"aria-label":k,"aria-labelledby":s,"aria-orientation":Ue==="vertical"?"vertical":null,role:"tablist",...Ne,children:ta}),Qn&&Xi]}),Fo.scrollButtonEnd]})});function gz(a){return is("MuiTextField",a)}ts("MuiTextField",["root"]);const _z={standard:q0,filled:H0,outlined:Z0},yz=a=>{const{classes:h}=a;return ns({root:["root"]},gz,h)},xz=dn(lD,{name:"MuiTextField",slot:"Root"})({}),sp=it.forwardRef(function(h,_){const w=Cs({props:h,name:"MuiTextField"}),{autoComplete:M,autoFocus:O=!1,children:k,className:s,color:W="primary",defaultValue:X,disabled:Y=!1,error:fe=!1,FormHelperTextProps:Ie,fullWidth:je=!1,helperText:He,id:Re,InputLabelProps:Ue,inputProps:et,InputProps:vt,inputRef:ot,label:Ct,maxRows:Dt,minRows:Vt,multiline:hi=!1,name:Kt,onBlur:Ei,onChange:gi,onFocus:_i,placeholder:an,required:yi=!1,rows:Jt,select:Pi=!1,SelectProps:Vi,slots:Ii={},slotProps:Hi={},type:Ci,value:ti,variant:tn="outlined",...rr}=w,Wn={...w,autoFocus:O,color:W,disabled:Y,error:fe,fullWidth:je,multiline:hi,required:yi,select:Pi,variant:tn},Qn=yz(Wn),xi=U0(Re),Ai=He&&xi?`${xi}-helper-text`:void 0,ji=Ct&&xi?`${xi}-label`:void 0,Br=_z[tn],zi={slots:Ii,slotProps:{input:vt,inputLabel:Ue,htmlInput:et,formHelperText:Ie,select:Vi,...Hi}},Sr={},Rr=zi.slotProps.inputLabel;tn==="outlined"&&(Rr&&typeof Rr.shrink<"u"&&(Sr.notched=Rr.shrink),Sr.label=Ct),Pi&&((!Vi||!Vi.native)&&(Sr.id=void 0),Sr["aria-describedby"]=void 0);const[Zn,Ui]=xs("root",{elementType:xz,shouldForwardComponentProp:!0,externalForwardedProps:{...zi,...rr},ownerState:Wn,className:Tr(Qn.root,s),ref:_,additionalProps:{disabled:Y,error:fe,fullWidth:je,required:yi,color:W,variant:tn}}),[Un,lr]=xs("input",{elementType:Br,externalForwardedProps:zi,additionalProps:Sr,ownerState:Wn}),[Kn,er]=xs("inputLabel",{elementType:SD,externalForwardedProps:zi,ownerState:Wn}),[sr,tr]=xs("htmlInput",{elementType:"input",externalForwardedProps:zi,ownerState:Wn}),[dr,Dr]=xs("formHelperText",{elementType:dD,externalForwardedProps:zi,ownerState:Wn}),[fr,Nr]=xs("select",{elementType:KS,externalForwardedProps:zi,ownerState:Wn}),Sn=Ae.jsx(Un,{"aria-describedby":Ai,autoComplete:M,autoFocus:O,defaultValue:X,fullWidth:je,multiline:hi,name:Kt,rows:Jt,maxRows:Dt,minRows:Vt,type:Ci,value:ti,id:xi,inputRef:ot,onBlur:Ei,onChange:gi,onFocus:_i,placeholder:an,inputProps:tr,slots:{input:Ii.htmlInput?sr:void 0},...lr});return Ae.jsxs(Zn,{...Ui,children:[Ct!=null&&Ct!==""&&Ae.jsx(Kn,{htmlFor:xi,id:ji,...er,children:Ct}),Pi?Ae.jsx(fr,{"aria-describedby":Ai,id:xi,labelId:ji,value:ti,input:Sn,...Nr,children:k}):Sn,He&&Ae.jsx(dr,{id:Ai,...Dr,children:He})]})});function vz(a){return is("MuiMasonry",a)}ts("MuiMasonry",["root"]);const sc=a=>Number(a.replace("px","")),bz={flexBasis:"100%",width:0,margin:0,padding:0},wz=a=>{const{classes:h}=a;return ns({root:["root"]},vz,h)},Tz=({ownerState:a,theme:h})=>{let _={width:"100%",display:"flex",flexFlow:"column wrap",alignContent:"flex-start",boxSizing:"border-box","& > *":{boxSizing:"border-box"}};const w={};if(a.isSSR){const X={},Y=sc(h.spacing(a.defaultSpacing));for(let fe=1;fe<=a.defaultColumns;fe+=1)X[`&:nth-of-type(${a.defaultColumns}n+${fe%a.defaultColumns})`]={order:fe};return w.height=a.defaultHeight,w.margin=-(Y/2),w["& > *"]={..._["& > *"],...X,margin:Y/2,width:`calc(${(100/a.defaultColumns).toFixed(2)}% - ${Y}px)`},{..._,...w}}const M=N2({values:a.spacing,breakpoints:h.breakpoints.values}),O=yR(h);_=Wh(_,Vx({theme:h},M,X=>{let Y;if(typeof X=="string"&&!Number.isNaN(Number(X))||typeof X=="number"){const fe=Number(X);Y=jx(O,fe)}else Y=X;return{margin:`calc(0px - (${Y} / 2))`,"& > *":{margin:`calc(${Y} / 2)`},...a.maxColumnHeight&&{height:typeof Y=="number"?Math.ceil(a.maxColumnHeight+sc(Y)):`calc(${a.maxColumnHeight}px + ${Y})`}}}));const s=N2({values:a.columns,breakpoints:h.breakpoints.values});return _=Wh(_,Vx({theme:h},s,X=>{const fe=`${(100/Number(X)).toFixed(2)}%`,Ie=typeof M=="string"&&!Number.isNaN(Number(M))||typeof M=="number"?jx(O,Number(M)):"0px";return{"& > *":{width:`calc(${fe} - ${Ie})`}}})),typeof M=="object"&&(_=Wh(_,Vx({theme:h},M,(X,Y)=>{if(Y){const fe=Number(X),Ie=Object.keys(s).pop(),je=jx(O,fe);return{"& > *":{width:`calc(${`${(100/(typeof s=="object"?s[Y]||s[Ie]:s)).toFixed(2)}%`} - ${je})`}}}return null}))),_},Sz=dn("div",{name:"MuiMasonry",slot:"Root"})(Tz),Ez=it.forwardRef(function(h,_){const w=SR({props:h,name:"MuiMasonry"}),{children:M,className:O,component:k="div",columns:s=4,spacing:W=1,sequential:X=!1,defaultColumns:Y,defaultHeight:fe,defaultSpacing:Ie,...je}=w,He=it.useRef(),[Re,Ue]=it.useState(),et=!Re&&fe&&Y!==void 0&&Ie!==void 0,[vt,ot]=it.useState(et?Y-1:0),Ct={...w,spacing:W,columns:s,maxColumnHeight:Re,defaultColumns:Y,defaultHeight:fe,defaultSpacing:Ie,isSSR:et},Dt=wz(Ct),Vt=it.useCallback(Ei=>{if(!He.current||!Ei||Ei.length===0)return;const gi=He.current,_i=He.current.firstChild,an=gi.clientWidth,yi=_i.clientWidth;if(an===0||yi===0)return;const Jt=window.getComputedStyle(_i),Pi=sc(Jt.marginLeft),Vi=sc(Jt.marginRight),Ii=Math.round(an/(yi+Pi+Vi)),Hi=new Array(Ii).fill(0);let Ci=!1,ti=1;gi.childNodes.forEach(tn=>{if(tn.nodeType!==Node.ELEMENT_NODE||tn.dataset.class==="line-break"||Ci)return;const rr=window.getComputedStyle(tn),Wn=sc(rr.marginTop),Qn=sc(rr.marginBottom),xi=sc(rr.height)?Math.ceil(sc(rr.height))+Wn+Qn:0;if(xi===0){Ci=!0;return}for(let Ai=0;Ai<tn.childNodes.length;Ai+=1){const ji=tn.childNodes[Ai];if(ji.tagName==="IMG"&&ji.clientHeight===0){Ci=!0;break}}if(!Ci)if(X)Hi[ti-1]+=xi,tn.style.order=ti,ti+=1,ti>Ii&&(ti=1);else{const Ai=Hi.indexOf(Math.min(...Hi));Hi[Ai]+=xi;const ji=Ai+1;tn.style.order=ji}}),Ci||_R.flushSync(()=>{Ue(Math.max(...Hi)),ot(Ii>0?Ii-1:0)})},[X]);mp(()=>{if(typeof ResizeObserver>"u")return;let Ei;const gi=new ResizeObserver(()=>{Ei=requestAnimationFrame(Vt)});return He.current&&He.current.childNodes.forEach(_i=>{gi.observe(_i)}),()=>{Ei&&cancelAnimationFrame(Ei),gi&&gi.disconnect()}},[s,W,M,Vt]);const hi=Ep(_,He),Kt=new Array(vt).fill("").map((Ei,gi)=>Ae.jsx("span",{"data-class":"line-break",style:{...bz,order:gi+1}},gi));return Ae.jsxs(Sz,{as:k,className:Tr(Dt.root,O),ref:hi,ownerState:Ct,...je,children:[M,Kt]})});/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/function YS(a,h,_){if(typeof a=="function"?a===h:a.has(h))return arguments.length<3?h:_;throw new TypeError("Private element is not present on this object")}function Az(a,h){if(h.has(a))throw new TypeError("Cannot initialize the same private elements twice on an object")}function eT(a,h){return a.get(YS(a,h))}function Iz(a,h,_){Az(a,h),h.set(a,_)}function Cz(a,h,_){return a.set(YS(a,h),_),_}const Mz=100,Fi={},Pz=()=>{Fi.previousActiveElement instanceof HTMLElement?(Fi.previousActiveElement.focus(),Fi.previousActiveElement=null):document.body&&document.body.focus()},Rz=a=>new Promise(h=>{if(!a)return h();const _=window.scrollX,w=window.scrollY;Fi.restoreFocusTimeout=setTimeout(()=>{Pz(),h()},Mz),window.scrollTo(_,w)}),JS="swal2-",Dz=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"],yt=Dz.reduce((a,h)=>(a[h]=JS+h,a),{}),zz=["success","warning","info","question","error"],i_=zz.reduce((a,h)=>(a[h]=JS+h,a),{}),QS="SweetAlert2:",K0=a=>a.charAt(0).toUpperCase()+a.slice(1),Ws=a=>{console.warn(`${QS} ${typeof a=="object"?a.join(" "):a}`)},Su=a=>{console.error(`${QS} ${a}`)},tT=[],Lz=a=>{tT.includes(a)||(tT.push(a),Ws(a))},eE=(a,h=null)=>{Lz(`"${a}" is deprecated and will be removed in the next major release.${h?` Use "${h}" instead.`:""}`)},E_=a=>typeof a=="function"?a():a,Y0=a=>a&&typeof a.toPromise=="function",Ap=a=>Y0(a)?a.toPromise():Promise.resolve(a),J0=a=>a&&Promise.resolve(a)===a,Zs=()=>document.body.querySelector(`.${yt.container}`),Ip=a=>{const h=Zs();return h?h.querySelector(a):null},wo=a=>Ip(`.${a}`),qn=()=>wo(yt.popup),rd=()=>wo(yt.icon),kz=()=>wo(yt["icon-content"]),tE=()=>wo(yt.title),Q0=()=>wo(yt["html-container"]),iE=()=>wo(yt.image),ev=()=>wo(yt["progress-steps"]),A_=()=>wo(yt["validation-message"]),Pa=()=>Ip(`.${yt.actions} .${yt.confirm}`),sd=()=>Ip(`.${yt.actions} .${yt.cancel}`),Eu=()=>Ip(`.${yt.actions} .${yt.deny}`),Oz=()=>wo(yt["input-label"]),od=()=>Ip(`.${yt.loader}`),Cp=()=>wo(yt.actions),nE=()=>wo(yt.footer),I_=()=>wo(yt["timer-progress-bar"]),tv=()=>wo(yt.close),Fz=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,iv=()=>{const a=qn();if(!a)return[];const h=a.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),_=Array.from(h).sort((O,k)=>{const s=parseInt(O.getAttribute("tabindex")||"0"),W=parseInt(k.getAttribute("tabindex")||"0");return s>W?1:s<W?-1:0}),w=a.querySelectorAll(Fz),M=Array.from(w).filter(O=>O.getAttribute("tabindex")!=="-1");return[...new Set(_.concat(M))].filter(O=>ro(O))},nv=()=>ll(document.body,yt.shown)&&!ll(document.body,yt["toast-shown"])&&!ll(document.body,yt["no-backdrop"]),C_=()=>{const a=qn();return a?ll(a,yt.toast):!1},Bz=()=>{const a=qn();return a?a.hasAttribute("data-loading"):!1},To=(a,h)=>{if(a.textContent="",h){const w=new DOMParser().parseFromString(h,"text/html"),M=w.querySelector("head");M&&Array.from(M.childNodes).forEach(k=>{a.appendChild(k)});const O=w.querySelector("body");O&&Array.from(O.childNodes).forEach(k=>{k instanceof HTMLVideoElement||k instanceof HTMLAudioElement?a.appendChild(k.cloneNode(!0)):a.appendChild(k)})}},ll=(a,h)=>{if(!h)return!1;const _=h.split(/\s+/);for(let w=0;w<_.length;w++)if(!a.classList.contains(_[w]))return!1;return!0},Nz=(a,h)=>{Array.from(a.classList).forEach(_=>{!Object.values(yt).includes(_)&&!Object.values(i_).includes(_)&&!Object.values(h.showClass||{}).includes(_)&&a.classList.remove(_)})},bo=(a,h,_)=>{if(Nz(a,h),!h.customClass)return;const w=h.customClass[_];if(w){if(typeof w!="string"&&!w.forEach){Ws(`Invalid type of customClass.${_}! Expected string or iterable object, got "${typeof w}"`);return}Xn(a,w)}},M_=(a,h)=>{if(!h)return null;switch(h){case"select":case"textarea":case"file":return a.querySelector(`.${yt.popup} > .${yt[h]}`);case"checkbox":return a.querySelector(`.${yt.popup} > .${yt.checkbox} input`);case"radio":return a.querySelector(`.${yt.popup} > .${yt.radio} input:checked`)||a.querySelector(`.${yt.popup} > .${yt.radio} input:first-child`);case"range":return a.querySelector(`.${yt.popup} > .${yt.range} input`);default:return a.querySelector(`.${yt.popup} > .${yt.input}`)}},rE=a=>{if(a.focus(),a.type!=="file"){const h=a.value;a.value="",a.value=h}},sE=(a,h,_)=>{!a||!h||(typeof h=="string"&&(h=h.split(/\s+/).filter(Boolean)),h.forEach(w=>{Array.isArray(a)?a.forEach(M=>{_?M.classList.add(w):M.classList.remove(w)}):_?a.classList.add(w):a.classList.remove(w)}))},Xn=(a,h)=>{sE(a,h,!0)},Oo=(a,h)=>{sE(a,h,!1)},oc=(a,h)=>{const _=Array.from(a.children);for(let w=0;w<_.length;w++){const M=_[w];if(M instanceof HTMLElement&&ll(M,h))return M}},_u=(a,h,_)=>{_===`${parseInt(_)}`&&(_=parseInt(_)),_||parseInt(_)===0?a.style.setProperty(h,typeof _=="number"?`${_}px`:_):a.style.removeProperty(h)},vs=(a,h="flex")=>{a&&(a.style.display=h)},Vs=a=>{a&&(a.style.display="none")},rv=(a,h="block")=>{a&&new MutationObserver(()=>{Mp(a,a.innerHTML,h)}).observe(a,{childList:!0,subtree:!0})},iT=(a,h,_,w)=>{const M=a.querySelector(h);M&&M.style.setProperty(_,w)},Mp=(a,h,_="flex")=>{h?vs(a,_):Vs(a)},ro=a=>!!(a&&(a.offsetWidth||a.offsetHeight||a.getClientRects().length)),Vz=()=>!ro(Pa())&&!ro(Eu())&&!ro(sd()),d0=a=>a.scrollHeight>a.clientHeight,jz=(a,h)=>{let _=a;for(;_&&_!==h;){if(d0(_))return!0;_=_.parentElement}return!1},oE=a=>{const h=window.getComputedStyle(a),_=parseFloat(h.getPropertyValue("animation-duration")||"0"),w=parseFloat(h.getPropertyValue("transition-duration")||"0");return _>0||w>0},sv=(a,h=!1)=>{const _=I_();_&&ro(_)&&(h&&(_.style.transition="none",_.style.width="100%"),setTimeout(()=>{_.style.transition=`width ${a/1e3}s linear`,_.style.width="0%"},10))},Uz=()=>{const a=I_();if(!a)return;const h=parseInt(window.getComputedStyle(a).width);a.style.removeProperty("transition"),a.style.width="100%";const _=parseInt(window.getComputedStyle(a).width),w=h/_*100;a.style.width=`${w}%`},$z=()=>typeof window>"u"||typeof document>"u",Gz=`
 <div aria-labelledby="${yt.title}" aria-describedby="${yt["html-container"]}" class="${yt.popup}" tabindex="-1">
   <button type="button" class="${yt.close}"></button>
   <ul class="${yt["progress-steps"]}"></ul>
   <div class="${yt.icon}"></div>
   <img class="${yt.image}" />
   <h2 class="${yt.title}" id="${yt.title}"></h2>
   <div class="${yt["html-container"]}" id="${yt["html-container"]}"></div>
   <input class="${yt.input}" id="${yt.input}" />
   <input type="file" class="${yt.file}" />
   <div class="${yt.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${yt.select}" id="${yt.select}"></select>
   <div class="${yt.radio}"></div>
   <label class="${yt.checkbox}">
     <input type="checkbox" id="${yt.checkbox}" />
     <span class="${yt.label}"></span>
   </label>
   <textarea class="${yt.textarea}" id="${yt.textarea}"></textarea>
   <div class="${yt["validation-message"]}" id="${yt["validation-message"]}"></div>
   <div class="${yt.actions}">
     <div class="${yt.loader}"></div>
     <button type="button" class="${yt.confirm}"></button>
     <button type="button" class="${yt.deny}"></button>
     <button type="button" class="${yt.cancel}"></button>
   </div>
   <div class="${yt.footer}"></div>
   <div class="${yt["timer-progress-bar-container"]}">
     <div class="${yt["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),Hz=()=>{const a=Zs();return a?(a.remove(),Oo([document.documentElement,document.body],[yt["no-backdrop"],yt["toast-shown"],yt["has-column"]]),!0):!1},hu=()=>{Fi.currentInstance.resetValidationMessage()},qz=()=>{const a=qn(),h=oc(a,yt.input),_=oc(a,yt.file),w=a.querySelector(`.${yt.range} input`),M=a.querySelector(`.${yt.range} output`),O=oc(a,yt.select),k=a.querySelector(`.${yt.checkbox} input`),s=oc(a,yt.textarea);h.oninput=hu,_.onchange=hu,O.onchange=hu,k.onchange=hu,s.oninput=hu,w.oninput=()=>{hu(),M.value=w.value},w.onchange=()=>{hu(),M.value=w.value}},Wz=a=>typeof a=="string"?document.querySelector(a):a,Zz=a=>{const h=qn();h.setAttribute("role",a.toast?"alert":"dialog"),h.setAttribute("aria-live",a.toast?"polite":"assertive"),a.toast||h.setAttribute("aria-modal","true")},Xz=a=>{window.getComputedStyle(a).direction==="rtl"&&Xn(Zs(),yt.rtl)},Kz=a=>{const h=Hz();if($z()){Su("SweetAlert2 requires document to initialize");return}const _=document.createElement("div");_.className=yt.container,h&&Xn(_,yt["no-transition"]),To(_,Gz),_.dataset.swal2Theme=a.theme;const w=Wz(a.target);w.appendChild(_),a.topLayer&&(_.setAttribute("popover",""),_.showPopover()),Zz(a),Xz(w),qz()},ov=(a,h)=>{a instanceof HTMLElement?h.appendChild(a):typeof a=="object"?Yz(a,h):a&&To(h,a)},Yz=(a,h)=>{a.jquery?Jz(h,a):To(h,a.toString())},Jz=(a,h)=>{if(a.textContent="",0 in h)for(let _=0;_ in h;_++)a.appendChild(h[_].cloneNode(!0));else a.appendChild(h.cloneNode(!0))},Qz=(a,h)=>{const _=Cp(),w=od();!_||!w||(!h.showConfirmButton&&!h.showDenyButton&&!h.showCancelButton?Vs(_):vs(_),bo(_,h,"actions"),eL(_,w,h),To(w,h.loaderHtml||""),bo(w,h,"loader"))};function eL(a,h,_){const w=Pa(),M=Eu(),O=sd();!w||!M||!O||(Hx(w,"confirm",_),Hx(M,"deny",_),Hx(O,"cancel",_),tL(w,M,O,_),_.reverseButtons&&(_.toast?(a.insertBefore(O,w),a.insertBefore(M,w)):(a.insertBefore(O,h),a.insertBefore(M,h),a.insertBefore(w,h))))}function tL(a,h,_,w){if(!w.buttonsStyling){Oo([a,h,_],yt.styled);return}Xn([a,h,_],yt.styled),w.confirmButtonColor&&a.style.setProperty("--swal2-confirm-button-background-color",w.confirmButtonColor),w.denyButtonColor&&h.style.setProperty("--swal2-deny-button-background-color",w.denyButtonColor),w.cancelButtonColor&&_.style.setProperty("--swal2-cancel-button-background-color",w.cancelButtonColor),Gx(a),Gx(h),Gx(_)}function Gx(a){const h=window.getComputedStyle(a);if(h.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const _=h.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");a.style.setProperty("--swal2-action-button-focus-box-shadow",h.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${_}`))}function Hx(a,h,_){const w=K0(h);Mp(a,_[`show${w}Button`],"inline-block"),To(a,_[`${h}ButtonText`]||""),a.setAttribute("aria-label",_[`${h}ButtonAriaLabel`]||""),a.className=yt[h],bo(a,_,`${h}Button`)}const iL=(a,h)=>{const _=tv();_&&(To(_,h.closeButtonHtml||""),bo(_,h,"closeButton"),Mp(_,h.showCloseButton),_.setAttribute("aria-label",h.closeButtonAriaLabel||""))},nL=(a,h)=>{const _=Zs();_&&(rL(_,h.backdrop),sL(_,h.position),oL(_,h.grow),bo(_,h,"container"))};function rL(a,h){typeof h=="string"?a.style.background=h:h||Xn([document.documentElement,document.body],yt["no-backdrop"])}function sL(a,h){h&&(h in yt?Xn(a,yt[h]):(Ws('The "position" parameter is not valid, defaulting to "center"'),Xn(a,yt.center)))}function oL(a,h){h&&Xn(a,yt[`grow-${h}`])}var yr={innerParams:new WeakMap,domCache:new WeakMap};const aL=["input","file","range","select","radio","checkbox","textarea"],lL=(a,h)=>{const _=qn();if(!_)return;const w=yr.innerParams.get(a),M=!w||h.input!==w.input;aL.forEach(O=>{const k=oc(_,yt[O]);k&&(hL(O,h.inputAttributes),k.className=yt[O],M&&Vs(k))}),h.input&&(M&&cL(h),dL(h))},cL=a=>{if(!a.input)return;if(!qr[a.input]){Su(`Unexpected type of input! Expected ${Object.keys(qr).join(" | ")}, got "${a.input}"`);return}const h=aE(a.input);if(!h)return;const _=qr[a.input](h,a);vs(h),a.inputAutoFocus&&setTimeout(()=>{rE(_)})},uL=a=>{for(let h=0;h<a.attributes.length;h++){const _=a.attributes[h].name;["id","type","value","style"].includes(_)||a.removeAttribute(_)}},hL=(a,h)=>{const _=qn();if(!_)return;const w=M_(_,a);if(w){uL(w);for(const M in h)w.setAttribute(M,h[M])}},dL=a=>{if(!a.input)return;const h=aE(a.input);h&&bo(h,a,"input")},av=(a,h)=>{!a.placeholder&&h.inputPlaceholder&&(a.placeholder=h.inputPlaceholder)},Pp=(a,h,_)=>{if(_.inputLabel){const w=document.createElement("label"),M=yt["input-label"];w.setAttribute("for",a.id),w.className=M,typeof _.customClass=="object"&&Xn(w,_.customClass.inputLabel),w.innerText=_.inputLabel,h.insertAdjacentElement("beforebegin",w)}},aE=a=>{const h=qn();if(h)return oc(h,yt[a]||yt.input)},n_=(a,h)=>{["string","number"].includes(typeof h)?a.value=`${h}`:J0(h)||Ws(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof h}"`)},qr={};qr.text=qr.email=qr.password=qr.number=qr.tel=qr.url=qr.search=qr.date=qr["datetime-local"]=qr.time=qr.week=qr.month=(a,h)=>(n_(a,h.inputValue),Pp(a,a,h),av(a,h),a.type=h.input,a);qr.file=(a,h)=>(Pp(a,a,h),av(a,h),a);qr.range=(a,h)=>{const _=a.querySelector("input"),w=a.querySelector("output");return n_(_,h.inputValue),_.type=h.input,n_(w,h.inputValue),Pp(_,a,h),a};qr.select=(a,h)=>{if(a.textContent="",h.inputPlaceholder){const _=document.createElement("option");To(_,h.inputPlaceholder),_.value="",_.disabled=!0,_.selected=!0,a.appendChild(_)}return Pp(a,a,h),a};qr.radio=a=>(a.textContent="",a);qr.checkbox=(a,h)=>{const _=M_(qn(),"checkbox");_.value="1",_.checked=!!h.inputValue;const w=a.querySelector("span");return To(w,h.inputPlaceholder||h.inputLabel),_};qr.textarea=(a,h)=>{n_(a,h.inputValue),av(a,h),Pp(a,a,h);const _=w=>parseInt(window.getComputedStyle(w).marginLeft)+parseInt(window.getComputedStyle(w).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const w=parseInt(window.getComputedStyle(qn()).width),M=()=>{if(!document.body.contains(a))return;const O=a.offsetWidth+_(a);O>w?qn().style.width=`${O}px`:_u(qn(),"width",h.width)};new MutationObserver(M).observe(a,{attributes:!0,attributeFilter:["style"]})}}),a};const fL=(a,h)=>{const _=Q0();_&&(rv(_),bo(_,h,"htmlContainer"),h.html?(ov(h.html,_),vs(_,"block")):h.text?(_.textContent=h.text,vs(_,"block")):Vs(_),lL(a,h))},pL=(a,h)=>{const _=nE();_&&(rv(_),Mp(_,h.footer,"block"),h.footer&&ov(h.footer,_),bo(_,h,"footer"))},mL=(a,h)=>{const _=yr.innerParams.get(a),w=rd();if(!w)return;if(_&&h.icon===_.icon){rT(w,h),nT(w,h);return}if(!h.icon&&!h.iconHtml){Vs(w);return}if(h.icon&&Object.keys(i_).indexOf(h.icon)===-1){Su(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${h.icon}"`),Vs(w);return}vs(w),rT(w,h),nT(w,h),Xn(w,h.showClass&&h.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",lE)},nT=(a,h)=>{for(const[_,w]of Object.entries(i_))h.icon!==_&&Oo(a,w);Xn(a,h.icon&&i_[h.icon]),yL(a,h),lE(),bo(a,h,"icon")},lE=()=>{const a=qn();if(!a)return;const h=window.getComputedStyle(a).getPropertyValue("background-color"),_=a.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let w=0;w<_.length;w++)_[w].style.backgroundColor=h},gL=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,_L=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,rT=(a,h)=>{if(!h.icon&&!h.iconHtml)return;let _=a.innerHTML,w="";h.iconHtml?w=sT(h.iconHtml):h.icon==="success"?(w=gL,_=_.replace(/ style=".*?"/g,"")):h.icon==="error"?w=_L:h.icon&&(w=sT({question:"?",warning:"!",info:"i"}[h.icon])),_.trim()!==w.trim()&&To(a,w)},yL=(a,h)=>{if(h.iconColor){a.style.color=h.iconColor,a.style.borderColor=h.iconColor;for(const _ of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])iT(a,_,"background-color",h.iconColor);iT(a,".swal2-success-ring","border-color",h.iconColor)}},sT=a=>`<div class="${yt["icon-content"]}">${a}</div>`,xL=(a,h)=>{const _=iE();if(_){if(!h.imageUrl){Vs(_);return}vs(_,""),_.setAttribute("src",h.imageUrl),_.setAttribute("alt",h.imageAlt||""),_u(_,"width",h.imageWidth),_u(_,"height",h.imageHeight),_.className=yt.image,bo(_,h,"image")}};let lv=!1,cE=0,uE=0,hE=0,dE=0;const vL=a=>{a.addEventListener("mousedown",r_),document.body.addEventListener("mousemove",s_),a.addEventListener("mouseup",o_),a.addEventListener("touchstart",r_),document.body.addEventListener("touchmove",s_),a.addEventListener("touchend",o_)},bL=a=>{a.removeEventListener("mousedown",r_),document.body.removeEventListener("mousemove",s_),a.removeEventListener("mouseup",o_),a.removeEventListener("touchstart",r_),document.body.removeEventListener("touchmove",s_),a.removeEventListener("touchend",o_)},r_=a=>{const h=qn();if(a.target===h||rd().contains(a.target)){lv=!0;const _=fE(a);cE=_.clientX,uE=_.clientY,hE=parseInt(h.style.insetInlineStart)||0,dE=parseInt(h.style.insetBlockStart)||0,Xn(h,"swal2-dragging")}},s_=a=>{const h=qn();if(lv){let{clientX:_,clientY:w}=fE(a);h.style.insetInlineStart=`${hE+(_-cE)}px`,h.style.insetBlockStart=`${dE+(w-uE)}px`}},o_=()=>{const a=qn();lv=!1,Oo(a,"swal2-dragging")},fE=a=>{let h=0,_=0;return a.type.startsWith("mouse")?(h=a.clientX,_=a.clientY):a.type.startsWith("touch")&&(h=a.touches[0].clientX,_=a.touches[0].clientY),{clientX:h,clientY:_}},wL=(a,h)=>{const _=Zs(),w=qn();if(!(!_||!w)){if(h.toast){_u(_,"width",h.width),w.style.width="100%";const M=od();M&&w.insertBefore(M,rd())}else _u(w,"width",h.width);_u(w,"padding",h.padding),h.color&&(w.style.color=h.color),h.background&&(w.style.background=h.background),Vs(A_()),TL(w,h),h.draggable&&!h.toast?(Xn(w,yt.draggable),vL(w)):(Oo(w,yt.draggable),bL(w))}},TL=(a,h)=>{const _=h.showClass||{};a.className=`${yt.popup} ${ro(a)?_.popup:""}`,h.toast?(Xn([document.documentElement,document.body],yt["toast-shown"]),Xn(a,yt.toast)):Xn(a,yt.modal),bo(a,h,"popup"),typeof h.customClass=="string"&&Xn(a,h.customClass),h.icon&&Xn(a,yt[`icon-${h.icon}`])},SL=(a,h)=>{const _=ev();if(!_)return;const{progressSteps:w,currentProgressStep:M}=h;if(!w||w.length===0||M===void 0){Vs(_);return}vs(_),_.textContent="",M>=w.length&&Ws("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),w.forEach((O,k)=>{const s=EL(O);if(_.appendChild(s),k===M&&Xn(s,yt["active-progress-step"]),k!==w.length-1){const W=AL(h);_.appendChild(W)}})},EL=a=>{const h=document.createElement("li");return Xn(h,yt["progress-step"]),To(h,a),h},AL=a=>{const h=document.createElement("li");return Xn(h,yt["progress-step-line"]),a.progressStepsDistance&&_u(h,"width",a.progressStepsDistance),h},IL=(a,h)=>{const _=tE();_&&(rv(_),Mp(_,h.title||h.titleText,"block"),h.title&&ov(h.title,_),h.titleText&&(_.innerText=h.titleText),bo(_,h,"title"))},pE=(a,h)=>{wL(a,h),nL(a,h),SL(a,h),mL(a,h),xL(a,h),IL(a,h),iL(a,h),fL(a,h),Qz(a,h),pL(a,h);const _=qn();typeof h.didRender=="function"&&_&&h.didRender(_),Fi.eventEmitter.emit("didRender",_)},CL=()=>ro(qn()),mE=()=>{var a;return(a=Pa())===null||a===void 0?void 0:a.click()},ML=()=>{var a;return(a=Eu())===null||a===void 0?void 0:a.click()},PL=()=>{var a;return(a=sd())===null||a===void 0?void 0:a.click()},ad=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),gE=a=>{a.keydownTarget&&a.keydownHandlerAdded&&(a.keydownTarget.removeEventListener("keydown",a.keydownHandler,{capture:a.keydownListenerCapture}),a.keydownHandlerAdded=!1)},RL=(a,h,_)=>{gE(a),h.toast||(a.keydownHandler=w=>zL(h,w,_),a.keydownTarget=h.keydownListenerCapture?window:qn(),a.keydownListenerCapture=h.keydownListenerCapture,a.keydownTarget.addEventListener("keydown",a.keydownHandler,{capture:a.keydownListenerCapture}),a.keydownHandlerAdded=!0)},f0=(a,h)=>{var _;const w=iv();if(w.length){a=a+h,a===-2&&(a=w.length-1),a===w.length?a=0:a===-1&&(a=w.length-1),w[a].focus();return}(_=qn())===null||_===void 0||_.focus()},_E=["ArrowRight","ArrowDown"],DL=["ArrowLeft","ArrowUp"],zL=(a,h,_)=>{a&&(h.isComposing||h.keyCode===229||(a.stopKeydownPropagation&&h.stopPropagation(),h.key==="Enter"?LL(h,a):h.key==="Tab"?kL(h):[..._E,...DL].includes(h.key)?OL(h.key):h.key==="Escape"&&FL(h,a,_)))},LL=(a,h)=>{if(!E_(h.allowEnterKey))return;const _=M_(qn(),h.input);if(a.target&&_&&a.target instanceof HTMLElement&&a.target.outerHTML===_.outerHTML){if(["textarea","file"].includes(h.input))return;mE(),a.preventDefault()}},kL=a=>{const h=a.target,_=iv();let w=-1;for(let M=0;M<_.length;M++)if(h===_[M]){w=M;break}a.shiftKey?f0(w,-1):f0(w,1),a.stopPropagation(),a.preventDefault()},OL=a=>{const h=Cp(),_=Pa(),w=Eu(),M=sd();if(!h||!_||!w||!M)return;const O=[_,w,M];if(document.activeElement instanceof HTMLElement&&!O.includes(document.activeElement))return;const k=_E.includes(a)?"nextElementSibling":"previousElementSibling";let s=document.activeElement;if(s){for(let W=0;W<h.children.length;W++){if(s=s[k],!s)return;if(s instanceof HTMLButtonElement&&ro(s))break}s instanceof HTMLButtonElement&&s.focus()}},FL=(a,h,_)=>{E_(h.allowEscapeKey)&&(a.preventDefault(),_(ad.esc))};var Jh={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const BL=()=>{const a=Zs();Array.from(document.body.children).forEach(_=>{_.contains(a)||(_.hasAttribute("aria-hidden")&&_.setAttribute("data-previous-aria-hidden",_.getAttribute("aria-hidden")||""),_.setAttribute("aria-hidden","true"))})},yE=()=>{Array.from(document.body.children).forEach(h=>{h.hasAttribute("data-previous-aria-hidden")?(h.setAttribute("aria-hidden",h.getAttribute("data-previous-aria-hidden")||""),h.removeAttribute("data-previous-aria-hidden")):h.removeAttribute("aria-hidden")})},xE=typeof window<"u"&&!!window.GestureEvent,NL=()=>{if(xE&&!ll(document.body,yt.iosfix)){const a=document.body.scrollTop;document.body.style.top=`${a*-1}px`,Xn(document.body,yt.iosfix),VL()}},VL=()=>{const a=Zs();if(!a)return;let h;a.ontouchstart=_=>{h=jL(_)},a.ontouchmove=_=>{h&&(_.preventDefault(),_.stopPropagation())}},jL=a=>{const h=a.target,_=Zs(),w=Q0();return!_||!w||UL(a)||$L(a)?!1:h===_||!d0(_)&&h instanceof HTMLElement&&!jz(h,w)&&h.tagName!=="INPUT"&&h.tagName!=="TEXTAREA"&&!(d0(w)&&w.contains(h))},UL=a=>a.touches&&a.touches.length&&a.touches[0].touchType==="stylus",$L=a=>a.touches&&a.touches.length>1,GL=()=>{if(ll(document.body,yt.iosfix)){const a=parseInt(document.body.style.top,10);Oo(document.body,yt.iosfix),document.body.style.top="",document.body.scrollTop=a*-1}},HL=()=>{const a=document.createElement("div");a.className=yt["scrollbar-measure"],document.body.appendChild(a);const h=a.getBoundingClientRect().width-a.clientWidth;return document.body.removeChild(a),h};let Zh=null;const qL=a=>{Zh===null&&(document.body.scrollHeight>window.innerHeight||a==="scroll")&&(Zh=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Zh+HL()}px`)},WL=()=>{Zh!==null&&(document.body.style.paddingRight=`${Zh}px`,Zh=null)};function vE(a,h,_,w){C_()?oT(a,w):(Rz(_).then(()=>oT(a,w)),gE(Fi)),xE?(h.setAttribute("style","display:none !important"),h.removeAttribute("class"),h.innerHTML=""):h.remove(),nv()&&(WL(),GL(),yE()),ZL()}function ZL(){Oo([document.documentElement,document.body],[yt.shown,yt["height-auto"],yt["no-backdrop"],yt["toast-shown"]])}function ac(a){a=KL(a);const h=Jh.swalPromiseResolve.get(this),_=XL(this);this.isAwaitingPromise?a.isDismissed||(Rp(this),h(a)):_&&h(a)}const XL=a=>{const h=qn();if(!h)return!1;const _=yr.innerParams.get(a);if(!_||ll(h,_.hideClass.popup))return!1;Oo(h,_.showClass.popup),Xn(h,_.hideClass.popup);const w=Zs();return Oo(w,_.showClass.backdrop),Xn(w,_.hideClass.backdrop),YL(a,h,_),!0};function bE(a){const h=Jh.swalPromiseReject.get(this);Rp(this),h&&h(a)}const Rp=a=>{a.isAwaitingPromise&&(delete a.isAwaitingPromise,yr.innerParams.get(a)||a._destroy())},KL=a=>typeof a>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},a),YL=(a,h,_)=>{var w;const M=Zs(),O=oE(h);typeof _.willClose=="function"&&_.willClose(h),(w=Fi.eventEmitter)===null||w===void 0||w.emit("willClose",h),O?JL(a,h,M,_.returnFocus,_.didClose):vE(a,M,_.returnFocus,_.didClose)},JL=(a,h,_,w,M)=>{Fi.swalCloseEventFinishedCallback=vE.bind(null,a,_,w,M);const O=function(k){if(k.target===h){var s;(s=Fi.swalCloseEventFinishedCallback)===null||s===void 0||s.call(Fi),delete Fi.swalCloseEventFinishedCallback,h.removeEventListener("animationend",O),h.removeEventListener("transitionend",O)}};h.addEventListener("animationend",O),h.addEventListener("transitionend",O)},oT=(a,h)=>{setTimeout(()=>{var _;typeof h=="function"&&h.bind(a.params)(),(_=Fi.eventEmitter)===null||_===void 0||_.emit("didClose"),a._destroy&&a._destroy()})},Qh=a=>{let h=qn();if(h||new gp,h=qn(),!h)return;const _=od();C_()?Vs(rd()):QL(h,a),vs(_),h.setAttribute("data-loading","true"),h.setAttribute("aria-busy","true"),h.focus()},QL=(a,h)=>{const _=Cp(),w=od();!_||!w||(!h&&ro(Pa())&&(h=Pa()),vs(_),h&&(Vs(h),w.setAttribute("data-button-to-replace",h.className),_.insertBefore(w,h)),Xn([a,_],yt.loading))},ek=(a,h)=>{h.input==="select"||h.input==="radio"?sk(a,h):["text","email","number","tel","textarea"].some(_=>_===h.input)&&(Y0(h.inputValue)||J0(h.inputValue))&&(Qh(Pa()),ok(a,h))},tk=(a,h)=>{const _=a.getInput();if(!_)return null;switch(h.input){case"checkbox":return ik(_);case"radio":return nk(_);case"file":return rk(_);default:return h.inputAutoTrim?_.value.trim():_.value}},ik=a=>a.checked?1:0,nk=a=>a.checked?a.value:null,rk=a=>a.files&&a.files.length?a.getAttribute("multiple")!==null?a.files:a.files[0]:null,sk=(a,h)=>{const _=qn();if(!_)return;const w=M=>{h.input==="select"?ak(_,a_(M),h):h.input==="radio"&&lk(_,a_(M),h)};Y0(h.inputOptions)||J0(h.inputOptions)?(Qh(Pa()),Ap(h.inputOptions).then(M=>{a.hideLoading(),w(M)})):typeof h.inputOptions=="object"?w(h.inputOptions):Su(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof h.inputOptions}`)},ok=(a,h)=>{const _=a.getInput();_&&(Vs(_),Ap(h.inputValue).then(w=>{_.value=h.input==="number"?`${parseFloat(w)||0}`:`${w}`,vs(_),_.focus(),a.hideLoading()}).catch(w=>{Su(`Error in inputValue promise: ${w}`),_.value="",vs(_),_.focus(),a.hideLoading()}))};function ak(a,h,_){const w=oc(a,yt.select);if(!w)return;const M=(O,k,s)=>{const W=document.createElement("option");W.value=s,To(W,k),W.selected=wE(s,_.inputValue),O.appendChild(W)};h.forEach(O=>{const k=O[0],s=O[1];if(Array.isArray(s)){const W=document.createElement("optgroup");W.label=k,W.disabled=!1,w.appendChild(W),s.forEach(X=>M(W,X[1],X[0]))}else M(w,s,k)}),w.focus()}function lk(a,h,_){const w=oc(a,yt.radio);if(!w)return;h.forEach(O=>{const k=O[0],s=O[1],W=document.createElement("input"),X=document.createElement("label");W.type="radio",W.name=yt.radio,W.value=k,wE(k,_.inputValue)&&(W.checked=!0);const Y=document.createElement("span");To(Y,s),Y.className=yt.label,X.appendChild(W),X.appendChild(Y),w.appendChild(X)});const M=w.querySelectorAll("input");M.length&&M[0].focus()}const a_=a=>{const h=[];return a instanceof Map?a.forEach((_,w)=>{let M=_;typeof M=="object"&&(M=a_(M)),h.push([w,M])}):Object.keys(a).forEach(_=>{let w=a[_];typeof w=="object"&&(w=a_(w)),h.push([_,w])}),h},wE=(a,h)=>!!h&&h.toString()===a.toString(),ck=a=>{const h=yr.innerParams.get(a);a.disableButtons(),h.input?TE(a,"confirm"):uv(a,!0)},uk=a=>{const h=yr.innerParams.get(a);a.disableButtons(),h.returnInputValueOnDeny?TE(a,"deny"):cv(a,!1)},hk=(a,h)=>{a.disableButtons(),h(ad.cancel)},TE=(a,h)=>{const _=yr.innerParams.get(a);if(!_.input){Su(`The "input" parameter is needed to be set when using returnInputValueOn${K0(h)}`);return}const w=a.getInput(),M=tk(a,_);_.inputValidator?dk(a,M,h):w&&!w.checkValidity()?(a.enableButtons(),a.showValidationMessage(_.validationMessage||w.validationMessage)):h==="deny"?cv(a,M):uv(a,M)},dk=(a,h,_)=>{const w=yr.innerParams.get(a);a.disableInput(),Promise.resolve().then(()=>Ap(w.inputValidator(h,w.validationMessage))).then(O=>{a.enableButtons(),a.enableInput(),O?a.showValidationMessage(O):_==="deny"?cv(a,h):uv(a,h)})},cv=(a,h)=>{const _=yr.innerParams.get(a||void 0);_.showLoaderOnDeny&&Qh(Eu()),_.preDeny?(a.isAwaitingPromise=!0,Promise.resolve().then(()=>Ap(_.preDeny(h,_.validationMessage))).then(M=>{M===!1?(a.hideLoading(),Rp(a)):a.close({isDenied:!0,value:typeof M>"u"?h:M})}).catch(M=>SE(a||void 0,M))):a.close({isDenied:!0,value:h})},aT=(a,h)=>{a.close({isConfirmed:!0,value:h})},SE=(a,h)=>{a.rejectPromise(h)},uv=(a,h)=>{const _=yr.innerParams.get(a||void 0);_.showLoaderOnConfirm&&Qh(),_.preConfirm?(a.resetValidationMessage(),a.isAwaitingPromise=!0,Promise.resolve().then(()=>Ap(_.preConfirm(h,_.validationMessage))).then(M=>{ro(A_())||M===!1?(a.hideLoading(),Rp(a)):aT(a,typeof M>"u"?h:M)}).catch(M=>SE(a||void 0,M))):aT(a,h)};function l_(){const a=yr.innerParams.get(this);if(!a)return;const h=yr.domCache.get(this);Vs(h.loader),C_()?a.icon&&vs(rd()):fk(h),Oo([h.popup,h.actions],yt.loading),h.popup.removeAttribute("aria-busy"),h.popup.removeAttribute("data-loading"),h.confirmButton.disabled=!1,h.denyButton.disabled=!1,h.cancelButton.disabled=!1}const fk=a=>{const h=a.popup.getElementsByClassName(a.loader.getAttribute("data-button-to-replace"));h.length?vs(h[0],"inline-block"):Vz()&&Vs(a.actions)};function EE(){const a=yr.innerParams.get(this),h=yr.domCache.get(this);return h?M_(h.popup,a.input):null}function AE(a,h,_){const w=yr.domCache.get(a);h.forEach(M=>{w[M].disabled=_})}function IE(a,h){const _=qn();if(!(!_||!a))if(a.type==="radio"){const w=_.querySelectorAll(`[name="${yt.radio}"]`);for(let M=0;M<w.length;M++)w[M].disabled=h}else a.disabled=h}function CE(){AE(this,["confirmButton","denyButton","cancelButton"],!1)}function ME(){AE(this,["confirmButton","denyButton","cancelButton"],!0)}function PE(){IE(this.getInput(),!1)}function RE(){IE(this.getInput(),!0)}function DE(a){const h=yr.domCache.get(this),_=yr.innerParams.get(this);To(h.validationMessage,a),h.validationMessage.className=yt["validation-message"],_.customClass&&_.customClass.validationMessage&&Xn(h.validationMessage,_.customClass.validationMessage),vs(h.validationMessage);const w=this.getInput();w&&(w.setAttribute("aria-invalid","true"),w.setAttribute("aria-describedby",yt["validation-message"]),rE(w),Xn(w,yt.inputerror))}function zE(){const a=yr.domCache.get(this);a.validationMessage&&Vs(a.validationMessage);const h=this.getInput();h&&(h.removeAttribute("aria-invalid"),h.removeAttribute("aria-describedby"),Oo(h,yt.inputerror))}const Xh={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},pk=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],mk={allowEnterKey:void 0},gk=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],LE=a=>Object.prototype.hasOwnProperty.call(Xh,a),kE=a=>pk.indexOf(a)!==-1,OE=a=>mk[a],_k=a=>{LE(a)||Ws(`Unknown parameter "${a}"`)},yk=a=>{gk.includes(a)&&Ws(`The parameter "${a}" is incompatible with toasts`)},xk=a=>{const h=OE(a);h&&eE(a,h)},FE=a=>{a.backdrop===!1&&a.allowOutsideClick&&Ws('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),a.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(a.theme)&&Ws(`Invalid theme "${a.theme}"`);for(const h in a)_k(h),a.toast&&yk(h),xk(h)};function BE(a){const h=Zs(),_=qn(),w=yr.innerParams.get(this);if(!_||ll(_,w.hideClass.popup)){Ws("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const M=vk(a),O=Object.assign({},w,M);FE(O),h.dataset.swal2Theme=O.theme,pE(this,O),yr.innerParams.set(this,O),Object.defineProperties(this,{params:{value:Object.assign({},this.params,a),writable:!1,enumerable:!0}})}const vk=a=>{const h={};return Object.keys(a).forEach(_=>{kE(_)?h[_]=a[_]:Ws(`Invalid parameter to update: ${_}`)}),h};function NE(){const a=yr.domCache.get(this),h=yr.innerParams.get(this);if(!h){VE(this);return}a.popup&&Fi.swalCloseEventFinishedCallback&&(Fi.swalCloseEventFinishedCallback(),delete Fi.swalCloseEventFinishedCallback),typeof h.didDestroy=="function"&&h.didDestroy(),Fi.eventEmitter.emit("didDestroy"),bk(this)}const bk=a=>{VE(a),delete a.params,delete Fi.keydownHandler,delete Fi.keydownTarget,delete Fi.currentInstance},VE=a=>{a.isAwaitingPromise?(qx(yr,a),a.isAwaitingPromise=!0):(qx(Jh,a),qx(yr,a),delete a.isAwaitingPromise,delete a.disableButtons,delete a.enableButtons,delete a.getInput,delete a.disableInput,delete a.enableInput,delete a.hideLoading,delete a.disableLoading,delete a.showValidationMessage,delete a.resetValidationMessage,delete a.close,delete a.closePopup,delete a.closeModal,delete a.closeToast,delete a.rejectPromise,delete a.update,delete a._destroy)},qx=(a,h)=>{for(const _ in a)a[_].delete(h)};var wk=Object.freeze({__proto__:null,_destroy:NE,close:ac,closeModal:ac,closePopup:ac,closeToast:ac,disableButtons:ME,disableInput:RE,disableLoading:l_,enableButtons:CE,enableInput:PE,getInput:EE,handleAwaitingPromise:Rp,hideLoading:l_,rejectPromise:bE,resetValidationMessage:zE,showValidationMessage:DE,update:BE});const Tk=(a,h,_)=>{a.toast?Sk(a,h,_):(Ak(h),Ik(h),Ck(a,h,_))},Sk=(a,h,_)=>{h.popup.onclick=()=>{a&&(Ek(a)||a.timer||a.input)||_(ad.close)}},Ek=a=>!!(a.showConfirmButton||a.showDenyButton||a.showCancelButton||a.showCloseButton);let c_=!1;const Ak=a=>{a.popup.onmousedown=()=>{a.container.onmouseup=function(h){a.container.onmouseup=()=>{},h.target===a.container&&(c_=!0)}}},Ik=a=>{a.container.onmousedown=h=>{h.target===a.container&&h.preventDefault(),a.popup.onmouseup=function(_){a.popup.onmouseup=()=>{},(_.target===a.popup||_.target instanceof HTMLElement&&a.popup.contains(_.target))&&(c_=!0)}}},Ck=(a,h,_)=>{h.container.onclick=w=>{if(c_){c_=!1;return}w.target===h.container&&E_(a.allowOutsideClick)&&_(ad.backdrop)}},Mk=a=>typeof a=="object"&&a.jquery,lT=a=>a instanceof Element||Mk(a),Pk=a=>{const h={};return typeof a[0]=="object"&&!lT(a[0])?Object.assign(h,a[0]):["title","html","icon"].forEach((_,w)=>{const M=a[w];typeof M=="string"||lT(M)?h[_]=M:M!==void 0&&Su(`Unexpected type of ${_}! Expected "string" or "Element", got ${typeof M}`)}),h};function Rk(...a){return new this(...a)}function Dk(a){class h extends this{_main(w,M){return super._main(w,Object.assign({},a,M))}}return h}const zk=()=>Fi.timeout&&Fi.timeout.getTimerLeft(),jE=()=>{if(Fi.timeout)return Uz(),Fi.timeout.stop()},UE=()=>{if(Fi.timeout){const a=Fi.timeout.start();return sv(a),a}},Lk=()=>{const a=Fi.timeout;return a&&(a.running?jE():UE())},kk=a=>{if(Fi.timeout){const h=Fi.timeout.increase(a);return sv(h,!0),h}},Ok=()=>!!(Fi.timeout&&Fi.timeout.isRunning());let cT=!1;const p0={};function Fk(a="data-swal-template"){p0[a]=this,cT||(document.body.addEventListener("click",Bk),cT=!0)}const Bk=a=>{for(let h=a.target;h&&h!==document;h=h.parentNode)for(const _ in p0){const w=h.getAttribute(_);if(w){p0[_].fire({template:w});return}}};class Nk{constructor(){this.events={}}_getHandlersByEventName(h){return typeof this.events[h]>"u"&&(this.events[h]=[]),this.events[h]}on(h,_){const w=this._getHandlersByEventName(h);w.includes(_)||w.push(_)}once(h,_){const w=(...M)=>{this.removeListener(h,w),_.apply(this,M)};this.on(h,w)}emit(h,..._){this._getHandlersByEventName(h).forEach(w=>{try{w.apply(this,_)}catch(M){console.error(M)}})}removeListener(h,_){const w=this._getHandlersByEventName(h),M=w.indexOf(_);M>-1&&w.splice(M,1)}removeAllListeners(h){this.events[h]!==void 0&&(this.events[h].length=0)}reset(){this.events={}}}Fi.eventEmitter=new Nk;const Vk=(a,h)=>{Fi.eventEmitter.on(a,h)},jk=(a,h)=>{Fi.eventEmitter.once(a,h)},Uk=(a,h)=>{if(!a){Fi.eventEmitter.reset();return}h?Fi.eventEmitter.removeListener(a,h):Fi.eventEmitter.removeAllListeners(a)};var $k=Object.freeze({__proto__:null,argsToParams:Pk,bindClickHandler:Fk,clickCancel:PL,clickConfirm:mE,clickDeny:ML,enableLoading:Qh,fire:Rk,getActions:Cp,getCancelButton:sd,getCloseButton:tv,getConfirmButton:Pa,getContainer:Zs,getDenyButton:Eu,getFocusableElements:iv,getFooter:nE,getHtmlContainer:Q0,getIcon:rd,getIconContent:kz,getImage:iE,getInputLabel:Oz,getLoader:od,getPopup:qn,getProgressSteps:ev,getTimerLeft:zk,getTimerProgressBar:I_,getTitle:tE,getValidationMessage:A_,increaseTimer:kk,isDeprecatedParameter:OE,isLoading:Bz,isTimerRunning:Ok,isUpdatableParameter:kE,isValidParameter:LE,isVisible:CL,mixin:Dk,off:Uk,on:Vk,once:jk,resumeTimer:UE,showLoading:Qh,stopTimer:jE,toggleTimer:Lk});class Gk{constructor(h,_){this.callback=h,this.remaining=_,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(h){const _=this.running;return _&&this.stop(),this.remaining+=h,_&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const $E=["swal-title","swal-html","swal-footer"],Hk=a=>{const h=typeof a.template=="string"?document.querySelector(a.template):a.template;if(!h)return{};const _=h.content;return Qk(_),Object.assign(qk(_),Wk(_),Zk(_),Xk(_),Kk(_),Yk(_),Jk(_,$E))},qk=a=>{const h={};return Array.from(a.querySelectorAll("swal-param")).forEach(w=>{bu(w,["name","value"]);const M=w.getAttribute("name"),O=w.getAttribute("value");!M||!O||(typeof Xh[M]=="boolean"?h[M]=O!=="false":typeof Xh[M]=="object"?h[M]=JSON.parse(O):h[M]=O)}),h},Wk=a=>{const h={};return Array.from(a.querySelectorAll("swal-function-param")).forEach(w=>{const M=w.getAttribute("name"),O=w.getAttribute("value");!M||!O||(h[M]=new Function(`return ${O}`)())}),h},Zk=a=>{const h={};return Array.from(a.querySelectorAll("swal-button")).forEach(w=>{bu(w,["type","color","aria-label"]);const M=w.getAttribute("type");!M||!["confirm","cancel","deny"].includes(M)||(h[`${M}ButtonText`]=w.innerHTML,h[`show${K0(M)}Button`]=!0,w.hasAttribute("color")&&(h[`${M}ButtonColor`]=w.getAttribute("color")),w.hasAttribute("aria-label")&&(h[`${M}ButtonAriaLabel`]=w.getAttribute("aria-label")))}),h},Xk=a=>{const h={},_=a.querySelector("swal-image");return _&&(bu(_,["src","width","height","alt"]),_.hasAttribute("src")&&(h.imageUrl=_.getAttribute("src")||void 0),_.hasAttribute("width")&&(h.imageWidth=_.getAttribute("width")||void 0),_.hasAttribute("height")&&(h.imageHeight=_.getAttribute("height")||void 0),_.hasAttribute("alt")&&(h.imageAlt=_.getAttribute("alt")||void 0)),h},Kk=a=>{const h={},_=a.querySelector("swal-icon");return _&&(bu(_,["type","color"]),_.hasAttribute("type")&&(h.icon=_.getAttribute("type")),_.hasAttribute("color")&&(h.iconColor=_.getAttribute("color")),h.iconHtml=_.innerHTML),h},Yk=a=>{const h={},_=a.querySelector("swal-input");_&&(bu(_,["type","label","placeholder","value"]),h.input=_.getAttribute("type")||"text",_.hasAttribute("label")&&(h.inputLabel=_.getAttribute("label")),_.hasAttribute("placeholder")&&(h.inputPlaceholder=_.getAttribute("placeholder")),_.hasAttribute("value")&&(h.inputValue=_.getAttribute("value")));const w=Array.from(a.querySelectorAll("swal-input-option"));return w.length&&(h.inputOptions={},w.forEach(M=>{bu(M,["value"]);const O=M.getAttribute("value");if(!O)return;const k=M.innerHTML;h.inputOptions[O]=k})),h},Jk=(a,h)=>{const _={};for(const w in h){const M=h[w],O=a.querySelector(M);O&&(bu(O,[]),_[M.replace(/^swal-/,"")]=O.innerHTML.trim())}return _},Qk=a=>{const h=$E.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(a.children).forEach(_=>{const w=_.tagName.toLowerCase();h.includes(w)||Ws(`Unrecognized element <${w}>`)})},bu=(a,h)=>{Array.from(a.attributes).forEach(_=>{h.indexOf(_.name)===-1&&Ws([`Unrecognized attribute "${_.name}" on <${a.tagName.toLowerCase()}>.`,`${h.length?`Allowed attributes are: ${h.join(", ")}`:"To set the value, use HTML within the element."}`])})},GE=10,e3=a=>{const h=Zs(),_=qn();typeof a.willOpen=="function"&&a.willOpen(_),Fi.eventEmitter.emit("willOpen",_);const M=window.getComputedStyle(document.body).overflowY;n3(h,_,a),setTimeout(()=>{t3(h,_)},GE),nv()&&(i3(h,a.scrollbarPadding,M),BL()),!C_()&&!Fi.previousActiveElement&&(Fi.previousActiveElement=document.activeElement),typeof a.didOpen=="function"&&setTimeout(()=>a.didOpen(_)),Fi.eventEmitter.emit("didOpen",_),Oo(h,yt["no-transition"])},u_=a=>{const h=qn();if(a.target!==h)return;const _=Zs();h.removeEventListener("animationend",u_),h.removeEventListener("transitionend",u_),_.style.overflowY="auto"},t3=(a,h)=>{oE(h)?(a.style.overflowY="hidden",h.addEventListener("animationend",u_),h.addEventListener("transitionend",u_)):a.style.overflowY="auto"},i3=(a,h,_)=>{NL(),h&&_!=="hidden"&&qL(_),setTimeout(()=>{a.scrollTop=0})},n3=(a,h,_)=>{Xn(a,_.showClass.backdrop),_.animation?(h.style.setProperty("opacity","0","important"),vs(h,"grid"),setTimeout(()=>{Xn(h,_.showClass.popup),h.style.removeProperty("opacity")},GE)):vs(h,"grid"),Xn([document.documentElement,document.body],yt.shown),_.heightAuto&&_.backdrop&&!_.toast&&Xn([document.documentElement,document.body],yt["height-auto"])};var uT={email:(a,h)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(a)?Promise.resolve():Promise.resolve(h||"Invalid email address"),url:(a,h)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(a)?Promise.resolve():Promise.resolve(h||"Invalid URL")};function r3(a){a.inputValidator||(a.input==="email"&&(a.inputValidator=uT.email),a.input==="url"&&(a.inputValidator=uT.url))}function s3(a){(!a.target||typeof a.target=="string"&&!document.querySelector(a.target)||typeof a.target!="string"&&!a.target.appendChild)&&(Ws('Target parameter is not valid, defaulting to "body"'),a.target="body")}function o3(a){r3(a),a.showLoaderOnConfirm&&!a.preConfirm&&Ws(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),s3(a),typeof a.title=="string"&&(a.title=a.title.split(`
`).join("<br />")),Kz(a)}let Aa;var Ng=new WeakMap;class Zr{constructor(...h){if(Iz(this,Ng,void 0),typeof window>"u")return;Aa=this;const _=Object.freeze(this.constructor.argsToParams(h));this.params=_,this.isAwaitingPromise=!1,Cz(Ng,this,this._main(Aa.params))}_main(h,_={}){if(FE(Object.assign({},_,h)),Fi.currentInstance){const O=Jh.swalPromiseResolve.get(Fi.currentInstance),{isAwaitingPromise:k}=Fi.currentInstance;Fi.currentInstance._destroy(),k||O({isDismissed:!0}),nv()&&yE()}Fi.currentInstance=Aa;const w=l3(h,_);o3(w),Object.freeze(w),Fi.timeout&&(Fi.timeout.stop(),delete Fi.timeout),clearTimeout(Fi.restoreFocusTimeout);const M=c3(Aa);return pE(Aa,w),yr.innerParams.set(Aa,w),a3(Aa,M,w)}then(h){return eT(Ng,this).then(h)}finally(h){return eT(Ng,this).finally(h)}}const a3=(a,h,_)=>new Promise((w,M)=>{const O=k=>{a.close({isDismissed:!0,dismiss:k})};Jh.swalPromiseResolve.set(a,w),Jh.swalPromiseReject.set(a,M),h.confirmButton.onclick=()=>{ck(a)},h.denyButton.onclick=()=>{uk(a)},h.cancelButton.onclick=()=>{hk(a,O)},h.closeButton.onclick=()=>{O(ad.close)},Tk(_,h,O),RL(Fi,_,O),ek(a,_),e3(_),u3(Fi,_,O),h3(h,_),setTimeout(()=>{h.container.scrollTop=0})}),l3=(a,h)=>{const _=Hk(a),w=Object.assign({},Xh,h,_,a);return w.showClass=Object.assign({},Xh.showClass,w.showClass),w.hideClass=Object.assign({},Xh.hideClass,w.hideClass),w.animation===!1&&(w.showClass={backdrop:"swal2-noanimation"},w.hideClass={}),w},c3=a=>{const h={popup:qn(),container:Zs(),actions:Cp(),confirmButton:Pa(),denyButton:Eu(),cancelButton:sd(),loader:od(),closeButton:tv(),validationMessage:A_(),progressSteps:ev()};return yr.domCache.set(a,h),h},u3=(a,h,_)=>{const w=I_();Vs(w),h.timer&&(a.timeout=new Gk(()=>{_("timer"),delete a.timeout},h.timer),h.timerProgressBar&&(vs(w),bo(w,h,"timerProgressBar"),setTimeout(()=>{a.timeout&&a.timeout.running&&sv(h.timer)})))},h3=(a,h)=>{if(!h.toast){if(!E_(h.allowEnterKey)){eE("allowEnterKey"),p3();return}d3(a)||f3(a,h)||f0(-1,1)}},d3=a=>{const h=Array.from(a.popup.querySelectorAll("[autofocus]"));for(const _ of h)if(_ instanceof HTMLElement&&ro(_))return _.focus(),!0;return!1},f3=(a,h)=>h.focusDeny&&ro(a.denyButton)?(a.denyButton.focus(),!0):h.focusCancel&&ro(a.cancelButton)?(a.cancelButton.focus(),!0):h.focusConfirm&&ro(a.confirmButton)?(a.confirmButton.focus(),!0):!1,p3=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const a=new Date,h=localStorage.getItem("swal-initiation");h?(a.getTime()-Date.parse(h))/(1e3*60*60*24)>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const _=document.createElement("audio");_.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",_.loop=!0,document.body.appendChild(_),setTimeout(()=>{_.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${a}`)}Zr.prototype.disableButtons=ME;Zr.prototype.enableButtons=CE;Zr.prototype.getInput=EE;Zr.prototype.disableInput=RE;Zr.prototype.enableInput=PE;Zr.prototype.hideLoading=l_;Zr.prototype.disableLoading=l_;Zr.prototype.showValidationMessage=DE;Zr.prototype.resetValidationMessage=zE;Zr.prototype.close=ac;Zr.prototype.closePopup=ac;Zr.prototype.closeModal=ac;Zr.prototype.closeToast=ac;Zr.prototype.rejectPromise=bE;Zr.prototype.update=BE;Zr.prototype._destroy=NE;Object.assign(Zr,$k);Object.keys(wk).forEach(a=>{Zr[a]=function(...h){return Aa&&Aa[a]?Aa[a](...h):null}});Zr.DismissReason=ad;Zr.version="11.22.0";const gp=Zr;gp.default=gp;typeof document<"u"&&function(a,h){var _=a.createElement("style");if(a.getElementsByTagName("head")[0].appendChild(_),_.styleSheet)_.styleSheet.disabled||(_.styleSheet.cssText=h);else try{_.innerHTML=h}catch{_.innerText=h}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');const m3=it.memo(a=>{const h=hl("(max-width : 1050px)");return Ae.jsxs(y_,{component:xR.div,initial:{opacity:0},animate:{opacity:1},transition:{duration:.85,ease:"easeInOut"},sx:{minHeight:h?"42vh":"62vh",display:"flex",flexDirection:"row",position:"relative",overflow:"hidden","&::after":{content:'""',position:"absolute",bottom:0,left:0,right:0,height:"100%",background:"linear-gradient(to top, rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0))",zIndex:2,boxShadow:"0 4px 10px rgba(0, 0, 0, 0.3)"}},children:[Ae.jsx(zn,{loading:"eager",component:"img",src:a.item.img,sx:{zIndex:0,position:"absolute",justifyContent:"center",width:"100%",height:"100%",objectFit:"cover",objectPosition:"center"}}),Ae.jsxs(Jn,{fontFamily:"sans-serif",fontWeight:"bold",position:"absolute",top:"50%",left:"50%",fontSize:h?27:43,zIndex:3,color:"primary.main",sx:{transform:"translate(-50%, -50%)",width:"100%"},children:[Ae.jsx("b",{style:{color:"#d6bf9b"},children:"¡"}),"BIENVENIDOS A LAS JORNADAS MÉDICAS",Ae.jsx("b",{style:{color:"#d6bf9b"},children:"!"})]}),Ae.jsx(zn,{sx:{width:h?"50%":"20%",height:"5px",background:"linear-gradient(90deg,rgb(244, 255, 251) 0%, rgb(127, 201, 177) 100%)",m:"auto",position:"absolute",top:h?"27vh":"35vh",left:"50%",transform:"translate(-50%, -50%)"}}),Ae.jsx(zn,{sx:{height:{md:"70px",xs:"50px"},mt:"auto",ml:{md:"5vh",xs:"2vh"},zIndex:3},children:Ae.jsx(Jn,{sx:{fontWeight:"bold",fontSize:{md:"25px",xs:"18px"},border:"1px solid white",backgroundColor:"rgba(255, 255, 255, 0.5)",pl:4,pr:4,borderRadius:3,color:"text.primary"},children:a.item.name})})]})}),Wx=[{name:"Medicina",img:"./carousel/medicine.webp"},{name:"Enfermería",img:"./carousel/nursing.webp"},{name:"Químicos",img:"./carousel/chemicals.webp"},{name:"Estomatología",img:"./carousel/stomatology.webp"}],g3=()=>{const a=hl("(max-width : 1050px)"),[h,_]=it.useState(0),w=M=>{_(M)};return it.useEffect(()=>{const M=setInterval(()=>{_(O=>(O+1)%Wx.length)},4e3);return()=>clearInterval(M)},[h]),Ae.jsxs(HS,{children:[Ae.jsx(zn,{sx:{width:"100%",minHeight:a?"44vh":"62vh",position:"relative"},children:Wx.map((M,O)=>Ae.jsx(zn,{sx:{position:"absolute",width:"100%",opacity:O===h?1:0,transition:"opacity 1s ease-in-out",willChange:"opacity",pointerEvents:O===h?"auto":"none"},children:Ae.jsx(m3,{item:M})},M.name))}),Ae.jsx(zn,{gap:3,sx:{display:"flex",justifyContent:"center",width:"100%",minHeight:a?"2.5vh":"3vh",alignItems:"center",mt:a?0:2,mb:a?1:0},children:Wx.map((M,O)=>Ae.jsx(zn,{onClick:()=>w(O),sx:{backgroundColor:O===h?"rgba(19, 50, 44, 1)":"rgba(19, 50, 44, 0.3)",width:"13px",height:"13px",borderRadius:10,transition:"background 1s ease","&:hover":{cursor:"pointer"}}},M.name))})]})},HE=it.createContext({});function _3(a){const h=it.useRef(null);return h.current===null&&(h.current=a()),h.current}const hv=typeof window<"u",y3=hv?it.useLayoutEffect:it.useEffect,dv=it.createContext(null),qE=it.createContext({transformPagePoint:a=>a,isStatic:!1,reducedMotion:"never"});function WE(a){return typeof a=="object"&&a!==null}function ZE(a){return WE(a)&&"offsetHeight"in a}function x3(a=!0){const h=it.useContext(dv);if(h===null)return[!0,null];const{isPresent:_,onExitComplete:w,register:M}=h,O=it.useId();it.useEffect(()=>{if(a)return M(O)},[a]);const k=it.useCallback(()=>a&&w&&w(O),[O,w,a]);return!_&&w?[!1,k]:[!0]}const Vg=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],hT={value:null};function v3(a,h){let _=new Set,w=new Set,M=!1,O=!1;const k=new WeakSet;let s={delta:0,timestamp:0,isProcessing:!1},W=0;function X(fe){k.has(fe)&&(Y.schedule(fe),a()),W++,fe(s)}const Y={schedule:(fe,Ie=!1,je=!1)=>{const Re=je&&M?_:w;return Ie&&k.add(fe),Re.has(fe)||Re.add(fe),fe},cancel:fe=>{w.delete(fe),k.delete(fe)},process:fe=>{if(s=fe,M){O=!0;return}M=!0,[_,w]=[w,_],_.forEach(X),h&&hT.value&&hT.value.frameloop[h].push(W),W=0,_.clear(),M=!1,O&&(O=!1,Y.process(fe))}};return Y}const cl={},b3=40;function XE(a,h){let _=!1,w=!0;const M={delta:0,timestamp:0,isProcessing:!1},O=()=>_=!0,k=Vg.reduce((ot,Ct)=>(ot[Ct]=v3(O,h?Ct:void 0),ot),{}),{setup:s,read:W,resolveKeyframes:X,preUpdate:Y,update:fe,preRender:Ie,render:je,postRender:He}=k,Re=()=>{const ot=cl.useManualTiming?M.timestamp:performance.now();_=!1,cl.useManualTiming||(M.delta=w?1e3/60:Math.max(Math.min(ot-M.timestamp,b3),1)),M.timestamp=ot,M.isProcessing=!0,s.process(M),W.process(M),X.process(M),Y.process(M),fe.process(M),Ie.process(M),je.process(M),He.process(M),M.isProcessing=!1,_&&h&&(w=!1,a(Re))},Ue=()=>{_=!0,w=!0,M.isProcessing||a(Re)};return{schedule:Vg.reduce((ot,Ct)=>{const Dt=k[Ct];return ot[Ct]=(Vt,hi=!1,Kt=!1)=>(_||Ue(),Dt.schedule(Vt,hi,Kt)),ot},{}),cancel:ot=>{for(let Ct=0;Ct<Vg.length;Ct++)k[Vg[Ct]].cancel(ot)},state:M,steps:k}}const ko=a=>a,{schedule:Pr,cancel:lc,state:Is,steps:Zx}=XE(typeof requestAnimationFrame<"u"?requestAnimationFrame:ko,!0),KE=it.createContext({strict:!1}),dT={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ed={};for(const a in dT)ed[a]={isEnabled:h=>dT[a].some(_=>!!h[_])};function w3(a){for(const h in a)ed[h]={...ed[h],...a[h]}}const T3=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function h_(a){return a.startsWith("while")||a.startsWith("drag")&&a!=="draggable"||a.startsWith("layout")||a.startsWith("onTap")||a.startsWith("onPan")||a.startsWith("onLayout")||T3.has(a)}let YE=a=>!h_(a);function S3(a){a&&(YE=h=>h.startsWith("on")?!h_(h):a(h))}try{S3(require("@emotion/is-prop-valid").default)}catch{}function E3(a,h,_){const w={};for(const M in a)M==="values"&&typeof a.values=="object"||(YE(M)||_===!0&&h_(M)||!h&&!h_(M)||a.draggable&&M.startsWith("onDrag"))&&(w[M]=a[M]);return w}function A3(a){if(typeof Proxy>"u")return a;const h=new Map,_=(...w)=>a(...w);return new Proxy(_,{get:(w,M)=>M==="create"?a:(h.has(M)||h.set(M,a(M)),h.get(M))})}const P_=it.createContext({});function R_(a){return a!==null&&typeof a=="object"&&typeof a.start=="function"}function _p(a){return typeof a=="string"||Array.isArray(a)}const fv=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],pv=["initial",...fv];function D_(a){return R_(a.animate)||pv.some(h=>_p(a[h]))}function JE(a){return!!(D_(a)||a.variants)}function I3(a,h){if(D_(a)){const{initial:_,animate:w}=a;return{initial:_===!1||_p(_)?_:void 0,animate:_p(w)?w:void 0}}return a.inherit!==!1?h:{}}function C3(a){const{initial:h,animate:_}=I3(a,it.useContext(P_));return it.useMemo(()=>({initial:h,animate:_}),[fT(h),fT(_)])}function fT(a){return Array.isArray(a)?a.join(" "):a}const M3=Symbol.for("motionComponentSymbol");function Uh(a){return a&&typeof a=="object"&&Object.prototype.hasOwnProperty.call(a,"current")}function P3(a,h,_){return it.useCallback(w=>{w&&a.onMount&&a.onMount(w),h&&(w?h.mount(w):h.unmount()),_&&(typeof _=="function"?_(w):Uh(_)&&(_.current=w))},[h])}const mv=a=>a.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),R3="framerAppearId",QE="data-"+mv(R3),eA=it.createContext({}),{schedule:gv}=XE(queueMicrotask,!1);function D3(a,h,_,w,M){var Re,Ue;const{visualElement:O}=it.useContext(P_),k=it.useContext(KE),s=it.useContext(dv),W=it.useContext(qE).reducedMotion,X=it.useRef(null);w=w||k.renderer,!X.current&&w&&(X.current=w(a,{visualState:h,parent:O,props:_,presenceContext:s,blockInitialAnimation:s?s.initial===!1:!1,reducedMotionConfig:W}));const Y=X.current,fe=it.useContext(eA);Y&&!Y.projection&&M&&(Y.type==="html"||Y.type==="svg")&&z3(X.current,_,M,fe);const Ie=it.useRef(!1);it.useInsertionEffect(()=>{Y&&Ie.current&&Y.update(_,s)});const je=_[QE],He=it.useRef(!!je&&!((Re=window.MotionHandoffIsComplete)!=null&&Re.call(window,je))&&((Ue=window.MotionHasOptimisedAnimation)==null?void 0:Ue.call(window,je)));return y3(()=>{Y&&(Ie.current=!0,window.MotionIsMounted=!0,Y.updateFeatures(),gv.render(Y.render),He.current&&Y.animationState&&Y.animationState.animateChanges())}),it.useEffect(()=>{Y&&(!He.current&&Y.animationState&&Y.animationState.animateChanges(),He.current&&(queueMicrotask(()=>{var et;(et=window.MotionHandoffMarkAsComplete)==null||et.call(window,je)}),He.current=!1))}),Y}function z3(a,h,_,w){const{layoutId:M,layout:O,drag:k,dragConstraints:s,layoutScroll:W,layoutRoot:X,layoutCrossfade:Y}=h;a.projection=new _(a.latestValues,h["data-framer-portal-id"]?void 0:tA(a.parent)),a.projection.setOptions({layoutId:M,layout:O,alwaysMeasureLayout:!!k||s&&Uh(s),visualElement:a,animationType:typeof O=="string"?O:"both",initialPromotionConfig:w,crossfade:Y,layoutScroll:W,layoutRoot:X})}function tA(a){if(a)return a.options.allowProjection!==!1?a.projection:tA(a.parent)}let _v=()=>{};function L3({preloadedFeatures:a,createVisualElement:h,useRender:_,useVisualState:w,Component:M}){a&&w3(a);function O(s,W){let X;const Y={...it.useContext(qE),...s,layoutId:k3(s)},{isStatic:fe}=Y,Ie=C3(s),je=w(s,fe);if(!fe&&hv){O3();const He=F3(Y);X=He.MeasureLayout,Ie.visualElement=D3(M,je,Y,h,He.ProjectionNode)}return Ae.jsxs(P_.Provider,{value:Ie,children:[X&&Ie.visualElement?Ae.jsx(X,{visualElement:Ie.visualElement,...Y}):null,_(M,s,P3(je,Ie.visualElement,W),je,fe,Ie.visualElement)]})}O.displayName=`motion.${typeof M=="string"?M:`create(${M.displayName??M.name??""})`}`;const k=it.forwardRef(O);return k[M3]=M,k}function k3({layoutId:a}){const h=it.useContext(HE).id;return h&&a!==void 0?h+"-"+a:a}function O3(a,h){it.useContext(KE).strict}function F3(a){const{drag:h,layout:_}=ed;if(!h&&!_)return{};const w={...h,..._};return{MeasureLayout:h!=null&&h.isEnabled(a)||_!=null&&_.isEnabled(a)?w.MeasureLayout:void 0,ProjectionNode:w.ProjectionNode}}const iA=a=>h=>typeof h=="string"&&h.startsWith(a),yv=iA("--"),B3=iA("var(--"),xv=a=>B3(a)?N3.test(a.split("/*")[0].trim()):!1,N3=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,yp={};function V3(a){for(const h in a)yp[h]=a[h],yv(h)&&(yp[h].isCSSVariable=!0)}const ld=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],cd=new Set(ld);function nA(a,{layout:h,layoutId:_}){return cd.has(a)||a.startsWith("origin")||(h||_!==void 0)&&(!!yp[a]||a==="opacity")}const rA=(a,h)=>h&&typeof a=="number"?h.transform(a):a,ul=(a,h,_)=>_>h?h:_<a?a:_,ud={test:a=>typeof a=="number",parse:parseFloat,transform:a=>a},xp={...ud,transform:a=>ul(0,1,a)},jg={...ud,default:1},pT={...ud,transform:Math.round},Dp=a=>({test:h=>typeof h=="string"&&h.endsWith(a)&&h.split(" ").length===1,parse:parseFloat,transform:h=>`${h}${a}`}),rc=Dp("deg"),Ia=Dp("%"),qi=Dp("px"),j3=Dp("vh"),U3=Dp("vw"),mT={...Ia,parse:a=>Ia.parse(a)/100,transform:a=>Ia.transform(a*100)},$3={rotate:rc,rotateX:rc,rotateY:rc,rotateZ:rc,scale:jg,scaleX:jg,scaleY:jg,scaleZ:jg,skew:rc,skewX:rc,skewY:rc,distance:qi,translateX:qi,translateY:qi,translateZ:qi,x:qi,y:qi,z:qi,perspective:qi,transformPerspective:qi,opacity:xp,originX:mT,originY:mT,originZ:qi},vv={borderWidth:qi,borderTopWidth:qi,borderRightWidth:qi,borderBottomWidth:qi,borderLeftWidth:qi,borderRadius:qi,radius:qi,borderTopLeftRadius:qi,borderTopRightRadius:qi,borderBottomRightRadius:qi,borderBottomLeftRadius:qi,width:qi,maxWidth:qi,height:qi,maxHeight:qi,top:qi,right:qi,bottom:qi,left:qi,padding:qi,paddingTop:qi,paddingRight:qi,paddingBottom:qi,paddingLeft:qi,margin:qi,marginTop:qi,marginRight:qi,marginBottom:qi,marginLeft:qi,backgroundPositionX:qi,backgroundPositionY:qi,...$3,zIndex:pT,fillOpacity:xp,strokeOpacity:xp,numOctaves:pT},G3={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},H3=ld.length;function q3(a,h,_){let w="",M=!0;for(let O=0;O<H3;O++){const k=ld[O],s=a[k];if(s===void 0)continue;let W=!0;if(typeof s=="number"?W=s===(k.startsWith("scale")?1:0):W=parseFloat(s)===0,!W||_){const X=rA(s,vv[k]);if(!W){M=!1;const Y=G3[k]||k;w+=`${Y}(${X}) `}_&&(h[k]=X)}}return w=w.trim(),_?w=_(h,M?"":w):M&&(w="none"),w}function bv(a,h,_){const{style:w,vars:M,transformOrigin:O}=a;let k=!1,s=!1;for(const W in h){const X=h[W];if(cd.has(W)){k=!0;continue}else if(yv(W)){M[W]=X;continue}else{const Y=rA(X,vv[W]);W.startsWith("origin")?(s=!0,O[W]=Y):w[W]=Y}}if(h.transform||(k||_?w.transform=q3(h,a.transform,_):w.transform&&(w.transform="none")),s){const{originX:W="50%",originY:X="50%",originZ:Y=0}=O;w.transformOrigin=`${W} ${X} ${Y}`}}const wv=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Ns=a=>!!(a&&a.getVelocity);function sA(a,h,_){for(const w in h)!Ns(h[w])&&!nA(w,_)&&(a[w]=h[w])}function W3({transformTemplate:a},h){return it.useMemo(()=>{const _=wv();return bv(_,h,a),Object.assign({},_.vars,_.style)},[h])}function Z3(a,h){const _=a.style||{},w={};return sA(w,_,a),Object.assign(w,W3(a,h)),w}function X3(a,h){const _={},w=Z3(a,h);return a.drag&&a.dragListener!==!1&&(_.draggable=!1,w.userSelect=w.WebkitUserSelect=w.WebkitTouchCallout="none",w.touchAction=a.drag===!0?"none":`pan-${a.drag==="x"?"y":"x"}`),a.tabIndex===void 0&&(a.onTap||a.onTapStart||a.whileTap)&&(_.tabIndex=0),_.style=w,_}const K3={offset:"stroke-dashoffset",array:"stroke-dasharray"},Y3={offset:"strokeDashoffset",array:"strokeDasharray"};function J3(a,h,_=1,w=0,M=!0){a.pathLength=1;const O=M?K3:Y3;a[O.offset]=qi.transform(-w);const k=qi.transform(h),s=qi.transform(_);a[O.array]=`${k} ${s}`}function oA(a,{attrX:h,attrY:_,attrScale:w,pathLength:M,pathSpacing:O=1,pathOffset:k=0,...s},W,X,Y){if(bv(a,s,X),W){a.style.viewBox&&(a.attrs.viewBox=a.style.viewBox);return}a.attrs=a.style,a.style={};const{attrs:fe,style:Ie}=a;fe.transform&&(Ie.transform=fe.transform,delete fe.transform),(Ie.transform||fe.transformOrigin)&&(Ie.transformOrigin=fe.transformOrigin??"50% 50%",delete fe.transformOrigin),Ie.transform&&(Ie.transformBox=(Y==null?void 0:Y.transformBox)??"fill-box",delete fe.transformBox),h!==void 0&&(fe.x=h),_!==void 0&&(fe.y=_),w!==void 0&&(fe.scale=w),M!==void 0&&J3(fe,M,O,k,!1)}const aA=()=>({...wv(),attrs:{}}),lA=a=>typeof a=="string"&&a.toLowerCase()==="svg";function Q3(a,h,_,w){const M=it.useMemo(()=>{const O=aA();return oA(O,h,lA(w),a.transformTemplate,a.style),{...O.attrs,style:{...O.style}}},[h]);if(a.style){const O={};sA(O,a.style,a),M.style={...O,...M.style}}return M}const eO=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Tv(a){return typeof a!="string"||a.includes("-")?!1:!!(eO.indexOf(a)>-1||/[A-Z]/u.test(a))}function tO(a=!1){return(_,w,M,{latestValues:O},k)=>{const W=(Tv(_)?Q3:X3)(w,O,k,_),X=E3(w,typeof _=="string",a),Y=_!==it.Fragment?{...X,...W,ref:M}:{},{children:fe}=w,Ie=it.useMemo(()=>Ns(fe)?fe.get():fe,[fe]);return it.createElement(_,{...Y,children:Ie})}}function gT(a){const h=[{},{}];return a==null||a.values.forEach((_,w)=>{h[0][w]=_.get(),h[1][w]=_.getVelocity()}),h}function Sv(a,h,_,w){if(typeof h=="function"){const[M,O]=gT(w);h=h(_!==void 0?_:a.custom,M,O)}if(typeof h=="string"&&(h=a.variants&&a.variants[h]),typeof h=="function"){const[M,O]=gT(w);h=h(_!==void 0?_:a.custom,M,O)}return h}function Hg(a){return Ns(a)?a.get():a}function iO({scrapeMotionValuesFromProps:a,createRenderState:h},_,w,M){return{latestValues:nO(_,w,M,a),renderState:h()}}const cA=a=>(h,_)=>{const w=it.useContext(P_),M=it.useContext(dv),O=()=>iO(a,h,w,M);return _?O():_3(O)};function nO(a,h,_,w){const M={},O=w(a,{});for(const Ie in O)M[Ie]=Hg(O[Ie]);let{initial:k,animate:s}=a;const W=D_(a),X=JE(a);h&&X&&!W&&a.inherit!==!1&&(k===void 0&&(k=h.initial),s===void 0&&(s=h.animate));let Y=_?_.initial===!1:!1;Y=Y||k===!1;const fe=Y?s:k;if(fe&&typeof fe!="boolean"&&!R_(fe)){const Ie=Array.isArray(fe)?fe:[fe];for(let je=0;je<Ie.length;je++){const He=Sv(a,Ie[je]);if(He){const{transitionEnd:Re,transition:Ue,...et}=He;for(const vt in et){let ot=et[vt];if(Array.isArray(ot)){const Ct=Y?ot.length-1:0;ot=ot[Ct]}ot!==null&&(M[vt]=ot)}for(const vt in Re)M[vt]=Re[vt]}}}return M}function Ev(a,h,_){var O;const{style:w}=a,M={};for(const k in w)(Ns(w[k])||h.style&&Ns(h.style[k])||nA(k,a)||((O=_==null?void 0:_.getValue(k))==null?void 0:O.liveStyle)!==void 0)&&(M[k]=w[k]);return M}const rO={useVisualState:cA({scrapeMotionValuesFromProps:Ev,createRenderState:wv})};function uA(a,h,_){const w=Ev(a,h,_);for(const M in a)if(Ns(a[M])||Ns(h[M])){const O=ld.indexOf(M)!==-1?"attr"+M.charAt(0).toUpperCase()+M.substring(1):M;w[O]=a[M]}return w}const sO={useVisualState:cA({scrapeMotionValuesFromProps:uA,createRenderState:aA})};function oO(a,h){return function(w,{forwardMotionProps:M}={forwardMotionProps:!1}){const k={...Tv(w)?sO:rO,preloadedFeatures:a,useRender:tO(M),createVisualElement:h,Component:w};return L3(k)}}function vp(a,h,_){const w=a.getProps();return Sv(w,h,_!==void 0?_:w.custom,a)}const m0=a=>Array.isArray(a);let qg;function aO(){qg=void 0}const no={now:()=>(qg===void 0&&no.set(Is.isProcessing||cl.useManualTiming?Is.timestamp:performance.now()),qg),set:a=>{qg=a,queueMicrotask(aO)}};function Av(a,h){a.indexOf(h)===-1&&a.push(h)}function Iv(a,h){const _=a.indexOf(h);_>-1&&a.splice(_,1)}class Cv{constructor(){this.subscriptions=[]}add(h){return Av(this.subscriptions,h),()=>Iv(this.subscriptions,h)}notify(h,_,w){const M=this.subscriptions.length;if(M)if(M===1)this.subscriptions[0](h,_,w);else for(let O=0;O<M;O++){const k=this.subscriptions[O];k&&k(h,_,w)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function hA(a,h){return h?a*(1e3/h):0}const _T=30,lO=a=>!isNaN(parseFloat(a));class cO{constructor(h,_={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=(w,M=!0)=>{var k,s;const O=no.now();if(this.updatedAt!==O&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(w),this.current!==this.prev&&((k=this.events.change)==null||k.notify(this.current),this.dependents))for(const W of this.dependents)W.dirty();M&&((s=this.events.renderRequest)==null||s.notify(this.current))},this.hasAnimated=!1,this.setCurrent(h),this.owner=_.owner}setCurrent(h){this.current=h,this.updatedAt=no.now(),this.canTrackVelocity===null&&h!==void 0&&(this.canTrackVelocity=lO(this.current))}setPrevFrameValue(h=this.current){this.prevFrameValue=h,this.prevUpdatedAt=this.updatedAt}onChange(h){return this.on("change",h)}on(h,_){this.events[h]||(this.events[h]=new Cv);const w=this.events[h].add(_);return h==="change"?()=>{w(),Pr.read(()=>{this.events.change.getSize()||this.stop()})}:w}clearListeners(){for(const h in this.events)this.events[h].clear()}attach(h,_){this.passiveEffect=h,this.stopPassiveEffect=_}set(h,_=!0){!_||!this.passiveEffect?this.updateAndNotify(h,_):this.passiveEffect(h,this.updateAndNotify)}setWithVelocity(h,_,w){this.set(_),this.prev=void 0,this.prevFrameValue=h,this.prevUpdatedAt=this.updatedAt-w}jump(h,_=!0){this.updateAndNotify(h),this.prev=h,this.prevUpdatedAt=this.prevFrameValue=void 0,_&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var h;(h=this.events.change)==null||h.notify(this.current)}addDependent(h){this.dependents||(this.dependents=new Set),this.dependents.add(h)}removeDependent(h){this.dependents&&this.dependents.delete(h)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const h=no.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||h-this.updatedAt>_T)return 0;const _=Math.min(this.updatedAt-this.prevUpdatedAt,_T);return hA(parseFloat(this.current)-parseFloat(this.prevFrameValue),_)}start(h){return this.stop(),new Promise(_=>{this.hasAnimated=!0,this.animation=h(_),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var h,_;(h=this.dependents)==null||h.clear(),(_=this.events.destroy)==null||_.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function td(a,h){return new cO(a,h)}function uO(a,h,_){a.hasValue(h)?a.getValue(h).set(_):a.addValue(h,td(_))}function hO(a){return m0(a)?a[a.length-1]||0:a}function dO(a,h){const _=vp(a,h);let{transitionEnd:w={},transition:M={},...O}=_||{};O={...O,...w};for(const k in O){const s=hO(O[k]);uO(a,k,s)}}function fO(a){return!!(Ns(a)&&a.add)}function g0(a,h){const _=a.getValue("willChange");if(fO(_))return _.add(h);if(!_&&cl.WillChange){const w=new cl.WillChange("auto");a.addValue("willChange",w),w.add(h)}}function dA(a){return a.props[QE]}const pO=a=>a!==null;function mO(a,{repeat:h,repeatType:_="loop"},w){const M=a.filter(pO),O=h&&_!=="loop"&&h%2===1?0:M.length-1;return M[O]}const gO={type:"spring",stiffness:500,damping:25,restSpeed:10},_O=a=>({type:"spring",stiffness:550,damping:a===0?2*Math.sqrt(550):30,restSpeed:10}),yO={type:"keyframes",duration:.8},xO={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},vO=(a,{keyframes:h})=>h.length>2?yO:cd.has(a)?a.startsWith("scale")?_O(h[1]):gO:xO;function bO({when:a,delay:h,delayChildren:_,staggerChildren:w,staggerDirection:M,repeat:O,repeatType:k,repeatDelay:s,from:W,elapsed:X,...Y}){return!!Object.keys(Y).length}function Mv(a,h){return(a==null?void 0:a[h])??(a==null?void 0:a.default)??a}const Ca=a=>a*1e3,Ma=a=>a/1e3,up=a=>Math.round(a*1e5)/1e5,Pv=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function wO(a){return a==null}const TO=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Rv=(a,h)=>_=>!!(typeof _=="string"&&TO.test(_)&&_.startsWith(a)||h&&!wO(_)&&Object.prototype.hasOwnProperty.call(_,h)),fA=(a,h,_)=>w=>{if(typeof w!="string")return w;const[M,O,k,s]=w.match(Pv);return{[a]:parseFloat(M),[h]:parseFloat(O),[_]:parseFloat(k),alpha:s!==void 0?parseFloat(s):1}},SO=a=>ul(0,255,a),Xx={...ud,transform:a=>Math.round(SO(a))},pu={test:Rv("rgb","red"),parse:fA("red","green","blue"),transform:({red:a,green:h,blue:_,alpha:w=1})=>"rgba("+Xx.transform(a)+", "+Xx.transform(h)+", "+Xx.transform(_)+", "+up(xp.transform(w))+")"};function EO(a){let h="",_="",w="",M="";return a.length>5?(h=a.substring(1,3),_=a.substring(3,5),w=a.substring(5,7),M=a.substring(7,9)):(h=a.substring(1,2),_=a.substring(2,3),w=a.substring(3,4),M=a.substring(4,5),h+=h,_+=_,w+=w,M+=M),{red:parseInt(h,16),green:parseInt(_,16),blue:parseInt(w,16),alpha:M?parseInt(M,16)/255:1}}const _0={test:Rv("#"),parse:EO,transform:pu.transform},$h={test:Rv("hsl","hue"),parse:fA("hue","saturation","lightness"),transform:({hue:a,saturation:h,lightness:_,alpha:w=1})=>"hsla("+Math.round(a)+", "+Ia.transform(up(h))+", "+Ia.transform(up(_))+", "+up(xp.transform(w))+")"},Fs={test:a=>pu.test(a)||_0.test(a)||$h.test(a),parse:a=>pu.test(a)?pu.parse(a):$h.test(a)?$h.parse(a):_0.parse(a),transform:a=>typeof a=="string"?a:a.hasOwnProperty("red")?pu.transform(a):$h.transform(a)},AO=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function IO(a){var h,_;return isNaN(a)&&typeof a=="string"&&(((h=a.match(Pv))==null?void 0:h.length)||0)+(((_=a.match(AO))==null?void 0:_.length)||0)>0}const pA="number",mA="color",CO="var",MO="var(",yT="${}",PO=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function bp(a){const h=a.toString(),_=[],w={color:[],number:[],var:[]},M=[];let O=0;const s=h.replace(PO,W=>(Fs.test(W)?(w.color.push(O),M.push(mA),_.push(Fs.parse(W))):W.startsWith(MO)?(w.var.push(O),M.push(CO),_.push(W)):(w.number.push(O),M.push(pA),_.push(parseFloat(W))),++O,yT)).split(yT);return{values:_,split:s,indexes:w,types:M}}function gA(a){return bp(a).values}function _A(a){const{split:h,types:_}=bp(a),w=h.length;return M=>{let O="";for(let k=0;k<w;k++)if(O+=h[k],M[k]!==void 0){const s=_[k];s===pA?O+=up(M[k]):s===mA?O+=Fs.transform(M[k]):O+=M[k]}return O}}const RO=a=>typeof a=="number"?0:a;function DO(a){const h=gA(a);return _A(a)(h.map(RO))}const cc={test:IO,parse:gA,createTransformer:_A,getAnimatableNone:DO};function Kx(a,h,_){return _<0&&(_+=1),_>1&&(_-=1),_<1/6?a+(h-a)*6*_:_<1/2?h:_<2/3?a+(h-a)*(2/3-_)*6:a}function zO({hue:a,saturation:h,lightness:_,alpha:w}){a/=360,h/=100,_/=100;let M=0,O=0,k=0;if(!h)M=O=k=_;else{const s=_<.5?_*(1+h):_+h-_*h,W=2*_-s;M=Kx(W,s,a+1/3),O=Kx(W,s,a),k=Kx(W,s,a-1/3)}return{red:Math.round(M*255),green:Math.round(O*255),blue:Math.round(k*255),alpha:w}}function d_(a,h){return _=>_>0?h:a}const Mr=(a,h,_)=>a+(h-a)*_,Yx=(a,h,_)=>{const w=a*a,M=_*(h*h-w)+w;return M<0?0:Math.sqrt(M)},LO=[_0,pu,$h],kO=a=>LO.find(h=>h.test(a));function xT(a){const h=kO(a);if(!h)return!1;let _=h.parse(a);return h===$h&&(_=zO(_)),_}const vT=(a,h)=>{const _=xT(a),w=xT(h);if(!_||!w)return d_(a,h);const M={..._};return O=>(M.red=Yx(_.red,w.red,O),M.green=Yx(_.green,w.green,O),M.blue=Yx(_.blue,w.blue,O),M.alpha=Mr(_.alpha,w.alpha,O),pu.transform(M))},y0=new Set(["none","hidden"]);function OO(a,h){return y0.has(a)?_=>_<=0?a:h:_=>_>=1?h:a}const FO=(a,h)=>_=>h(a(_)),zp=(...a)=>a.reduce(FO);function BO(a,h){return _=>Mr(a,h,_)}function Dv(a){return typeof a=="number"?BO:typeof a=="string"?xv(a)?d_:Fs.test(a)?vT:jO:Array.isArray(a)?yA:typeof a=="object"?Fs.test(a)?vT:NO:d_}function yA(a,h){const _=[...a],w=_.length,M=a.map((O,k)=>Dv(O)(O,h[k]));return O=>{for(let k=0;k<w;k++)_[k]=M[k](O);return _}}function NO(a,h){const _={...a,...h},w={};for(const M in _)a[M]!==void 0&&h[M]!==void 0&&(w[M]=Dv(a[M])(a[M],h[M]));return M=>{for(const O in w)_[O]=w[O](M);return _}}function VO(a,h){const _=[],w={color:0,var:0,number:0};for(let M=0;M<h.values.length;M++){const O=h.types[M],k=a.indexes[O][w[O]],s=a.values[k]??0;_[M]=s,w[O]++}return _}const jO=(a,h)=>{const _=cc.createTransformer(h),w=bp(a),M=bp(h);return w.indexes.var.length===M.indexes.var.length&&w.indexes.color.length===M.indexes.color.length&&w.indexes.number.length>=M.indexes.number.length?y0.has(a)&&!M.values.length||y0.has(h)&&!w.values.length?OO(a,h):zp(yA(VO(w,M),M.values),_):d_(a,h)};function xA(a,h,_){return typeof a=="number"&&typeof h=="number"&&typeof _=="number"?Mr(a,h,_):Dv(a)(a,h)}const UO=a=>{const h=({timestamp:_})=>a(_);return{start:(_=!0)=>Pr.update(h,_),stop:()=>lc(h),now:()=>Is.isProcessing?Is.timestamp:no.now()}},vA=(a,h,_=10)=>{let w="";const M=Math.max(Math.round(h/_),2);for(let O=0;O<M;O++)w+=a(O/(M-1))+", ";return`linear(${w.substring(0,w.length-2)})`},f_=2e4;function zv(a){let h=0;const _=50;let w=a.next(h);for(;!w.done&&h<f_;)h+=_,w=a.next(h);return h>=f_?1/0:h}function $O(a,h=100,_){const w=_({...a,keyframes:[0,h]}),M=Math.min(zv(w),f_);return{type:"keyframes",ease:O=>w.next(M*O).value/h,duration:Ma(M)}}const GO=5;function bA(a,h,_){const w=Math.max(h-GO,0);return hA(_-a(w),h-w)}const Or={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},bT=.001;function HO({duration:a=Or.duration,bounce:h=Or.bounce,velocity:_=Or.velocity,mass:w=Or.mass}){let M,O,k=1-h;k=ul(Or.minDamping,Or.maxDamping,k),a=ul(Or.minDuration,Or.maxDuration,Ma(a)),k<1?(M=X=>{const Y=X*k,fe=Y*a,Ie=Y-_,je=x0(X,k),He=Math.exp(-fe);return bT-Ie/je*He},O=X=>{const fe=X*k*a,Ie=fe*_+_,je=Math.pow(k,2)*Math.pow(X,2)*a,He=Math.exp(-fe),Re=x0(Math.pow(X,2),k);return(-M(X)+bT>0?-1:1)*((Ie-je)*He)/Re}):(M=X=>{const Y=Math.exp(-X*a),fe=(X-_)*a+1;return-.001+Y*fe},O=X=>{const Y=Math.exp(-X*a),fe=(_-X)*(a*a);return Y*fe});const s=5/a,W=WO(M,O,s);if(a=Ca(a),isNaN(W))return{stiffness:Or.stiffness,damping:Or.damping,duration:a};{const X=Math.pow(W,2)*w;return{stiffness:X,damping:k*2*Math.sqrt(w*X),duration:a}}}const qO=12;function WO(a,h,_){let w=_;for(let M=1;M<qO;M++)w=w-a(w)/h(w);return w}function x0(a,h){return a*Math.sqrt(1-h*h)}const ZO=["duration","bounce"],XO=["stiffness","damping","mass"];function wT(a,h){return h.some(_=>a[_]!==void 0)}function KO(a){let h={velocity:Or.velocity,stiffness:Or.stiffness,damping:Or.damping,mass:Or.mass,isResolvedFromDuration:!1,...a};if(!wT(a,XO)&&wT(a,ZO))if(a.visualDuration){const _=a.visualDuration,w=2*Math.PI/(_*1.2),M=w*w,O=2*ul(.05,1,1-(a.bounce||0))*Math.sqrt(M);h={...h,mass:Or.mass,stiffness:M,damping:O}}else{const _=HO(a);h={...h,..._,mass:Or.mass},h.isResolvedFromDuration=!0}return h}function p_(a=Or.visualDuration,h=Or.bounce){const _=typeof a!="object"?{visualDuration:a,keyframes:[0,1],bounce:h}:a;let{restSpeed:w,restDelta:M}=_;const O=_.keyframes[0],k=_.keyframes[_.keyframes.length-1],s={done:!1,value:O},{stiffness:W,damping:X,mass:Y,duration:fe,velocity:Ie,isResolvedFromDuration:je}=KO({..._,velocity:-Ma(_.velocity||0)}),He=Ie||0,Re=X/(2*Math.sqrt(W*Y)),Ue=k-O,et=Ma(Math.sqrt(W/Y)),vt=Math.abs(Ue)<5;w||(w=vt?Or.restSpeed.granular:Or.restSpeed.default),M||(M=vt?Or.restDelta.granular:Or.restDelta.default);let ot;if(Re<1){const Dt=x0(et,Re);ot=Vt=>{const hi=Math.exp(-Re*et*Vt);return k-hi*((He+Re*et*Ue)/Dt*Math.sin(Dt*Vt)+Ue*Math.cos(Dt*Vt))}}else if(Re===1)ot=Dt=>k-Math.exp(-et*Dt)*(Ue+(He+et*Ue)*Dt);else{const Dt=et*Math.sqrt(Re*Re-1);ot=Vt=>{const hi=Math.exp(-Re*et*Vt),Kt=Math.min(Dt*Vt,300);return k-hi*((He+Re*et*Ue)*Math.sinh(Kt)+Dt*Ue*Math.cosh(Kt))/Dt}}const Ct={calculatedDuration:je&&fe||null,next:Dt=>{const Vt=ot(Dt);if(je)s.done=Dt>=fe;else{let hi=Dt===0?He:0;Re<1&&(hi=Dt===0?Ca(He):bA(ot,Dt,Vt));const Kt=Math.abs(hi)<=w,Ei=Math.abs(k-Vt)<=M;s.done=Kt&&Ei}return s.value=s.done?k:Vt,s},toString:()=>{const Dt=Math.min(zv(Ct),f_),Vt=vA(hi=>Ct.next(Dt*hi).value,Dt,30);return Dt+"ms "+Vt},toTransition:()=>{}};return Ct}p_.applyToOptions=a=>{const h=$O(a,100,p_);return a.ease=h.ease,a.duration=Ca(h.duration),a.type="keyframes",a};function v0({keyframes:a,velocity:h=0,power:_=.8,timeConstant:w=325,bounceDamping:M=10,bounceStiffness:O=500,modifyTarget:k,min:s,max:W,restDelta:X=.5,restSpeed:Y}){const fe=a[0],Ie={done:!1,value:fe},je=Kt=>s!==void 0&&Kt<s||W!==void 0&&Kt>W,He=Kt=>s===void 0?W:W===void 0||Math.abs(s-Kt)<Math.abs(W-Kt)?s:W;let Re=_*h;const Ue=fe+Re,et=k===void 0?Ue:k(Ue);et!==Ue&&(Re=et-fe);const vt=Kt=>-Re*Math.exp(-Kt/w),ot=Kt=>et+vt(Kt),Ct=Kt=>{const Ei=vt(Kt),gi=ot(Kt);Ie.done=Math.abs(Ei)<=X,Ie.value=Ie.done?et:gi};let Dt,Vt;const hi=Kt=>{je(Ie.value)&&(Dt=Kt,Vt=p_({keyframes:[Ie.value,He(Ie.value)],velocity:bA(ot,Kt,Ie.value),damping:M,stiffness:O,restDelta:X,restSpeed:Y}))};return hi(0),{calculatedDuration:null,next:Kt=>{let Ei=!1;return!Vt&&Dt===void 0&&(Ei=!0,Ct(Kt),hi(Kt)),Dt!==void 0&&Kt>=Dt?Vt.next(Kt-Dt):(!Ei&&Ct(Kt),Ie)}}}const wp=(a,h,_)=>{const w=h-a;return w===0?1:(_-a)/w};function YO(a,h,_){const w=[],M=_||cl.mix||xA,O=a.length-1;for(let k=0;k<O;k++){let s=M(a[k],a[k+1]);if(h){const W=Array.isArray(h)?h[k]||ko:h;s=zp(W,s)}w.push(s)}return w}function JO(a,h,{clamp:_=!0,ease:w,mixer:M}={}){const O=a.length;if(_v(O===h.length),O===1)return()=>h[0];if(O===2&&h[0]===h[1])return()=>h[1];const k=a[0]===a[1];a[0]>a[O-1]&&(a=[...a].reverse(),h=[...h].reverse());const s=YO(h,w,M),W=s.length,X=Y=>{if(k&&Y<a[0])return h[0];let fe=0;if(W>1)for(;fe<a.length-2&&!(Y<a[fe+1]);fe++);const Ie=wp(a[fe],a[fe+1],Y);return s[fe](Ie)};return _?Y=>X(ul(a[0],a[O-1],Y)):X}function QO(a,h){const _=a[a.length-1];for(let w=1;w<=h;w++){const M=wp(0,h,w);a.push(Mr(_,1,M))}}function eF(a){const h=[0];return QO(h,a.length-1),h}function tF(a,h){return a.map(_=>_*h)}const wA=(a,h,_)=>(((1-3*_+3*h)*a+(3*_-6*h))*a+3*h)*a,iF=1e-7,nF=12;function rF(a,h,_,w,M){let O,k,s=0;do k=h+(_-h)/2,O=wA(k,w,M)-a,O>0?_=k:h=k;while(Math.abs(O)>iF&&++s<nF);return k}function Lp(a,h,_,w){if(a===h&&_===w)return ko;const M=O=>rF(O,0,1,a,_);return O=>O===0||O===1?O:wA(M(O),h,w)}const sF=Lp(.42,0,1,1),oF=Lp(0,0,.58,1),TA=Lp(.42,0,.58,1),aF=a=>Array.isArray(a)&&typeof a[0]!="number",SA=a=>h=>h<=.5?a(2*h)/2:(2-a(2*(1-h)))/2,EA=a=>h=>1-a(1-h),AA=Lp(.33,1.53,.69,.99),Lv=EA(AA),IA=SA(Lv),CA=a=>(a*=2)<1?.5*Lv(a):.5*(2-Math.pow(2,-10*(a-1))),kv=a=>1-Math.sin(Math.acos(a)),MA=EA(kv),PA=SA(kv),RA=a=>Array.isArray(a)&&typeof a[0]=="number",lF={linear:ko,easeIn:sF,easeInOut:TA,easeOut:oF,circIn:kv,circInOut:PA,circOut:MA,backIn:Lv,backInOut:IA,backOut:AA,anticipate:CA},cF=a=>typeof a=="string",TT=a=>{if(RA(a)){_v(a.length===4);const[h,_,w,M]=a;return Lp(h,_,w,M)}else if(cF(a))return lF[a];return a};function uF(a,h){return a.map(()=>h||TA).splice(0,a.length-1)}function hp({duration:a=300,keyframes:h,times:_,ease:w="easeInOut"}){const M=aF(w)?w.map(TT):TT(w),O={done:!1,value:h[0]},k=tF(_&&_.length===h.length?_:eF(h),a),s=JO(k,h,{ease:Array.isArray(M)?M:uF(h,M)});return{calculatedDuration:a,next:W=>(O.value=s(W),O.done=W>=a,O)}}const hF=a=>a!==null;function Ov(a,{repeat:h,repeatType:_="loop"},w,M=1){const O=a.filter(hF),s=M<0||h&&_!=="loop"&&h%2===1?0:O.length-1;return!s||w===void 0?O[s]:w}const dF={decay:v0,inertia:v0,tween:hp,keyframes:hp,spring:p_};function DA(a){typeof a.type=="string"&&(a.type=dF[a.type])}class Fv{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(h=>{this.resolve=h})}notifyFinished(){this.resolve()}then(h,_){return this.finished.then(h,_)}}const fF=a=>a/100;class Bv extends Fv{constructor(h){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var w,M;const{motionValue:_}=this.options;_&&_.updatedAt!==no.now()&&this.tick(no.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(M=(w=this.options).onStop)==null||M.call(w))},this.options=h,this.initAnimation(),this.play(),h.autoplay===!1&&this.pause()}initAnimation(){const{options:h}=this;DA(h);const{type:_=hp,repeat:w=0,repeatDelay:M=0,repeatType:O,velocity:k=0}=h;let{keyframes:s}=h;const W=_||hp;W!==hp&&typeof s[0]!="number"&&(this.mixKeyframes=zp(fF,xA(s[0],s[1])),s=[0,100]);const X=W({...h,keyframes:s});O==="mirror"&&(this.mirroredGenerator=W({...h,keyframes:[...s].reverse(),velocity:-k})),X.calculatedDuration===null&&(X.calculatedDuration=zv(X));const{calculatedDuration:Y}=X;this.calculatedDuration=Y,this.resolvedDuration=Y+M,this.totalDuration=this.resolvedDuration*(w+1)-M,this.generator=X}updateTime(h){const _=Math.round(h-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=_}tick(h,_=!1){const{generator:w,totalDuration:M,mixKeyframes:O,mirroredGenerator:k,resolvedDuration:s,calculatedDuration:W}=this;if(this.startTime===null)return w.next(0);const{delay:X=0,keyframes:Y,repeat:fe,repeatType:Ie,repeatDelay:je,type:He,onUpdate:Re,finalKeyframe:Ue}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,h):this.speed<0&&(this.startTime=Math.min(h-M/this.speed,this.startTime)),_?this.currentTime=h:this.updateTime(h);const et=this.currentTime-X*(this.playbackSpeed>=0?1:-1),vt=this.playbackSpeed>=0?et<0:et>M;this.currentTime=Math.max(et,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=M);let ot=this.currentTime,Ct=w;if(fe){const Kt=Math.min(this.currentTime,M)/s;let Ei=Math.floor(Kt),gi=Kt%1;!gi&&Kt>=1&&(gi=1),gi===1&&Ei--,Ei=Math.min(Ei,fe+1),!!(Ei%2)&&(Ie==="reverse"?(gi=1-gi,je&&(gi-=je/s)):Ie==="mirror"&&(Ct=k)),ot=ul(0,1,gi)*s}const Dt=vt?{done:!1,value:Y[0]}:Ct.next(ot);O&&(Dt.value=O(Dt.value));let{done:Vt}=Dt;!vt&&W!==null&&(Vt=this.playbackSpeed>=0?this.currentTime>=M:this.currentTime<=0);const hi=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Vt);return hi&&He!==v0&&(Dt.value=Ov(Y,this.options,Ue,this.speed)),Re&&Re(Dt.value),hi&&this.finish(),Dt}then(h,_){return this.finished.then(h,_)}get duration(){return Ma(this.calculatedDuration)}get time(){return Ma(this.currentTime)}set time(h){var _;h=Ca(h),this.currentTime=h,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=h:this.driver&&(this.startTime=this.driver.now()-h/this.playbackSpeed),(_=this.driver)==null||_.start(!1)}get speed(){return this.playbackSpeed}set speed(h){this.updateTime(no.now());const _=this.playbackSpeed!==h;this.playbackSpeed=h,_&&(this.time=Ma(this.currentTime))}play(){var M,O;if(this.isStopped)return;const{driver:h=UO,startTime:_}=this.options;this.driver||(this.driver=h(k=>this.tick(k))),(O=(M=this.options).onPlay)==null||O.call(M);const w=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=w):this.holdTime!==null?this.startTime=w-this.holdTime:this.startTime||(this.startTime=_??w),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(no.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var h,_;this.notifyFinished(),this.teardown(),this.state="finished",(_=(h=this.options).onComplete)==null||_.call(h)}cancel(){var h,_;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(_=(h=this.options).onCancel)==null||_.call(h)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(h){return this.startTime=0,this.tick(h,!0)}attachTimeline(h){var _;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(_=this.driver)==null||_.stop(),h.observe(this)}}function pF(a){for(let h=1;h<a.length;h++)a[h]??(a[h]=a[h-1])}const mu=a=>a*180/Math.PI,b0=a=>{const h=mu(Math.atan2(a[1],a[0]));return w0(h)},mF={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:a=>(Math.abs(a[0])+Math.abs(a[3]))/2,rotate:b0,rotateZ:b0,skewX:a=>mu(Math.atan(a[1])),skewY:a=>mu(Math.atan(a[2])),skew:a=>(Math.abs(a[1])+Math.abs(a[2]))/2},w0=a=>(a=a%360,a<0&&(a+=360),a),ST=b0,ET=a=>Math.sqrt(a[0]*a[0]+a[1]*a[1]),AT=a=>Math.sqrt(a[4]*a[4]+a[5]*a[5]),gF={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:ET,scaleY:AT,scale:a=>(ET(a)+AT(a))/2,rotateX:a=>w0(mu(Math.atan2(a[6],a[5]))),rotateY:a=>w0(mu(Math.atan2(-a[2],a[0]))),rotateZ:ST,rotate:ST,skewX:a=>mu(Math.atan(a[4])),skewY:a=>mu(Math.atan(a[1])),skew:a=>(Math.abs(a[1])+Math.abs(a[4]))/2};function T0(a){return a.includes("scale")?1:0}function S0(a,h){if(!a||a==="none")return T0(h);const _=a.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let w,M;if(_)w=gF,M=_;else{const s=a.match(/^matrix\(([-\d.e\s,]+)\)$/u);w=mF,M=s}if(!M)return T0(h);const O=w[h],k=M[1].split(",").map(yF);return typeof O=="function"?O(k):k[O]}const _F=(a,h)=>{const{transform:_="none"}=getComputedStyle(a);return S0(_,h)};function yF(a){return parseFloat(a.trim())}const IT=a=>a===ud||a===qi,xF=new Set(["x","y","z"]),vF=ld.filter(a=>!xF.has(a));function bF(a){const h=[];return vF.forEach(_=>{const w=a.getValue(_);w!==void 0&&(h.push([_,w.get()]),w.set(_.startsWith("scale")?1:0))}),h}const yu={width:({x:a},{paddingLeft:h="0",paddingRight:_="0"})=>a.max-a.min-parseFloat(h)-parseFloat(_),height:({y:a},{paddingTop:h="0",paddingBottom:_="0"})=>a.max-a.min-parseFloat(h)-parseFloat(_),top:(a,{top:h})=>parseFloat(h),left:(a,{left:h})=>parseFloat(h),bottom:({y:a},{top:h})=>parseFloat(h)+(a.max-a.min),right:({x:a},{left:h})=>parseFloat(h)+(a.max-a.min),x:(a,{transform:h})=>S0(h,"x"),y:(a,{transform:h})=>S0(h,"y")};yu.translateX=yu.x;yu.translateY=yu.y;const xu=new Set;let E0=!1,A0=!1,I0=!1;function zA(){if(A0){const a=Array.from(xu).filter(w=>w.needsMeasurement),h=new Set(a.map(w=>w.element)),_=new Map;h.forEach(w=>{const M=bF(w);M.length&&(_.set(w,M),w.render())}),a.forEach(w=>w.measureInitialState()),h.forEach(w=>{w.render();const M=_.get(w);M&&M.forEach(([O,k])=>{var s;(s=w.getValue(O))==null||s.set(k)})}),a.forEach(w=>w.measureEndState()),a.forEach(w=>{w.suspendedScrollY!==void 0&&window.scrollTo(0,w.suspendedScrollY)})}A0=!1,E0=!1,xu.forEach(a=>a.complete(I0)),xu.clear()}function LA(){xu.forEach(a=>{a.readKeyframes(),a.needsMeasurement&&(A0=!0)})}function wF(){I0=!0,LA(),zA(),I0=!1}class Nv{constructor(h,_,w,M,O,k=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...h],this.onComplete=_,this.name=w,this.motionValue=M,this.element=O,this.isAsync=k}scheduleResolve(){this.state="scheduled",this.isAsync?(xu.add(this),E0||(E0=!0,Pr.read(LA),Pr.resolveKeyframes(zA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:h,name:_,element:w,motionValue:M}=this;if(h[0]===null){const O=M==null?void 0:M.get(),k=h[h.length-1];if(O!==void 0)h[0]=O;else if(w&&_){const s=w.readValue(_,k);s!=null&&(h[0]=s)}h[0]===void 0&&(h[0]=k),M&&O===void 0&&M.set(h[0])}pF(h)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(h=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,h),xu.delete(this)}cancel(){this.state==="scheduled"&&(xu.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const TF=a=>a.startsWith("--");function SF(a,h,_){TF(h)?a.style.setProperty(h,_):a.style[h]=_}function Vv(a){let h;return()=>(h===void 0&&(h=a()),h)}const EF=Vv(()=>window.ScrollTimeline!==void 0),AF={};function IF(a,h){const _=Vv(a);return()=>AF[h]??_()}const kA=IF(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),lp=([a,h,_,w])=>`cubic-bezier(${a}, ${h}, ${_}, ${w})`,CT={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:lp([0,.65,.55,1]),circOut:lp([.55,0,1,.45]),backIn:lp([.31,.01,.66,-.59]),backOut:lp([.33,1.53,.69,.99])};function OA(a,h){if(a)return typeof a=="function"?kA()?vA(a,h):"ease-out":RA(a)?lp(a):Array.isArray(a)?a.map(_=>OA(_,h)||CT.easeOut):CT[a]}function CF(a,h,_,{delay:w=0,duration:M=300,repeat:O=0,repeatType:k="loop",ease:s="easeOut",times:W}={},X=void 0){const Y={[h]:_};W&&(Y.offset=W);const fe=OA(s,M);Array.isArray(fe)&&(Y.easing=fe);const Ie={delay:w,duration:M,easing:Array.isArray(fe)?"linear":fe,fill:"both",iterations:O+1,direction:k==="reverse"?"alternate":"normal"};return X&&(Ie.pseudoElement=X),a.animate(Y,Ie)}function FA(a){return typeof a=="function"&&"applyToOptions"in a}function MF({type:a,...h}){return FA(a)&&kA()?a.applyToOptions(h):(h.duration??(h.duration=300),h.ease??(h.ease="easeOut"),h)}class PF extends Fv{constructor(h){if(super(),this.finishedTime=null,this.isStopped=!1,!h)return;const{element:_,name:w,keyframes:M,pseudoElement:O,allowFlatten:k=!1,finalKeyframe:s,onComplete:W}=h;this.isPseudoElement=!!O,this.allowFlatten=k,this.options=h,_v(typeof h.type!="string");const X=MF(h);this.animation=CF(_,w,M,X,O),X.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!O){const Y=Ov(M,this.options,s,this.speed);this.updateMotionValue?this.updateMotionValue(Y):SF(_,w,Y),this.animation.cancel()}W==null||W(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var h,_;(_=(h=this.animation).finish)==null||_.call(h)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:h}=this;h==="idle"||h==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var h,_;this.isPseudoElement||(_=(h=this.animation).commitStyles)==null||_.call(h)}get duration(){var _,w;const h=((w=(_=this.animation.effect)==null?void 0:_.getComputedTiming)==null?void 0:w.call(_).duration)||0;return Ma(Number(h))}get time(){return Ma(Number(this.animation.currentTime)||0)}set time(h){this.finishedTime=null,this.animation.currentTime=Ca(h)}get speed(){return this.animation.playbackRate}set speed(h){h<0&&(this.finishedTime=null),this.animation.playbackRate=h}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(h){this.animation.startTime=h}attachTimeline({timeline:h,observe:_}){var w;return this.allowFlatten&&((w=this.animation.effect)==null||w.updateTiming({easing:"linear"})),this.animation.onfinish=null,h&&EF()?(this.animation.timeline=h,ko):_(this)}}const BA={anticipate:CA,backInOut:IA,circInOut:PA};function RF(a){return a in BA}function DF(a){typeof a.ease=="string"&&RF(a.ease)&&(a.ease=BA[a.ease])}const MT=10;class zF extends PF{constructor(h){DF(h),DA(h),super(h),h.startTime&&(this.startTime=h.startTime),this.options=h}updateMotionValue(h){const{motionValue:_,onUpdate:w,onComplete:M,element:O,...k}=this.options;if(!_)return;if(h!==void 0){_.set(h);return}const s=new Bv({...k,autoplay:!1}),W=Ca(this.finishedTime??this.time);_.setWithVelocity(s.sample(W-MT).value,s.sample(W).value,MT),s.stop()}}const PT=(a,h)=>h==="zIndex"?!1:!!(typeof a=="number"||Array.isArray(a)||typeof a=="string"&&(cc.test(a)||a==="0")&&!a.startsWith("url("));function LF(a){const h=a[0];if(a.length===1)return!0;for(let _=0;_<a.length;_++)if(a[_]!==h)return!0}function kF(a,h,_,w){const M=a[0];if(M===null)return!1;if(h==="display"||h==="visibility")return!0;const O=a[a.length-1],k=PT(M,h),s=PT(O,h);return!k||!s?!1:LF(a)||(_==="spring"||FA(_))&&w}const OF=new Set(["opacity","clipPath","filter","transform"]),FF=Vv(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function BF(a){var X;const{motionValue:h,name:_,repeatDelay:w,repeatType:M,damping:O,type:k}=a;if(!ZE((X=h==null?void 0:h.owner)==null?void 0:X.current))return!1;const{onUpdate:s,transformTemplate:W}=h.owner.getProps();return FF()&&_&&OF.has(_)&&(_!=="transform"||!W)&&!s&&!w&&M!=="mirror"&&O!==0&&k!=="inertia"}const NF=40;class VF extends Fv{constructor({autoplay:h=!0,delay:_=0,type:w="keyframes",repeat:M=0,repeatDelay:O=0,repeatType:k="loop",keyframes:s,name:W,motionValue:X,element:Y,...fe}){var He;super(),this.stop=()=>{var Re,Ue;this._animation&&(this._animation.stop(),(Re=this.stopTimeline)==null||Re.call(this)),(Ue=this.keyframeResolver)==null||Ue.cancel()},this.createdAt=no.now();const Ie={autoplay:h,delay:_,type:w,repeat:M,repeatDelay:O,repeatType:k,name:W,motionValue:X,element:Y,...fe},je=(Y==null?void 0:Y.KeyframeResolver)||Nv;this.keyframeResolver=new je(s,(Re,Ue,et)=>this.onKeyframesResolved(Re,Ue,Ie,!et),W,X,Y),(He=this.keyframeResolver)==null||He.scheduleResolve()}onKeyframesResolved(h,_,w,M){this.keyframeResolver=void 0;const{name:O,type:k,velocity:s,delay:W,isHandoff:X,onUpdate:Y}=w;this.resolvedAt=no.now(),kF(h,O,k,s)||((cl.instantAnimations||!W)&&(Y==null||Y(Ov(h,w,_))),h[0]=h[h.length-1],w.duration=0,w.repeat=0);const Ie={startTime:M?this.resolvedAt?this.resolvedAt-this.createdAt>NF?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:_,...w,keyframes:h},je=!X&&BF(Ie)?new zF({...Ie,element:Ie.motionValue.owner.current}):new Bv(Ie);je.finished.then(()=>this.notifyFinished()).catch(ko),this.pendingTimeline&&(this.stopTimeline=je.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=je}get finished(){return this._animation?this.animation.finished:this._finished}then(h,_){return this.finished.finally(h).then(()=>{})}get animation(){var h;return this._animation||((h=this.keyframeResolver)==null||h.resume(),wF()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(h){this.animation.time=h}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(h){this.animation.speed=h}get startTime(){return this.animation.startTime}attachTimeline(h){return this._animation?this.stopTimeline=this.animation.attachTimeline(h):this.pendingTimeline=h,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var h;this._animation&&this.animation.cancel(),(h=this.keyframeResolver)==null||h.cancel()}}const jv=(a,h,_,w={},M,O)=>k=>{const s=Mv(w,a)||{},W=s.delay||w.delay||0;let{elapsed:X=0}=w;X=X-Ca(W);const Y={keyframes:Array.isArray(_)?_:[null,_],ease:"easeOut",velocity:h.getVelocity(),...s,delay:-X,onUpdate:Ie=>{h.set(Ie),s.onUpdate&&s.onUpdate(Ie)},onComplete:()=>{k(),s.onComplete&&s.onComplete()},name:a,motionValue:h,element:O?void 0:M};bO(s)||Object.assign(Y,vO(a,Y)),Y.duration&&(Y.duration=Ca(Y.duration)),Y.repeatDelay&&(Y.repeatDelay=Ca(Y.repeatDelay)),Y.from!==void 0&&(Y.keyframes[0]=Y.from);let fe=!1;if((Y.type===!1||Y.duration===0&&!Y.repeatDelay)&&(Y.duration=0,Y.delay===0&&(fe=!0)),(cl.instantAnimations||cl.skipAnimations)&&(fe=!0,Y.duration=0,Y.delay=0),Y.allowFlatten=!s.type&&!s.ease,fe&&!O&&h.get()!==void 0){const Ie=mO(Y.keyframes,s);if(Ie!==void 0){Pr.update(()=>{Y.onUpdate(Ie),Y.onComplete()});return}}return s.isSync?new Bv(Y):new VF(Y)},NA=new Set(["width","height","top","left","right","bottom",...ld]);function jF({protectedKeys:a,needsAnimating:h},_){const w=a.hasOwnProperty(_)&&h[_]!==!0;return h[_]=!1,w}function VA(a,h,{delay:_=0,transitionOverride:w,type:M}={}){let{transition:O=a.getDefaultTransition(),transitionEnd:k,...s}=h;w&&(O=w);const W=[],X=M&&a.animationState&&a.animationState.getState()[M];for(const Y in s){const fe=a.getValue(Y,a.latestValues[Y]??null),Ie=s[Y];if(Ie===void 0||X&&jF(X,Y))continue;const je={delay:_,...Mv(O||{},Y)},He=fe.get();if(He!==void 0&&!fe.isAnimating&&!Array.isArray(Ie)&&Ie===He&&!je.velocity)continue;let Re=!1;if(window.MotionHandoffAnimation){const et=dA(a);if(et){const vt=window.MotionHandoffAnimation(et,Y,Pr);vt!==null&&(je.startTime=vt,Re=!0)}}g0(a,Y),fe.start(jv(Y,fe,Ie,a.shouldReduceMotion&&NA.has(Y)?{type:!1}:je,a,Re));const Ue=fe.animation;Ue&&W.push(Ue)}return k&&Promise.all(W).then(()=>{Pr.update(()=>{k&&dO(a,k)})}),W}function C0(a,h,_={}){var W;const w=vp(a,h,_.type==="exit"?(W=a.presenceContext)==null?void 0:W.custom:void 0);let{transition:M=a.getDefaultTransition()||{}}=w||{};_.transitionOverride&&(M=_.transitionOverride);const O=w?()=>Promise.all(VA(a,w,_)):()=>Promise.resolve(),k=a.variantChildren&&a.variantChildren.size?(X=0)=>{const{delayChildren:Y=0,staggerChildren:fe,staggerDirection:Ie}=M;return UF(a,h,Y+X,fe,Ie,_)}:()=>Promise.resolve(),{when:s}=M;if(s){const[X,Y]=s==="beforeChildren"?[O,k]:[k,O];return X().then(()=>Y())}else return Promise.all([O(),k(_.delay)])}function UF(a,h,_=0,w=0,M=1,O){const k=[],s=(a.variantChildren.size-1)*w,W=M===1?(X=0)=>X*w:(X=0)=>s-X*w;return Array.from(a.variantChildren).sort($F).forEach((X,Y)=>{X.notify("AnimationStart",h),k.push(C0(X,h,{...O,delay:_+W(Y)}).then(()=>X.notify("AnimationComplete",h)))}),Promise.all(k)}function $F(a,h){return a.sortNodePosition(h)}function GF(a,h,_={}){a.notify("AnimationStart",h);let w;if(Array.isArray(h)){const M=h.map(O=>C0(a,O,_));w=Promise.all(M)}else if(typeof h=="string")w=C0(a,h,_);else{const M=typeof h=="function"?vp(a,h,_.custom):h;w=Promise.all(VA(a,M,_))}return w.then(()=>{a.notify("AnimationComplete",h)})}function jA(a,h){if(!Array.isArray(h))return!1;const _=h.length;if(_!==a.length)return!1;for(let w=0;w<_;w++)if(h[w]!==a[w])return!1;return!0}const HF=pv.length;function UA(a){if(!a)return;if(!a.isControllingVariants){const _=a.parent?UA(a.parent)||{}:{};return a.props.initial!==void 0&&(_.initial=a.props.initial),_}const h={};for(let _=0;_<HF;_++){const w=pv[_],M=a.props[w];(_p(M)||M===!1)&&(h[w]=M)}return h}const qF=[...fv].reverse(),WF=fv.length;function ZF(a){return h=>Promise.all(h.map(({animation:_,options:w})=>GF(a,_,w)))}function XF(a){let h=ZF(a),_=RT(),w=!0;const M=W=>(X,Y)=>{var Ie;const fe=vp(a,Y,W==="exit"?(Ie=a.presenceContext)==null?void 0:Ie.custom:void 0);if(fe){const{transition:je,transitionEnd:He,...Re}=fe;X={...X,...Re,...He}}return X};function O(W){h=W(a)}function k(W){const{props:X}=a,Y=UA(a.parent)||{},fe=[],Ie=new Set;let je={},He=1/0;for(let Ue=0;Ue<WF;Ue++){const et=qF[Ue],vt=_[et],ot=X[et]!==void 0?X[et]:Y[et],Ct=_p(ot),Dt=et===W?vt.isActive:null;Dt===!1&&(He=Ue);let Vt=ot===Y[et]&&ot!==X[et]&&Ct;if(Vt&&w&&a.manuallyAnimateOnMount&&(Vt=!1),vt.protectedKeys={...je},!vt.isActive&&Dt===null||!ot&&!vt.prevProp||R_(ot)||typeof ot=="boolean")continue;const hi=KF(vt.prevProp,ot);let Kt=hi||et===W&&vt.isActive&&!Vt&&Ct||Ue>He&&Ct,Ei=!1;const gi=Array.isArray(ot)?ot:[ot];let _i=gi.reduce(M(et),{});Dt===!1&&(_i={});const{prevResolvedValues:an={}}=vt,yi={...an,..._i},Jt=Ii=>{Kt=!0,Ie.has(Ii)&&(Ei=!0,Ie.delete(Ii)),vt.needsAnimating[Ii]=!0;const Hi=a.getValue(Ii);Hi&&(Hi.liveStyle=!1)};for(const Ii in yi){const Hi=_i[Ii],Ci=an[Ii];if(je.hasOwnProperty(Ii))continue;let ti=!1;m0(Hi)&&m0(Ci)?ti=!jA(Hi,Ci):ti=Hi!==Ci,ti?Hi!=null?Jt(Ii):Ie.add(Ii):Hi!==void 0&&Ie.has(Ii)?Jt(Ii):vt.protectedKeys[Ii]=!0}vt.prevProp=ot,vt.prevResolvedValues=_i,vt.isActive&&(je={...je,..._i}),w&&a.blockInitialAnimation&&(Kt=!1),Kt&&(!(Vt&&hi)||Ei)&&fe.push(...gi.map(Ii=>({animation:Ii,options:{type:et}})))}if(Ie.size){const Ue={};if(typeof X.initial!="boolean"){const et=vp(a,Array.isArray(X.initial)?X.initial[0]:X.initial);et&&et.transition&&(Ue.transition=et.transition)}Ie.forEach(et=>{const vt=a.getBaseTarget(et),ot=a.getValue(et);ot&&(ot.liveStyle=!0),Ue[et]=vt??null}),fe.push({animation:Ue})}let Re=!!fe.length;return w&&(X.initial===!1||X.initial===X.animate)&&!a.manuallyAnimateOnMount&&(Re=!1),w=!1,Re?h(fe):Promise.resolve()}function s(W,X){var fe;if(_[W].isActive===X)return Promise.resolve();(fe=a.variantChildren)==null||fe.forEach(Ie=>{var je;return(je=Ie.animationState)==null?void 0:je.setActive(W,X)}),_[W].isActive=X;const Y=k(W);for(const Ie in _)_[Ie].protectedKeys={};return Y}return{animateChanges:k,setActive:s,setAnimateFunction:O,getState:()=>_,reset:()=>{_=RT(),w=!0}}}function KF(a,h){return typeof h=="string"?h!==a:Array.isArray(h)?!jA(h,a):!1}function du(a=!1){return{isActive:a,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function RT(){return{animate:du(!0),whileInView:du(),whileHover:du(),whileTap:du(),whileDrag:du(),whileFocus:du(),exit:du()}}class hc{constructor(h){this.isMounted=!1,this.node=h}update(){}}class YF extends hc{constructor(h){super(h),h.animationState||(h.animationState=XF(h))}updateAnimationControlsSubscription(){const{animate:h}=this.node.getProps();R_(h)&&(this.unmountControls=h.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:h}=this.node.getProps(),{animate:_}=this.node.prevProps||{};h!==_&&this.updateAnimationControlsSubscription()}unmount(){var h;this.node.animationState.reset(),(h=this.unmountControls)==null||h.call(this)}}let JF=0;class QF extends hc{constructor(){super(...arguments),this.id=JF++}update(){if(!this.node.presenceContext)return;const{isPresent:h,onExitComplete:_}=this.node.presenceContext,{isPresent:w}=this.node.prevPresenceContext||{};if(!this.node.animationState||h===w)return;const M=this.node.animationState.setActive("exit",!h);_&&!h&&M.then(()=>{_(this.id)})}mount(){const{register:h,onExitComplete:_}=this.node.presenceContext||{};_&&_(this.id),h&&(this.unmount=h(this.id))}unmount(){}}const eB={animation:{Feature:YF},exit:{Feature:QF}};function Tp(a,h,_,w={passive:!0}){return a.addEventListener(h,_,w),()=>a.removeEventListener(h,_)}const Uv=a=>a.pointerType==="mouse"?typeof a.button!="number"||a.button<=0:a.isPrimary!==!1;function kp(a){return{point:{x:a.pageX,y:a.pageY}}}const tB=a=>h=>Uv(h)&&a(h,kp(h));function dp(a,h,_,w){return Tp(a,h,tB(_),w)}function $A({top:a,left:h,right:_,bottom:w}){return{x:{min:h,max:_},y:{min:a,max:w}}}function iB({x:a,y:h}){return{top:h.min,right:a.max,bottom:h.max,left:a.min}}function nB(a,h){if(!h)return a;const _=h({x:a.left,y:a.top}),w=h({x:a.right,y:a.bottom});return{top:_.y,left:_.x,bottom:w.y,right:w.x}}const GA=1e-4,rB=1-GA,sB=1+GA,HA=.01,oB=0-HA,aB=0+HA;function qs(a){return a.max-a.min}function lB(a,h,_){return Math.abs(a-h)<=_}function DT(a,h,_,w=.5){a.origin=w,a.originPoint=Mr(h.min,h.max,a.origin),a.scale=qs(_)/qs(h),a.translate=Mr(_.min,_.max,a.origin)-a.originPoint,(a.scale>=rB&&a.scale<=sB||isNaN(a.scale))&&(a.scale=1),(a.translate>=oB&&a.translate<=aB||isNaN(a.translate))&&(a.translate=0)}function fp(a,h,_,w){DT(a.x,h.x,_.x,w?w.originX:void 0),DT(a.y,h.y,_.y,w?w.originY:void 0)}function zT(a,h,_){a.min=_.min+h.min,a.max=a.min+qs(h)}function cB(a,h,_){zT(a.x,h.x,_.x),zT(a.y,h.y,_.y)}function LT(a,h,_){a.min=h.min-_.min,a.max=a.min+qs(h)}function pp(a,h,_){LT(a.x,h.x,_.x),LT(a.y,h.y,_.y)}const kT=()=>({translate:0,scale:1,origin:0,originPoint:0}),Gh=()=>({x:kT(),y:kT()}),OT=()=>({min:0,max:0}),Hr=()=>({x:OT(),y:OT()});function Lo(a){return[a("x"),a("y")]}function Jx(a){return a===void 0||a===1}function M0({scale:a,scaleX:h,scaleY:_}){return!Jx(a)||!Jx(h)||!Jx(_)}function fu(a){return M0(a)||qA(a)||a.z||a.rotate||a.rotateX||a.rotateY||a.skewX||a.skewY}function qA(a){return FT(a.x)||FT(a.y)}function FT(a){return a&&a!=="0%"}function m_(a,h,_){const w=a-_,M=h*w;return _+M}function BT(a,h,_,w,M){return M!==void 0&&(a=m_(a,M,w)),m_(a,_,w)+h}function P0(a,h=0,_=1,w,M){a.min=BT(a.min,h,_,w,M),a.max=BT(a.max,h,_,w,M)}function WA(a,{x:h,y:_}){P0(a.x,h.translate,h.scale,h.originPoint),P0(a.y,_.translate,_.scale,_.originPoint)}const NT=.999999999999,VT=1.0000000000001;function uB(a,h,_,w=!1){const M=_.length;if(!M)return;h.x=h.y=1;let O,k;for(let s=0;s<M;s++){O=_[s],k=O.projectionDelta;const{visualElement:W}=O.options;W&&W.props.style&&W.props.style.display==="contents"||(w&&O.options.layoutScroll&&O.scroll&&O!==O.root&&qh(a,{x:-O.scroll.offset.x,y:-O.scroll.offset.y}),k&&(h.x*=k.x.scale,h.y*=k.y.scale,WA(a,k)),w&&fu(O.latestValues)&&qh(a,O.latestValues))}h.x<VT&&h.x>NT&&(h.x=1),h.y<VT&&h.y>NT&&(h.y=1)}function Hh(a,h){a.min=a.min+h,a.max=a.max+h}function jT(a,h,_,w,M=.5){const O=Mr(a.min,a.max,M);P0(a,h,_,O,w)}function qh(a,h){jT(a.x,h.x,h.scaleX,h.scale,h.originX),jT(a.y,h.y,h.scaleY,h.scale,h.originY)}function ZA(a,h){return $A(nB(a.getBoundingClientRect(),h))}function hB(a,h,_){const w=ZA(a,_),{scroll:M}=h;return M&&(Hh(w.x,M.offset.x),Hh(w.y,M.offset.y)),w}const XA=({current:a})=>a?a.ownerDocument.defaultView:null,UT=(a,h)=>Math.abs(a-h);function dB(a,h){const _=UT(a.x,h.x),w=UT(a.y,h.y);return Math.sqrt(_**2+w**2)}class KA{constructor(h,_,{transformPagePoint:w,contextWindow:M,dragSnapToOrigin:O=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const fe=e0(this.lastMoveEventInfo,this.history),Ie=this.startEvent!==null,je=dB(fe.offset,{x:0,y:0})>=3;if(!Ie&&!je)return;const{point:He}=fe,{timestamp:Re}=Is;this.history.push({...He,timestamp:Re});const{onStart:Ue,onMove:et}=this.handlers;Ie||(Ue&&Ue(this.lastMoveEvent,fe),this.startEvent=this.lastMoveEvent),et&&et(this.lastMoveEvent,fe)},this.handlePointerMove=(fe,Ie)=>{this.lastMoveEvent=fe,this.lastMoveEventInfo=Qx(Ie,this.transformPagePoint),Pr.update(this.updatePoint,!0)},this.handlePointerUp=(fe,Ie)=>{this.end();const{onEnd:je,onSessionEnd:He,resumeAnimation:Re}=this.handlers;if(this.dragSnapToOrigin&&Re&&Re(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Ue=e0(fe.type==="pointercancel"?this.lastMoveEventInfo:Qx(Ie,this.transformPagePoint),this.history);this.startEvent&&je&&je(fe,Ue),He&&He(fe,Ue)},!Uv(h))return;this.dragSnapToOrigin=O,this.handlers=_,this.transformPagePoint=w,this.contextWindow=M||window;const k=kp(h),s=Qx(k,this.transformPagePoint),{point:W}=s,{timestamp:X}=Is;this.history=[{...W,timestamp:X}];const{onSessionStart:Y}=_;Y&&Y(h,e0(s,this.history)),this.removeListeners=zp(dp(this.contextWindow,"pointermove",this.handlePointerMove),dp(this.contextWindow,"pointerup",this.handlePointerUp),dp(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(h){this.handlers=h}end(){this.removeListeners&&this.removeListeners(),lc(this.updatePoint)}}function Qx(a,h){return h?{point:h(a.point)}:a}function $T(a,h){return{x:a.x-h.x,y:a.y-h.y}}function e0({point:a},h){return{point:a,delta:$T(a,YA(h)),offset:$T(a,fB(h)),velocity:pB(h,.1)}}function fB(a){return a[0]}function YA(a){return a[a.length-1]}function pB(a,h){if(a.length<2)return{x:0,y:0};let _=a.length-1,w=null;const M=YA(a);for(;_>=0&&(w=a[_],!(M.timestamp-w.timestamp>Ca(h)));)_--;if(!w)return{x:0,y:0};const O=Ma(M.timestamp-w.timestamp);if(O===0)return{x:0,y:0};const k={x:(M.x-w.x)/O,y:(M.y-w.y)/O};return k.x===1/0&&(k.x=0),k.y===1/0&&(k.y=0),k}function mB(a,{min:h,max:_},w){return h!==void 0&&a<h?a=w?Mr(h,a,w.min):Math.max(a,h):_!==void 0&&a>_&&(a=w?Mr(_,a,w.max):Math.min(a,_)),a}function GT(a,h,_){return{min:h!==void 0?a.min+h:void 0,max:_!==void 0?a.max+_-(a.max-a.min):void 0}}function gB(a,{top:h,left:_,bottom:w,right:M}){return{x:GT(a.x,_,M),y:GT(a.y,h,w)}}function HT(a,h){let _=h.min-a.min,w=h.max-a.max;return h.max-h.min<a.max-a.min&&([_,w]=[w,_]),{min:_,max:w}}function _B(a,h){return{x:HT(a.x,h.x),y:HT(a.y,h.y)}}function yB(a,h){let _=.5;const w=qs(a),M=qs(h);return M>w?_=wp(h.min,h.max-w,a.min):w>M&&(_=wp(a.min,a.max-M,h.min)),ul(0,1,_)}function xB(a,h){const _={};return h.min!==void 0&&(_.min=h.min-a.min),h.max!==void 0&&(_.max=h.max-a.min),_}const R0=.35;function vB(a=R0){return a===!1?a=0:a===!0&&(a=R0),{x:qT(a,"left","right"),y:qT(a,"top","bottom")}}function qT(a,h,_){return{min:WT(a,h),max:WT(a,_)}}function WT(a,h){return typeof a=="number"?a:a[h]||0}const Qo={x:!1,y:!1};function JA(){return Qo.x||Qo.y}function bB(a){return a==="x"||a==="y"?Qo[a]?null:(Qo[a]=!0,()=>{Qo[a]=!1}):Qo.x||Qo.y?null:(Qo.x=Qo.y=!0,()=>{Qo.x=Qo.y=!1})}const wB=new WeakMap;class TB{constructor(h){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Hr(),this.visualElement=h}start(h,{snapToCursor:_=!1}={}){const{presenceContext:w}=this.visualElement;if(w&&w.isPresent===!1)return;const M=Y=>{const{dragSnapToOrigin:fe}=this.getProps();fe?this.pauseAnimation():this.stopAnimation(),_&&this.snapToCursor(kp(Y).point)},O=(Y,fe)=>{const{drag:Ie,dragPropagation:je,onDragStart:He}=this.getProps();if(Ie&&!je&&(this.openDragLock&&this.openDragLock(),this.openDragLock=bB(Ie),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Lo(Ue=>{let et=this.getAxisMotionValue(Ue).get()||0;if(Ia.test(et)){const{projection:vt}=this.visualElement;if(vt&&vt.layout){const ot=vt.layout.layoutBox[Ue];ot&&(et=qs(ot)*(parseFloat(et)/100))}}this.originPoint[Ue]=et}),He&&Pr.postRender(()=>He(Y,fe)),g0(this.visualElement,"transform");const{animationState:Re}=this.visualElement;Re&&Re.setActive("whileDrag",!0)},k=(Y,fe)=>{const{dragPropagation:Ie,dragDirectionLock:je,onDirectionLock:He,onDrag:Re}=this.getProps();if(!Ie&&!this.openDragLock)return;const{offset:Ue}=fe;if(je&&this.currentDirection===null){this.currentDirection=SB(Ue),this.currentDirection!==null&&He&&He(this.currentDirection);return}this.updateAxis("x",fe.point,Ue),this.updateAxis("y",fe.point,Ue),this.visualElement.render(),Re&&Re(Y,fe)},s=(Y,fe)=>this.stop(Y,fe),W=()=>Lo(Y=>{var fe;return this.getAnimationState(Y)==="paused"&&((fe=this.getAxisMotionValue(Y).animation)==null?void 0:fe.play())}),{dragSnapToOrigin:X}=this.getProps();this.panSession=new KA(h,{onSessionStart:M,onStart:O,onMove:k,onSessionEnd:s,resumeAnimation:W},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:X,contextWindow:XA(this.visualElement)})}stop(h,_){const w=this.isDragging;if(this.cancel(),!w)return;const{velocity:M}=_;this.startAnimation(M);const{onDragEnd:O}=this.getProps();O&&Pr.postRender(()=>O(h,_))}cancel(){this.isDragging=!1;const{projection:h,animationState:_}=this.visualElement;h&&(h.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:w}=this.getProps();!w&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),_&&_.setActive("whileDrag",!1)}updateAxis(h,_,w){const{drag:M}=this.getProps();if(!w||!Ug(h,M,this.currentDirection))return;const O=this.getAxisMotionValue(h);let k=this.originPoint[h]+w[h];this.constraints&&this.constraints[h]&&(k=mB(k,this.constraints[h],this.elastic[h])),O.set(k)}resolveConstraints(){var O;const{dragConstraints:h,dragElastic:_}=this.getProps(),w=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(O=this.visualElement.projection)==null?void 0:O.layout,M=this.constraints;h&&Uh(h)?this.constraints||(this.constraints=this.resolveRefConstraints()):h&&w?this.constraints=gB(w.layoutBox,h):this.constraints=!1,this.elastic=vB(_),M!==this.constraints&&w&&this.constraints&&!this.hasMutatedConstraints&&Lo(k=>{this.constraints!==!1&&this.getAxisMotionValue(k)&&(this.constraints[k]=xB(w.layoutBox[k],this.constraints[k]))})}resolveRefConstraints(){const{dragConstraints:h,onMeasureDragConstraints:_}=this.getProps();if(!h||!Uh(h))return!1;const w=h.current,{projection:M}=this.visualElement;if(!M||!M.layout)return!1;const O=hB(w,M.root,this.visualElement.getTransformPagePoint());let k=_B(M.layout.layoutBox,O);if(_){const s=_(iB(k));this.hasMutatedConstraints=!!s,s&&(k=$A(s))}return k}startAnimation(h){const{drag:_,dragMomentum:w,dragElastic:M,dragTransition:O,dragSnapToOrigin:k,onDragTransitionEnd:s}=this.getProps(),W=this.constraints||{},X=Lo(Y=>{if(!Ug(Y,_,this.currentDirection))return;let fe=W&&W[Y]||{};k&&(fe={min:0,max:0});const Ie=M?200:1e6,je=M?40:1e7,He={type:"inertia",velocity:w?h[Y]:0,bounceStiffness:Ie,bounceDamping:je,timeConstant:750,restDelta:1,restSpeed:10,...O,...fe};return this.startAxisValueAnimation(Y,He)});return Promise.all(X).then(s)}startAxisValueAnimation(h,_){const w=this.getAxisMotionValue(h);return g0(this.visualElement,h),w.start(jv(h,w,0,_,this.visualElement,!1))}stopAnimation(){Lo(h=>this.getAxisMotionValue(h).stop())}pauseAnimation(){Lo(h=>{var _;return(_=this.getAxisMotionValue(h).animation)==null?void 0:_.pause()})}getAnimationState(h){var _;return(_=this.getAxisMotionValue(h).animation)==null?void 0:_.state}getAxisMotionValue(h){const _=`_drag${h.toUpperCase()}`,w=this.visualElement.getProps(),M=w[_];return M||this.visualElement.getValue(h,(w.initial?w.initial[h]:void 0)||0)}snapToCursor(h){Lo(_=>{const{drag:w}=this.getProps();if(!Ug(_,w,this.currentDirection))return;const{projection:M}=this.visualElement,O=this.getAxisMotionValue(_);if(M&&M.layout){const{min:k,max:s}=M.layout.layoutBox[_];O.set(h[_]-Mr(k,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:h,dragConstraints:_}=this.getProps(),{projection:w}=this.visualElement;if(!Uh(_)||!w||!this.constraints)return;this.stopAnimation();const M={x:0,y:0};Lo(k=>{const s=this.getAxisMotionValue(k);if(s&&this.constraints!==!1){const W=s.get();M[k]=yB({min:W,max:W},this.constraints[k])}});const{transformTemplate:O}=this.visualElement.getProps();this.visualElement.current.style.transform=O?O({},""):"none",w.root&&w.root.updateScroll(),w.updateLayout(),this.resolveConstraints(),Lo(k=>{if(!Ug(k,h,null))return;const s=this.getAxisMotionValue(k),{min:W,max:X}=this.constraints[k];s.set(Mr(W,X,M[k]))})}addListeners(){if(!this.visualElement.current)return;wB.set(this.visualElement,this);const h=this.visualElement.current,_=dp(h,"pointerdown",W=>{const{drag:X,dragListener:Y=!0}=this.getProps();X&&Y&&this.start(W)}),w=()=>{const{dragConstraints:W}=this.getProps();Uh(W)&&W.current&&(this.constraints=this.resolveRefConstraints())},{projection:M}=this.visualElement,O=M.addEventListener("measure",w);M&&!M.layout&&(M.root&&M.root.updateScroll(),M.updateLayout()),Pr.read(w);const k=Tp(window,"resize",()=>this.scalePositionWithinConstraints()),s=M.addEventListener("didUpdate",({delta:W,hasLayoutChanged:X})=>{this.isDragging&&X&&(Lo(Y=>{const fe=this.getAxisMotionValue(Y);fe&&(this.originPoint[Y]+=W[Y].translate,fe.set(fe.get()+W[Y].translate))}),this.visualElement.render())});return()=>{k(),_(),O(),s&&s()}}getProps(){const h=this.visualElement.getProps(),{drag:_=!1,dragDirectionLock:w=!1,dragPropagation:M=!1,dragConstraints:O=!1,dragElastic:k=R0,dragMomentum:s=!0}=h;return{...h,drag:_,dragDirectionLock:w,dragPropagation:M,dragConstraints:O,dragElastic:k,dragMomentum:s}}}function Ug(a,h,_){return(h===!0||h===a)&&(_===null||_===a)}function SB(a,h=10){let _=null;return Math.abs(a.y)>h?_="y":Math.abs(a.x)>h&&(_="x"),_}class EB extends hc{constructor(h){super(h),this.removeGroupControls=ko,this.removeListeners=ko,this.controls=new TB(h)}mount(){const{dragControls:h}=this.node.getProps();h&&(this.removeGroupControls=h.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ko}unmount(){this.removeGroupControls(),this.removeListeners()}}const ZT=a=>(h,_)=>{a&&Pr.postRender(()=>a(h,_))};class AB extends hc{constructor(){super(...arguments),this.removePointerDownListener=ko}onPointerDown(h){this.session=new KA(h,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:XA(this.node)})}createPanHandlers(){const{onPanSessionStart:h,onPanStart:_,onPan:w,onPanEnd:M}=this.node.getProps();return{onSessionStart:ZT(h),onStart:ZT(_),onMove:w,onEnd:(O,k)=>{delete this.session,M&&Pr.postRender(()=>M(O,k))}}}mount(){this.removePointerDownListener=dp(this.node.current,"pointerdown",h=>this.onPointerDown(h))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const Wg={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function XT(a,h){return h.max===h.min?0:a/(h.max-h.min)*100}const op={correct:(a,h)=>{if(!h.target)return a;if(typeof a=="string")if(qi.test(a))a=parseFloat(a);else return a;const _=XT(a,h.target.x),w=XT(a,h.target.y);return`${_}% ${w}%`}},IB={correct:(a,{treeScale:h,projectionDelta:_})=>{const w=a,M=cc.parse(a);if(M.length>5)return w;const O=cc.createTransformer(a),k=typeof M[0]!="number"?1:0,s=_.x.scale*h.x,W=_.y.scale*h.y;M[0+k]/=s,M[1+k]/=W;const X=Mr(s,W,.5);return typeof M[2+k]=="number"&&(M[2+k]/=X),typeof M[3+k]=="number"&&(M[3+k]/=X),O(M)}};class CB extends it.Component{componentDidMount(){const{visualElement:h,layoutGroup:_,switchLayoutGroup:w,layoutId:M}=this.props,{projection:O}=h;V3(MB),O&&(_.group&&_.group.add(O),w&&w.register&&M&&w.register(O),O.root.didUpdate(),O.addEventListener("animationComplete",()=>{this.safeToRemove()}),O.setOptions({...O.options,onExitComplete:()=>this.safeToRemove()})),Wg.hasEverUpdated=!0}getSnapshotBeforeUpdate(h){const{layoutDependency:_,visualElement:w,drag:M,isPresent:O}=this.props,{projection:k}=w;return k&&(k.isPresent=O,M||h.layoutDependency!==_||_===void 0||h.isPresent!==O?k.willUpdate():this.safeToRemove(),h.isPresent!==O&&(O?k.promote():k.relegate()||Pr.postRender(()=>{const s=k.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:h}=this.props.visualElement;h&&(h.root.didUpdate(),gv.postRender(()=>{!h.currentAnimation&&h.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:h,layoutGroup:_,switchLayoutGroup:w}=this.props,{projection:M}=h;M&&(M.scheduleCheckAfterUnmount(),_&&_.group&&_.group.remove(M),w&&w.deregister&&w.deregister(M))}safeToRemove(){const{safeToRemove:h}=this.props;h&&h()}render(){return null}}function QA(a){const[h,_]=x3(),w=it.useContext(HE);return Ae.jsx(CB,{...a,layoutGroup:w,switchLayoutGroup:it.useContext(eA),isPresent:h,safeToRemove:_})}const MB={borderRadius:{...op,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:op,borderTopRightRadius:op,borderBottomLeftRadius:op,borderBottomRightRadius:op,boxShadow:IB};function PB(a,h,_){const w=Ns(a)?a:td(a);return w.start(jv("",w,h,_)),w.animation}const RB=(a,h)=>a.depth-h.depth;class DB{constructor(){this.children=[],this.isDirty=!1}add(h){Av(this.children,h),this.isDirty=!0}remove(h){Iv(this.children,h),this.isDirty=!0}forEach(h){this.isDirty&&this.children.sort(RB),this.isDirty=!1,this.children.forEach(h)}}function zB(a,h){const _=no.now(),w=({timestamp:M})=>{const O=M-_;O>=h&&(lc(w),a(O-h))};return Pr.setup(w,!0),()=>lc(w)}const eI=["TopLeft","TopRight","BottomLeft","BottomRight"],LB=eI.length,KT=a=>typeof a=="string"?parseFloat(a):a,YT=a=>typeof a=="number"||qi.test(a);function kB(a,h,_,w,M,O){M?(a.opacity=Mr(0,_.opacity??1,OB(w)),a.opacityExit=Mr(h.opacity??1,0,FB(w))):O&&(a.opacity=Mr(h.opacity??1,_.opacity??1,w));for(let k=0;k<LB;k++){const s=`border${eI[k]}Radius`;let W=JT(h,s),X=JT(_,s);if(W===void 0&&X===void 0)continue;W||(W=0),X||(X=0),W===0||X===0||YT(W)===YT(X)?(a[s]=Math.max(Mr(KT(W),KT(X),w),0),(Ia.test(X)||Ia.test(W))&&(a[s]+="%")):a[s]=X}(h.rotate||_.rotate)&&(a.rotate=Mr(h.rotate||0,_.rotate||0,w))}function JT(a,h){return a[h]!==void 0?a[h]:a.borderRadius}const OB=tI(0,.5,MA),FB=tI(.5,.95,ko);function tI(a,h,_){return w=>w<a?0:w>h?1:_(wp(a,h,w))}function QT(a,h){a.min=h.min,a.max=h.max}function zo(a,h){QT(a.x,h.x),QT(a.y,h.y)}function eS(a,h){a.translate=h.translate,a.scale=h.scale,a.originPoint=h.originPoint,a.origin=h.origin}function tS(a,h,_,w,M){return a-=h,a=m_(a,1/_,w),M!==void 0&&(a=m_(a,1/M,w)),a}function BB(a,h=0,_=1,w=.5,M,O=a,k=a){if(Ia.test(h)&&(h=parseFloat(h),h=Mr(k.min,k.max,h/100)-k.min),typeof h!="number")return;let s=Mr(O.min,O.max,w);a===O&&(s-=h),a.min=tS(a.min,h,_,s,M),a.max=tS(a.max,h,_,s,M)}function iS(a,h,[_,w,M],O,k){BB(a,h[_],h[w],h[M],h.scale,O,k)}const NB=["x","scaleX","originX"],VB=["y","scaleY","originY"];function nS(a,h,_,w){iS(a.x,h,NB,_?_.x:void 0,w?w.x:void 0),iS(a.y,h,VB,_?_.y:void 0,w?w.y:void 0)}function rS(a){return a.translate===0&&a.scale===1}function iI(a){return rS(a.x)&&rS(a.y)}function sS(a,h){return a.min===h.min&&a.max===h.max}function jB(a,h){return sS(a.x,h.x)&&sS(a.y,h.y)}function oS(a,h){return Math.round(a.min)===Math.round(h.min)&&Math.round(a.max)===Math.round(h.max)}function nI(a,h){return oS(a.x,h.x)&&oS(a.y,h.y)}function aS(a){return qs(a.x)/qs(a.y)}function lS(a,h){return a.translate===h.translate&&a.scale===h.scale&&a.originPoint===h.originPoint}class UB{constructor(){this.members=[]}add(h){Av(this.members,h),h.scheduleRender()}remove(h){if(Iv(this.members,h),h===this.prevLead&&(this.prevLead=void 0),h===this.lead){const _=this.members[this.members.length-1];_&&this.promote(_)}}relegate(h){const _=this.members.findIndex(M=>h===M);if(_===0)return!1;let w;for(let M=_;M>=0;M--){const O=this.members[M];if(O.isPresent!==!1){w=O;break}}return w?(this.promote(w),!0):!1}promote(h,_){const w=this.lead;if(h!==w&&(this.prevLead=w,this.lead=h,h.show(),w)){w.instance&&w.scheduleRender(),h.scheduleRender(),h.resumeFrom=w,_&&(h.resumeFrom.preserveOpacity=!0),w.snapshot&&(h.snapshot=w.snapshot,h.snapshot.latestValues=w.animationValues||w.latestValues),h.root&&h.root.isUpdating&&(h.isLayoutDirty=!0);const{crossfade:M}=h.options;M===!1&&w.hide()}}exitAnimationComplete(){this.members.forEach(h=>{const{options:_,resumingFrom:w}=h;_.onExitComplete&&_.onExitComplete(),w&&w.options.onExitComplete&&w.options.onExitComplete()})}scheduleRender(){this.members.forEach(h=>{h.instance&&h.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function $B(a,h,_){let w="";const M=a.x.translate/h.x,O=a.y.translate/h.y,k=(_==null?void 0:_.z)||0;if((M||O||k)&&(w=`translate3d(${M}px, ${O}px, ${k}px) `),(h.x!==1||h.y!==1)&&(w+=`scale(${1/h.x}, ${1/h.y}) `),_){const{transformPerspective:X,rotate:Y,rotateX:fe,rotateY:Ie,skewX:je,skewY:He}=_;X&&(w=`perspective(${X}px) ${w}`),Y&&(w+=`rotate(${Y}deg) `),fe&&(w+=`rotateX(${fe}deg) `),Ie&&(w+=`rotateY(${Ie}deg) `),je&&(w+=`skewX(${je}deg) `),He&&(w+=`skewY(${He}deg) `)}const s=a.x.scale*h.x,W=a.y.scale*h.y;return(s!==1||W!==1)&&(w+=`scale(${s}, ${W})`),w||"none"}function rI(a){return WE(a)&&"ownerSVGElement"in a}function GB(a){return rI(a)&&a.tagName==="svg"}const t0=["","X","Y","Z"],HB={visibility:"hidden"},qB=1e3;let WB=0;function i0(a,h,_,w){const{latestValues:M}=h;M[a]&&(_[a]=M[a],h.setStaticValue(a,0),w&&(w[a]=0))}function sI(a){if(a.hasCheckedOptimisedAppear=!0,a.root===a)return;const{visualElement:h}=a.options;if(!h)return;const _=dA(h);if(window.MotionHasOptimisedAnimation(_,"transform")){const{layout:M,layoutId:O}=a.options;window.MotionCancelOptimisedAnimation(_,"transform",Pr,!(M||O))}const{parent:w}=a;w&&!w.hasCheckedOptimisedAppear&&sI(w)}function oI({attachResizeListener:a,defaultParent:h,measureScroll:_,checkIsScrollRoot:w,resetTransform:M}){return class{constructor(k={},s=h==null?void 0:h()){this.id=WB++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(KB),this.nodes.forEach(t5),this.nodes.forEach(i5),this.nodes.forEach(YB)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=k,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let W=0;W<this.path.length;W++)this.path[W].shouldResetTransform=!0;this.root===this&&(this.nodes=new DB)}addEventListener(k,s){return this.eventHandlers.has(k)||this.eventHandlers.set(k,new Cv),this.eventHandlers.get(k).add(s)}notifyListeners(k,...s){const W=this.eventHandlers.get(k);W&&W.notify(...s)}hasListeners(k){return this.eventHandlers.has(k)}mount(k){if(this.instance)return;this.isSVG=rI(k)&&!GB(k),this.instance=k;const{layoutId:s,layout:W,visualElement:X}=this.options;if(X&&!X.current&&X.mount(k),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(W||s)&&(this.isLayoutDirty=!0),a){let Y;const fe=()=>this.root.updateBlockedByResize=!1;a(k,()=>{this.root.updateBlockedByResize=!0,Y&&Y(),Y=zB(fe,250),Wg.hasAnimatedSinceResize&&(Wg.hasAnimatedSinceResize=!1,this.nodes.forEach(uS))})}s&&this.root.registerSharedNode(s,this),this.options.animate!==!1&&X&&(s||W)&&this.addEventListener("didUpdate",({delta:Y,hasLayoutChanged:fe,hasRelativeLayoutChanged:Ie,layout:je})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const He=this.options.transition||X.getDefaultTransition()||a5,{onLayoutAnimationStart:Re,onLayoutAnimationComplete:Ue}=X.getProps(),et=!this.targetLayout||!nI(this.targetLayout,je),vt=!fe&&Ie;if(this.options.layoutRoot||this.resumeFrom||vt||fe&&(et||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const ot={...Mv(He,"layout"),onPlay:Re,onComplete:Ue};(X.shouldReduceMotion||this.options.layoutRoot)&&(ot.delay=0,ot.type=!1),this.startAnimation(ot),this.setAnimationOrigin(Y,vt)}else fe||uS(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=je})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const k=this.getStack();k&&k.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),lc(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(n5),this.animationId++)}getTransformTemplate(){const{visualElement:k}=this.options;return k&&k.getProps().transformTemplate}willUpdate(k=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&sI(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let Y=0;Y<this.path.length;Y++){const fe=this.path[Y];fe.shouldResetTransform=!0,fe.updateScroll("snapshot"),fe.options.layoutRoot&&fe.willUpdate(!1)}const{layoutId:s,layout:W}=this.options;if(s===void 0&&!W)return;const X=this.getTransformTemplate();this.prevTransformTemplateValue=X?X(this.latestValues,""):void 0,this.updateSnapshot(),k&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(cS);return}this.isUpdating||this.nodes.forEach(QB),this.isUpdating=!1,this.nodes.forEach(e5),this.nodes.forEach(ZB),this.nodes.forEach(XB),this.clearAllSnapshots();const s=no.now();Is.delta=ul(0,1e3/60,s-Is.timestamp),Is.timestamp=s,Is.isProcessing=!0,Zx.update.process(Is),Zx.preRender.process(Is),Zx.render.process(Is),Is.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,gv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(JB),this.sharedNodes.forEach(r5)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Pr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Pr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!qs(this.snapshot.measuredBox.x)&&!qs(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let W=0;W<this.path.length;W++)this.path[W].updateScroll();const k=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Hr(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,k?k.layoutBox:void 0)}updateScroll(k="measure"){let s=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===k&&(s=!1),s&&this.instance){const W=w(this.instance);this.scroll={animationId:this.root.animationId,phase:k,isRoot:W,offset:_(this.instance),wasRoot:this.scroll?this.scroll.isRoot:W}}}resetTransform(){if(!M)return;const k=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,s=this.projectionDelta&&!iI(this.projectionDelta),W=this.getTransformTemplate(),X=W?W(this.latestValues,""):void 0,Y=X!==this.prevTransformTemplateValue;k&&this.instance&&(s||fu(this.latestValues)||Y)&&(M(this.instance,X),this.shouldResetTransform=!1,this.scheduleRender())}measure(k=!0){const s=this.measurePageBox();let W=this.removeElementScroll(s);return k&&(W=this.removeTransform(W)),l5(W),{animationId:this.root.animationId,measuredBox:s,layoutBox:W,latestValues:{},source:this.id}}measurePageBox(){var X;const{visualElement:k}=this.options;if(!k)return Hr();const s=k.measureViewportBox();if(!(((X=this.scroll)==null?void 0:X.wasRoot)||this.path.some(c5))){const{scroll:Y}=this.root;Y&&(Hh(s.x,Y.offset.x),Hh(s.y,Y.offset.y))}return s}removeElementScroll(k){var W;const s=Hr();if(zo(s,k),(W=this.scroll)!=null&&W.wasRoot)return s;for(let X=0;X<this.path.length;X++){const Y=this.path[X],{scroll:fe,options:Ie}=Y;Y!==this.root&&fe&&Ie.layoutScroll&&(fe.wasRoot&&zo(s,k),Hh(s.x,fe.offset.x),Hh(s.y,fe.offset.y))}return s}applyTransform(k,s=!1){const W=Hr();zo(W,k);for(let X=0;X<this.path.length;X++){const Y=this.path[X];!s&&Y.options.layoutScroll&&Y.scroll&&Y!==Y.root&&qh(W,{x:-Y.scroll.offset.x,y:-Y.scroll.offset.y}),fu(Y.latestValues)&&qh(W,Y.latestValues)}return fu(this.latestValues)&&qh(W,this.latestValues),W}removeTransform(k){const s=Hr();zo(s,k);for(let W=0;W<this.path.length;W++){const X=this.path[W];if(!X.instance||!fu(X.latestValues))continue;M0(X.latestValues)&&X.updateSnapshot();const Y=Hr(),fe=X.measurePageBox();zo(Y,fe),nS(s,X.latestValues,X.snapshot?X.snapshot.layoutBox:void 0,Y)}return fu(this.latestValues)&&nS(s,this.latestValues),s}setTargetDelta(k){this.targetDelta=k,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(k){this.options={...this.options,...k,crossfade:k.crossfade!==void 0?k.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Is.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(k=!1){var Ie;const s=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=s.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=s.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=s.isSharedProjectionDirty);const W=!!this.resumingFrom||this!==s;if(!(k||W&&this.isSharedProjectionDirty||this.isProjectionDirty||(Ie=this.parent)!=null&&Ie.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:Y,layoutId:fe}=this.options;if(!(!this.layout||!(Y||fe))){if(this.resolvedRelativeTargetAt=Is.timestamp,!this.targetDelta&&!this.relativeTarget){const je=this.getClosestProjectingParent();je&&je.layout&&this.animationProgress!==1?(this.relativeParent=je,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Hr(),this.relativeTargetOrigin=Hr(),pp(this.relativeTargetOrigin,this.layout.layoutBox,je.layout.layoutBox),zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Hr(),this.targetWithTransforms=Hr()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),cB(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):zo(this.target,this.layout.layoutBox),WA(this.target,this.targetDelta)):zo(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const je=this.getClosestProjectingParent();je&&!!je.resumingFrom==!!this.resumingFrom&&!je.options.layoutScroll&&je.target&&this.animationProgress!==1?(this.relativeParent=je,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Hr(),this.relativeTargetOrigin=Hr(),pp(this.relativeTargetOrigin,this.target,je.target),zo(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||M0(this.parent.latestValues)||qA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var He;const k=this.getLead(),s=!!this.resumingFrom||this!==k;let W=!0;if((this.isProjectionDirty||(He=this.parent)!=null&&He.isProjectionDirty)&&(W=!1),s&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(W=!1),this.resolvedRelativeTargetAt===Is.timestamp&&(W=!1),W)return;const{layout:X,layoutId:Y}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(X||Y))return;zo(this.layoutCorrected,this.layout.layoutBox);const fe=this.treeScale.x,Ie=this.treeScale.y;uB(this.layoutCorrected,this.treeScale,this.path,s),k.layout&&!k.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(k.target=k.layout.layoutBox,k.targetWithTransforms=Hr());const{target:je}=k;if(!je){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(eS(this.prevProjectionDelta.x,this.projectionDelta.x),eS(this.prevProjectionDelta.y,this.projectionDelta.y)),fp(this.projectionDelta,this.layoutCorrected,je,this.latestValues),(this.treeScale.x!==fe||this.treeScale.y!==Ie||!lS(this.projectionDelta.x,this.prevProjectionDelta.x)||!lS(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",je))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(k=!0){var s;if((s=this.options.visualElement)==null||s.scheduleRender(),k){const W=this.getStack();W&&W.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Gh(),this.projectionDelta=Gh(),this.projectionDeltaWithTransform=Gh()}setAnimationOrigin(k,s=!1){const W=this.snapshot,X=W?W.latestValues:{},Y={...this.latestValues},fe=Gh();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const Ie=Hr(),je=W?W.source:void 0,He=this.layout?this.layout.source:void 0,Re=je!==He,Ue=this.getStack(),et=!Ue||Ue.members.length<=1,vt=!!(Re&&!et&&this.options.crossfade===!0&&!this.path.some(o5));this.animationProgress=0;let ot;this.mixTargetDelta=Ct=>{const Dt=Ct/1e3;hS(fe.x,k.x,Dt),hS(fe.y,k.y,Dt),this.setTargetDelta(fe),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(pp(Ie,this.layout.layoutBox,this.relativeParent.layout.layoutBox),s5(this.relativeTarget,this.relativeTargetOrigin,Ie,Dt),ot&&jB(this.relativeTarget,ot)&&(this.isProjectionDirty=!1),ot||(ot=Hr()),zo(ot,this.relativeTarget)),Re&&(this.animationValues=Y,kB(Y,X,this.latestValues,Dt,vt,et)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Dt},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(k){var s,W,X;this.notifyListeners("animationStart"),(s=this.currentAnimation)==null||s.stop(),(X=(W=this.resumingFrom)==null?void 0:W.currentAnimation)==null||X.stop(),this.pendingAnimation&&(lc(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Pr.update(()=>{Wg.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=td(0)),this.currentAnimation=PB(this.motionValue,[0,1e3],{...k,isSync:!0,onUpdate:Y=>{this.mixTargetDelta(Y),k.onUpdate&&k.onUpdate(Y)},onStop:()=>{},onComplete:()=>{k.onComplete&&k.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const k=this.getStack();k&&k.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(qB),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const k=this.getLead();let{targetWithTransforms:s,target:W,layout:X,latestValues:Y}=k;if(!(!s||!W||!X)){if(this!==k&&this.layout&&X&&aI(this.options.animationType,this.layout.layoutBox,X.layoutBox)){W=this.target||Hr();const fe=qs(this.layout.layoutBox.x);W.x.min=k.target.x.min,W.x.max=W.x.min+fe;const Ie=qs(this.layout.layoutBox.y);W.y.min=k.target.y.min,W.y.max=W.y.min+Ie}zo(s,W),qh(s,Y),fp(this.projectionDeltaWithTransform,this.layoutCorrected,s,Y)}}registerSharedNode(k,s){this.sharedNodes.has(k)||this.sharedNodes.set(k,new UB),this.sharedNodes.get(k).add(s);const X=s.options.initialPromotionConfig;s.promote({transition:X?X.transition:void 0,preserveFollowOpacity:X&&X.shouldPreserveFollowOpacity?X.shouldPreserveFollowOpacity(s):void 0})}isLead(){const k=this.getStack();return k?k.lead===this:!0}getLead(){var s;const{layoutId:k}=this.options;return k?((s=this.getStack())==null?void 0:s.lead)||this:this}getPrevLead(){var s;const{layoutId:k}=this.options;return k?(s=this.getStack())==null?void 0:s.prevLead:void 0}getStack(){const{layoutId:k}=this.options;if(k)return this.root.sharedNodes.get(k)}promote({needsReset:k,transition:s,preserveFollowOpacity:W}={}){const X=this.getStack();X&&X.promote(this,W),k&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const k=this.getStack();return k?k.relegate(this):!1}resetSkewAndRotation(){const{visualElement:k}=this.options;if(!k)return;let s=!1;const{latestValues:W}=k;if((W.z||W.rotate||W.rotateX||W.rotateY||W.rotateZ||W.skewX||W.skewY)&&(s=!0),!s)return;const X={};W.z&&i0("z",k,X,this.animationValues);for(let Y=0;Y<t0.length;Y++)i0(`rotate${t0[Y]}`,k,X,this.animationValues),i0(`skew${t0[Y]}`,k,X,this.animationValues);k.render();for(const Y in X)k.setStaticValue(Y,X[Y]),this.animationValues&&(this.animationValues[Y]=X[Y]);k.scheduleRender()}getProjectionStyles(k){if(!this.instance||this.isSVG)return;if(!this.isVisible)return HB;const s={visibility:""},W=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,s.opacity="",s.pointerEvents=Hg(k==null?void 0:k.pointerEvents)||"",s.transform=W?W(this.latestValues,""):"none",s;const X=this.getLead();if(!this.projectionDelta||!this.layout||!X.target){const je={};return this.options.layoutId&&(je.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,je.pointerEvents=Hg(k==null?void 0:k.pointerEvents)||""),this.hasProjected&&!fu(this.latestValues)&&(je.transform=W?W({},""):"none",this.hasProjected=!1),je}const Y=X.animationValues||X.latestValues;this.applyTransformsToTarget(),s.transform=$B(this.projectionDeltaWithTransform,this.treeScale,Y),W&&(s.transform=W(Y,s.transform));const{x:fe,y:Ie}=this.projectionDelta;s.transformOrigin=`${fe.origin*100}% ${Ie.origin*100}% 0`,X.animationValues?s.opacity=X===this?Y.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:Y.opacityExit:s.opacity=X===this?Y.opacity!==void 0?Y.opacity:"":Y.opacityExit!==void 0?Y.opacityExit:0;for(const je in yp){if(Y[je]===void 0)continue;const{correct:He,applyTo:Re,isCSSVariable:Ue}=yp[je],et=s.transform==="none"?Y[je]:He(Y[je],X);if(Re){const vt=Re.length;for(let ot=0;ot<vt;ot++)s[Re[ot]]=et}else Ue?this.options.visualElement.renderState.vars[je]=et:s[je]=et}return this.options.layoutId&&(s.pointerEvents=X===this?Hg(k==null?void 0:k.pointerEvents)||"":"none"),s}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(k=>{var s;return(s=k.currentAnimation)==null?void 0:s.stop()}),this.root.nodes.forEach(cS),this.root.sharedNodes.clear()}}}function ZB(a){a.updateLayout()}function XB(a){var _;const h=((_=a.resumeFrom)==null?void 0:_.snapshot)||a.snapshot;if(a.isLead()&&a.layout&&h&&a.hasListeners("didUpdate")){const{layoutBox:w,measuredBox:M}=a.layout,{animationType:O}=a.options,k=h.source!==a.layout.source;O==="size"?Lo(fe=>{const Ie=k?h.measuredBox[fe]:h.layoutBox[fe],je=qs(Ie);Ie.min=w[fe].min,Ie.max=Ie.min+je}):aI(O,h.layoutBox,w)&&Lo(fe=>{const Ie=k?h.measuredBox[fe]:h.layoutBox[fe],je=qs(w[fe]);Ie.max=Ie.min+je,a.relativeTarget&&!a.currentAnimation&&(a.isProjectionDirty=!0,a.relativeTarget[fe].max=a.relativeTarget[fe].min+je)});const s=Gh();fp(s,w,h.layoutBox);const W=Gh();k?fp(W,a.applyTransform(M,!0),h.measuredBox):fp(W,w,h.layoutBox);const X=!iI(s);let Y=!1;if(!a.resumeFrom){const fe=a.getClosestProjectingParent();if(fe&&!fe.resumeFrom){const{snapshot:Ie,layout:je}=fe;if(Ie&&je){const He=Hr();pp(He,h.layoutBox,Ie.layoutBox);const Re=Hr();pp(Re,w,je.layoutBox),nI(He,Re)||(Y=!0),fe.options.layoutRoot&&(a.relativeTarget=Re,a.relativeTargetOrigin=He,a.relativeParent=fe)}}}a.notifyListeners("didUpdate",{layout:w,snapshot:h,delta:W,layoutDelta:s,hasLayoutChanged:X,hasRelativeLayoutChanged:Y})}else if(a.isLead()){const{onExitComplete:w}=a.options;w&&w()}a.options.transition=void 0}function KB(a){a.parent&&(a.isProjecting()||(a.isProjectionDirty=a.parent.isProjectionDirty),a.isSharedProjectionDirty||(a.isSharedProjectionDirty=!!(a.isProjectionDirty||a.parent.isProjectionDirty||a.parent.isSharedProjectionDirty)),a.isTransformDirty||(a.isTransformDirty=a.parent.isTransformDirty))}function YB(a){a.isProjectionDirty=a.isSharedProjectionDirty=a.isTransformDirty=!1}function JB(a){a.clearSnapshot()}function cS(a){a.clearMeasurements()}function QB(a){a.isLayoutDirty=!1}function e5(a){const{visualElement:h}=a.options;h&&h.getProps().onBeforeLayoutMeasure&&h.notify("BeforeLayoutMeasure"),a.resetTransform()}function uS(a){a.finishAnimation(),a.targetDelta=a.relativeTarget=a.target=void 0,a.isProjectionDirty=!0}function t5(a){a.resolveTargetDelta()}function i5(a){a.calcProjection()}function n5(a){a.resetSkewAndRotation()}function r5(a){a.removeLeadSnapshot()}function hS(a,h,_){a.translate=Mr(h.translate,0,_),a.scale=Mr(h.scale,1,_),a.origin=h.origin,a.originPoint=h.originPoint}function dS(a,h,_,w){a.min=Mr(h.min,_.min,w),a.max=Mr(h.max,_.max,w)}function s5(a,h,_,w){dS(a.x,h.x,_.x,w),dS(a.y,h.y,_.y,w)}function o5(a){return a.animationValues&&a.animationValues.opacityExit!==void 0}const a5={duration:.45,ease:[.4,0,.1,1]},fS=a=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(a),pS=fS("applewebkit/")&&!fS("chrome/")?Math.round:ko;function mS(a){a.min=pS(a.min),a.max=pS(a.max)}function l5(a){mS(a.x),mS(a.y)}function aI(a,h,_){return a==="position"||a==="preserve-aspect"&&!lB(aS(h),aS(_),.2)}function c5(a){var h;return a!==a.root&&((h=a.scroll)==null?void 0:h.wasRoot)}const u5=oI({attachResizeListener:(a,h)=>Tp(a,"resize",h),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),n0={current:void 0},lI=oI({measureScroll:a=>({x:a.scrollLeft,y:a.scrollTop}),defaultParent:()=>{if(!n0.current){const a=new u5({});a.mount(window),a.setOptions({layoutScroll:!0}),n0.current=a}return n0.current},resetTransform:(a,h)=>{a.style.transform=h!==void 0?h:"none"},checkIsScrollRoot:a=>window.getComputedStyle(a).position==="fixed"}),h5={pan:{Feature:AB},drag:{Feature:EB,ProjectionNode:lI,MeasureLayout:QA}};function cI(a,h,_){if(a instanceof EventTarget)return[a];if(typeof a=="string"){const M=document.querySelectorAll(a);return M?Array.from(M):[]}return Array.from(a)}function uI(a,h){const _=cI(a),w=new AbortController,M={passive:!0,...h,signal:w.signal};return[_,M,()=>w.abort()]}function gS(a){return!(a.pointerType==="touch"||JA())}function d5(a,h,_={}){const[w,M,O]=uI(a,_),k=s=>{if(!gS(s))return;const{target:W}=s,X=h(W,s);if(typeof X!="function"||!W)return;const Y=fe=>{gS(fe)&&(X(fe),W.removeEventListener("pointerleave",Y))};W.addEventListener("pointerleave",Y,M)};return w.forEach(s=>{s.addEventListener("pointerenter",k,M)}),O}function _S(a,h,_){const{props:w}=a;a.animationState&&w.whileHover&&a.animationState.setActive("whileHover",_==="Start");const M="onHover"+_,O=w[M];O&&Pr.postRender(()=>O(h,kp(h)))}class f5 extends hc{mount(){const{current:h}=this.node;h&&(this.unmount=d5(h,(_,w)=>(_S(this.node,w,"Start"),M=>_S(this.node,M,"End"))))}unmount(){}}class p5 extends hc{constructor(){super(...arguments),this.isActive=!1}onFocus(){let h=!1;try{h=this.node.current.matches(":focus-visible")}catch{h=!0}!h||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=zp(Tp(this.node.current,"focus",()=>this.onFocus()),Tp(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const hI=(a,h)=>h?a===h?!0:hI(a,h.parentElement):!1,m5=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function g5(a){return m5.has(a.tagName)||a.tabIndex!==-1}const Zg=new WeakSet;function yS(a){return h=>{h.key==="Enter"&&a(h)}}function r0(a,h){a.dispatchEvent(new PointerEvent("pointer"+h,{isPrimary:!0,bubbles:!0}))}const _5=(a,h)=>{const _=a.currentTarget;if(!_)return;const w=yS(()=>{if(Zg.has(_))return;r0(_,"down");const M=yS(()=>{r0(_,"up")}),O=()=>r0(_,"cancel");_.addEventListener("keyup",M,h),_.addEventListener("blur",O,h)});_.addEventListener("keydown",w,h),_.addEventListener("blur",()=>_.removeEventListener("keydown",w),h)};function xS(a){return Uv(a)&&!JA()}function y5(a,h,_={}){const[w,M,O]=uI(a,_),k=s=>{const W=s.currentTarget;if(!xS(s))return;Zg.add(W);const X=h(W,s),Y=(je,He)=>{window.removeEventListener("pointerup",fe),window.removeEventListener("pointercancel",Ie),Zg.has(W)&&Zg.delete(W),xS(je)&&typeof X=="function"&&X(je,{success:He})},fe=je=>{Y(je,W===window||W===document||_.useGlobalTarget||hI(W,je.target))},Ie=je=>{Y(je,!1)};window.addEventListener("pointerup",fe,M),window.addEventListener("pointercancel",Ie,M)};return w.forEach(s=>{(_.useGlobalTarget?window:s).addEventListener("pointerdown",k,M),ZE(s)&&(s.addEventListener("focus",X=>_5(X,M)),!g5(s)&&!s.hasAttribute("tabindex")&&(s.tabIndex=0))}),O}function vS(a,h,_){const{props:w}=a;if(a.current instanceof HTMLButtonElement&&a.current.disabled)return;a.animationState&&w.whileTap&&a.animationState.setActive("whileTap",_==="Start");const M="onTap"+(_==="End"?"":_),O=w[M];O&&Pr.postRender(()=>O(h,kp(h)))}class x5 extends hc{mount(){const{current:h}=this.node;h&&(this.unmount=y5(h,(_,w)=>(vS(this.node,w,"Start"),(M,{success:O})=>vS(this.node,M,O?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const D0=new WeakMap,s0=new WeakMap,v5=a=>{const h=D0.get(a.target);h&&h(a)},b5=a=>{a.forEach(v5)};function w5({root:a,...h}){const _=a||document;s0.has(_)||s0.set(_,{});const w=s0.get(_),M=JSON.stringify(h);return w[M]||(w[M]=new IntersectionObserver(b5,{root:a,...h})),w[M]}function T5(a,h,_){const w=w5(h);return D0.set(a,_),w.observe(a),()=>{D0.delete(a),w.unobserve(a)}}const S5={some:0,all:1};class E5 extends hc{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:h={}}=this.node.getProps(),{root:_,margin:w,amount:M="some",once:O}=h,k={root:_?_.current:void 0,rootMargin:w,threshold:typeof M=="number"?M:S5[M]},s=W=>{const{isIntersecting:X}=W;if(this.isInView===X||(this.isInView=X,O&&!X&&this.hasEnteredView))return;X&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",X);const{onViewportEnter:Y,onViewportLeave:fe}=this.node.getProps(),Ie=X?Y:fe;Ie&&Ie(W)};return T5(this.node.current,k,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:h,prevProps:_}=this.node;["amount","margin","root"].some(A5(h,_))&&this.startObserver()}unmount(){}}function A5({viewport:a={}},{viewport:h={}}={}){return _=>a[_]!==h[_]}const I5={inView:{Feature:E5},tap:{Feature:x5},focus:{Feature:p5},hover:{Feature:f5}},C5={layout:{ProjectionNode:lI,MeasureLayout:QA}},z0={current:null},dI={current:!1};function M5(){if(dI.current=!0,!!hv)if(window.matchMedia){const a=window.matchMedia("(prefers-reduced-motion)"),h=()=>z0.current=a.matches;a.addListener(h),h()}else z0.current=!1}const P5=new WeakMap;function R5(a,h,_){for(const w in h){const M=h[w],O=_[w];if(Ns(M))a.addValue(w,M);else if(Ns(O))a.addValue(w,td(M,{owner:a}));else if(O!==M)if(a.hasValue(w)){const k=a.getValue(w);k.liveStyle===!0?k.jump(M):k.hasAnimated||k.set(M)}else{const k=a.getStaticValue(w);a.addValue(w,td(k!==void 0?k:M,{owner:a}))}}for(const w in _)h[w]===void 0&&a.removeValue(w);return h}const fI=a=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(a),pI=a=>/^0[^.\s]+$/u.test(a),D5={test:a=>a==="auto",parse:a=>a},mI=a=>h=>h.test(a),gI=[ud,qi,Ia,rc,U3,j3,D5],bS=a=>gI.find(mI(a)),z5=[...gI,Fs,cc],L5=a=>z5.find(mI(a)),k5=new Set(["brightness","contrast","saturate","opacity"]);function O5(a){const[h,_]=a.slice(0,-1).split("(");if(h==="drop-shadow")return a;const[w]=_.match(Pv)||[];if(!w)return a;const M=_.replace(w,"");let O=k5.has(h)?1:0;return w!==_&&(O*=100),h+"("+O+M+")"}const F5=/\b([a-z-]*)\(.*?\)/gu,L0={...cc,getAnimatableNone:a=>{const h=a.match(F5);return h?h.map(O5).join(" "):a}},B5={...vv,color:Fs,backgroundColor:Fs,outlineColor:Fs,fill:Fs,stroke:Fs,borderColor:Fs,borderTopColor:Fs,borderRightColor:Fs,borderBottomColor:Fs,borderLeftColor:Fs,filter:L0,WebkitFilter:L0},_I=a=>B5[a];function yI(a,h){let _=_I(a);return _!==L0&&(_=cc),_.getAnimatableNone?_.getAnimatableNone(h):void 0}const wS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class N5{scrapeMotionValuesFromProps(h,_,w){return{}}constructor({parent:h,props:_,presenceContext:w,reducedMotionConfig:M,blockInitialAnimation:O,visualState:k},s={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Nv,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Ie=no.now();this.renderScheduledAt<Ie&&(this.renderScheduledAt=Ie,Pr.render(this.render,!1,!0))};const{latestValues:W,renderState:X}=k;this.latestValues=W,this.baseTarget={...W},this.initialValues=_.initial?{...W}:{},this.renderState=X,this.parent=h,this.props=_,this.presenceContext=w,this.depth=h?h.depth+1:0,this.reducedMotionConfig=M,this.options=s,this.blockInitialAnimation=!!O,this.isControllingVariants=D_(_),this.isVariantNode=JE(_),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(h&&h.current);const{willChange:Y,...fe}=this.scrapeMotionValuesFromProps(_,{},this);for(const Ie in fe){const je=fe[Ie];W[Ie]!==void 0&&Ns(je)&&je.set(W[Ie],!1)}}mount(h){this.current=h,P5.set(h,this),this.projection&&!this.projection.instance&&this.projection.mount(h),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((_,w)=>this.bindToMotionValue(w,_)),dI.current||M5(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:z0.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),lc(this.notifyUpdate),lc(this.render),this.valueSubscriptions.forEach(h=>h()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const h in this.events)this.events[h].clear();for(const h in this.features){const _=this.features[h];_&&(_.unmount(),_.isMounted=!1)}this.current=null}bindToMotionValue(h,_){this.valueSubscriptions.has(h)&&this.valueSubscriptions.get(h)();const w=cd.has(h);w&&this.onBindTransform&&this.onBindTransform();const M=_.on("change",s=>{this.latestValues[h]=s,this.props.onUpdate&&Pr.preRender(this.notifyUpdate),w&&this.projection&&(this.projection.isTransformDirty=!0)}),O=_.on("renderRequest",this.scheduleRender);let k;window.MotionCheckAppearSync&&(k=window.MotionCheckAppearSync(this,h,_)),this.valueSubscriptions.set(h,()=>{M(),O(),k&&k(),_.owner&&_.stop()})}sortNodePosition(h){return!this.current||!this.sortInstanceNodePosition||this.type!==h.type?0:this.sortInstanceNodePosition(this.current,h.current)}updateFeatures(){let h="animation";for(h in ed){const _=ed[h];if(!_)continue;const{isEnabled:w,Feature:M}=_;if(!this.features[h]&&M&&w(this.props)&&(this.features[h]=new M(this)),this.features[h]){const O=this.features[h];O.isMounted?O.update():(O.mount(),O.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Hr()}getStaticValue(h){return this.latestValues[h]}setStaticValue(h,_){this.latestValues[h]=_}update(h,_){(h.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=h,this.prevPresenceContext=this.presenceContext,this.presenceContext=_;for(let w=0;w<wS.length;w++){const M=wS[w];this.propEventSubscriptions[M]&&(this.propEventSubscriptions[M](),delete this.propEventSubscriptions[M]);const O="on"+M,k=h[O];k&&(this.propEventSubscriptions[M]=this.on(M,k))}this.prevMotionValues=R5(this,this.scrapeMotionValuesFromProps(h,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(h){return this.props.variants?this.props.variants[h]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(h){const _=this.getClosestVariantNode();if(_)return _.variantChildren&&_.variantChildren.add(h),()=>_.variantChildren.delete(h)}addValue(h,_){const w=this.values.get(h);_!==w&&(w&&this.removeValue(h),this.bindToMotionValue(h,_),this.values.set(h,_),this.latestValues[h]=_.get())}removeValue(h){this.values.delete(h);const _=this.valueSubscriptions.get(h);_&&(_(),this.valueSubscriptions.delete(h)),delete this.latestValues[h],this.removeValueFromRenderState(h,this.renderState)}hasValue(h){return this.values.has(h)}getValue(h,_){if(this.props.values&&this.props.values[h])return this.props.values[h];let w=this.values.get(h);return w===void 0&&_!==void 0&&(w=td(_===null?void 0:_,{owner:this}),this.addValue(h,w)),w}readValue(h,_){let w=this.latestValues[h]!==void 0||!this.current?this.latestValues[h]:this.getBaseTargetFromProps(this.props,h)??this.readValueFromInstance(this.current,h,this.options);return w!=null&&(typeof w=="string"&&(fI(w)||pI(w))?w=parseFloat(w):!L5(w)&&cc.test(_)&&(w=yI(h,_)),this.setBaseTarget(h,Ns(w)?w.get():w)),Ns(w)?w.get():w}setBaseTarget(h,_){this.baseTarget[h]=_}getBaseTarget(h){var O;const{initial:_}=this.props;let w;if(typeof _=="string"||typeof _=="object"){const k=Sv(this.props,_,(O=this.presenceContext)==null?void 0:O.custom);k&&(w=k[h])}if(_&&w!==void 0)return w;const M=this.getBaseTargetFromProps(this.props,h);return M!==void 0&&!Ns(M)?M:this.initialValues[h]!==void 0&&w===void 0?void 0:this.baseTarget[h]}on(h,_){return this.events[h]||(this.events[h]=new Cv),this.events[h].add(_)}notify(h,..._){this.events[h]&&this.events[h].notify(..._)}}const V5=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function j5(a){const h=V5.exec(a);if(!h)return[,];const[,_,w,M]=h;return[`--${_??w}`,M]}function xI(a,h,_=1){const[w,M]=j5(a);if(!w)return;const O=window.getComputedStyle(h).getPropertyValue(w);if(O){const k=O.trim();return fI(k)?parseFloat(k):k}return xv(M)?xI(M,h,_+1):M}function U5(a){return typeof a=="number"?a===0:a!==null?a==="none"||a==="0"||pI(a):!0}const $5=new Set(["auto","none","0"]);function G5(a,h,_){let w=0,M;for(;w<a.length&&!M;){const O=a[w];typeof O=="string"&&!$5.has(O)&&bp(O).values.length&&(M=a[w]),w++}if(M&&_)for(const O of h)a[O]=yI(_,M)}class H5 extends Nv{constructor(h,_,w,M,O){super(h,_,w,M,O,!0)}readKeyframes(){const{unresolvedKeyframes:h,element:_,name:w}=this;if(!_||!_.current)return;super.readKeyframes();for(let W=0;W<h.length;W++){let X=h[W];if(typeof X=="string"&&(X=X.trim(),xv(X))){const Y=xI(X,_.current);Y!==void 0&&(h[W]=Y),W===h.length-1&&(this.finalKeyframe=X)}}if(this.resolveNoneKeyframes(),!NA.has(w)||h.length!==2)return;const[M,O]=h,k=bS(M),s=bS(O);if(k!==s)if(IT(k)&&IT(s))for(let W=0;W<h.length;W++){const X=h[W];typeof X=="string"&&(h[W]=parseFloat(X))}else yu[w]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:h,name:_}=this,w=[];for(let M=0;M<h.length;M++)(h[M]===null||U5(h[M]))&&w.push(M);w.length&&G5(h,w,_)}measureInitialState(){const{element:h,unresolvedKeyframes:_,name:w}=this;if(!h||!h.current)return;w==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=yu[w](h.measureViewportBox(),window.getComputedStyle(h.current)),_[0]=this.measuredOrigin;const M=_[_.length-1];M!==void 0&&h.getValue(w,M).jump(M,!1)}measureEndState(){var s;const{element:h,name:_,unresolvedKeyframes:w}=this;if(!h||!h.current)return;const M=h.getValue(_);M&&M.jump(this.measuredOrigin,!1);const O=w.length-1,k=w[O];w[O]=yu[_](h.measureViewportBox(),window.getComputedStyle(h.current)),k!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=k),(s=this.removedTransforms)!=null&&s.length&&this.removedTransforms.forEach(([W,X])=>{h.getValue(W).set(X)}),this.resolveNoneKeyframes()}}class vI extends N5{constructor(){super(...arguments),this.KeyframeResolver=H5}sortInstanceNodePosition(h,_){return h.compareDocumentPosition(_)&2?1:-1}getBaseTargetFromProps(h,_){return h.style?h.style[_]:void 0}removeValueFromRenderState(h,{vars:_,style:w}){delete _[h],delete w[h]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:h}=this.props;Ns(h)&&(this.childSubscription=h.on("change",_=>{this.current&&(this.current.textContent=`${_}`)}))}}function bI(a,{style:h,vars:_},w,M){Object.assign(a.style,h,M&&M.getProjectionStyles(w));for(const O in _)a.style.setProperty(O,_[O])}function q5(a){return window.getComputedStyle(a)}class W5 extends vI{constructor(){super(...arguments),this.type="html",this.renderInstance=bI}readValueFromInstance(h,_){var w;if(cd.has(_))return(w=this.projection)!=null&&w.isProjecting?T0(_):_F(h,_);{const M=q5(h),O=(yv(_)?M.getPropertyValue(_):M[_])||0;return typeof O=="string"?O.trim():O}}measureInstanceViewportBox(h,{transformPagePoint:_}){return ZA(h,_)}build(h,_,w){bv(h,_,w.transformTemplate)}scrapeMotionValuesFromProps(h,_,w){return Ev(h,_,w)}}const wI=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function Z5(a,h,_,w){bI(a,h,void 0,w);for(const M in h.attrs)a.setAttribute(wI.has(M)?M:mv(M),h.attrs[M])}class X5 extends vI{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Hr}getBaseTargetFromProps(h,_){return h[_]}readValueFromInstance(h,_){if(cd.has(_)){const w=_I(_);return w&&w.default||0}return _=wI.has(_)?_:mv(_),h.getAttribute(_)}scrapeMotionValuesFromProps(h,_,w){return uA(h,_,w)}build(h,_,w){oA(h,_,this.isSVGTag,w.transformTemplate,w.style)}renderInstance(h,_,w,M){Z5(h,_,w,M)}mount(h){this.isSVGTag=lA(h.tagName),super.mount(h)}}const K5=(a,h)=>Tv(a)?new X5(h):new W5(h,{allowProjection:a!==it.Fragment}),Y5=oO({...eB,...I5,...h5,...C5},K5),Hs=A3(Y5),J5={some:0,all:1};function Q5(a,h,{root:_,margin:w,amount:M="some"}={}){const O=cI(a),k=new WeakMap,s=X=>{X.forEach(Y=>{const fe=k.get(Y.target);if(Y.isIntersecting!==!!fe)if(Y.isIntersecting){const Ie=h(Y.target,Y);typeof Ie=="function"?k.set(Y.target,Ie):W.unobserve(Y.target)}else typeof fe=="function"&&(fe(Y),k.delete(Y.target))})},W=new IntersectionObserver(s,{root:_,rootMargin:w,threshold:typeof M=="number"?M:J5[M]});return O.forEach(X=>W.observe(X)),()=>W.disconnect()}function e4(a,{root:h,margin:_,amount:w,once:M=!1,initial:O=!1}={}){const[k,s]=it.useState(O);return it.useEffect(()=>{if(!a.current||M&&k)return;const W=()=>(s(!0),M?void 0:()=>s(!1)),X={root:h&&h.current||void 0,margin:_,amount:w};return Q5(a.current,W,X)},[h,a,_,M,w]),k}const t4=Ra([Ae.jsx("circle",{cx:"9",cy:"8",r:"2",opacity:".3"},"0"),Ae.jsx("path",{d:"M9 15c-2.7 0-5.8 1.29-6 2.01V18h12v-1c-.2-.71-3.3-2-6-2",opacity:".3"},"1"),Ae.jsx("path",{d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 0c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0-6c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m0 7c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m6 5H3v-.99C3.2 16.29 6.3 15 9 15s5.8 1.29 6 2z"},"2")]),i4=Ra([Ae.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 2v3H4V5zM4 21V10h16v11z"},"0"),Ae.jsx("path",{d:"M4 5.01h16V8H4z",opacity:".3"},"1")]),n4=Ra([Ae.jsx("path",{d:"M12 4c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6m2.31 9.69L12 11.93l-2.32 1.76.88-2.85L8.25 9h2.84L12 6.19 12.91 9h2.84l-2.32 1.84zM12 19l-4 1.02v-3.1c1.18.68 2.54 1.08 4 1.08s2.82-.4 4-1.08v3.1z",opacity:".3"},"0"),Ae.jsx("path",{d:"M9.68 13.69 12 11.93l2.31 1.76-.88-2.85L15.75 9h-2.84L12 6.19 11.09 9H8.25l2.31 1.84zM20 10c0-4.42-3.58-8-8-8s-8 3.58-8 8c0 2.03.76 3.87 2 5.28V23l6-2 6 2v-7.72c1.24-1.41 2-3.25 2-5.28m-8-6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6m0 15-4 1.02v-3.1c1.18.68 2.54 1.08 4 1.08s2.82-.4 4-1.08v3.1z"},"1")]),r4=Ra([Ae.jsx("path",{d:"M15 7H7.89l3.57 5-3.57 5H15l3.55-5z",opacity:".3"},"0"),Ae.jsx("path",{d:"M16.63 5.84C16.27 5.33 15.67 5 15 5H4l5 7-5 6.99h11c.67 0 1.27-.32 1.63-.83L21 12zM15 17H7.89l3.57-5-3.57-5H15l3.55 5z"},"1")]),z_=({sectionId:a})=>{const{setActiveSection:h,setTriggerRelocation:_}=it.useContext(Tu),w=it.useRef(null),M=e4(w,{once:!1});return it.useEffect(()=>{M&&(h(a),_(!1))},[M,h,_]),Ae.jsx(zn,{ref:w,sx:{position:"absolute"}})},s4=[{title:parseInt(h0().format("YYYY"))-1989+" Años",subtitle:"de Asistencia Médica",icon:Ae.jsx(i4,{sx:{fontSize:40,color:"#13322c"}}),color:"#275e51"},{title:"Colaboración",subtitle:"y Avances en Salud",icon:Ae.jsx(t4,{sx:{fontSize:40,color:"#13322c"}}),color:"#275e51"},{title:"Innovación",subtitle:"y Excelencia",icon:Ae.jsx(n4,{sx:{fontSize:40,color:"#13322c"}}),color:"#275e51"}],o4=()=>{const a=hl("(max-width : 1050px)");return Ae.jsxs(nr,{container:!0,columns:12,sx:{display:"flex",minHeight:"auto",flexDirection:"column",mt:a?0:2,mb:a?4:7},children:[Ae.jsx(nr,{size:12,sx:{textAlign:"center",minHeight:a?"46.5vh":"65vh"},children:Ae.jsx(g3,{})}),Ae.jsxs(zn,{children:[Ae.jsx(nr,{container:!0,columns:12,sx:{display:"flex",flexDirection:a?"column":"row",justifyContent:"center",gap:3,mb:4,mt:2,ml:a?2:0,mr:a?2:0},children:s4.map((h,_)=>Ae.jsx(nr,{size:"auto",children:Ae.jsx(BR,{component:Hs.div,initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.85,delay:.3*_},viewport:{once:!0},sx:{borderRadius:3,boxShadow:3,borderTop:`4px solid ${h.color}`,width:a?"100%":370,textAlign:"center","&:hover":{transform:"scale(1.05)",boxShadow:4}},children:Ae.jsxs(UR,{children:[Ae.jsx(zn,{display:"flex",justifyContent:"center",mb:1,children:h.icon}),Ae.jsx(Jn,{variant:"h6",fontWeight:"bold",color:"text.primary",children:h.title}),Ae.jsx(Jn,{variant:"body2",color:"background.default",children:h.subtitle})]})})},h.title))}),Ae.jsx(nr,{component:Hs.div,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut",delay:.8},viewport:{once:!0},size:12,sx:{pt:a?0:2},children:Ae.jsxs(zn,{sx:{display:"flex",position:"relative",flexDirection:"column",pt:a?2:0,backgroundColor:"primary.main",borderRadius:5,width:a?"auto":"100%",m:"auto",p:a?2:"20px 40px 20px 40px",gap:3,borderLeft:"",pl:a?3:25,pr:a?3:25},children:[Ae.jsx(z_,{sectionId:"Inicio"}),Ae.jsx(Jn,{m:"auto",fontFamily:"sans-serif",fontWeight:"bold",textAlign:"justify",sx:{color:"secondary.main",fontSize:a?"18px":"27px"},children:"MENSAJE DE BIENVENIDA"}),Ae.jsx("img",{loading:"eager",width:a?"165px":"200px",height:"auto",src:"./leaf_ornament.webp",style:{margin:"auto",marginTop:-20}}),Ae.jsxs(Jn,{fontFamily:"sans-serif",fontWeight:500,textAlign:"justify",letterSpacing:.5,lineHeight:a?"auto":2,sx:{color:"secondary.main",fontSize:a?"18px":"20px"},children:["Es un honor darles la bienvenida a este congreso tan especial, donde celebramos ",Ae.jsxs("b",{style:{color:"#13322c"},children:[" ",parseInt(h0.utc().format("YYYY"))-1989," años de logros, colaboración y avances"]})," en el campo de la salud de Veracruz."]}),Ae.jsxs(Jn,{fontFamily:"sans-serif",fontWeight:500,textAlign:"justify",letterSpacing:.5,lineHeight:a?"auto":2,sx:{color:"secondary.main",fontSize:a?"18px":"20px"},children:["A lo largo de estos ",parseInt(h0.utc().format("YYYY"))-1989," años, hemos enfrentado numerosos desafíos, pero también hemos alcanzado metas significativas gracias al esfuerzo y dedicación de cada uno de ustedes. Este congreso es un testimonio de nuestro ",Ae.jsx("b",{style:{color:"#13322c"},children:"compromiso continuo con la excelencia y la innovación"}),"."]}),Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:500,textAlign:"justify",letterSpacing:.5,lineHeight:a?"auto":2,fontStyle:"italic",sx:{color:"gray",fontSize:a?"18px":"20px",p:2,textAlign:"right",borderRadius:5,borderLeft:"4px solid #50736c"},children:'"Quiero expresar mi más profundo agradecimiento a todos los que han contribuido a este viaje: a nuestros directivos, por su apoyo incondicional; a los ponentes, por compartir su valioso conocimiento; y a todos los asistentes, por su entusiasmo y participación activa".'}),Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:500,textAlign:"justify",letterSpacing:.5,lineHeight:a?"auto":2,sx:{color:"secondary.main",fontSize:a?"18px":"20px"},children:"En este evento, no solo celebraremos nuestros logros pasados, sino que también exploraremos nuevas ideas y estrategias para enfrentar los retos futuros."})]})}),Ae.jsxs(nr,{container:!0,spacing:4,columns:12,sx:{pl:a?3:25,pr:a?3:25,mt:3},children:[Ae.jsxs(nr,{component:Hs.div,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut",delay:.5},viewport:{once:!0},size:12,sx:{display:"flex",justifyContent:"center",mb:2},children:[Ae.jsx(r4,{sx:{fontSize:a?33:40,color:"#13322c",mr:1}}),Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:"bold",textAlign:"justify",sx:{fontSize:a?"18px":"24px",mt:"auto",mb:"auto"},children:"INFORMACIÓN IMPORTANTE"})]}),Ae.jsxs(nr,{component:Hs.div,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut",delay:.7},viewport:{once:!0},size:a?12:4,sx:{display:"flex",justifyContent:"left",flexDirection:"column"},children:[Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:"bold",textAlign:a?"left":"center",fontSize:a?"18px":"20px",color:"#13322c",children:"TEMA PRINCIPAL"}),Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:400,fontSize:"18px",textAlign:a?"left":"center",letterSpacing:.5,children:"DESAFIOS EN SALUD DESDE EL TERCER NIVEL DE ATENCIÓN Y EL USO DE LA INTELIGENCIA ARTIFICIAL EN EL CAE"})]}),Ae.jsxs(nr,{component:Hs.div,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut",delay:.9},viewport:{once:!0},size:a?12:4,children:[Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:"bold",textAlign:a?"left":"center",fontSize:a?"18px":"20px",color:"#13322c",children:"FECHAS"}),Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:400,fontSize:"18px",textAlign:a?"left":"center",letterSpacing:.5,children:"27 AL 29 DE NOVIEMBRE - 2025"})]}),Ae.jsxs(nr,{component:Hs.div,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut",delay:1.1},viewport:{once:!0},size:a?12:4,children:[Ae.jsx(Jn,{fontFamily:"sans-serif",fontWeight:"bold",textAlign:a?"left":"center",fontSize:a?"18px":"20px",color:"#13322c",children:"COSTOS"}),Ae.jsxs(Jn,{fontFamily:"sans-serif",fontWeight:400,fontSize:"18px",textAlign:a?"left":"center",letterSpacing:.5,children:["Medicina: $800 pesos",Ae.jsx("br",{}),"Enfermería: $300 pesos",Ae.jsx("br",{}),"Químicos: $300 pesos",Ae.jsx("br",{}),"Odontología: $300 pesos",Ae.jsx("br",{}),Ae.jsx(Kh,{sx:{mt:"5px",mb:"5px",width:"50%",ml:"auto",mr:"auto"}}),"Estudiantes: $200 pesos"]})]})]})]})]})},a4=[{id:1,title:"CONGRESO GENERAL",place:"HOTEL XALAPA (SALÓN GOBERNADORES Y MARGARITAS)",address:"Guadalupe Victoria 163, Zona Centro, Centro, 91000 Xalapa-Enríquez, Ver.",map:"https://www.google.com/maps/place/Gran+Hotel+Xalapa/@19.5308982,-96.9301983,206m/data=!3m1!1e3!4m9!3m8!1s0x85db2e078654c40d:0xd479ebcae355883f!5m2!4m1!1i2!8m2!3d19.5314895!4d-96.9294777!16s%2Fg%2F1tcz_wlm?entry=ttu&g_ep=EgoyMDI1MTAwMS4wIKXMDSoASAFQAw%3D%3D",location:[-96.92947807721428,19.531518343354062]}],l4=[{id:1,title:"CONGRESO DE MEDICINA Y ENFERMERIA",place:'AUDITORIO "LA CALERA"',address:"Av. Libertad #84, Centro, Banderilla, Ver.",map:"https://www.google.com/maps/place/Auditorio+La+Calera/@19.5880245,-96.9367653,21z/data=!4m14!1m7!3m6!1s0x85db2f70dc981183:0x87c40b494ab4247!2sAuditorio+La+Calera!8m2!3d19.5880971!4d-96.9367311!16s%2Fg%2F11hf38_vl3!3m5!1s0x85db2f70dc981183:0x87c40b494ab4247!8m2!3d19.5880971!4d-96.9367311!16s%2Fg%2F11hf38_vl3?entry=ttu&g_ep=EgoyMDI0MTExMS4wIKXMDSoASAFQAw%3D%3D",location:[-96.93671537793244,19.588090811612958]},{id:2,title:"TALLERES",place:"HOTEL KLIMIT",address:"Av. Miguel Alemán #310 Col. Laderas de Macuiltepetl, Xalapa, Ver.",map:"https://www.google.com/maps/place/Hotel+Klimt/@19.5429163,-96.919342,19.72z/data=!4m9!3m8!1s0x85db31e62f9e703d:0x49c95114b908a981!5m2!4m1!1i2!8m2!3d19.5428097!4d-96.9192168!16s%2Fg%2F11ggs3blfr?entry=ttu&g_ep=EgoyMDI0MTExMS4wIKXMDSoASAFQAw%3D%3D",location:[-96.91924225652667,19.542849287196848]},{id:3,title:"CONGRESO DE QUÍMICOS Y ESTOMATOLOGÍA",place:"Centro de Alta Epecialidad Dr. Rafael Lucio",address:"Av. Adolfo Ruiz Cortines 2903, Unidad Magisterial, Xalapa, Ver.",map:"https://www.google.com.mx/maps/place/Centro+de+Alta+Especialidad+%22Dr.+Rafael+Lucio%22/@19.5517662,-96.9384562,17z/data=!3m1!4b1!4m6!3m5!1s0x85db2e16cb33d43b:0xef08a9e7531a4f7d!8m2!3d19.5517612!4d-96.9358813!16s%2Fg%2F1yl452rl7?entry=ttu&g_ep=EgoyMDI0MTExOC4wIKXMDSoASAFQAw%3D%3D",location:[-96.93588130332994,19.551993716336828]}],c4=[{id:1,title:"CONGRESO GENERAL",place:"HOTEL GAMMA NUBARA",address:"Av. Adolfo Ruiz Cortines 912 Col, U.H. del Bosque, 91017 Xalapa, Ver.",map:"https://www.google.com/maps/place/Gamma+Xalapa+Nubara/@19.558173,-96.931181,17z/data=!3m1!4b1!4m9!3m8!1s0x85db2e232efcc82b:0x1f5cbcbce6916a50!5m2!4m1!1i2!8m2!3d19.558173!4d-96.931181!16s%2Fg%2F1tmxfxql?entry=ttu&g_ep=EgoyMDI1MDYxNi4wIKXMDSoASAFQAw%3D%3D",location:[-96.93122391534591,19.558360031273345]},{id:2,title:"TALLER DE MEDICINA",place:"Centro de Alta Epecialidad Dr. Rafael Lucio",address:"Av. Adolfo Ruiz Cortines 2903, Unidad Magisterial, Xalapa, Ver.",map:"https://www.google.com.mx/maps/place/Centro+de+Alta+Especialidad+%22Dr.+Rafael+Lucio%22/@19.5517662,-96.9384562,17z/data=!3m1!4b1!4m6!3m5!1s0x85db2e16cb33d43b:0xef08a9e7531a4f7d!8m2!3d19.5517612!4d-96.9358813!16s%2Fg%2F1yl452rl7?entry=ttu&g_ep=EgoyMDI0MTExOC4wIKXMDSoASAFQAw%3D%3D",location:[-96.93588130332994,19.551993716336828]},{id:3,title:"TALLERES DE ESTOMATOLOGÍA",place:"Centro de Alta Epecialidad Dr. Rafael Lucio",address:"Av. Adolfo Ruiz Cortines 2903, Unidad Magisterial, Xalapa, Ver.",map:"https://www.google.com.mx/maps/place/Centro+de+Alta+Especialidad+%22Dr.+Rafael+Lucio%22/@19.5517662,-96.9384562,17z/data=!3m1!4b1!4m6!3m5!1s0x85db2e16cb33d43b:0xef08a9e7531a4f7d!8m2!3d19.5517612!4d-96.9358813!16s%2Fg%2F1yl452rl7?entry=ttu&g_ep=EgoyMDI0MTExOC4wIKXMDSoASAFQAw%3D%3D",location:[-96.93588130332994,19.551993716336828]}];var Xg={exports:{}},u4=Xg.exports,TS;function h4(){return TS||(TS=1,function(a,h){(function(_,w){a.exports=w()})(u4,function(){var _,w,M;function O(s,W){if(!_)_=W;else if(!w)w=W;else{var X="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+_+")(sharedChunk); ("+w+")(sharedChunk); self.onerror = null;",Y={};_(Y),M=W(Y),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}O(["exports"],function(s){var W=1e-6,X=typeof Float32Array<"u"?Float32Array:Array;function Y(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*d-l*o;return f?(n[0]=d*(f=1/f),n[1]=-o*f,n[2]=-l*f,n[3]=i*f,n):null}function fe(){var n=new X(9);return X!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Ie(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],S=e[8];return n[0]=f*S-g*b,n[1]=l*b-o*S,n[2]=o*g-l*f,n[3]=g*x-d*S,n[4]=i*S-l*x,n[5]=l*d-i*g,n[6]=d*b-f*x,n[7]=o*x-i*b,n[8]=i*f-o*d,n}function je(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],S=e[7],E=e[8],I=i[0],D=i[1],z=i[2],F=i[3],$=i[4],H=i[5],ee=i[6],K=i[7],N=i[8];return n[0]=I*o+D*f+z*b,n[1]=I*l+D*g+z*S,n[2]=I*d+D*x+z*E,n[3]=F*o+$*f+H*b,n[4]=F*l+$*g+H*S,n[5]=F*d+$*x+H*E,n[6]=ee*o+K*f+N*b,n[7]=ee*l+K*g+N*S,n[8]=ee*d+K*x+N*E,n}function He(){var n=new X(16);return X!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Re(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Ue(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],S=e[8],E=e[9],I=e[10],D=e[11],z=e[12],F=e[13],$=e[14],H=e[15],ee=i*g-o*f,K=i*x-l*f,N=i*b-d*f,Z=o*x-l*g,Q=o*b-d*g,re=l*b-d*x,pe=S*F-E*z,_e=S*$-I*z,xe=S*H-D*z,Te=E*$-I*F,Be=E*H-D*F,Je=I*H-D*$,Ze=ee*Je-K*Be+N*Te+Z*xe-Q*_e+re*pe;return Ze?(n[0]=(g*Je-x*Be+b*Te)*(Ze=1/Ze),n[1]=(l*Be-o*Je-d*Te)*Ze,n[2]=(F*re-$*Q+H*Z)*Ze,n[3]=(I*Q-E*re-D*Z)*Ze,n[4]=(x*xe-f*Je-b*_e)*Ze,n[5]=(i*Je-l*xe+d*_e)*Ze,n[6]=($*N-z*re-H*K)*Ze,n[7]=(S*re-I*N+D*K)*Ze,n[8]=(f*Be-g*xe+b*pe)*Ze,n[9]=(o*xe-i*Be-d*pe)*Ze,n[10]=(z*Q-F*N+H*ee)*Ze,n[11]=(E*N-S*Q-D*ee)*Ze,n[12]=(g*_e-f*Te-x*pe)*Ze,n[13]=(i*Te-o*_e+l*pe)*Ze,n[14]=(F*K-z*Z-$*ee)*Ze,n[15]=(S*Z-E*K+I*ee)*Ze,n):null}function et(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],S=e[7],E=e[8],I=e[9],D=e[10],z=e[11],F=e[12],$=e[13],H=e[14],ee=e[15],K=i[0],N=i[1],Z=i[2],Q=i[3];return n[0]=K*o+N*g+Z*E+Q*F,n[1]=K*l+N*x+Z*I+Q*$,n[2]=K*d+N*b+Z*D+Q*H,n[3]=K*f+N*S+Z*z+Q*ee,n[4]=(K=i[4])*o+(N=i[5])*g+(Z=i[6])*E+(Q=i[7])*F,n[5]=K*l+N*x+Z*I+Q*$,n[6]=K*d+N*b+Z*D+Q*H,n[7]=K*f+N*S+Z*z+Q*ee,n[8]=(K=i[8])*o+(N=i[9])*g+(Z=i[10])*E+(Q=i[11])*F,n[9]=K*l+N*x+Z*I+Q*$,n[10]=K*d+N*b+Z*D+Q*H,n[11]=K*f+N*S+Z*z+Q*ee,n[12]=(K=i[12])*o+(N=i[13])*g+(Z=i[14])*E+(Q=i[15])*F,n[13]=K*l+N*x+Z*I+Q*$,n[14]=K*d+N*b+Z*D+Q*H,n[15]=K*f+N*S+Z*z+Q*ee,n}function vt(n,e,i){var o,l,d,f,g,x,b,S,E,I,D,z,F=i[0],$=i[1],H=i[2];return e===n?(n[12]=e[0]*F+e[4]*$+e[8]*H+e[12],n[13]=e[1]*F+e[5]*$+e[9]*H+e[13],n[14]=e[2]*F+e[6]*$+e[10]*H+e[14],n[15]=e[3]*F+e[7]*$+e[11]*H+e[15]):(l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],S=e[7],E=e[8],I=e[9],D=e[10],z=e[11],n[0]=o=e[0],n[1]=l,n[2]=d,n[3]=f,n[4]=g,n[5]=x,n[6]=b,n[7]=S,n[8]=E,n[9]=I,n[10]=D,n[11]=z,n[12]=o*F+g*$+E*H+e[12],n[13]=l*F+x*$+I*H+e[13],n[14]=d*F+b*$+D*H+e[14],n[15]=f*F+S*$+z*H+e[15]),n}function ot(n,e,i){var o=i[0],l=i[1],d=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*l,n[5]=e[5]*l,n[6]=e[6]*l,n[7]=e[7]*l,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Ct(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[4],f=e[5],g=e[6],x=e[7],b=e[8],S=e[9],E=e[10],I=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*l+b*o,n[5]=f*l+S*o,n[6]=g*l+E*o,n[7]=x*l+I*o,n[8]=b*l-d*o,n[9]=S*l-f*o,n[10]=E*l-g*o,n[11]=I*l-x*o,n}function Dt(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],b=e[8],S=e[9],E=e[10],I=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l-b*o,n[1]=f*l-S*o,n[2]=g*l-E*o,n[3]=x*l-I*o,n[8]=d*o+b*l,n[9]=f*o+S*l,n[10]=g*o+E*l,n[11]=x*o+I*l,n}function Vt(n,e,i){var o=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],b=e[4],S=e[5],E=e[6],I=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l+b*o,n[1]=f*l+S*o,n[2]=g*l+E*o,n[3]=x*l+I*o,n[4]=b*l-d*o,n[5]=S*l-f*o,n[6]=E*l-g*o,n[7]=I*l-x*o,n}function hi(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Kt(n,e,i){var o,l,d,f=i[0],g=i[1],x=i[2],b=Math.hypot(f,g,x);return b<W?null:(f*=b=1/b,g*=b,x*=b,o=Math.sin(e),l=Math.cos(e),n[0]=f*f*(d=1-l)+l,n[1]=g*f*d+x*o,n[2]=x*f*d-g*o,n[3]=0,n[4]=f*g*d-x*o,n[5]=g*g*d+l,n[6]=x*g*d+f*o,n[7]=0,n[8]=f*x*d+g*o,n[9]=g*x*d-f*o,n[10]=x*x*d+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Ei(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i+i,g=o+o,x=l+l,b=i*f,S=o*f,E=o*g,I=l*f,D=l*g,z=l*x,F=d*f,$=d*g,H=d*x;return n[0]=1-E-z,n[1]=S+H,n[2]=I-$,n[3]=0,n[4]=S-H,n[5]=1-b-z,n[6]=D+F,n[7]=0,n[8]=I+$,n[9]=D-F,n[10]=1-b-E,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var gi=et;function _i(){var n=new X(3);return X!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function an(n){var e=new X(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function yi(n){return Math.hypot(n[0],n[1],n[2])}function Jt(n,e,i){var o=new X(3);return o[0]=n,o[1]=e,o[2]=i,o}function Pi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function Vi(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function Ii(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Hi(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Ci(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function ti(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function tn(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function rr(n,e){var i=e[0]-n[0],o=e[1]-n[1],l=e[2]-n[2];return i*i+o*o+l*l}function Wn(n){var e=n[0],i=n[1],o=n[2];return e*e+i*i+o*o}function Qn(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function xi(n,e){var i=e[0],o=e[1],l=e[2],d=i*i+o*o+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Ai(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function ji(n,e,i){var o=e[0],l=e[1],d=e[2],f=i[0],g=i[1],x=i[2];return n[0]=l*x-d*g,n[1]=d*f-o*x,n[2]=o*g-l*f,n}function Br(n,e,i,o){var l=e[0],d=e[1],f=e[2];return n[0]=l+o*(i[0]-l),n[1]=d+o*(i[1]-d),n[2]=f+o*(i[2]-f),n}function zi(n,e,i){var o=e[0],l=e[1],d=e[2],f=i[3]*o+i[7]*l+i[11]*d+i[15];return n[0]=(i[0]*o+i[4]*l+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*o+i[5]*l+i[9]*d+i[13])/f,n[2]=(i[2]*o+i[6]*l+i[10]*d+i[14])/f,n}function Sr(n,e,i){var o=e[0],l=e[1],d=e[2];return n[0]=o*i[0]+l*i[3]+d*i[6],n[1]=o*i[1]+l*i[4]+d*i[7],n[2]=o*i[2]+l*i[5]+d*i[8],n}function Rr(n,e,i){var o=i[0],l=i[1],d=i[2],f=e[0],g=e[1],x=e[2],b=l*x-d*g,S=d*f-o*x,E=o*g-l*f,I=l*E-d*S,D=d*b-o*E,z=o*S-l*b,F=2*i[3];return S*=F,E*=F,D*=2,z*=2,n[0]=f+(b*=F)+(I*=2),n[1]=g+S+D,n[2]=x+E+z,n}function Zn(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Ui=Vi,Un=Ii,lr=yi;function Kn(){var n=new X(4);return X!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function er(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function sr(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=i*i+o*o+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=o*f,n[2]=l*f,n[3]=d*f,n}function tr(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3];return n[0]=i[0]*o+i[4]*l+i[8]*d+i[12]*f,n[1]=i[1]*o+i[5]*l+i[9]*d+i[13]*f,n[2]=i[2]*o+i[6]*l+i[10]*d+i[14]*f,n[3]=i[3]*o+i[7]*l+i[11]*d+i[15]*f,n}function dr(){var n=new X(4);return X!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Dr(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function fr(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=o*x+f*g,n[1]=l*x+d*g,n[2]=d*x-l*g,n[3]=f*x-o*g,n}function Nr(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=o*x-d*g,n[1]=l*x+f*g,n[2]=d*x+o*g,n[3]=f*x-l*g,n}_i(),Kn();var Sn,vr,js,ws,Xr,Vr=sr,jr=(Sn=_i(),vr=Jt(1,0,0),js=Jt(0,1,0),function(n,e,i){var o=Ai(e,i);return o<-.999999?(ji(Sn,vr,e),lr(Sn)<1e-6&&ji(Sn,js,e),xi(Sn,Sn),function(l,d,f){f*=.5;var g=Math.sin(f);l[0]=g*d[0],l[1]=g*d[1],l[2]=g*d[2],l[3]=Math.cos(f)}(n,Sn,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(ji(Sn,e,i),n[0]=Sn[0],n[1]=Sn[1],n[2]=Sn[2],n[3]=1+o,Vr(n,n))});function Qi(){var n=new X(2);return X!=Float32Array&&(n[0]=0,n[1]=0),n}function rs(n,e){var i=new X(2);return i[0]=n,i[1]=e,i}function cs(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function us(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function fi(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function Mn(n){return Math.hypot(n[0],n[1])}function cr(n,e){var i=e[0],o=e[1],l=i*i+o*o;return l>0&&(l=1/Math.sqrt(l)),n[0]=e[0]*l,n[1]=e[1]*l,n}function Xi(n,e){return n[0]*e[0]+n[1]*e[1]}function Kr(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}dr(),dr(),fe(),Qi();var ta,Ms,Fo=function(){if(Xr)return ws;function n(e,i,o,l){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=l}return Xr=1,ws=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,l=0;l<8;l++){var d=this.sampleCurveX(o)-e;if(Math.abs(d)<i)return o;var f=this.sampleCurveDerivativeX(o);if(Math.abs(f)<1e-6)break;o-=d/f}var g=0,x=1;for(o=e,l=0;l<20&&(d=this.sampleCurveX(o),!(Math.abs(d-e)<i));l++)e>d?g=o:x=o,o=.5*(x-g)+g;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ws}(),dl=Kr(Fo);function Da(){if(Ms)return ta;function n(e,i){this.x=e,this.y=i}return Ms=1,ta=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),l=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=l,this},_rotateAround:function(e,i){var o=Math.cos(e),l=Math.sin(e),d=i.y+l*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-l*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},ta}var dt=Kr(Da());function ao(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ao(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ao(n[i],e[i]))return!1;return!0}return n===e}const fl=Math.PI/180,Ne=180/Math.PI;function B(n){return n*fl}function q(n){return n*Ne}const ie=[[0,0],[1,0],[1,1],[0,1]];function he(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function de(n,e,i,o){const l=new dl(n,e,i,o);return function(d){return l.solve(d)}}const ye=de(.25,.1,.25,1);function ve(n,e,i){return Math.min(i,Math.max(e,n))}function be(n,e,i){return(i=ve((i-n)/(e-n),0,1))*i*(3-2*i)}function De(n,e,i){const o=i-e,l=((n-e)%o+o)%o+e;return l===e?i:l}function Ge(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const l=new Array(n.length);let d=null;n.forEach((f,g)=>{e(f,(x,b)=>{x&&(d=x),l[g]=b,--o==0&&i(d,l)})})}function ze(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let ft=1;function bt(){return ft++}function Lt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Yt(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ii(n,e,i){const o={};for(const l in n)o[l]=e.call(this,n[l],l,n);return o}function li(n,e,i){const o={};for(const l in n)e.call(this,n[l],l,n)&&(o[l]=n[l]);return o}function pi(n){return Array.isArray(n)?n.map(pi):typeof n=="object"&&n?ii(n,pi):n}const Bn={};function vi(n){Bn[n]||(typeof console<"u"&&console.warn(n),Bn[n]=!0)}function fn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Bi(n){let e=0;for(let i,o,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],o=n[f],e+=(o.x-i.x)*(i.y+o.y);return e}function pn([n,e,i]){const o=B(e+90),l=B(i);return{x:n*Math.cos(o)*Math.sin(l),y:n*Math.sin(o)*Math.sin(l),z:n*Math.cos(l),azimuthal:e,polar:i}}function _n(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Yn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,l,d)=>{const f=l||d;return e[o]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let pr=null;function Er(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Ur(n,e,i,o){for(;e<i;){const l=e+i>>1;n[l]<o?e=l+1:i=l}return e}function Bo(n,e,i,o){for(;e<i;){const l=e+i>>1;n[l]<=o?e=l+1:i=l}return e}function ss(n){return n>0?1/(1.001-n):1+n}function os(n){return n>0?1-1/(1.001-n):-n}function zr(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Yr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Yr.API_URL)return null;try{const n=new URL(Yr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function So(n){return Yr.API_URL_REGEX.test(n)}function za(n){return Yr.API_SPRITE_REGEX.test(n)}let dc,pl,Au,fc,La,pc;function fd(){return dc==null&&(dc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),dc}const lo={now:()=>fc!==void 0?fc:performance.now(),setNow(n){fc=n},restoreNow(){fc=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;La||(La=document.createElement("canvas"));const l=La.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>La.width||o>La.height)&&(La.width=i,La.height=o),l.clearRect(-e,-e,i+2*e,o+2*e),l.drawImage(n,0,0,i,o),l.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(pl||(pl=document.createElement("a")),pl.href=n,pl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Au==null&&(Au=window.matchMedia("(prefers-reduced-motion: reduce)")),Au.matches)},hasCanvasFingerprintNoise(){if(pc!==void 0)return pc;if(!fd())return pc=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<n.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let l=0;l<o.data.length;++l)if(l%4!=3&&i++!==o.data[l])return pc=!0,!0;return pc=!1,!1}};function pd(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const l in e)o.set(l,e[l]);return`${n.slice(0,i)}?${o.toString()}`}function Ps(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,l=new URLSearchParams(n.slice(i));for(const f of e.persistentParams){const g=l.get(f);g&&o.set(f,g)}const d=o.toString();return`${n.slice(0,i)}${d.length>0?`?${d}`:""}`}const co="mapbox-tiles";let No=500,uo=50;const Vo=["language","worldview","jobid"];let Xs,mc;function md(){try{return caches}catch{}}function jo(){const n=md();n&&Xs==null&&(Xs=n.open(co))}let gc=1/0;const gd={supported:!1,testSupport:function(n){!Iu&&hs&&(Cu?Bp(n):_c=n)}};let _c,hs,Iu=!1,Cu=!1;const ml=typeof self<"u"?self:{};function Bp(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,hs),n.isContextLost())return;gd.supported=!0}catch{}n.deleteTexture(e),Iu=!0}ml.document&&(hs=ml.document.createElement("img"),hs.onload=function(){_c&&Bp(_c),_c=null,Cu=!0},hs.onerror=function(){Iu=!0,_c=null},hs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Mu);class Pu extends Error{constructor(e,i,o){i===401&&So(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ki=_n()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,gl=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ki())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,l){const d=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ki(),referrerPolicy:o.referrerPolicy,signal:d.signal});let g=!1,x=!1;const b=(S=f.url).indexOf("sku=")>0&&So(S);var S;o.type==="json"&&f.headers.set("Accept","application/json");const E=(D,z,F)=>{if(x)return;if(D&&D.message!=="SecurityError"&&vi(D.toString()),z&&F)return I(z);const $=Date.now();fetch(f).then(H=>{if(H.ok){const ee=b?H.clone():null;return I(H,ee,$)}return l(new Pu(H.statusText,H.status,o.url))}).catch(H=>{H.name!=="AbortError"&&l(new Error(`${H.message} ${o.url}`))})},I=(D,z,F)=>{(o.type==="arrayBuffer"?D.arrayBuffer():o.type==="json"?D.json():D.text()).then($=>{x||(z&&F&&function(H,ee,K){if(jo(),Xs==null)return;const N=Yn(ee.headers.get("Cache-Control")||"");if(N["no-store"])return;const Z={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((pe,_e)=>Z.headers.set(_e,pe)),N["max-age"]&&Z.headers.set("Expires",new Date(K+1e3*N["max-age"]).toUTCString());const Q=Z.headers.get("Expires");if(!Q||new Date(Q).getTime()-K<42e4)return;let re=Ps(H.url,{persistentParams:Vo});if(ee.status===206){const pe=H.headers.get("Range");if(!pe)return;Z.status=200,re=pd(re,{range:pe})}(function(pe,_e){if(mc===void 0)try{new Response(new ReadableStream),mc=!0}catch{mc=!1}mc?_e(pe.body):pe.blob().then(_e).catch(xe=>vi(xe.message))})(ee,pe=>{const _e=new Response((xe=ee.status)!==200&&xe!==404&&[101,103,204,205,304].includes(xe)?null:pe,Z);var xe;jo(),Xs!=null&&Xs.then(Te=>Te.put(re,_e)).catch(Te=>vi(Te.message))})}(f,z,F),g=!0,l(null,$,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch($=>{x||l(new Error($.message))})};return b?function(D,z){if(jo(),Xs==null)return z(null);Xs.then(F=>{let $=Ps(D.url,{persistentParams:Vo});const H=D.headers.get("Range");H&&($=pd($,{range:H})),F.match($).then(ee=>{const K=function(N){if(!N)return!1;const Z=new Date(N.headers.get("Expires")||0),Q=Yn(N.headers.get("Cache-Control")||"");return Number(Z)>Date.now()&&!Q["no-cache"]}(ee);F.delete($).catch(z),K&&F.put($,ee.clone()).catch(z),z(null,ee,K)}).catch(z)}).catch(z)}(f,E):E(null,null),{cancel:()=>{x=!0,g||d.abort()}}}(n,e);if(_n(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,l){const d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in o.headers)d.setRequestHeader(f,o.headers[f]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(o.type==="json")try{f=JSON.parse(d.response)}catch(g){return l(g)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new Pu(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(n,e)},_l=function(n,e){return gl(ze(n,{type:"arrayBuffer"}),e)};function j_(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Np="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ka,ia;ka=[],ia=0;const yl=function(n,e){if(gd.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ia>=Yr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ka.push(d),d}ia++;let i=!1;const o=()=>{if(!i)for(i=!0,ia--;ka.length&&ia<Yr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=ka.shift(),{requestParameters:f,callback:g,cancelled:x}=d;x||(d.cancel=yl(f,g).cancel)}},l=_l(n,(d,f,g,x)=>{o(),d?e(d):f&&(self.createImageBitmap?function(b,S){const E=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(E).then(I=>{S(null,I)}).catch(I=>{S(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,S)=>e(b,S,g,x)):function(b,S){const E=new Image;E.onload=()=>{S(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=Np})},E.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(b)],{type:"image/png"});E.src=b.byteLength?URL.createObjectURL(I):Np}(f,(b,S)=>e(b,S,g,x)))});return{cancel:()=>{l.cancel(),o()}}};var Vp,_d,Oa,yc={exports:{}},xl={exports:{}},Ru={exports:{}},yd=function(){if(Oa)return yc.exports;Oa=1;var n=(Vp||(Vp=1,xl.exports=function(i,o){var l,d,f,g,x,b,S,E;for(d=i.length-(l=3&i.length),f=o,x=3432918353,b=461845907,E=0;E<d;)S=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,f=27492+(65535&(g=5*(65535&(f=(f^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,l){case 3:S^=(255&i.charCodeAt(E+2))<<16;case 2:S^=(255&i.charCodeAt(E+1))<<8;case 1:f^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(E)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),xl.exports),e=(_d||(_d=1,Ru.exports=function(i,o){for(var l,d=i.length,f=o^d,g=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++g;switch(d){case 3:f^=(255&i.charCodeAt(g+2))<<16;case 2:f^=(255&i.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Ru.exports);return yc.exports=n,yc.exports.murmur3=n,yc.exports.murmur2=e,yc.exports}(),Rs=Kr(yd);class na{constructor(e,...i){ze(this,i[0]||{}),this.type=e}}class xd extends na{constructor(e,i={}){super("error",ze({error:e},i))}}function vd(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Du(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Fa{on(e,i){return this._listeners=this._listeners||{},vd(e,i,this._listeners),this}off(e,i){return Du(e,i,this._listeners),Du(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},vd(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new na(e,i):e,l=o.type;if(this.listens(l)){o.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of d)x.call(this,o);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)Du(l,x,this._oneTimeListeners),x.call(this,o);const g=this._eventedParent;g&&(ze(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof xd&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Ds{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ds(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new Ds({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Ds.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var bd,zu={},xc=function(){if(bd)return zu;bd=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function o(d){return(f=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:f>1?1:f;var f}function l(d,f,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?d+(f-d)*g*6:2*g<1?f:3*g<2?d+(f-d)*(2/3-g)*6:d}try{zu.parseCSSColor=function(d){var f,g=d.replace(/ /g,"").toLowerCase();if(g in n)return n[g].slice();if(g[0]==="#")return g.length===4?(f=parseInt(g.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:g.length===7&&(f=parseInt(g.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var x=g.indexOf("("),b=g.indexOf(")");if(x!==-1&&b+1===g.length){var S=g.substr(0,x),E=g.substr(x+1,b-(x+1)).split(","),I=1;switch(S){case"rgba":if(E.length!==4)return null;I=o(E.pop());case"rgb":return E.length!==3?null:[i(E[0]),i(E[1]),i(E[2]),I];case"hsla":if(E.length!==4)return null;I=o(E.pop());case"hsl":if(E.length!==3)return null;var D=(parseFloat(E[0])%360+360)%360/360,z=o(E[1]),F=o(E[2]),$=F<=.5?F*(z+1):F+z-F*z,H=2*F-$;return[e(255*l(H,$,D+1/3)),e(255*l(H,$,D)),e(255*l(H,$,D-1/3)),I];default:return null}}return null}}catch{}return zu}();class $i{constructor(e,i,o,l=1){this.r=e,this.g=i,this.b=o,this.a=l}static parse(e){if(!e)return;if(e instanceof $i)return e;if(typeof e!="string")return;const i=xc.parseCSSColor(e);return i?new $i(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toStringPremultipliedAlpha(){const[e,i,o,l]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${l})`}toString(){const[e,i,o,l]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${l})`}toRenderColor(e){const{r:i,g:o,b:l,a:d}=this;return new jp(e,i,o,l,d)}clone(){return new $i(this.r,this.g,this.b,this.a)}}class jp{constructor(e,i,o,l,d){if(e){const f=e.image.height,g=f*f;i=d===0?0:i/d*(f-1),o=d===0?0:o/d*(f-1),l=d===0?0:l/d*(f-1);const x=Math.floor(i),b=Math.floor(o),S=Math.floor(l),E=Math.ceil(i),I=Math.ceil(o),D=Math.ceil(l),z=i-x,F=o-b,$=l-S,H=e.image.data,ee=4*(x+b*g+S*f),K=4*(x+b*g+D*f),N=4*(x+I*g+S*f),Z=4*(x+I*g+D*f),Q=4*(E+b*g+S*f),re=4*(E+b*g+D*f),pe=4*(E+I*g+S*f),_e=4*(E+I*g+D*f);if(ee<0||_e>=H.length)throw new Error("out of range");this.r=Nt(Nt(Nt(H[ee],H[K],$),Nt(H[N],H[Z],$),F),Nt(Nt(H[Q],H[re],$),Nt(H[pe],H[_e],$),F),z)/255*d,this.g=Nt(Nt(Nt(H[ee+1],H[K+1],$),Nt(H[N+1],H[Z+1],$),F),Nt(Nt(H[Q+1],H[re+1],$),Nt(H[pe+1],H[_e+1],$),F),z)/255*d,this.b=Nt(Nt(Nt(H[ee+2],H[K+2],$),Nt(H[N+2],H[Z+2],$),F),Nt(Nt(H[Q+2],H[re+2],$),Nt(H[pe+2],H[_e+2],$),F),z)/255*d,this.a=d}else this.r=i,this.g=o,this.b=l,this.a=d}toArray(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*i/l,255*o/l,l]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:i,b:o,a:l}=this,d=Math.min(Math.max(e/l,0),1),f=Math.min(Math.max(i/l,0),1),g=Math.min(Math.max(o/l,0),1),x=Math.min(d,f,g),b=Math.max(d,f,g),S=(x+b)/2;if(x===b)return[0,0,100*S,l];const E=b-x,I=S>.5?E/(2-b-x):E/(b+x);let D=0;return b===d?D=(f-g)/E+(f<g?6:0):b===f?D=(g-d)/E+2:b===g&&(D=(d-f)/E+4),D*=60,[Math.min(Math.max(D,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*S,0),100),l]}toArray01(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[e/l,i/l,o/l,l]}toArray01Scaled(e){const{r:i,g:o,b:l,a:d}=this;return d===0?[0,0,0]:[i/d*e,o/d*e,l/d*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:o,a:l}=this;return[e,i,o,l]}toArray01Linear(){const{r:e,g:i,b:o,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(i/l,2.2),Math.pow(o/l,2.2),l]}}function Nt(n,e,i){return n*(1-i)+e*i}function Up(n,e,i){return n.map((o,l)=>Nt(o,e[l],i))}function Lu(n){return n*n*n*n*n}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1),$i.blue=new $i(0,0,1,1);var ku=Object.freeze({__proto__:null,array:Up,color:function(n,e,i){return new $i(Nt(n.r,e.r,i),Nt(n.g,e.g,i),Nt(n.b,e.b,i),Nt(n.a,e.a,i))},easeIn:Lu,number:Nt});function vc(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class Ks extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ba{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,l]of i)this.bindings[o]=l}concat(e){return new Ba(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ra={kind:"null"},Bt={kind:"number"},ln={kind:"string"},Ki={kind:"boolean"},Ts={kind:"color"},sa={kind:"object"},Wi={kind:"value"},Na={kind:"collator"},bc={kind:"formatted"},wc={kind:"resolvedImage"};function ds(n,e){return{kind:"array",itemType:n,N:e}}function mr(n){if(n.kind==="array"){const e=mr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const U_=[ra,Bt,ln,Ki,Ts,bc,sa,ds(Wi),wc];function Tc(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Tc(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of U_)if(!Tc(i,e))return null}}return`Expected ${mr(n)} but found ${mr(e)} instead.`}function wd(n,e){return e.some(i=>i.kind===n.kind)}function vl(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}class oa{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ou{constructor(e,i,o,l,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=l,this.textColor=d}}class fs{constructor(e){this.sections=e}static fromString(e){return new fs([new Ou(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof fs?e:fs.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const l=i.image.getPrimary().id.toString();e.push(["image",l]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class ho{constructor(e,i={}){if(this.id=Ds.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:l,c:d,d:f,e:g,f:x}=i.transform;this.options.transform=new DOMMatrix([o,l,d,f,g,x])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:l,e:d,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:l,e:d,f}})}static parse(e){let i,o,l,d;try{({name:i,iconsetId:o,params:l,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:g,c:x,d:b,e:S,f:E}=d||{};return new ho({name:i,iconsetId:o},{params:l,transform:new DOMMatrix([f,g,x,b,S,E])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Ss{constructor(e,i,o,l,d=!1){this.primaryId=Ds.from(e),this.primaryOptions=i,o&&(this.secondaryId=Ds.from(o)),this.secondaryOptions=l,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ho(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ho(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ss.build({name:e}):e}static build(e,i,o,l){return!e||typeof e=="object"&&!("name"in e)?null:new Ss(e,o,i,l)}}function $p(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function bl(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof $i||n instanceof oa||n instanceof fs||n instanceof Ss)return!0;if(Array.isArray(n)){for(const e of n)if(!bl(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!bl(n[e]))return!1;return!0}return!1}function br(n){if(n===null)return ra;if(typeof n=="string")return ln;if(typeof n=="boolean")return Ki;if(typeof n=="number")return Bt;if(n instanceof $i)return Ts;if(n instanceof oa)return Na;if(n instanceof fs)return bc;if(n instanceof Ss)return wc;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const l=br(o);if(i){if(i===l)continue;i=Wi;break}i=l}return ds(i||Wi,e)}return sa}function ps(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof $i?n.toStringPremultipliedAlpha():n instanceof fs||n instanceof Ss?n.toString():JSON.stringify(n)}class ci{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!bl(e[1]))return i.error("invalid value");const o=e[1];let l=br(o);const d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new ci(l,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $i?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof fs?this.value.serialize():this.value}}class It{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Sc={string:ln,number:Bt,boolean:Ki,object:sa};class qt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,l=1;const d=e[0];if(d==="array"){let g,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in Sc)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=Sc[b],l++}else g=Wi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}o=ds(g,x)}else o=Sc[d];const f=[];for(;l<e.length;l++){const g=i.parse(e[l],l,Wi);if(!g)return null;f.push(g)}return new qt(o,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Tc(this.type,br(o)))return o;if(i===this.args.length-1)throw new It(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${mr(br(o))} but was expected to be of type ${mr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(o=>o.serialize()))}}class Va{constructor(e){this.type=bc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let x=null;if(g["font-scale"]&&(x=i.parseObjectValue(g["font-scale"],f,"font-scale",Bt),!x))return null;let b=null;if(g["text-font"]&&(b=i.parseObjectValue(g["text-font"],f,"text-font",ds(ln)),!b))return null;let S=null;if(g["text-color"]&&(S=i.parseObjectValue(g["text-color"],f,"text-color",Ts),!S))return null;const E=l[l.length-1];E.scale=x,E.font=b,E.textColor=S}else{const x=i.parse(e[f],f,Wi);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new Va(l)}evaluate(e){return new fs(this.sections.map(i=>{const o=i.content.evaluate(e);return br(o)===wc?new Ou("",o,null,null,null):new Ou(ps(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class wl{constructor(e,i,o,l){this._imageWarnHistory={},this.type=wc,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),l&&(this.paramsSecondary=l.params,this.iconsetIdSecondary=l.iconset?l.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const l=[];function d(){if(o<e.length){const g=i.parse(e[o],o++,ln);return g?(l.push({image:g,options:{}}),!0):(i.error(l.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(o<e.length){const x=e[o];if((g=x)===null||typeof g!="object"||Array.isArray(g))return!0;const b=x.params,S=x.iconset,E=i.concat(o);if(!b&&!S)return o++,!0;if(b){if(typeof b!="object"||b.constructor!==Object)return E.error('Image options "params" should be an object'),!1;const I={},D=E.concat(void 0,"params");for(const z in b){if(!z)return D.error("Image parameter name should be non-empty"),!1;const F=D.concat(void 0,z).parse(b[z],void 0,Ts,void 0,{typeAnnotation:"coerce"});if(!F)return!1;I[z]=F}l[l.length-1].options.params=I}if(S){if(typeof S!="object"||S.constructor!==Object)return E.error('Image options "iconset" should be an object'),!1;if(!S.id)return E.error('Image options "iconset" should have an "id" property'),!1;l[l.length-1].options.iconset=S}return o++,!0}var g;return!0}for(let g=0;g<2;g++)if(!d()||!f())return;return new wl(l[0].image,l[1]?l[1].image:void 0,l[0].options,l[1]?l[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const l in i)if(i[l])try{o[l]=i[l].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,l=Ss.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(l&&e.availableImages){const d=l.getPrimary().id;if(l.available=e.availableImages.some(f=>Ds.isEqual(f,d)),l.available){const f=l.getSecondary()?l.getSecondary().id:null;f&&(l.available=e.availableImages.some(g=>Ds.isEqual(g,f)))}}return l}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const l in e)e[l]&&(o.params[l]=e[l].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Wt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const Gp={"to-boolean":Ki,"to-color":Ts,"to-number":Bt,"to-string":ln};class fo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],l=[];let d=ra;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=ds(i.expectedType.itemType,f)}else{if(!(f>0&&bl(e[1][0])))return null;d=ds(br(e[1][0]),f)}for(let g=0;g<f;g++){const x=e[1][g];let b;if(Wt(x)==="array")b=i.parse(x,void 0,d.itemType);else{const S=Wt(x);if(S!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${S}.`);b=i.registry.literal.parse(["literal",x===void 0?null:x],i)}if(!b)return null;l.push(b)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=Gp[o];for(let f=1;f<e.length;f++){const g=i.parse(e[f],f,Wi);if(!g)return null;l.push(g)}}return new fo(d,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const l of this.args){if(i=l.evaluate(e),o=null,i instanceof $i)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:$p(i[0],i[1],i[2],i[3]),!o))return new $i(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new It(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new It(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?fs.fromString(ps(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ss.build(ps(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ps(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Va([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Hp=["Unknown","Point","LineString","Polygon"];class Fu{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=$i.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class as{constructor(e,i,o,l,d){this.name=e,this.type=i,this._evaluate=o,this.args=l,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=as.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],l=as.definitions[o];if(!l)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[];let x=null,b=-1;for(const[S,E]of f){if(Array.isArray(S)&&S.length!==e.length-1)continue;g.push(S),b++,x=new tm(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const I=[];let D=!1;for(let z=1;z<e.length;z++){const F=e[z],$=Array.isArray(S)?S[z-1]:S.type,H=x.parse(F,1+I.length,$);if(!H){D=!0;break}I.push(H)}if(!D)if(Array.isArray(S)&&S.length!==I.length)x.error(`Expected ${S.length} arguments, but found ${I.length} instead.`);else{for(let z=0;z<I.length;z++){const F=Array.isArray(S)?S[z]:S.type,$=I[z];x.concat(z+1).checkSubtype(F,$.type)}if(x.errors.length===0)return new as(o,d,E,I,b)}}if(g.length===1)i.errors.push(...x.errors);else{const S=(g.length?g:f.map(([I])=>I)).map(ms).join(" | "),E=[];for(let I=1;I<e.length;I++){const D=i.parse(e[I],1+E.length);if(!D)return null;E.push(mr(D.type))}i.error(`Expected arguments of type ${S}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){as.definitions=i;for(const o in i)e[o]=as}}function ms(n){return Array.isArray(n)?`(${n.map(mr).join(", ")})`:`(${mr(n.type)}...)`}class Tl{constructor(e,i,o){this.type=Na,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const l=o["case-sensitive"]===void 0?i.parse(!1,1,Ki):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Ki);if(!l)return null;const d=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Ki):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Ki);if(!d)return null;let f=null;return o.locale&&(f=i.parseObjectValue(o.locale,1,"locale",ln),!f)?null:new Tl(l,d,f)}evaluate(e){return new oa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function aa(n,e,i=0,o=n.length-1,l=Ua){for(;o>i;){if(o-i>600){const x=o-i+1,b=e-i+1,S=Math.log(x),E=.5*Math.exp(2*S/3),I=.5*Math.sqrt(S*E*(x-E)/x)*(b-x/2<0?-1:1);aa(n,e,Math.max(i,Math.floor(e-b*E/x+I)),Math.min(o,Math.floor(e+(x-b)*E/x+I)),l)}const d=n[e];let f=i,g=o;for(ja(n,i,e),l(n[o],d)>0&&ja(n,i,o);f<g;){for(ja(n,f,g),f++,g--;l(n[f],d)<0;)f++;for(;l(n[g],d)>0;)g--}l(n[i],d)===0?ja(n,i,g):(g++,ja(n,g,o)),g<=e&&(i=g+1),e<=g&&(o=g-1)}}function ja(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Ua(n,e){return n<e?-1:n>e?1:0}function gs(n){let e=0;for(let i,o,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],o=n[f],e+=(o.x-i.x)*(i.y+o.y);return e}function Ec(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Ac(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function $_(n,e,i){const o=n[0]-e[0],l=n[1]-e[1],d=n[0]-i[0],f=n[1]-i[1];return o*f-d*l==0&&o*d<=0&&l*f<=0}function Uo(n,e,i=!1){let o=!1;for(let g=0,x=e.length;g<x;g++){const b=e[g];for(let S=0,E=b.length,I=E-1;S<E;I=S++){const D=b[I],z=b[S];if($_(n,D,z))return i;(d=D)[1]>(l=n)[1]!=(f=z)[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(o=!o)}}var l,d,f;return o}function Td(n,e,i,o){const l=o[0]-i[0],d=o[1]-i[1],f=(n[0]-i[0])*d-l*(n[1]-i[1]),g=(e[0]-i[0])*d-l*(e[1]-i[1]);return f>0&&g<0||f<0&&g>0}function Eo(n,e,i,o){return(l=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!Td(n,e,i,o)||!Td(i,o,n,e));var l,d}function Sd(n){const e=new dt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new dt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const la=8192;function G_(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*la),Math.round(o*l*la)]}function H_(n,e){for(let i=0;i<e.length;i++)if(Uo(n,e[i]))return!0;return!1}function qp(n,e,i){for(const o of i)for(let l=0,d=o.length,f=d-1;l<d;f=l++)if(Eo(n,e,o[f],o[l]))return!0;return!1}function Wp(n,e){for(let i=0;i<n.length;++i)if(!Uo(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(qp(n[i],n[i+1],e))return!1;return!0}function q_(n,e){for(let i=0;i<e.length;i++)if(Wp(n,e[i]))return!0;return!1}function Bu(n,e,i){const o=[];for(let l=0;l<n.length;l++){const d=[];for(let f=0;f<n[l].length;f++){const g=G_(n[l][f],i);Ec(e,g),d.push(g)}o.push(d)}return o}function Zp(n,e,i){const o=[];for(let l=0;l<n.length;l++){const d=Bu(n[l],e,i);o.push(d)}return o}function ca(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const l=.5*o;let d=n[0]-i[0]>l?-o:i[0]-n[0]>l?o:0;d===0&&(d=n[0]-i[2]>l?-o:i[2]-n[0]>l?o:0),n[0]+=d}Ec(e,n)}function Xp(n,e,i,o){const l=Math.pow(2,o.z)*la,d=[o.x*la,o.y*la],f=[];if(!n)return f;for(const g of n)for(const x of g){const b=[x.x+d[0],x.y+d[1]];ca(b,e,i,l),f.push(b)}return f}function Kp(n,e,i,o){const l=Math.pow(2,o.z)*la,d=[o.x*la,o.y*la],f=[];if(!n)return f;for(const x of n){const b=[];for(const S of x){const E=[S.x+d[0],S.y+d[1]];Ec(e,E),b.push(E)}f.push(b)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of f)for(const b of x)ca(b,e,i,l)}var g;return f}class $o{constructor(e,i){this.type=Ki,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(bl(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let l=0;l<o.features.length;++l){const d=o.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new $o(o,o.features[l].geometry)}else if(o.type==="Feature"){const l=o.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new $o(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new $o(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=Bu(o.coordinates,d,f),x=Xp(i.geometry(),l,d,f);if(!Ac(l,d))return!1;for(const b of x)if(!Uo(b,g))return!1}if(o.type==="MultiPolygon"){const g=Zp(o.coordinates,d,f),x=Xp(i.geometry(),l,d,f);if(!Ac(l,d))return!1;for(const b of x)if(!H_(b,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(o.type==="Polygon"){const g=Bu(o.coordinates,d,f),x=Kp(i.geometry(),l,d,f);if(!Ac(l,d))return!1;for(const b of x)if(!Wp(b,g))return!1}if(o.type==="MultiPolygon"){const g=Zp(o.coordinates,d,f),x=Kp(i.geometry(),l,d,f);if(!Ac(l,d))return!1;for(const b of x)if(!q_(b,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ic={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ed=1/298.257223563,Ys=Ed*(2-Ed),Sl=Math.PI/180;class El{static fromTile(e,i,o){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Sl;return new El(d,o)}static get units(){return Ic}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ic[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ic).join(", ")}`);const o=6378.137*Sl*(i?Ic[i]:1),l=Math.cos(e*Sl),d=1/(1-Ys*(1-l*l)),f=Math.sqrt(d);this.kx=o*f*l,this.ky=o*f*d*(1-Ys)}distance(e,i){const o=Us(e[0]-i[0])*this.kx,l=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+l*l)}bearing(e,i){const o=Us(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Sl}destination(e,i,o){const l=o*Sl;return this.offset(e,Math.sin(l)*i,Math.cos(l)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const l=e[o];for(let d=0,f=l.length,g=f-1;d<f;g=d++)i+=Us(l[d][0]-l[g][0])*(l[d][1]+l[g][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let l=0;l<e.length-1;l++){const d=e[l],f=e[l+1],g=this.distance(d,f);if(o+=g,o>i)return Nu(d,f,(i-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[l,d]=i,f=Us(o[0]-l)*this.kx,g=(o[1]-d)*this.ky;if(f!==0||g!==0){const x=(Us(e[0]-l)*this.kx*f+(e[1]-d)*this.ky*g)/(f*f+g*g);x>1?(l=o[0],d=o[1]):x>0&&(l+=f/this.kx*x,d+=g/this.ky*x)}return f=Us(e[0]-l)*this.kx,g=(e[1]-d)*this.ky,Math.sqrt(f*f+g*g)}pointOnLine(e,i){let o=1/0,l=e[0][0],d=e[0][1],f=0,g=0;for(let x=0;x<e.length-1;x++){let b=e[x][0],S=e[x][1],E=Us(e[x+1][0]-b)*this.kx,I=(e[x+1][1]-S)*this.ky,D=0;E===0&&I===0||(D=(Us(i[0]-b)*this.kx*E+(i[1]-S)*this.ky*I)/(E*E+I*I),D>1?(b=e[x+1][0],S=e[x+1][1]):D>0&&(b+=E/this.kx*D,S+=I/this.ky*D)),E=Us(i[0]-b)*this.kx,I=(i[1]-S)*this.ky;const z=E*E+I*I;z<o&&(o=z,l=b,d=S,f=x,g=D)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,o){let l=this.pointOnLine(o,e),d=this.pointOnLine(o,i);if(l.index>d.index||l.index===d.index&&l.t>d.t){const b=l;l=d,d=b}const f=[l.point],g=l.index+1,x=d.index;!Ad(o[g],f[0])&&g<=x&&f.push(o[g]);for(let b=g+1;b<=x;b++)f.push(o[b]);return Ad(o[x],d.point)||f.push(d.point),f}lineSliceAlong(e,i,o){let l=0;const d=[];for(let f=0;f<o.length-1;f++){const g=o[f],x=o[f+1],b=this.distance(g,x);if(l+=b,l>e&&d.length===0&&d.push(Nu(g,x,(e-(l-b))/b)),l>=i)return d.push(Nu(g,x,(i-(l-b))/b)),d;l>e&&d.push(x)}return d}bufferPoint(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[0]+l,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-o,e[2]+l,e[3]+o]}insideBBox(e,i){return Us(e[0]-i[0])>=0&&Us(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Ad(n,e){return n[0]===e[0]&&n[1]===e[1]}function Nu(n,e,i){const o=Us(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function Us(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Vu{constructor(e=[],i=(o,l)=>o<l?-1:o>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,l=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(o(l,f)>=0)break;i[e]=f,e=d}i[e]=l}_down(e){const{data:i,compare:o}=this,l=this.length>>1,d=i[e];for(;e<l;){let f=1+(e<<1);const g=f+1;if(g<this.length&&o(i[g],i[f])<0&&(f=g),o(i[f],d)>=0)break;i[e]=i[f],e=f}i[e]=d}}var pt=8192;function Id(n,e){return e.dist-n.dist}const ju=100,Uu=50;function Cd(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function $a(n){return n[1]-n[0]+1}function Js(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Al(n,e){if(n[0]>n[1])return[null,null];const i=$a(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function ua(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Js(e,n.length))return i;for(let o=e[0];o<=e[1];++o)Ec(i,n[o]);return i}function Cc(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)Ec(e,n[i][o]);return e}function Ga(n,e,i){if(Cd(n)||Cd(e))return NaN;let o=0,l=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(l=n[1]-e[3]),n[3]<e[1]&&(l=e[1]-n[3]),i.distance([0,0],[o,l])}function Il(n){return 360*n-180}function Ri(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Md(n,e){const i=Math.pow(2,e.z),o=(n.y/pt+e.y)/i;return[Il((n.x/pt+e.x)/i),Ri(o)]}function W_(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(Md(n[o],e));return i}function Yp(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function Pd(n,e,i,o,l){const d=i.slice(o[0],o[1]+1);let f=1/0;for(let g=e[0];g<=e[1];++g)if((f=Math.min(f,Yp(n[g],d,l)))===0)return 0;return f}function Rd(n,e,i,o,l){const d=Math.min(l.pointToSegmentDistance(n,i,o),l.pointToSegmentDistance(e,i,o)),f=Math.min(l.pointToSegmentDistance(i,n,e),l.pointToSegmentDistance(o,n,e));return Math.min(d,f)}function Nn(n,e,i,o,l){if(!Js(e,n.length)||!Js(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let g=o[0];g<o[1];++g){if(Eo(n[f],n[f+1],i[g],i[g+1]))return 0;d=Math.min(d,Rd(n[f],n[f+1],i[g],i[g+1],l))}return d}function Z_(n,e,i,o,l){if(!Js(e,n.length)||!Js(o,i.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let g=o[0];g<=o[1];++g)if((d=Math.min(d,l.distance(n[f],i[g])))===0)return d;return d}function X_(n,e,i){if(Uo(n,e,!0))return 0;let o=1/0;for(const l of e){const d=l.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[d-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,l[d-1],l[0])))===0||(o=Math.min(o,Yp(n,l,i)))===0)return o}return o}function K_(n,e,i,o){if(!Js(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(Uo(n[d],i,!0))return 0;let l=1/0;for(let d=e[0];d<e[1];++d)for(const f of i)for(let g=0,x=f.length,b=x-1;g<x;b=g++){if(Eo(n[d],n[d+1],f[b],f[g]))return 0;l=Math.min(l,Rd(n[d],n[d+1],f[b],f[g],o))}return l}function Jp(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if(Uo(i[o],e,!0))return!0;return!1}function Y_(n,e,i,o=1/0){const l=Cc(n),d=Cc(e);if(o!==1/0&&Ga(l,d,i)>=o)return o;if(Ac(l,d)){if(Jp(n,e))return 0}else if(Jp(e,n))return 0;let f=o;for(const g of n)for(let x=0,b=g.length,S=b-1;x<b;S=x++)for(const E of e)for(let I=0,D=E.length,z=D-1;I<D;z=I++){if(Eo(g[S],g[x],E[z],E[I]))return 0;f=Math.min(f,Rd(g[S],g[x],E[z],E[I],i))}return f}function $u(n,e,i,o,l,d,f){if(d===null||f===null)return;const g=Ga(ua(o,d),ua(l,f),i);g<e&&n.push({dist:g,range1:d,range2:f})}function J_(n,e,i,o,l=1/0){let d=Math.min(o.distance(n[0],i[0][0]),l);if(d===0)return d;const f=new Vu([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Id),g=e?Uu:ju,x=Cc(i);for(;f.length;){const b=f.pop();if(b.dist>=d)continue;const S=b.range1;if($a(S)<=g){if(!Js(S,n.length))return NaN;if(e){const E=K_(n,S,i,o);if((d=Math.min(d,E))===0)return d}else for(let E=S[0];E<=S[1];++E){const I=X_(n[E],i,o);if((d=Math.min(d,I))===0)return d}}else{const E=Al(S,e);if(E[0]!==null){const I=Ga(ua(n,E[0]),x,o);I<d&&f.push({dist:I,range1:E[0],range2:[0,0]})}if(E[1]!==null){const I=Ga(ua(n,E[1]),x,o);I<d&&f.push({dist:I,range1:E[1],range2:[0,0]})}}}return d}function Qp(n,e,i,o,l,d=1/0){let f=Math.min(d,l.distance(n[0],i[0]));if(f===0)return f;const g=new Vu([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Id),x=e?Uu:ju,b=o?Uu:ju;for(;g.length;){const S=g.pop();if(S.dist>=f)continue;const E=S.range1,I=S.range2;if($a(E)<=x&&$a(I)<=b){if(!Js(E,n.length)||!Js(I,i.length))return NaN;if(e&&o?f=Math.min(f,Nn(n,E,i,I,l)):e||o?e&&!o?f=Math.min(f,Pd(i,I,n,E,l)):!e&&o&&(f=Math.min(f,Pd(n,E,i,I,l))):f=Math.min(f,Z_(n,E,i,I,l)),f===0)return f}else{const D=Al(E,e),z=Al(I,o);$u(g,f,l,n,i,D[0],z[0]),$u(g,f,l,n,i,D[0],z[1]),$u(g,f,l,n,i,D[1],z[0]),$u(g,f,l,n,i,D[1],z[1])}}return f}function Dd(n,e,i,o,l=1/0){let d=l;const f=ua(n,[0,n.length-1]);for(const g of i)if(!(d!==1/0&&Ga(f,ua(g,[0,g.length-1]),o)>=d)&&(d=Math.min(d,Qp(n,e,g,!0,o,d)),d===0))return d;return d}function Gu(n,e,i,o,l=1/0){let d=l;const f=ua(n,[0,n.length-1]);for(const g of i){if(d!==1/0&&Ga(f,Cc(g),o)>=d)continue;const x=J_(n,e,g,o,d);if(isNaN(x))return x;if((d=Math.min(d,x))===0)return d}return d}function zd(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Ha{constructor(e,i){this.type=Bt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(bl(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let l=0;l<o.features.length;++l)if(zd(o.features[l].geometry.type))return new Ha(o,o.features[l].geometry)}else if(o.type==="Feature"){if(zd(o.geometry.type))return new Ha(o,o.geometry)}else if(zd(o.type))return new Ha(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(l,d,f){const g=[];for(const b of l)for(const S of b)g.push(Md(S,d));const x=new El(g[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Qp(g,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?Dd(g,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?Gu(g,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(l,d,f){const g=[];for(const b of l){const S=[];for(const E of b)S.push(Md(E,d));g.push(S)}const x=new El(g[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Dd(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let b=1/0;for(let S=0;S<f.coordinates.length;S++){const E=Dd(f.coordinates[S],!0,g,x,b);if(isNaN(E))return E;if((b=Math.min(b,E))===0)return b}return b}if(f.type==="Polygon"||f.type==="MultiPolygon"){let b=1/0;for(let S=0;S<g.length;S++){const E=Gu(g[S],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,b);if(isNaN(E))return E;if((b=Math.min(b,E))===0)return b}return b}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(l,d,f){const g=[];for(const b of function(S,E){const I=S.length;if(I<=1)return[S];const D=[];let z,F;for(let $=0;$<I;$++){const H=gs(S[$]);H!==0&&(S[$].area=Math.abs(H),F===void 0&&(F=H<0),F===H<0?(z&&D.push(z),z=[S[$]]):z.push(S[$]))}return z&&D.push(z),D}(l)){const S=[];for(let E=0;E<b.length;++E)S.push(W_(b[E],d));g.push(S)}const x=new El(g[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Gu(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let b=1/0;for(let S=0;S<f.coordinates.length;S++){const E=Gu(f.coordinates[S],!0,g,x,b);if(isNaN(E))return E;if((b=Math.min(b,E))===0)return b}return b}return f.type==="Polygon"||f.type==="MultiPolygon"?function(b,S,E){let I=1/0;for(const D of b)for(const z of S){const F=Y_(D,z,E,I);if(isNaN(F))return F;if((I=Math.min(I,F))===0)return I}return I}(f.type==="Polygon"?[f.coordinates]:f.coordinates,g,x):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ld(n,e){switch(n){case"string":return ps(e);case"number":return+e;case"boolean":return!!e;case"color":return $i.parse(e);case"formatted":return fs.fromString(ps(e));case"resolvedImage":return Ss.build(ps(e))}return e}function em(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Cl{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Wi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof ci))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const d=i.parse(e[2],2);return d instanceof ci?new Cl(o,ps(l.value),ps(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Cl(o,ps(l.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;const{type:l,value:d,values:f,minValue:g,maxValue:x,stepValue:b}=o,S=o.default.evaluate(e);let E=S;if(d){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),E=d.evaluate(e),e.scope=I}return l&&(E=Ld(l,E)),E===void 0||g===void 0&&x===void 0&&b===void 0||(typeof E=="number"?E=em(E,g,x,b):Array.isArray(E)&&(E=E.map(I=>typeof I=="number"?em(I,g,x,b):I))),d!==void 0&&E!==void 0&&f&&!f.includes(E)&&(E=S,l&&(E=Ld(l,E))),(l&&l!==this.type||E!==void 0&&br(E)!==this.type)&&(E=Ld(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Mc(n){if(n instanceof as&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof $o||n instanceof Ha)return!1;let e=!0;return n.eachChild(i=>{e&&!Mc(i)&&(e=!1)}),e}function Hu(n){if(n instanceof as&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Hu(i)&&(e=!1)}),e}function qu(n){if(n instanceof Cl)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...qu(i)])}),e}function Ml(n,e){if(n instanceof as&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Ml(o,e)&&(i=!1)}),i}class Wu{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Wu(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class kd{constructor(e,i=[],o,l=new Ba,d=[],f,g){this.registry=e,this.path=i,this.key=i.map(x=>typeof x=="string"?`['${x}']`:`[${x}]`).join(""),this.scope=l,this.errors=d,this.expectedType=o,this._scope=f,this.options=g}parse(e,i,o,l,d={}){return i||o?this.concat(i,null,o,l)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,o,l,d,f={}){return this.concat(i,o,l,d)._parse(e,f)}_parse(e,i){function o(l,d,f){return f==="assert"?new qt(d,[l]):f==="coerce"?new fo(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let d=l.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,g=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else d=o(d,f,i.typeAnnotation||"coerce");else d=o(d,f,i.typeAnnotation||"assert")}if(!(d instanceof ci)&&d.type.kind!=="resolvedImage"&&Od(d)){const f=new Fu(this._scope,this.options);try{d=new ci(d.type,d.evaluate(f))}catch(g){return this.error(g.message),null}}return d}return fo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,l){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const f=l?this.scope.concat(l):this.scope;return new kd(this.registry,d,o||null,f,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new Ks(o,e))}checkSubtype(e,i){const o=Tc(e,i);return o&&this.error(o),o}}var tm=kd;function Od(n){if(n instanceof Wu)return Od(n.boundExpression);if(n instanceof as&&n.name==="error"||n instanceof Tl||n instanceof $o||n instanceof Ha||n instanceof Cl)return!1;const e=n instanceof fo||n instanceof qt;let i=!0;return n.eachChild(o=>{i=e?i&&Od(o):i&&o instanceof ci}),!!i&&Mc(n)&&Ml(n,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Zu(n,e){const i=n.length-1;let o,l,d=0,f=i,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),o=n[g],l=n[g+1],o<=e){if(g===i||e<l)return g;d=g+1}else{if(!(o>e))throw new It("Input is not a number.");f=g-1}return 0}class Pc{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,d]of o)this.labels.push(l),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Bt);if(!o)return null;const l=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],x=e[f+1],b=f,S=f+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const E=i.parse(x,S,d);if(!E)return null;d=d||E.type,l.push([g,E])}return new Pc(d,o,l)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;return l>=i[d-1]?o[d-1].evaluate(e):o[Zu(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const im=.95047,nm=1.08883,rm=4/29,Pl=6/29,sm=3*Pl*Pl,Q_=Pl*Pl*Pl,Fd=Math.PI/180,ey=180/Math.PI;function Xu(n){return n>Q_?Math.pow(n,1/3):n/sm+rm}function Bd(n){return n>Pl?n*n*n:sm*(n-rm)}function Nd(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Vd(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function jd(n){const e=Vd(n.r),i=Vd(n.g),o=Vd(n.b),l=Xu((.4124564*e+.3575761*i+.1804375*o)/im),d=Xu((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-Xu((.0193339*e+.119192*i+.9503041*o)/nm)),alpha:n.a}}function Ud(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*Bd(e),i=im*Bd(i),o=nm*Bd(o),new $i(Nd(3.2404542*i-1.5371385*e-.4985314*o),Nd(-.969266*i+1.8760108*e+.041556*o),Nd(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function Rl(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const Dl={forward:jd,reverse:Ud,interpolate:function(n,e,i){return{l:Nt(n.l,e.l,i),a:Nt(n.a,e.a,i),b:Nt(n.b,e.b,i),alpha:Nt(n.alpha,e.alpha,i)}}},zl={forward:function(n){const{l:e,a:i,b:o}=jd(n),l=Math.atan2(o,i)*ey;return{h:l<0?l+360:l,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Fd,i=n.c;return Ud({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Rl(n.h,e.h,i),c:Nt(n.c,e.c,i),l:Nt(n.l,e.l,i),alpha:Nt(n.alpha,e.alpha,i)}}};var om=Object.freeze({__proto__:null,hcl:zl,lab:Dl});class Es{constructor(e,i,o,l,d){this.type=e,this.operator=i,this.interpolation=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,i,o,l){let d=0;if(e.name==="exponential")d=Rc(i,e.base,o,l);else if(e.name==="linear")d=Rc(i,1,o,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new dl(f[0],f[1],f[2],f[3]).solve(Rc(i,1,o,l))}return d}static parse(e,i){let[o,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(S=>typeof S!="number"||S<0||S>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Bt),!d)return null;const g=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=Ts:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let b=0;b<f.length;b+=2){const S=f[b],E=f[b+1],I=b+3,D=b+4;if(typeof S!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=S)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const z=i.parse(E,D,x);if(!z)return null;x=x||z.type,g.push([S,z])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new Es(x,o,l,d,g):i.error(`Type ${mr(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return o[0].evaluate(e);const d=i.length;if(l>=i[d-1])return o[d-1].evaluate(e);const f=Zu(i,l),g=Es.interpolationFactor(this.interpolation,l,i[f],i[f+1]),x=o[f].evaluate(e),b=o[f+1].evaluate(e);return this.operator==="interpolate"?ku[this.type.kind.toLowerCase()](x,b,g):this.operator==="interpolate-hcl"?zl.reverse(zl.interpolate(zl.forward(x),zl.forward(b),g)):Dl.reverse(Dl.interpolate(Dl.forward(x),Dl.forward(b),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Rc(n,e,i,o){const l=o-i,d=n-i;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class Ku{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const l=i.expectedType;l&&l.kind!=="value"&&(o=l);const d=[];for(const g of e.slice(1)){const x=i.parse(g,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,d.push(x)}const f=l&&d.some(g=>Tc(l,g.type));return new Ku(f?Wi:o,d)}evaluate(e){let i,o=null,l=0;for(const d of this.args){if(l++,o=d.evaluate(e),o&&o instanceof Ss&&!o.available&&(i||(i=o),o=null,l===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Yu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=i.parse(e[d+1],d+1);if(!g)return null;o.push([f,g])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return l?new Yu(o,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Ju{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Bt),l=i.parse(e[2],2,ds(i.expectedType||Wi));return o&&l?new Ju(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new It(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new It(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new It(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Qu{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Bt),l=i.parse(e[2],2,ds(i.expectedType||Wi));return o&&l?new Qu(l.type.itemType,o,l):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new It(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new It(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const l=Math.floor(i),d=Math.ceil(i),f=o[l],g=o[d];if(typeof f!="number"||typeof g!="number")throw new It(`Cannot interpolate between non-number values at index ${i}.`);const x=i-l;return f*(1-x)+g*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class $d{constructor(e,i){this.type=Ki,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Wi),l=i.parse(e[2],2,Wi);return o&&l?wd(o.type,[Ki,ln,Bt,ra,Wi])?new $d(o,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!vl(i,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${mr(br(i))} instead.`);if(!vl(o,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${mr(br(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class eh{constructor(e,i,o){this.type=Bt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Wi),l=i.parse(e[2],2,Wi);if(!o||!l)return null;if(!wd(o.type,[Ki,ln,Bt,ra,Wi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mr(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Bt);return d?new eh(o,l,d):null}return new eh(o,l)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!vl(i,["boolean","string","number","null"]))throw new It(`Expected first argument to be of type boolean, string, number or null, but found ${mr(br(i))} instead.`);if(!vl(o,["string","array"]))throw new It(`Expected second argument to be of type array or string, but found ${mr(br(o))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return o.indexOf(i,l)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gd{constructor(e,i,o,l,d,f){this.inputType=e,this.type=i,this.input=o,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d={},f=[];for(let b=2;b<e.length-1;b+=2){let S=e[b];const E=e[b+1];Array.isArray(S)||(S=[S]);const I=i.concat(b);if(S.length===0)return I.error("Expected at least one branch label.");for(const z of S){if(typeof z!="number"&&typeof z!="string")return I.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,br(z)))return null}else o=br(z);if(d[String(z)]!==void 0)return I.error("Branch labels must be unique.");d[String(z)]=f.length}const D=i.parse(E,b,l);if(!D)return null;l=l||D.type,f.push(D)}const g=i.parse(e[1],1,Wi);if(!g)return null;const x=i.parse(e[e.length-1],e.length-1,l);return x?g.type.kind!=="value"&&i.concat(1).checkSubtype(o,g.type)?null:new Gd(o,l,g,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(br(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],l={};for(const f of i){const g=l[this.cases[f]];g===void 0?(l[this.cases[f]]=o.length,o.push([this.cases[f],[f]])):o[g][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of o)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class th{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const g=i.parse(e[f],f,Ki);if(!g)return null;const x=i.parse(e[f+1],f+1,o);if(!x)return null;l.push([g,x]),o=o||x.type}const d=i.parse(e[e.length-1],e.length-1,o);return d?new th(o,l,d):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Dc{constructor(e,i,o,l){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Wi),l=i.parse(e[2],2,Bt);if(!o||!l)return null;if(!wd(o.type,[ds(Wi),ln,Wi]))return i.error(`Expected first argument to be of type array or string, but found ${mr(o.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Bt);return d?new Dc(o.type,o,l,d):null}return new Dc(o.type,o,l)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!vl(i,["string","array"]))throw new It(`Expected first argument to be of type array or string, but found ${mr(br(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(o,l)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function zc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function am(n,e,i,o){return o.compare(e,i)===0}function qa(n,e,i){const o=n!=="=="&&n!=="!=";return class TI{constructor(d,f,g){this.type=Ki,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let x=f.parse(d[1],1,Wi);if(!x)return null;if(!zc(g,x.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${mr(x.type)}'.`);let b=f.parse(d[2],2,Wi);if(!b)return null;if(!zc(g,b.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${mr(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${mr(x.type)}' and '${mr(b.type)}'.`);o&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new qt(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new qt(x.type,[b])));let S=null;if(d.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(S=f.parse(d[3],3,Na),!S)return null}return new TI(x,b,S)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const x=br(f),b=br(g);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new It(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=br(f),b=br(g);if(x.kind!=="string"||b.kind!=="string")return e(d,f,g)}return this.collator?i(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const ty=qa("==",function(n,e,i){return e===i},am),iy=qa("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!am(0,e,i,o)}),lm=qa("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),cm=qa(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),ny=qa("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),ry=qa(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class Hd{constructor(e,i,o,l,d,f){this.type=ln,this.number=e,this.locale=i,this.currency=o,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Bt);if(!o)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parseObjectValue(l.locale,2,"locale",ln),!d))return null;let f=null;if(l.currency&&(f=i.parseObjectValue(l.currency,2,"currency",ln),!f))return null;let g=null;if(l.unit&&(g=i.parseObjectValue(l.unit,2,"unit",ln),!g))return null;let x=null;if(l["min-fraction-digits"]&&(x=i.parseObjectValue(l["min-fraction-digits"],2,"min-fraction-digits",Bt),!x))return null;let b=null;return l["max-fraction-digits"]&&(b=i.parseObjectValue(l["max-fraction-digits"],2,"max-fraction-digits",Bt),!b)?null:new Hd(o,d,f,g,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Lc{constructor(e){this.type=Bt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${mr(o.type)} instead.`):new Lc(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new It(`Expected value to be of type string or array, but found ${mr(br(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function um(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Wa={"==":ty,"!=":iy,">":cm,"<":lm,">=":ry,"<=":ny,array:qt,at:Ju,"at-interpolated":Qu,boolean:qt,case:th,coalesce:Ku,collator:Tl,format:Va,image:wl,in:$d,"index-of":eh,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:Lc,let:Yu,literal:ci,match:Gd,number:qt,"number-format":Hd,object:qt,slice:Dc,step:Pc,string:qt,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Wu,within:$o,distance:Ha,config:Cl};function hm(n,[e,i,o,l]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=l?l.evaluate(n):1,f=$p(e,i,o,d);if(f)throw new It(f);return new $i(e/255*d,i/255*d,o/255*d,d)}function dm(n,[e,i,o,l]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const d=l?l.evaluate(n):1,f=function(b,S,E,I){return typeof b=="number"&&b>=0&&b<=360?typeof S=="number"&&S>=0&&S<=100&&typeof E=="number"&&E>=0&&E<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[b,S,E,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[b,S,E,I]:[b,S,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[b,S,E,I]:[b,S,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,d);if(f)throw new It(f);const g=`hsla(${e}, ${i}%, ${o}%, ${d})`,x=$i.parse(g);if(!x)throw new It(`Failed to parse HSLA color: ${g}`);return x}function qd(n,e){return n in e}function ih(n,e){const i=e[n];return i===void 0?null:i}function ha(n){return{type:n}}function fm(n){return{result:"success",value:n}}function $s(n){return{result:"error",value:n}}function Wd(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function nh(n){return n["property-type"]==="data-driven"}function pm(n){return Wd(n.expression,"measure-light")}function Zd(n){return Wd(n.expression,"zoom")}function rh(n){return!!n.expression&&n.expression.interpolated}function sh(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function mm(n){return n}function oh(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",l=o||!(o||n.property!==void 0),d=n.type||(rh(e)?"exponential":"interval");if(i&&((n=vc({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],$i.parse(b[1])])),n.default=$i.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!om[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,g,x;if(d==="exponential")f=Go;else if(d==="interval")f=sy;else if(d==="categorical"){f=gm,g=Object.create(null);for(const b of n.stops)g[b[0]]=b[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=oy}if(o){const b={},S=[];for(let D=0;D<n.stops.length;D++){const z=n.stops[D],F=z[0].zoom;b[F]===void 0&&(b[F]={zoom:F,type:n.type,property:n.property,default:n.default,stops:[]},S.push(F)),b[F].stops.push([z[0].value,z[1]])}const E=[];for(const D of S)E.push([b[D].zoom,oh(b[D],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Es.interpolationFactor.bind(void 0,I),zoomStops:E.map(D=>D[0]),evaluate:({zoom:D},z)=>Go({stops:E,base:n.base},e,D).evaluate(D,z)}}if(l){const b=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Es.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>f(n,e,S,g,x)}}return{kind:"source",evaluate(b,S){const E=S&&S.properties?S.properties[n.property]:void 0;return E===void 0?Za(n.default,e.default):f(n,e,E,g,x)}}}function Za(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function gm(n,e,i,o,l){return Za(typeof i===l?o[i]:void 0,n.default,e.default)}function sy(n,e,i){if(Wt(i)!=="number")return Za(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const l=Zu(n.stops.map(d=>d[0]),i);return n.stops[l][1]}function Go(n,e,i){const o=n.base!==void 0?n.base:1;if(Wt(i)!=="number")return Za(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const d=Zu(n.stops.map(S=>S[0]),i),f=function(S,E,I,D){const z=D-I,F=S-I;return z===0?0:E===1?F/z:(Math.pow(E,F)-1)/(Math.pow(E,z)-1)}(i,o,n.stops[d][0],n.stops[d+1][0]),g=n.stops[d][1],x=n.stops[d+1][1];let b=ku[e.type]||mm;if(n.colorSpace&&n.colorSpace!=="rgb"){const S=om[n.colorSpace];b=(E,I)=>S.reverse(S.interpolate(S.forward(E),S.forward(I),f))}return typeof g.evaluate=="function"?{evaluate(...S){const E=g.evaluate.apply(void 0,S),I=x.evaluate.apply(void 0,S);if(E!==void 0&&I!==void 0)return b(E,I,f)}}:b(g,x,f)}function oy(n,e,i){return e.type==="color"?i=$i.parse(i):e.type==="formatted"?i=fs.fromString(i.toString()):e.type==="resolvedImage"?i=Ss.build(i.toString()):Wt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Za(i,n.default,e.default)}as.register(Wa,{error:[{kind:"error"},[ln],(n,[e])=>{throw new It(e.evaluate(n))}],typeof:[ln,[Wi],(n,[e])=>mr(br(e.evaluate(n)))],"to-rgba":[ds(Bt,4),[Ts],(n,[e])=>e.evaluate(n).toRenderColor(null).toArray()],"to-hsla":[ds(Bt,4),[Ts],(n,[e])=>e.evaluate(n).toRenderColor(null).toHslaArray()],rgb:[Ts,[Bt,Bt,Bt],hm],rgba:[Ts,[Bt,Bt,Bt,Bt],hm],hsl:[Ts,[Bt,Bt,Bt],dm],hsla:[Ts,[Bt,Bt,Bt,Bt],dm],has:{type:Ki,overloads:[[[ln],(n,[e])=>qd(e.evaluate(n),n.properties())],[[ln,sa],(n,[e,i])=>qd(e.evaluate(n),i.evaluate(n))]]},get:{type:Wi,overloads:[[[ln],(n,[e])=>ih(e.evaluate(n),n.properties())],[[ln,sa],(n,[e,i])=>ih(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Wi,[ln],(n,[e])=>ih(e.evaluate(n),n.featureState||{})],properties:[sa,[],n=>n.properties()],"geometry-type":[ln,[],n=>n.geometryType()],id:[Wi,[],n=>n.id()],zoom:[Bt,[],n=>n.globals.zoom],pitch:[Bt,[],n=>n.globals.pitch||0],"distance-from-center":[Bt,[],n=>n.distanceFromCenter()],"measure-light":[Bt,[ln],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Bt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Bt,[],n=>n.globals.lineProgress||0],"raster-value":[Bt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Bt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Bt,[],n=>n.globals.skyRadialProgress||0],accumulated:[Wi,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Bt,ha(Bt),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Bt,ha(Bt),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Bt,overloads:[[[Bt,Bt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Bt],(n,[e])=>-e.evaluate(n)]]},"/":[Bt,[Bt,Bt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Bt,[Bt,Bt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Bt,[Bt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Bt,[Bt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Bt,[Bt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Bt,[Bt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Bt,[Bt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Bt,[Bt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Bt,[Bt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Bt,[Bt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Bt,[Bt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Bt,[Bt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Bt,ha(Bt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Bt,ha(Bt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Bt,[Bt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Bt,[Bt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Bt,[Bt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Bt,[Bt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Ki,[ln,Wi],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Ki,[Wi],(n,[e])=>n.id()===e.value],"filter-type-==":[Ki,[ln],(n,[e])=>n.geometryType()===e.value],"filter-<":[Ki,[ln,Wi],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o<l}],"filter-id-<":[Ki,[Wi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Ki,[ln,Wi],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o>l}],"filter-id->":[Ki,[Wi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Ki,[ln,Wi],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o<=l}],"filter-id-<=":[Ki,[Wi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Ki,[ln,Wi],(n,[e,i])=>{const o=n.properties()[e.value],l=i.value;return typeof o==typeof l&&o>=l}],"filter-id->=":[Ki,[Wi],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Ki,[Wi],(n,[e])=>e.value in n.properties()],"filter-has-id":[Ki,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ki,[ds(ln)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ki,[ds(Wi)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Ki,[ln,ds(Wi)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Ki,[ln,ds(Wi)],(n,[e,i])=>function(o,l,d,f){for(;d<=f;){const g=d+f>>1;if(l[g]===o)return!0;l[g]>o?f=g-1:d=g+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ki,overloads:[[[Ki,Ki],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ha(Ki),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Ki,overloads:[[[Ki,Ki],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ha(Ki),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Ki,[Ki],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Ki,[ln],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[ln,[ln],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[ln,[ln],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[ln,ha(Wi),(n,e)=>e.map(i=>ps(i.evaluate(n))).join("")],"resolved-locale":[ln,[Na],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Bt,[Bt,Bt,Wi],(n,e)=>{const[i,o,l]=e.map(f=>f.evaluate(n));if(i>o||i===o)return i;let d;if(typeof l=="string")d=function(f){let g=0;if(f.length===0)return g;for(let x=0;x<f.length;x++)g=(g<<5)-g+f.charCodeAt(x),g|=0;return g}(l);else{if(typeof l!="number")throw new It(`Invalid seed input: ${l}`);d=l}return i+um(d)()*(o-i)}]});class Xd{constructor(e,i,o,l){this.expression=e,this._warningHistory={},this._evaluator=new Fu(o,l),this._defaultValue=i?function(d){return d.type==="color"&&(sh(d.default)||Array.isArray(d.default))?new $i(0,0,0,0):d.type==="color"?$i.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=qu(e)}evaluateWithoutErrorHandling(e,i,o,l,d,f,g,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,l,d,f,g,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new It(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${b.message}`)),this._defaultValue}}}function ah(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Wa}function Ll(n,e,i,o){const l=new tm(Wa,[],e?function(f){const g={color:Ts,string:ln,number:Bt,enum:ln,boolean:Ki,formatted:bc,resolvedImage:wc};return f.type==="array"?ds(g[f.value]||Wi,f.length):g[f.type]}(e):void 0,void 0,void 0,i,o),d=l.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?fm(new Xd(d,e,i,o)):$s(l.errors)}class Xa{constructor(e,i,o,l){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=l,this.isStateDependent=e!=="constant"&&!Hu(i.expression),this.configDependencies=qu(i.expression)}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}}class kl{constructor(e,i,o,l,d,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Hu(i.expression),this.isLightConstant=d,this.isLineProgressConstant=f,this.configDependencies=qu(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,o,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,l,d,f)}evaluate(e,i,o,l,d,f){return this._styleExpression.evaluate(e,i,o,l,d,f)}interpolationFactor(e,i,o){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,i,o):0}}function kc(n,e,i,o){if((n=Ll(n,e,i,o)).result==="error")return n;const l=n.value.expression,d=Mc(l);if(!d&&!nh(e))return $s([new Ks("","data expressions not supported")]);const f=Ml(l,["zoom","pitch","distance-from-center"]);if(!f&&!Zd(e))return $s([new Ks("","zoom expressions not supported")]);const g=Ml(l,["measure-light"]);if(!g&&!pm(e))return $s([new Ks("","measure-light expression not supported")]);const x=Ml(l,["line-progress"]);if(!x&&!function(E){return Wd(E.expression,"line-progress")}(e))return $s([new Ks("","line-progress expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,S=lh(l);return S||f||b?S instanceof Ks?$s([S]):S instanceof Es&&!rh(e)?$s([new Ks("",'"interpolate" expressions cannot be used with this property')]):fm(S?new kl(d&&x?"camera":"composite",n.value,S.labels,S instanceof Es?S.interpolation:void 0,g,x):new Xa(d&&x?"constant":"source",n.value,g,x)):$s([new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Oc{constructor(e,i){this._parameters=e,this._specification=i,vc(this,oh(this._parameters,this._specification))}static deserialize(e){return new Oc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lh(n){let e=null;if(n instanceof Yu)e=lh(n.result);else if(n instanceof Ku){for(const i of n.args)if(e=lh(i),e)break}else(n instanceof Pc||n instanceof Es)&&n.input instanceof as&&n.input.name==="zoom"&&(e=n);return e instanceof Ks||n.eachChild(i=>{const o=lh(i);o instanceof Ks?e=o:e&&o&&e!==o&&(e=new Ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Kd,ch,Yd=function(){if(ch)return Kd;ch=1,Kd=e;var n=3;function e(i,o,l){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var g=0;g<this.d*this.d;g++){var x=f[n+g],b=f[n+g+1];d.push(x===b?null:f.subarray(x,b))}var S=f[n+d.length+1];this.keys=f.subarray(f[n+d.length],S),this.bboxes=f.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var E=0;E<this.d*this.d;E++)d.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=l,this.scale=o/i,this.uid=0;var I=l/o*i;this.min=-I,this.max=i+I}return e.prototype.insert=function(i,o,l,d,f){this._forEachCell(o,l,d,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,l,d,f,g){this.cells[f].push(g)},e.prototype.query=function(i,o,l,d,f){var g=this.min,x=this.max;if(i<=g&&o<=g&&x<=l&&x<=d&&!f)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,o,l,d,this._queryCell,b,{},f),b},e.prototype._queryCell=function(i,o,l,d,f,g,x,b){var S=this.cells[f];if(S!==null)for(var E=this.keys,I=this.bboxes,D=0;D<S.length;D++){var z=S[D];if(x[z]===void 0){var F=4*z;(b?b(I[F+0],I[F+1],I[F+2],I[F+3]):i<=I[F+2]&&o<=I[F+3]&&l>=I[F+0]&&d>=I[F+1])?(x[z]=!0,g.push(E[z])):x[z]=!1}}},e.prototype._forEachCell=function(i,o,l,d,f,g,x,b){for(var S=this._convertToCellCoord(i),E=this._convertToCellCoord(o),I=this._convertToCellCoord(l),D=this._convertToCellCoord(d),z=S;z<=I;z++)for(var F=E;F<=D;F++){var $=this.d*F+z;if((!b||b(this._convertFromCellCoord(z),this._convertFromCellCoord(F),this._convertFromCellCoord(z+1),this._convertFromCellCoord(F+1)))&&f.call(this,i,o,l,d,$,g,x,b))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=o,x=0;x<i.length;x++){var b=i[x];f[n+x]=g,f.set(b,g),g+=b.length}return f[n+i.length]=g,f.set(this.keys,g),f[n+i.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer},Kd}(),Ol=Kr(Yd);const Fc={};function Tt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Fc[e]={klass:n,omit:i.omit||[]}}Tt(Object,"Object"),Ol.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ol.deserialize=function(n){return new Ol(n.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),Tt(Ol,"Grid"),typeof DOMMatrix<"u"&&Tt(DOMMatrix,"DOMMatrix"),Tt($i,"Color"),Tt(Error,"Error"),Tt(fs,"Formatted"),Tt(Ou,"FormattedSection"),Tt(Pu,"AJAXError"),Tt(Ss,"ResolvedImage"),Tt(Oc,"StylePropertyFunction"),Tt(Xd,"StyleExpression",{omit:["_evaluator"]}),Tt(Ds,"ImageId"),Tt(ho,"ImageVariant"),Tt(kl,"ZoomDependentExpression"),Tt(Xa,"ZoomConstantExpression"),Tt(as,"CompoundExpression",{omit:["_evaluate"]});for(const n in Wa)Fc[Wa[n]._classRegistryKey]||Tt(Wa[n],`Expression${n}`);function Bc(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Ka(n){return self.ImageBitmap&&n instanceof ImageBitmap}function da(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Bc(n)||Ka(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(da(o,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[o,l]of n.entries())i.entries.push(da(o),da(l,e));return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const l of n.values())i[++o]=da(l);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const l of o)i[l]=n[l];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const l=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Fc[o].omit.indexOf(d)>=0||(l[d]=da(n[d],e)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(l.$name=o),l}throw new Error("can't serialize object of type "+typeof n)}function fa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Bc(n)||Ka(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(fa);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const l=n.entries||[],d=new Map;for(let f=0;f<l.length;f+=2)d.set(fa(l[f]),fa(l[f+1]));return d}if(e==="Set"){const l=new Set;for(const d of Object.keys(n))d!=="$name"&&l.add(fa(n[d]));return l}if(e==="DOMMatrix"){let l;return l=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(l)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Fc[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const l of Object.keys(n))l!=="$name"&&(o[l]=fa(n[l]));return o}throw new Error("can't deserialize object of type "+typeof n)}const jt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Jd(n){for(const e of n)if(Nc(e.charCodeAt(0)))return!0;return!1}function ay(n){for(const e of n)if(!_m(e.charCodeAt(0)))return!1;return!0}function _m(n){return!(jt.Arabic(n)||jt["Arabic Supplement"](n)||jt["Arabic Extended-A"](n)||jt["Arabic Presentation Forms-A"](n)||jt["Arabic Presentation Forms-B"](n))}function Nc(n){return!(n!==746&&n!==747&&(n<4352||!(jt["Bopomofo Extended"](n)||jt.Bopomofo(n)||jt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||jt["CJK Compatibility Ideographs"](n)||jt["CJK Compatibility"](n)||jt["CJK Radicals Supplement"](n)||jt["CJK Strokes"](n)||!(!jt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||jt["CJK Unified Ideographs Extension A"](n)||jt["CJK Unified Ideographs"](n)||jt["Enclosed CJK Letters and Months"](n)||jt["Hangul Compatibility Jamo"](n)||jt["Hangul Jamo Extended-A"](n)||jt["Hangul Jamo Extended-B"](n)||jt["Hangul Jamo"](n)||jt["Hangul Syllables"](n)||jt.Hiragana(n)||jt["Ideographic Description Characters"](n)||jt.Kanbun(n)||jt["Kangxi Radicals"](n)||jt["Katakana Phonetic Extensions"](n)||jt.Katakana(n)&&n!==12540||!(!jt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!jt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||jt["Unified Canadian Aboriginal Syllabics"](n)||jt["Unified Canadian Aboriginal Syllabics Extended"](n)||jt["Vertical Forms"](n)||jt["Yijing Hexagram Symbols"](n)||jt["Yi Syllables"](n)||jt["Yi Radicals"](n))))}function ym(n){return!(Nc(n)||function(e){return!!(jt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||jt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||jt["Letterlike Symbols"](e)||jt["Number Forms"](e)||jt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||jt["Control Pictures"](e)&&e!==9251||jt["Optical Character Recognition"](e)||jt["Enclosed Alphanumerics"](e)||jt["Geometric Shapes"](e)||jt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||jt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||jt["CJK Symbols and Punctuation"](e)||jt.Katakana(e)||jt["Private Use Area"](e)||jt["CJK Compatibility Forms"](e)||jt["Small Form Variants"](e)||jt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function ly(n){return jt.Arabic(n)||jt["Arabic Supplement"](n)||jt["Arabic Extended-A"](n)||jt["Arabic Presentation Forms-A"](n)||jt["Arabic Presentation Forms-B"](n)}function xm(n){return n>=1424&&n<=2303||jt["Arabic Presentation Forms-A"](n)||jt["Arabic Presentation Forms-B"](n)}function cy(n,e){return!(!e&&xm(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||jt.Khmer(n))}function uy(n){for(const e of n)if(xm(e.charCodeAt(0)))return!0;return!1}const Qd="deferred",ef="loading",tf="loaded";let nf=null,zs="unavailable",pa=null;const Ya=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(zs="error"),nf&&nf(n)};function uh(){hh.fire(new na("pluginStateChange",{pluginStatus:zs,pluginURL:pa}))}const hh=new Fa,Fl=function(){return zs},vm=function(){if(zs!==Qd||!pa)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");zs=ef,uh(),pa&&_l({url:pa},n=>{n?Ya(n):(zs=tf,uh())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>zs===tf||Qs.applyArabicShaping!=null,isLoading:()=>zs===ef,setState(n){zs=n.pluginStatus,pa=n.pluginURL},isParsed:()=>Qs.applyArabicShaping!=null&&Qs.processBidirectionalText!=null&&Qs.processStyledBidirectionalText!=null,getPluginURL:()=>pa};class nn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const l of i)if(!cy(l.charCodeAt(0),o))return!1;return!0}(e,Qs.isLoaded())}}class Vc{constructor(e,i,o,l){this.property=e,this.value=i,this.expression=function(d,f,g,x){if(sh(d))return new Oc(d,f);if(ah(d)||Array.isArray(d)&&d.length>0){const b=kc(d,f,g,x);if(b.result==="error")throw new Error(b.value.map(S=>`${S.key}: ${S.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&f.type==="color"&&(b=$i.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>b}}}(i===void 0?e.specification.default:i,e.specification,o,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class ma{constructor(e,i,o){this.property=e,this.value=new Vc(e,void 0,i,o)}transitioned(e,i){return new wm(this.property,this.value,i,ze({},e.transition,this.transition),e.now)}untransitioned(){return new wm(this.property,this.value,null,{},0)}}class bm{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return pi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ma(this._values[e].property,this._scope,this._options)),this._values[e].value=new Vc(this._values[e].property,i===null?void 0:pi(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const l in e){const d=e[l];if(l.endsWith("-transition")){const f=l.slice(0,-11);o[f]&&this.setTransition(f,d)}else o.hasOwnProperty(l)&&this.setValue(l,d)}}getTransition(e){return pi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ma(this._values[e].property)),this._values[e].transition=pi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const o=new Tm(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].transitioned(e,i._values[l]);return o}untransitioned(){const e=new Tm(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class wm{constructor(e,i,o,l,d){const f=l.delay||0,g=l.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const l=e.now||0,d=this.value.possiblyEvaluate(e,i,o),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,i,o);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,o),d,he(g))}}return d}}class Tm{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const l=new Ja(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class hy{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return pi(this._values[e].value)}setValue(e,i){this._values[e]=new Vc(this._values[e].property,i===null?void 0:pi(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const l=new Ja(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,o);return l}}class Bl{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,l){return this.property.evaluate(this.value,this.parameters,e,i,o,l)}}class Ja{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const l=ku[this.specification.type];return l?l(e,i,o):e}}class wt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,l){return new Bl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,l)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Bl(this,{kind:"constant",value:void 0},e.parameters);const l=ku[this.specification.type];return l?new Bl(this,{kind:"constant",value:l(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,l,d,f){return e.kind==="constant"?e.value:e.evaluate(i,o,l,d,f)}}class Qa{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,l){return!!e.expression.evaluate(i,null,{},o,l)}interpolate(){return!1}}class $n{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new nn(0,{});for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new Vc(l,void 0),f=this.defaultTransitionablePropertyValues[o]=new ma(l);this.defaultTransitioningPropertyValues[o]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(i)}}}Tt(wt,"DataDrivenProperty"),Tt(ut,"DataConstantProperty"),Tt(Qa,"ColorRampProperty");var Ce=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function po(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function dh(n){if(Array.isArray(n))return n.map(dh);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=dh(n[i]);return e}return po(n)}function fh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!fh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function rf(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fh(n)||(n=ph(n));const l=n;let d=!0;try{d=function(S){if(!Nl(S))return S;let E=dh(S);return Em(E),E=Sm(E),E}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let f=null,g=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){g=Ce[`filter_${o}`];const S=Ll(d,g,e,i);if(S.result==="error")throw new Error(S.value.map(E=>`${E.key}: ${E.message}`).join(", "));f=(E,I,D)=>S.value.evaluate(E,I,{},D)}let x=null,b=null;if(d!==l){const S=Ll(l,g,e,i);if(S.result==="error")throw new Error(S.value.map(E=>`${E.key}: ${E.message}`).join(", "));x=(E,I,D,z,F)=>S.value.evaluate(E,I,{},D,void 0,void 0,z,F),b=!Mc(S.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:Am(d),needFeature:!!b}}function Sm(n){if(!Array.isArray(n))return n;const e=function(i){if(dy.has(i[0])){for(let o=1;o<i.length;o++)if(Nl(i[o]))return!0}return i}(n);return e===!0?e:e.map(i=>Sm(i))}function Em(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||Nl(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Nl(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Nl(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Em(n[o])}function Nl(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Nl(n[i]))return!0;return!1}const dy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fy(n,e){return n<e?-1:n>e?1:0}function Am(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Am(n[e]))return!0;return!1}function ph(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?sf(n[1],n[2],"=="):e==="!="?mh(sf(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?sf(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(ph))):e==="all"?["all"].concat(n.slice(1).map(ph)):e==="none"?["all"].concat(n.slice(1).map(ph).map(mh)):e==="in"?of(n[1],n.slice(2)):e==="!in"?mh(of(n[1],n.slice(2))):e==="has"?Im(n[1]):e!=="!has"||mh(Im(n[1]));var i}function sf(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function of(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(fy)]]:["filter-in-small",n,["literal",e]]}}function Im(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function mh(n){return["!",n]}const jc="";function el(n,e){return e?`${n}${jc}${e}`:n}const af="-transition",ga=new Set(["fill","line","background","hillshade","raster"]);class _s extends Fa{constructor(e,i,o,l,d){if(super(),this.id=e.id,this.fqid=el(this.id,o),this.type=e.type,this.scope=o,this.lut=l,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Ll(this.filter,Ce[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new hy(i.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new bm(i.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ja(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ga.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(af)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,l=o._properties.properties;if(e.endsWith(af)){const E=e.slice(0,-11);return l[E]&&o.setTransition(E,i||void 0),!1}if(!l[e])return!1;const d=o._values[e],f=d.value.isDataDriven(),g=d.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const x=o._values[e].value,b=x.isDataDriven(),S=e.endsWith("pattern")||e==="line-dasharray";return b||f||S||this._handleOverridablePaintPropertyUpdate(e,g,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Bl&&nh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=rf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,l,d,f,g,x,b){}}const py={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Uc{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ni(n,e=1){let i=0,o=0;return{members:n.map(l=>{const d=py[l.type].BYTES_PER_ELEMENT,f=i=lf(i,Math.max(e,d)),g=l.components||1;return o=Math.max(o,d),i+=d*g,{name:l.name,type:l.type,components:g,offset:f}}),size:lf(i,Math.max(o,e)),alignment:e}}function lf(n,e){return Math.ceil(n/e)*e}class Ho extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=o,e}}Ho.prototype.bytesPerElement=4,Tt(Ho,"StructArrayLayout2i4");class gh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}gh.prototype.bytesPerElement=6,Tt(gh,"StructArrayLayout3i6");class tl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=l,this.int16[f+3]=d,e}}tl.prototype.bytesPerElement=8,Tt(tl,"StructArrayLayout4i8");class Vl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Vl.prototype.bytesPerElement=4,Tt(Vl,"StructArrayLayout1f4");class _h extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e,f=2*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.float32[f+1]=l,e}}_h.prototype.bytesPerElement=8,Tt(_h,"StructArrayLayout2i1f8");class jl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=l,e}}jl.prototype.bytesPerElement=8,Tt(jl,"StructArrayLayout3i8");class cf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=l,this.int16[g+3]=d,this.int16[g+4]=f,e}}cf.prototype.bytesPerElement=10,Tt(cf,"StructArrayLayout5i10");class uf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const b=6*e,S=12*e,E=3*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.uint8[S+4]=l,this.uint8[S+5]=d,this.uint8[S+6]=f,this.uint8[S+7]=g,this.float32[E+2]=x,e}}uf.prototype.bytesPerElement=12,Tt(uf,"StructArrayLayout2i4ub1f12");class Ao extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=l,e}}Ao.prototype.bytesPerElement=12,Tt(Ao,"StructArrayLayout3f12");class qo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=6*e,x=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=l,this.uint16[g+3]=d,this.float32[x+2]=f,e}}qo.prototype.bytesPerElement=12,Tt(qo,"StructArrayLayout4ui1f12");class yh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}yh.prototype.bytesPerElement=8,Tt(yh,"StructArrayLayout4ui8");class il extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=g,e}}il.prototype.bytesPerElement=12,Tt(il,"StructArrayLayout6i12");class Ul extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E,I){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,o,l,d,f,g,x,b,S,E,I)}emplace(e,i,o,l,d,f,g,x,b,S,E,I,D){const z=12*e;return this.int16[z+0]=i,this.int16[z+1]=o,this.int16[z+2]=l,this.int16[z+3]=d,this.uint16[z+4]=f,this.uint16[z+5]=g,this.uint16[z+6]=x,this.uint16[z+7]=b,this.int16[z+8]=S,this.int16[z+9]=E,this.int16[z+10]=I,this.int16[z+11]=D,e}}Ul.prototype.bytesPerElement=24,Tt(Ul,"StructArrayLayout4i4ui4i24");class As extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=10*e,b=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=l,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=g,e}}As.prototype.bytesPerElement=20,Tt(As,"StructArrayLayout3i3f20");class Io extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=l,this.float32[f+3]=d,e}}Io.prototype.bytesPerElement=16,Tt(Io,"StructArrayLayout4f16");class hf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}hf.prototype.bytesPerElement=4,Tt(hf,"StructArrayLayout1ul4");class _a extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=o,e}}_a.prototype.bytesPerElement=4,Tt(_a,"StructArrayLayout2ui4");class df extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E,I,D){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,o,l,d,f,g,x,b,S,E,I,D)}emplace(e,i,o,l,d,f,g,x,b,S,E,I,D,z){const F=20*e,$=10*e;return this.int16[F+0]=i,this.int16[F+1]=o,this.int16[F+2]=l,this.int16[F+3]=d,this.int16[F+4]=f,this.float32[$+3]=g,this.float32[$+4]=x,this.float32[$+5]=b,this.float32[$+6]=S,this.int16[F+14]=E,this.uint32[$+8]=I,this.uint16[F+18]=D,this.uint16[F+19]=z,e}}df.prototype.bytesPerElement=40,Tt(df,"StructArrayLayout5i4f1i1ul2ui40");class xh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const b=8*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=l,this.int16[b+4]=d,this.int16[b+5]=f,this.int16[b+6]=g,this.int16[b+7]=x,e}}xh.prototype.bytesPerElement=16,Tt(xh,"StructArrayLayout3i2i2i16");class $c extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=4*e,x=8*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=l,this.int16[x+6]=d,this.int16[x+7]=f,e}}$c.prototype.bytesPerElement=16,Tt($c,"StructArrayLayout2f1f2i16");class ff extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,l,d,f)}emplace(e,i,o,l,d,f,g){const x=20*e,b=5*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[b+1]=l,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=g,e}}ff.prototype.bytesPerElement=20,Tt(ff,"StructArrayLayout2ub4f20");class Ar extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,o)}emplace(e,i,o,l){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=l,e}}Ar.prototype.bytesPerElement=6,Tt(Ar,"StructArrayLayout3ui6");class pf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z)}emplace(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z,Q){const re=30*e,pe=15*e,_e=60*e;return this.int16[re+0]=i,this.int16[re+1]=o,this.int16[re+2]=l,this.float32[pe+2]=d,this.float32[pe+3]=f,this.uint16[re+8]=g,this.uint16[re+9]=x,this.uint32[pe+5]=b,this.uint32[pe+6]=S,this.uint32[pe+7]=E,this.uint16[re+16]=I,this.uint16[re+17]=D,this.uint16[re+18]=z,this.float32[pe+10]=F,this.float32[pe+11]=$,this.uint8[_e+48]=H,this.uint8[_e+49]=ee,this.uint8[_e+50]=K,this.uint32[pe+13]=N,this.int16[re+28]=Z,this.uint8[_e+58]=Q,e}}pf.prototype.bytesPerElement=60,Tt(pf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class mf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z,Q,re,pe,_e,xe,Te,Be,Je,Ze,Ye,rt,Oe){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z,Q,re,pe,_e,xe,Te,Be,Je,Ze,Ye,rt,Oe)}emplace(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K,N,Z,Q,re,pe,_e,xe,Te,Be,Je,Ze,Ye,rt,Oe,Ke){const Le=20*e,Fe=40*e,at=80*e;return this.float32[Le+0]=i,this.float32[Le+1]=o,this.int16[Fe+4]=l,this.int16[Fe+5]=d,this.int16[Fe+6]=f,this.int16[Fe+7]=g,this.int16[Fe+8]=x,this.int16[Fe+9]=b,this.int16[Fe+10]=S,this.int16[Fe+11]=E,this.int16[Fe+12]=I,this.uint16[Fe+13]=D,this.uint16[Fe+14]=z,this.uint16[Fe+15]=F,this.uint16[Fe+16]=$,this.uint16[Fe+17]=H,this.uint16[Fe+18]=ee,this.uint16[Fe+19]=K,this.uint16[Fe+20]=N,this.uint16[Fe+21]=Z,this.uint16[Fe+22]=Q,this.uint16[Fe+23]=re,this.uint16[Fe+24]=pe,this.uint16[Fe+25]=_e,this.uint16[Fe+26]=xe,this.uint16[Fe+27]=Te,this.uint32[Le+14]=Be,this.float32[Le+15]=Je,this.float32[Le+16]=Ze,this.float32[Le+17]=Ye,this.float32[Le+18]=rt,this.uint8[at+76]=Oe,this.uint16[Fe+39]=Ke,e}}mf.prototype.bytesPerElement=80,Tt(mf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ya extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,l,d)}emplace(e,i,o,l,d,f){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=l,this.float32[g+3]=d,this.float32[g+4]=f,e}}ya.prototype.bytesPerElement=20,Tt(ya,"StructArrayLayout5f20");class Gc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const b=7*e;return this.float32[b+0]=i,this.float32[b+1]=o,this.float32[b+2]=l,this.float32[b+3]=d,this.float32[b+4]=f,this.float32[b+5]=g,this.float32[b+6]=x,e}}Gc.prototype.bytesPerElement=28,Tt(Gc,"StructArrayLayout7f28");class gf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,l,d,f,g,x,b,S,E)}emplace(e,i,o,l,d,f,g,x,b,S,E,I){const D=11*e;return this.float32[D+0]=i,this.float32[D+1]=o,this.float32[D+2]=l,this.float32[D+3]=d,this.float32[D+4]=f,this.float32[D+5]=g,this.float32[D+6]=x,this.float32[D+7]=b,this.float32[D+8]=S,this.float32[D+9]=E,this.float32[D+10]=I,e}}gf.prototype.bytesPerElement=44,Tt(gf,"StructArrayLayout11f44");class vh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,o,l,d,f,g,x,b)}emplace(e,i,o,l,d,f,g,x,b,S){const E=9*e;return this.float32[E+0]=i,this.float32[E+1]=o,this.float32[E+2]=l,this.float32[E+3]=d,this.float32[E+4]=f,this.float32[E+5]=g,this.float32[E+6]=x,this.float32[E+7]=b,this.float32[E+8]=S,e}}vh.prototype.bytesPerElement=36,Tt(vh,"StructArrayLayout9f36");class nl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=o,e}}nl.prototype.bytesPerElement=8,Tt(nl,"StructArrayLayout2f8");class _f extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,l)}emplace(e,i,o,l,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=l,this.uint16[f+4]=d,e}}_f.prototype.bytesPerElement=12,Tt(_f,"StructArrayLayout1ul3ui12");class Hc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Hc.prototype.bytesPerElement=2,Tt(Hc,"StructArrayLayout1ui2");class $l extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$){const H=this.length;return this.resize(H+1),this.emplace(H,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$)}emplace(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H){const ee=16*e;return this.float32[ee+0]=i,this.float32[ee+1]=o,this.float32[ee+2]=l,this.float32[ee+3]=d,this.float32[ee+4]=f,this.float32[ee+5]=g,this.float32[ee+6]=x,this.float32[ee+7]=b,this.float32[ee+8]=S,this.float32[ee+9]=E,this.float32[ee+10]=I,this.float32[ee+11]=D,this.float32[ee+12]=z,this.float32[ee+13]=F,this.float32[ee+14]=$,this.float32[ee+15]=H,e}}$l.prototype.bytesPerElement=64,Tt($l,"StructArrayLayout16f64");class qc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,l,d,f,g)}emplace(e,i,o,l,d,f,g,x){const b=10*e,S=5*e;return this.uint16[b+0]=i,this.uint16[b+1]=o,this.uint16[b+2]=l,this.uint16[b+3]=d,this.float32[S+2]=f,this.float32[S+3]=g,this.float32[S+4]=x,e}}qc.prototype.bytesPerElement=20,Tt(qc,"StructArrayLayout4ui3f20");class yf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}yf.prototype.bytesPerElement=2,Tt(yf,"StructArrayLayout1i2");class bh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}bh.prototype.bytesPerElement=1,Tt(bh,"StructArrayLayout1ub1");class Cm extends Uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cm.prototype.size=40;class wh extends df{get(e){return new Cm(this,e)}}Tt(wh,"CollisionBoxArray");class Mm extends Uc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Mm.prototype.size=60;class Pm extends pf{get(e){return new Mm(this,e)}}Tt(Pm,"PlacedSymbolArray");class Rm extends Uc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Rm.prototype.size=80;class Dm extends mf{get(e){return new Rm(this,e)}}Tt(Dm,"SymbolInstanceArray");class xf extends Vl{getoffsetX(e){return this.float32[1*e+0]}}Tt(xf,"GlyphOffsetArray");class zm extends Ho{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Tt(zm,"SymbolLineVertexArray");class Lm extends Uc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lm.prototype.size=12;class km extends _f{get(e){return new Lm(this,e)}}Tt(km,"FeatureIndexArray");class Om extends _a{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Tt(Om,"FillExtrusionCentroidArray");class Fm extends Uc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Fm.prototype.size=6;class Bm extends gh{get(e){return new Fm(this,e)}}Tt(Bm,"FillExtrusionWallArray");const my=Ni([{name:"a_pos",components:2,type:"Int16"}],4),gy=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class kn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,l){let d=this.segments[this.segments.length-1];return e>kn.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${kn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>kn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}prepareSegment(e,i,o,l){return this._prepareSegment(e,i.length,o.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,l){return new kn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:l,vaos:{},sortKey:0}])}}function Nm(n,e){return 256*(n=ve(Math.floor(n),0,255))+ve(Math.floor(e),0,255)}kn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt(kn,"SegmentVector");const _y=Ni([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Gl=Ni([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yy=Ni([{name:"a_dash",components:4,type:"Uint16"}]);class Hl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,l){this.ids.push(Vm(e)),this.positions.push(i,o,l)}eachPosition(e,i){const o=Vm(e);let l=0,d=this.ids.length-1;for(;l<d;){const f=l+d>>1;this.ids[f]>=o?d=f:l=f+1}for(;this.ids[l]===o;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const o=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Th(o,l,0,o.length-1),i&&(i.add(o.buffer),i.add(l.buffer)),{ids:o,positions:l}}static deserialize(e){const i=new Hl;let o;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==o&&i.uniqueIds.push(l),o=l;return i.indexed=!0,i}}function Vm(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Rs(String(n))}function Th(n,e,i,o){for(;i<o;){const l=n[i+o>>1];let d=i-1,f=o+1;for(;;){do d++;while(n[d]<l);do f--;while(n[f]>l);if(d>=f)break;Wc(n,d,f),Wc(e,3*d,3*f),Wc(e,3*d+1,3*f+1),Wc(e,3*d+2,3*f+2)}f-i<o-f?(Th(n,e,i,f),i=f+1):(Th(n,e,f+1,o),o=f)}}function Wc(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}Tt(Hl,"FeaturePositionMap");class Co{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sh extends Co{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class or extends Co{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class mo extends Co{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Zc extends Co{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Eh extends Co{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class jm extends Co{constructor(e){super(e),this.current=$i.transparent.toRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const xy=new Float32Array(16);class Xc extends Co{constructor(e){super(e),this.current=xy}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let l=1;l<16;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Um=new Float32Array(9),vf=new Float32Array(4);class eo extends Co{constructor(e){super(e),this.current=vf}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(o[l]!==this.current[l]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Kc(n){return[Nm(255*n.r,255*n.g),Nm(255*n.b,255*n.a)]}class Yc{constructor(e,i,o,l){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=o,this.context=l}setUniform(e,i,o,l,d){const f=l.constantOr(this.value);i.set(e,d,f instanceof $i?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new jm(e):new or(e)}}class ql{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,l,d){let f=null;d!=="u_pattern"&&d!=="u_dash"||(f=this.pattern),d==="u_pattern_b"&&(f=this.patternTransition),d==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Eh(e):new or(e)}}class Wo{constructor(e,i,o,l){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,o,l,d,f,g){const x=this.paintVertexArray.length,b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new nn(0,{brightness:f}),i,{},d,l,g):this.expression.kind==="constant"&&this.expression.value,S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new nn(0,{brightness:f}),i,{},d,l,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(x,e,b,S?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,g){const x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g},o,l,void 0,d):this.expression.kind==="constant"&&this.expression.value,b=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new nn(0,{brightness:g}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,b?null:this.context.lut)}_setPaintValue(e,i,o,l){if(this.type==="color"){const d=Kc(o.toRenderColor(l));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class go{constructor(e,i,o,l,d,f){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=l,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,o,l,d,f,g){const x=this.expression.evaluate(new nn(this.context.zoom,{brightness:f}),i,{},d,l,g),b=this.expression.evaluate(new nn(this.context.zoom+1,{brightness:f}),i,{},d,l,g),S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new nn(0,{brightness:f}),i,{},d,l,g):this.lutExpression.value)==="none",E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,x,b,S?null:this.context.lut)}updatePaintArray(e,i,o,l,d,f,g){const x=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,l,void 0,d),b=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,l,void 0,d),S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new nn(0,{brightness:g}),o,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,x,b,S?null:this.context.lut)}_setPaintValue(e,i,o,l,d){if(this.type==="color"){const f=Kc(o.toRenderColor(d)),g=Kc(o.toRenderColor(d));for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,l);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,l,d){const f=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=ve(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,g)}getBinding(e,i){return new or(e)}}class _o{constructor(e,i,o,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(o==="array"?yy:_y).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new l,this.paintTransitionVertexArray=new qo}populatePaintArray(e,i,o,l){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,l,d,f,g){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,i,o,l){if(!l||!o)return;const d=l[o[0]],f=l[o[1]];if(d){if(d){const{tl:g,br:x,pixelRatio:b}=d;for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1],b)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:x,pixelRatio:b}=f;for(let S=e;S<i;S++)this.paintTransitionVertexArray.emplace(S,g[0],g[1],x[0],x[1],b)}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Gl.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class xa{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const l=[];for(const d in e.paint._values){const f=e.paint.get(d);if(d.endsWith("-use-theme")||!o(d)||!(f instanceof Bl&&nh(f.property.specification)))continue;const g=t(d,e.type),x=f.value,b=f.property.specification.type,S=!!f.property.useIntegerZoom,E=d==="line-dasharray"||d.endsWith("pattern"),I=e.paint.get(`${d}-use-theme`),D=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(x.kind!=="constant"||D)if(x.kind==="source"||D||E){const z=p(d,b,"source");this.binders[d]=E?new _o(x,g,b,z,e.id):new Wo(x,g,b,z),l.push(`/a_${d}`)}else{const z=p(d,b,"composite");this.binders[d]=new go(x,g,b,S,i,z),l.push(`/z_${d}`)}else this.binders[d]=E?new ql(x.value,g):new Yc(x.value,g,b,i),l.push(`/u_${d}`);I&&(this.binders[d].lutExpression=I.value)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Wo||i instanceof go?i.maxValue:0}populatePaintArrays(e,i,o,l,d,f,g){for(const x in this.binders){const b=this.binders[x];b.context=this.context,(b instanceof Wo||b instanceof go||b instanceof _o)&&b.populatePaintArray(e,i,o,l,d,f,g)}}setConstantPatternPositions(e,i){for(const o in this.binders){const l=this.binders[o];l instanceof ql&&l.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof _o?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,l,d,f,g,x,b){let S=!1;const E=Object.keys(e),I=E.length!==0&&!x,D=I?E:i.uniqueIds;this.context.lut=d.lut;for(const z in this.binders){const F=this.binders[z];if(F.context=this.context,(F instanceof Wo||F instanceof go||F instanceof _o)&&F.expression&&F.expression.kind&&F.expression.kind!=="constant"&&(F.expression.isStateDependent===!0||F.expression.isLightConstant===!1)){const $=d.paint.get(z);F.expression=$.value;for(const H of D){const ee=e[H.toString()];i.eachPosition(H,(K,N,Z)=>{const Q=l.feature(K);F.updatePaintArray(N,Z,Q,ee,f,g,b)})}if(!I)for(const H of o.uniqueIds){const ee=e[H.toString()];o.eachPosition(H,(K,N,Z)=>{const Q=l.feature(K);F.updatePaintArray(N,Z,Q,ee,f,g,b)})}S=!0}}return S}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Yc||o instanceof ql)&&e.push(...o.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Wo||o instanceof go||o instanceof _o)for(let l=0;l<o.paintVertexAttributes.length;l++)e.push(o.paintVertexAttributes[l].name);if(o instanceof _o)for(let l=0;l<Gl.members.length;l++)e.push(Gl.members[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Yc||o instanceof ql||o instanceof go)for(const l of o.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Yc||l instanceof ql||l instanceof go)for(const d of l.uniformNames)i.push({name:d,property:o,binding:l.getBinding(e,d)})}return i}setUniforms(e,i,o,l,d){for(const{name:f,property:g,binding:x}of o)this.binders[g].setUniform(e,x,d,l.get(g),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Wo||i instanceof go||i instanceof _o)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof _o&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Wo||o instanceof go||o instanceof _o)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Wo||i instanceof go||i instanceof _o)&&i.destroy()}}}class rl{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new xa(l,i,o);this.needsUpload=!1,this._featureMap=new Hl,this._featureMapWithoutIds=new Hl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,l,d,f,g,x){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,i,l,d,f,g,x);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,l,d,f,g){for(const x of o)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,x,l,d,f,g||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const c={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function t(n,e){return c[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const r={"line-pattern":{source:qo,composite:qo},"fill-pattern":{source:qo,composite:qo},"fill-extrusion-pattern":{source:qo,composite:qo},"line-dasharray":{source:yh,composite:yh}},u={color:{source:nl,composite:Io},number:{source:Vl,composite:nl}};function p(n,e,i){const o=r[n];return o&&o[i]||u[e][i]}Tt(Yc,"ConstantBinder"),Tt(ql,"PatternConstantBinder"),Tt(Wo,"SourceExpressionBinder"),Tt(_o,"PatternCompositeBinder"),Tt(go,"CompositeExpressionBinder"),Tt(xa,"ProgramConfiguration",{omit:["_buffers"]}),Tt(rl,"ProgramConfigurationSet");const m=pt/Math.PI/2,y=5,v=6,T=16383,A=64,C=[A,32,16],R=-m,P=m;function L(n,e,i,o=m){return i=B(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function j(n,e,i){return L(Math.cos(B(n)),Math.sin(B(n)),e,i)}const V=63710088e-1,G=2*Math.PI*V;class U{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new U(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,l=e.lat*i,d=Math.sin(o)*Math.sin(l)+Math.cos(o)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return V*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new J({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return j(this.lat,this.lng,m+e*m/V)}static convert(e){if(e instanceof U)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new U(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new U(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class J{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}setSouthWest(e){return this._sw=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}extend(e){const i=this._sw,o=this._ne;let l,d;if(e instanceof U)l=e,d=e;else{if(!(e instanceof J))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(J.convert(e)):this.extend(U.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(U.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return i||o?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new U(l.lng,l.lat),this._ne=new U(d.lng,d.lat)),this}getCenter(){return new U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new U(this.getWest(),this.getNorth())}getSouthEast(){return new U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=U.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&l}static convert(e){if(e)return e instanceof J?e:new J(e)}}const ne=0,oe=25.5;function ue(n){return G*Math.cos(n*Math.PI/180)}function le(n){return(180+n)/360}function ce(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function ae(n,e){return n/ue(e)}function me(n){return 360*n-180}function ge(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Me(n,e){return n*ue(ge(e))}const Ee=85.051129;function qe(n){return Math.cos(B(ve(n,-85.051129,Ee)))}function $e(n,e){const i=ve(e,ne,oe),o=Math.pow(2,i);return qe(n)*G/(512*o)}function ct(n){return 1/Math.cos(n*Math.PI/180)}function Se(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/pt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/pt/(1<<n.z)}class Pe{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=U.convert(e);return new Pe(le(o.lng),ce(o.lat),ae(i,o.lat))}toLngLat(){return new U(me(this.x),ge(this.y))}toAltitude(){return Me(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/G*ct(ge(this.y))}}function we(n,e,i,o,l,d,f,g,x){const b=(e+o)/2,S=(i+l)/2,E=new dt(b,S);g(E),function(I,D,z,F,$,H){const ee=z-$,K=F-H;return Math.abs((F-D)*ee-(z-I)*K)/Math.hypot(ee,K)}(E.x,E.y,d.x,d.y,f.x,f.y)>=x?(we(n,e,i,b,S,d,E,g,x),we(n,b,S,o,l,E,f,g,x)):n.push(f)}function Xe(n,e,i){let o=n[0],l=o.x,d=o.y;e(o);const f=[o];for(let g=1;g<n.length;g++){const x=n[g],{x:b,y:S}=x;e(x),we(f,l,d,b,S,o,x,e,i),l=b,d=S,o=x}return f}function ke(n,e,i,o){if(o(e,i)){const l=e.add(i)._mult(.5);ke(n,e,l,o),ke(n,l,i,o)}else n.push(i)}function Qe(n,e){let i=n[0];const o=[i];for(let l=1;l<n.length;l++){const d=n[l];ke(o,i,d,e),i=d}return o}const We=Math.pow(2,14)-1,tt=-We-1;function nt(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=ve(i,tt,We),n.y=ve(o,tt,We),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function At(n,e,i){const o=n.loadGeometry(),l=n.extent,d=pt/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x,y:b,projection:S}=i,E=I=>{const D=me((e.x+I.x/l)/f),z=ge((e.y+I.y/l)/f),F=S.project(D,z);I.x=(F.x*g-x)*l,I.y=(F.y*g-b)*l};for(let I=0;I<o.length;I++)if(n.type!==1)o[I]=Xe(o[I],E,1);else{const D=[];for(const z of o[I])z.x<0||z.x>=l||z.y<0||z.y>=l||(E(z),D.push(z));o[I]=D}}for(const f of o)for(const g of f)nt(g,d);return o}function Ot(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?At(n):[]}}function St(n,e,i,o,l){n.emplaceBack(2*e+(o+1)/2,2*i+(l+1)/2)}function Ft(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Mt{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ho,this.indexArray=new Ar,this.segments=new kn,this.programConfigurations=new rl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}updateFootprints(e,i){}populate(e,i,o,l){const d=this.layers[0],f=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:b,id:S,index:E,sourceLayerIndex:I}of e){const D=this.layers[0]._featureFilter.needGeometry,z=Ot(b,D);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),z,o))continue;const F=g?g.evaluate(z,{},o):void 0,$={id:S,properties:b.properties,type:b.type,sourceLayerIndex:I,index:E,geometry:D?z.geometry:At(b,o,l),patterns:{},sortKey:F};f.push($)}g&&f.sort((b,S)=>b.sortKey-S.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new il,x=l.projection);for(const b of f){const{geometry:S,index:E,sourceLayerIndex:I}=b,D=e[E].feature;this.addFeature(b,S,E,i.availableImages,o,x,i.brightness),i.featureIndex.insert(D,S,E,I,this.index)}}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,my.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,gy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,l,d,f,g){for(const x of i)for(const b of x){const S=b.x,E=b.y;if(S<0||S>=pt||E<0||E>=pt)continue;if(f){const z=f.projectTilePoint(S,E,d),F=f.upVector(d,S,E),$=this.globeExtVertexArray;Ft($,z,F),Ft($,z,F),Ft($,z,F),Ft($,z,F)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=I.vertexLength;St(this.layoutVertexArray,S,E,-1,-1),St(this.layoutVertexArray,S,E,1,-1),St(this.layoutVertexArray,S,E,1,1),St(this.layoutVertexArray,S,E,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},l,d,g)}}function Ut(n,e){for(let i=0;i<n.length;i++)if(sn(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(sn(n,e[i]))return!0;return!!Yi(n,e)}function Xt(n,e,i){return!!sn(n,e)||!!Qt(e,n,i)}function mi(n,e){if(n.length===1)return Oi(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let l=0;l<o.length;l++)if(sn(n,o[l]))return!0}for(let i=0;i<n.length;i++)if(Oi(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Yi(n,e[i]))return!0;return!1}function rn(n,e,i){if(n.length>1){if(Yi(n,e))return!0;for(let o=0;o<e.length;o++)if(Qt(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Qt(n[o],e,i))return!0;return!1}function Yi(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],l=n[i+1];for(let d=0;d<e.length-1;d++)if(bi(o,l,e[d],e[d+1]))return!0}return!1}function bi(n,e,i,o){return fn(n,i,o)!==fn(e,i,o)&&fn(n,e,i)!==fn(n,e,o)}function Vn(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Ln(n,e,i,o){const l=Vn(n,e,o),d=Vn(n,e,i);if(Math.sign(l)===Math.sign(d))return;const f=Vn(i,o,n),g=f+d-l;return Math.sign(f)!==Math.sign(g)?[f/(f-g),d/(d-l)]:void 0}function Qt(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let l=1;l<e.length;l++)if(Mi(n,e[l-1],e[l])<o)return!0;return!1}function Mi(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const l=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function Oi(n,e){let i,o,l,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let g=0,x=i.length-1;g<i.length;x=g++)o=i[g],l=i[x],o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(d=!d)}return d}function sn(n,e){let i=!1;for(let o=0,l=n.length-1;o<n.length;l=o++){const d=n[o],f=n[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function ur(n,e,i,o,l){for(const f of n)if(e<=f.x&&i<=f.y&&o>=f.x&&l>=f.y)return!0;const d=[new dt(e,i),new dt(e,l),new dt(o,l),new dt(o,i)];if(n.length>2){for(const f of d)if(sn(n,f))return!0}for(let f=0;f<n.length-1;f++)if(Gn(n[f],n[f+1],d))return!0;return!1}function Gn(n,e,i){const o=i[0],l=i[2];if(n.x<o.x&&e.x<o.x||n.x>l.x&&e.x>l.x||n.y<o.y&&e.y<o.y||n.y>l.y&&e.y>l.y)return!1;const d=fn(n,e,i[0]);return d!==fn(n,e,i[1])||d!==fn(n,e,i[2])||d!==fn(n,e,i[3])}function ar(n,e,i,o,l,d){let f=e.y-n.y,g=n.x-e.x;if(d=d||0){const x=f*f+g*g;if(x===0)return!0;const b=Math.sqrt(x);f/=b,g/=b}return!((i.x-n.x)*f+(i.y-n.y)*g-d<0||(o.x-n.x)*f+(o.y-n.y)*g-d<0||(l.x-n.x)*f+(l.y-n.y)*g-d<0)}function Rn(n,e,i,o,l,d,f){return!(ar(n,e,o,l,d,f)||ar(e,i,o,l,d,f)||ar(i,n,o,l,d,f)||ar(o,l,n,e,i,f)||ar(l,d,n,e,i,f)||ar(d,o,n,e,i,f))}function ri(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function En(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Li(n,e,i,o,l){if(!e[0]&&!e[1])return n;const d=dt.convert(e)._mult(l);i==="viewport"&&d._rotate(-o);const f=[];for(let g=0;g<n.length;g++)f.push(n[g].sub(d));return f}function An(n,e,i,o){const l=dt.convert(n)._mult(o);return e==="viewport"&&l._rotate(-i),l}let Gi,Dn;function Ir(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}Tt(Mt,"CircleBucket",{omit:["layers"]});class yn{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=$r(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(d,f,g){var x=Ir(256*d,256*(f=Math.pow(2,g)-f-1),g),b=Ir(256*(d+1),256*(f+1),g);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),l=function(d,f,g){let x,b="";for(let S=d;S>0;S--)x=1<<S-1,b+=(f&x?1:0)+(g&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lr{constructor(e,i){this.wrap=e,this.canonical=i,this.key=$r(e,i.z,i.z,i.x,i.y)}}class ir{constructor(e,i,o,l,d){this.overscaledZ=e,this.wrap=i,this.canonical=new yn(o,+l,+d),this.key=i===0&&e===o?this.canonical.key:$r(i,e,o,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ir(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ir(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return $r(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return $r(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ir(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,l=2*this.canonical.y;return[new ir(i,this.wrap,i,o,l),new ir(i,this.wrap,i,o+1,l),new ir(i,this.wrap,i,o,l+1),new ir(i,this.wrap,i,o+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ir(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ir(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lr(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $r(n,e,i,o,l){const d=1<<Math.min(i,22);let f=d*(l%d)+o%d;return n&&i<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const yo=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new ir(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new ir(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new ir(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new ir(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Tt(yn,"CanonicalTileID"),Tt(ir,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Zo=Ni([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ls}=Zo,to=Ni([{name:"a_pos_3",components:3,type:"Int16"}]);var Mo=Ni([{name:"a_pos",type:"Int16",components:2}]);class Po{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=Xi(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,!0}}class xo{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const l=Ai(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,o){if(function(D,z){var F=D[0],$=D[1],H=D[2],ee=z[0],K=z[1],N=z[2];return Math.abs(F-ee)<=W*Math.max(1,Math.abs(F),Math.abs(ee))&&Math.abs($-K)<=W*Math.max(1,Math.abs($),Math.abs(K))&&Math.abs(H-N)<=W*Math.max(1,Math.abs(H),Math.abs(N))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[l,d,f]=this.dir,g=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],S=l*l+d*d+f*f,E=2*(g*l+x*d+b*f),I=E*E-4*S*(g*g+x*x+b*b-i*i);if(I<0){const D=Math.max(-E/2,0),z=g+l*D,F=x+d*D,$=b+f*D,H=Math.hypot(z,F,$);return o[0]=z*i/H,o[1]=F*i/H,o[2]=$*i/H,!1}{const D=(-E-Math.sqrt(I))/(2*S);if(D<0){const z=Math.hypot(g,x,b);return o[0]=g*i/z,o[1]=x*i/z,o[2]=b*i/z,!1}return o[0]=g+l*D,o[1]=x+d*D,o[2]=b+f*D,!0}}}class Wl{constructor(e,i,o,l,d){this.TL=e,this.TR=i,this.BR=o,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,i,o){const l=[-1,1,1],d=[1,1,1],f=[1,-1,1],g=[-1,-1,1],x=zi(l,l,e),b=zi(d,d,e),S=zi(f,f,e),E=zi(g,g,e);return new Wl(x,b,S,E,i/o)}}function sl(n,e,i){let o=1/0,l=-1/0;const d=[];for(const f of n){Ui(d,f,e);const g=Ai(d,i);o=Math.min(o,g),l=Math.max(l,g)}return[o,l]}function Ah(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const l=n.planes[o];let d=0;for(let f=0;f<e.length;f++)d+=Ai(l,e[f])+l[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Ih(n,e){for(const i of n.projections){const o=sl(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Ch(n,e){let i=0;const o=[0,0,0,0];for(let f=0;f<n.length;f++)o[0]=n[f][0],o[1]=n[f][1],o[2]=n[f][2],o[3]=1,(l=o)[0]*(d=e)[0]+l[1]*d[1]+l[2]*d[2]+l[3]*d[3]>=0&&i++;var l,d;return i}class Jc{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=In.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ui([],this.points[2],this.points[3]),Ui([],this.points[0],this.points[3]),Ui([],this.points[4],this.points[0]),Ui([],this.points[5],this.points[1]),Ui([],this.points[6],this.points[2]),Ui([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const l=[0,-o[2],o[1]],d=[o[2],0,-o[0]];this.projections.push({axis:l,projection:sl(this.points,this.points[0],l)}),this.projections.push({axis:d,projection:sl(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,o,l){const d=Math.pow(2,o),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=tr([],b,e),E=1/S[3]/i*d;return(I=S)[0]=(D=S)[0]*(z=[E,E,l?1/S[3]:E,E])[0],I[1]=D[1]*z[1],I[2]=D[2]*z[2],I[3]=D[3]*z[3],I;var I,D,z}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=xi([],ji([],Ui([],f[b[0]],f[b[1]]),Ui([],f[b[2]],f[b[1]]))),E=-Ai(S,f[b[1]]);return S.concat(E)}),x=[];for(let b=0;b<f.length;b++)x.push([f[b][0],f[b][1],f[b][2]]);return new Jc(x,g)}intersectsPrecise(e,i,o){for(let l=0;l<i.length;l++)if(!Ch(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Ch(e,this.planes[l]))return 0;for(const l of o)for(const d of this.frustumEdges){const f=ji([],l,d),g=yi(f);if(g===0)continue;ti(f,f,1/g);const x=sl(this.points,this.points[0],f),b=sl(e,this.points[0],f);if(x[0]>b[1]||b[0]>x[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Ai([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class In{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const l of e)Hi(i,i,l),Ci(o,o,l);return new In(i,o)}static fromTileIdAndHeight(e,i,o){const l=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new In([d/l,f/l,i],[(d+1)/l,(f+1)/l,o])}static applyTransform(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)zi(o[l],o[l],i);return In.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],l=[...o];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const g=i[4*f+d],x=g*e.min[f],b=g*e.max[f];o[d]+=Math.min(x,b),l[d]+=Math.max(x,b)}return new In(o,l)}static projectAabbCorners(e,i){const o=e.getCorners();for(let l=0;l<o.length;++l)zi(o[l],o[l],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=ti([],Pi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=an(this.min),l=an(this.max);for(let d=0;d<i.length;d++)o[d]=i[d]?this.min[d]:this.center[d],l[d]=i[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new In(o,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ah(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ah(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ih(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ih(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Zl(n){return n*m/V}Tt(In,"Aabb");const bf=[new In([R,R,R],[P,P,P]),new In([R,R,R],[0,0,P]),new In([0,R,R],[P,0,P]),new In([R,0,R],[0,P,P]),new In([0,0,R],[P,P,P])];function qv(n,e,i,o=!0){const l=ti([],n._camera.position,n.worldSize),d=[e,i,1,1];tr(d,d,n.pixelMatrixInverse),er(d,d,1/d[3]);const f=xi([],Ui([],d,l)),g=n.globeMatrix,x=[g[12],g[13],g[14]],b=Ui([],x,l),S=yi(b),E=xi([],b),I=n.worldSize/(2*Math.PI),D=Ai(E,f),z=Math.asin(I/S);if(z<Math.acos(D)){if(!o)return null;const xe=[],Te=[];ti(xe,f,S/D),xi(Te,Ui(Te,xe,b)),xi(f,Pi(f,b,ti(f,Te,Math.tan(z)*S)))}const F=[];new xo(l,f).closestPointOnSphere(x,I,F);const $=xi([],Er(g,0)),H=xi([],Er(g,1)),ee=xi([],Er(g,2)),K=Ai($,F),N=Ai(H,F),Z=Ai(ee,F),Q=q(Math.asin(-N/I));let re=q(Math.atan2(K,Z));re=n.center.lng+function(xe,Te){const Be=(Te-xe+180)%360-180;return Be<-180?Be+360:Be}(n.center.lng,re);const pe=le(re),_e=ve(ce(Q),0,1);return new Pe(pe,_e)}class YI{constructor(e,i,o){this.a=Ui([],e,o),this.b=Ui([],i,o),this.center=o;const l=xi([],this.a),d=xi([],this.b);this.angle=Math.acos(Ai(l,d))}}function vy(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,l,d,f){const g=Math.sin(d);return o*(Math.sin((1-f)*d)/g)+l*(Math.sin(f*d)/g)}(n.a[e],n.b[e],n.angle,ve(i,0,1))+n.center[e]}function va(n){if(n.z<=1)return bf[n.z+2*n.y+n.x];const e=by($m(n));return In.fromPoints(e)}function ol(n,e,i){return ti(n,n,1-i),tn(n,n,e,i)}function Wv(n,e,i){for(const o of n)zi(o,o,e),ti(o,o,i)}function Zv(n,e,i,o){const l=e/n.worldSize,d=n.globeMatrix;if(i.z<=1){const _e=va(i).getCorners();return Wv(_e,d,l),In.fromPoints(_e)}const f=$m(i,o),g=by(f,m+Zl(n._tileCoverLift));Wv(g,d,l);const x=Number.MAX_VALUE,b=[-x,-x,-x],S=[x,x,x];if(f.contains(n.center)){for(const Te of g)Hi(S,S,Te),Ci(b,b,Te);b[2]=0;const _e=n.point,xe=[_e.x*l,_e.y*l,0];return Hi(S,S,xe),Ci(b,b,xe),new In(S,b)}if(n._tileCoverLift>0){for(const _e of g)Hi(S,S,_e),Ci(b,b,_e);return new In(S,b)}const E=[d[12]*l,d[13]*l,d[14]*l],I=f.getCenter(),D=ve(n.center.lat,-85.051129,Ee),z=ve(I.lat,-85.051129,Ee),F=le(n.center.lng),$=ce(D);let H=F-le(I.lng);const ee=$-ce(z);H>.5?H-=1:H<-.5&&(H+=1);let K=0;Math.abs(H)>Math.abs(ee)?K=H>=0?1:3:(K=ee>=0?0:2,tn(E,E,[d[4]*l,d[5]*l,d[6]*l],-Math.sin(B(ee>=0?f.getSouth():f.getNorth()))*m));const N=g[K],Z=g[(K+1)%4],Q=new YI(N,Z,E),re=[vy(Q,0)||N[0],vy(Q,1)||N[1],vy(Q,2)||N[2]],pe=Xl(n.zoom);if(pe>0){const _e=function({x:Te,y:Be,z:Je},Ze,Ye,rt,Oe){const Ke=1/(1<<Je);let Le=Te*Ke,Fe=Le+Ke,at=Be*Ke,lt=at+Ke,kt=0;const Et=(Le+Fe)/2-rt;return Et>.5?kt=-1:Et<-.5&&(kt=1),Le=((Le+kt)*Ze-(rt*=Ze))*Ye+rt,Fe=((Fe+kt)*Ze-rt)*Ye+rt,at=(at*Ze-(Oe*=Ze))*Ye+Oe,lt=(lt*Ze-Oe)*Ye+Oe,[[Le,lt,0],[Fe,lt,0],[Fe,at,0],[Le,at,0]]}(i,e,n._pixelsPerMercatorPixel,F,$);for(let Te=0;Te<g.length;Te++)ol(g[Te],_e[Te],pe);const xe=Pi([],_e[K],_e[(K+1)%4]);ti(xe,xe,.5),ol(re,xe,pe)}for(const _e of g)Hi(S,S,_e),Ci(b,b,_e);return S[2]=Math.min(N[2],Z[2]),Hi(S,S,re),Ci(b,b,re),new In(S,b)}function $m({x:n,y:e,z:i},o=!1){const l=1/(1<<i),d=new U(me(n*l),e===(1<<i)-1&&o?-90:ge((e+1)*l)),f=new U(me((n+1)*l),e===0&&o?90:ge(e*l));return new J(d,f)}function by(n,e=m){const i=B(n.getNorth()),o=B(n.getSouth()),l=Math.cos(i),d=Math.cos(o),f=Math.sin(i),g=Math.sin(o),x=n.getWest(),b=n.getEast();return[L(d,g,x,e),L(d,g,b,e),L(l,f,b,e),L(l,f,x,e)]}function wf(n,e,i,o){const l=1<<i.z,d=(n/pt+i.x)/l;return j(ge((e/pt+i.y)/l),me(d),o)}function Gm({min:n,max:e}){return T/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Xv=new Float64Array(16);function Hm(n){const e=Gm(n),i=hi(Xv,[e,e,e]);return vt(i,i,Qn([],n.min))}function wy(n){const e=(o=n.min,(i=Xv)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const l=1/Gm(n);return ot(e,e,[l,l,l])}function Ty(n){const e=pt/(2*Math.PI);return n/(2*Math.PI)/e}function Kv(n,e){return pt/(512*Math.pow(2,n))*Gm(va(e))}function Yv(n,e,i,o,l){const d=Ty(i),f=[n,e,-i/(2*Math.PI)],g=Re(new Float64Array(16));return vt(g,g,f),ot(g,g,[d,d,d]),Ct(g,g,B(-l)),Dt(g,g,B(-o)),g}function Xl(n){return be(y,v,n)}function Jv(n,e){const i=j(e.lat,e.lng),o=function(z){const F=j(z._center.lat,z._center.lng);let $=ji([],Jt(0,1,0),F);const H=Kt([],-z.angle,F);$=zi($,$,H),Kt(H,-z._pitch,$);const ee=xi([],F);return ti(ee,ee,Zl(z.cameraToCenterDistance/z.pixelsPerMeter)),zi(ee,ee,H),Pi([],F,ee)}(n);return f=(l=Vi([],o,i))[0],g=l[1],x=l[2],b=(d=i)[0],S=d[1],E=d[2],D=(I=Math.sqrt(f*f+g*g+x*x)*Math.sqrt(b*b+S*S+E*E))&&Ai(l,d)/I,Math.acos(Math.min(Math.max(D,-1),1));var l,d,f,g,x,b,S,E,I,D}function Sy(n,e){return Jv(n,e)>Math.PI/2*1.01}const Qv=B(85),JI=Math.cos(Qv),QI=Math.sin(Qv),eC=He(),eb=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function tb(n,e,i,o,l,d,f,g,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const b=n.tileID.canonical,S=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const I of E){const D=I.add(g),z=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(D.x,D.y,!0):0,F=i.projection.projectTilePoint(D.x,D.y,b);if(z>0){const K=i.projection.upVector(b,D.x,D.y);F.x+=K[0]*S*z,F.y+=K[1]*S*z,F.z+=K[2]*S*z}const $=d?D:tC(F.x,F.y,F.z,o),H=d?n.tilespaceRays.map(K=>nC(K,z)):n.queryGeometry.screenGeometry,ee=tr([],[F.x,F.y,F.z,1],o);if(!f&&d?x*=ee[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/ee[3]),d){const K=ge((I.y/pt+b.y)/(1<<b.z));x/=i.projection.pixelsPerMeter(K,1)/ae(1,K)}if(Xt(H,$,x))return!0}return!1}function tC(n,e,i,o){const l=tr([],[n,e,i,1],o);return new dt(l[0]/l[3],l[1]/l[3])}const ib=Jt(0,0,0),iC=Jt(0,0,1);function nC(n,e){const i=_i();return ib[2]=e,n.intersectsPlane(ib,iC,i),new dt(i[0],i[1])}class nb extends Mt{}let rb,sb,ob,ab;function lb(n,{width:e,height:i},o,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*o)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=l,n}function cb(n,e,i){const{width:o,height:l}=e;o===n.width&&l===n.height||(Ey(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,l)},i,null),n.width=o,n.height=l,n.data=e.data)}function Ey(n,e,i,o,l,d,f,g){if(l.width===0||l.height===0)return e;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||o.x>e.width-l.width||o.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,b=e.data,S=d===4&&g;for(let E=0;E<l.height;E++){const I=((i.y+E)*n.width+i.x)*d,D=((o.y+E)*e.width+o.x)*d;if(S)for(let z=0;z<l.width;z++){const F=I+z*d+3,$=D+z*d;b[$+0]=255,b[$+1]=255,b[$+2]=255,b[$+3]=x[F]}else if(f)for(let z=0;z<l.width;z++){const F=I+z*d,$=D+z*d,H=x[F+3],ee=new $i(x[F+0]/255*H,x[F+1]/255*H,x[F+2]/255*H,H).toRenderColor(f).toArray();b[$+0]=ee[0],b[$+1]=ee[1],b[$+2]=ee[2],b[$+3]=ee[3]}else for(let z=0;z<l.width*d;z++)b[D+z]=x[I+z]}return e}Tt(nb,"HeatmapBucket",{omit:["layers"]});class Kl{constructor(e,i){lb(this,e,1,i)}resize(e){cb(this,new Kl(e),1)}clone(){return new Kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d){Ey(e,i,o,l,d,1,null)}}class Jr{constructor(e,i){lb(this,e,4,i)}resize(e){cb(this,new Jr(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Jr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,l,d,f,g){Ey(e,i,o,l,d,4,f,g)}}class ub{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Tf(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,l=n.image||new Jr({width:i,height:o}),d=(f,g,x)=>{e[n.evaluationKey]=x;const b=n.expression.evaluate(e);b&&(l.data[f+g+0]=Math.floor(255*b.r/b.a),l.data[f+g+1]=Math.floor(255*b.g/b.a),l.data[f+g+2]=Math.floor(255*b.b/b.a),l.data[f+g+3]=Math.floor(255*b.a))};if(n.clips)for(let f=0,g=0;f<o;++f,g+=4*i)for(let x=0,b=0;x<i;x++,b+=4){const S=x/(i-1),{start:E,end:I}=n.clips[f];d(g,b,E*(1-S)+I*S)}else for(let f=0,g=0;f<i;f++,g+=4)d(0,g,f/(i-1));return l}Tt(Kl,"AlphaImage"),Tt(Jr,"RGBAImage");const rC=Ni([{name:"a_pos",components:2,type:"Int16"}],4),sC=Ni([{name:"a_road_z_offset",components:1,type:"Float32"}],4),oC=Ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),aC=Ni([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Sf(n,e,i=2){const o=e&&e.length,l=o?e[0]*i:n.length;let d=hb(n,0,l,i,!0);const f=[];if(!d||d.next===d.prev)return f;let g,x,b;if(o&&(d=function(S,E,I,D){const z=[];for(let F=0,$=E.length;F<$;F++){const H=hb(S,E[F]*D,F<$-1?E[F+1]*D:S.length,D,!1);H===H.next&&(H.steiner=!0),z.push(mC(H))}z.sort(dC);for(let F=0;F<z.length;F++)I=fC(z[F],I);return I}(n,e,d,i)),n.length>80*i){g=1/0,x=1/0;let S=-1/0,E=-1/0;for(let I=i;I<l;I+=i){const D=n[I],z=n[I+1];D<g&&(g=D),z<x&&(x=z),D>S&&(S=D),z>E&&(E=z)}b=Math.max(S-g,E-x),b=b!==0?32767/b:0}return Ef(d,f,i,g,x,b,0),f}function hb(n,e,i,o,l){let d;if(l===function(f,g,x,b){let S=0;for(let E=g,I=x-b;E<x;E+=b)S+=(f[I]-f[E])*(f[E+1]+f[I+1]),I=E;return S}(n,e,i,o)>0)for(let f=e;f<i;f+=o)d=mb(f/o|0,n[f],n[f+1],d);else for(let f=i-o;f>=e;f-=o)d=mb(f/o|0,n[f],n[f+1],d);return d&&Mh(d,d.next)&&(Cf(d),d=d.next),d}function Qc(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Mh(o,o.next)&&Cr(o.prev,o,o.next)!==0)o=o.next;else{if(Cf(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Ef(n,e,i,o,l,d,f){if(!n)return;!f&&d&&function(x,b,S,E){let I=x;do I.z===0&&(I.z=Ay(I.x,I.y,b,S,E)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==x);I.prevZ.nextZ=null,I.prevZ=null,function(D){let z,F=1;do{let $,H=D;D=null;let ee=null;for(z=0;H;){z++;let K=H,N=0;for(let Q=0;Q<F&&(N++,K=K.nextZ,K);Q++);let Z=F;for(;N>0||Z>0&&K;)N!==0&&(Z===0||!K||H.z<=K.z)?($=H,H=H.nextZ,N--):($=K,K=K.nextZ,Z--),ee?ee.nextZ=$:D=$,$.prevZ=ee,ee=$;H=K}ee.nextZ=null,F*=2}while(z>1)}(I)}(n,o,l,d);let g=n;for(;n.prev!==n.next;){const x=n.prev,b=n.next;if(d?cC(n,o,l,d):lC(n))e.push(x.i,n.i,b.i),Cf(n),n=b.next,g=b.next;else if((n=b)===g){f?f===1?Ef(n=uC(Qc(n),e),e,i,o,l,d,2):f===2&&hC(n,e,i,o,l,d):Ef(Qc(n),e,i,o,l,d,1);break}}}function lC(n){const e=n.prev,i=n,o=n.next;if(Cr(e,i,o)>=0)return!1;const l=e.x,d=i.x,f=o.x,g=e.y,x=i.y,b=o.y,S=Math.min(l,d,f),E=Math.min(g,x,b),I=Math.max(l,d,f),D=Math.max(g,x,b);let z=o.next;for(;z!==e;){if(z.x>=S&&z.x<=I&&z.y>=E&&z.y<=D&&Af(l,g,d,x,f,b,z.x,z.y)&&Cr(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function cC(n,e,i,o){const l=n.prev,d=n,f=n.next;if(Cr(l,d,f)>=0)return!1;const g=l.x,x=d.x,b=f.x,S=l.y,E=d.y,I=f.y,D=Math.min(g,x,b),z=Math.min(S,E,I),F=Math.max(g,x,b),$=Math.max(S,E,I),H=Ay(D,z,e,i,o),ee=Ay(F,$,e,i,o);let K=n.prevZ,N=n.nextZ;for(;K&&K.z>=H&&N&&N.z<=ee;){if(K.x>=D&&K.x<=F&&K.y>=z&&K.y<=$&&K!==l&&K!==f&&Af(g,S,x,E,b,I,K.x,K.y)&&Cr(K.prev,K,K.next)>=0||(K=K.prevZ,N.x>=D&&N.x<=F&&N.y>=z&&N.y<=$&&N!==l&&N!==f&&Af(g,S,x,E,b,I,N.x,N.y)&&Cr(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;K&&K.z>=H;){if(K.x>=D&&K.x<=F&&K.y>=z&&K.y<=$&&K!==l&&K!==f&&Af(g,S,x,E,b,I,K.x,K.y)&&Cr(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;N&&N.z<=ee;){if(N.x>=D&&N.x<=F&&N.y>=z&&N.y<=$&&N!==l&&N!==f&&Af(g,S,x,E,b,I,N.x,N.y)&&Cr(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function uC(n,e){let i=n;do{const o=i.prev,l=i.next.next;!Mh(o,l)&&fb(o,i,i.next,l)&&If(o,l)&&If(l,o)&&(e.push(o.i,i.i,l.i),Cf(i),Cf(i.next),i=n=l),i=i.next}while(i!==n);return Qc(i)}function hC(n,e,i,o,l,d){let f=n;do{let g=f.next.next;for(;g!==f.prev;){if(f.i!==g.i&&gC(f,g)){let x=pb(f,g);return f=Qc(f,f.next),x=Qc(x,x.next),Ef(f,e,i,o,l,d,0),void Ef(x,e,i,o,l,d,0)}g=g.next}f=f.next}while(f!==n)}function dC(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function fC(n,e){const i=function(l,d){let f=d;const g=l.x,x=l.y;let b,S=-1/0;if(Mh(l,f))return f;do{if(Mh(l,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const F=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(F<=g&&F>S&&(S=F,b=f.x<f.next.x?f:f.next,F===g))return b}f=f.next}while(f!==d);if(!b)return null;const E=b,I=b.x,D=b.y;let z=1/0;f=b;do{if(g>=f.x&&f.x>=I&&g!==f.x&&db(x<D?g:S,x,I,D,x<D?S:g,x,f.x,f.y)){const F=Math.abs(x-f.y)/(g-f.x);If(f,l)&&(F<z||F===z&&(f.x>b.x||f.x===b.x&&pC(b,f)))&&(b=f,z=F)}f=f.next}while(f!==E);return b}(n,e);if(!i)return e;const o=pb(i,n);return Qc(o,o.next),Qc(i,i.next)}function pC(n,e){return Cr(n.prev,n,e.prev)<0&&Cr(e.next,n,n.next)<0}function Ay(n,e,i,o,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function mC(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function db(n,e,i,o,l,d,f,g){return(l-f)*(e-g)>=(n-f)*(d-g)&&(n-f)*(o-g)>=(i-f)*(e-g)&&(i-f)*(d-g)>=(l-f)*(o-g)}function Af(n,e,i,o,l,d,f,g){return!(n===f&&e===g)&&db(n,e,i,o,l,d,f,g)}function gC(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==o.i&&l.next.i!==o.i&&fb(l,l.next,i,o))return!0;l=l.next}while(l!==i);return!1}(n,e)&&(If(n,e)&&If(e,n)&&function(i,o){let l=i,d=!1;const f=(i.x+o.x)/2,g=(i.y+o.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&f<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d}(n,e)&&(Cr(n.prev,n,e.prev)||Cr(n,e.prev,e))||Mh(n,e)&&Cr(n.prev,n,n.next)>0&&Cr(e.prev,e,e.next)>0)}function Cr(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Mh(n,e){return n.x===e.x&&n.y===e.y}function fb(n,e,i,o){const l=Wm(Cr(n,e,i)),d=Wm(Cr(n,e,o)),f=Wm(Cr(i,o,n)),g=Wm(Cr(i,o,e));return l!==d&&f!==g||!(l!==0||!qm(n,i,e))||!(d!==0||!qm(n,o,e))||!(f!==0||!qm(i,n,o))||!(g!==0||!qm(i,e,o))}function qm(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Wm(n){return n>0?1:n<0?-1:0}function If(n,e){return Cr(n.prev,n,n.next)<0?Cr(n,e,n.next)>=0&&Cr(n,n.prev,e)>=0:Cr(n,e,n.prev)<0||Cr(n,n.next,e)<0}function pb(n,e){const i=Iy(n.i,n.x,n.y),o=Iy(e.i,e.x,e.y),l=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=l,l.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function mb(n,e,i,o){const l=Iy(n,e,i);return o?(l.next=o.next,l.prev=o,o.next.prev=l,o.next=l):(l.prev=l,l.next=l),l}function Cf(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Iy(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zm(n,e){const i=n.length;if(i<=1)return[n];const o=[];let l,d;for(let f=0;f<i;f++){const g=Bi(n[f]);g!==0&&(n[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(l&&o.push(l),l=[n[f]]):l.push(n[f]))}if(l&&o.push(l),e>1)for(let f=0;f<o.length;f++)o[f].length<=e||(aa(o[f],e,1,o[f].length-1,_C),o[f]=o[f].slice(0,e));return o}function _C(n,e){return e.area-n.area}function gb(n,e,i=1){if(!n)return null;const o=typeof n=="string"?Ss.from(n).getPrimary():n.getPrimary(),l=typeof n=="string"?null:n.getSecondary();for(const d of[o,l]){if(!d)continue;const f=d.id.toString();e.has(f)||e.set(f,[]),d.scaleSelf(i),e.get(f).push(d)}return{primary:o.toString(),secondary:l?l.toString():null}}function Cy(n,e,i,o){const l=o.patternDependencies;let d=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(d=!0),gb(g.constantOr(null),l,i)&&(d=!0)}return d}function My(n,e,i,o,l,d){const f=d.patternDependencies;for(const g of e){const x=g.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let b=x.evaluate({zoom:o},i,{},d.availableImages);b=b&&b.name?b.name:b;const S=gb(b,f,l);if(!S)continue;const{primary:E,secondary:I}=S;E&&(i.patterns[g.id]=[E,I].filter(Boolean))}}return i}var Py,_b,Ry,yb,Dy,xb,vb,Xm={};function bb(){if(_b)return Py;_b=1;var n=Da();function e(l,d,f,g,x){this.properties={},this.extent=f,this.type=0,this._pbf=l,this._geometry=-1,this._keys=g,this._values=x,l.readFields(i,this,d)}function i(l,d,f){l==1?d.id=f.readVarint():l==2?function(g,x){for(var b=g.readVarint()+g.pos;g.pos<b;){var S=x._keys[g.readVarint()],E=x._values[g.readVarint()];x.properties[S]=E}}(f,d):l==3?d.type=f.readVarint():l==4&&(d._geometry=f.pos)}function o(l){for(var d,f,g=0,x=0,b=l.length,S=b-1;x<b;S=x++)g+=((f=l[S]).x-(d=l[x]).x)*(d.y+f.y);return g}return Py=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var d,f=l.readVarint()+l.pos,g=1,x=0,b=0,S=0,E=[];l.pos<f;){if(x<=0){var I=l.readVarint();g=7&I,x=I>>3}if(x--,g===1||g===2)b+=l.readSVarint(),S+=l.readSVarint(),g===1&&(d&&E.push(d),d=[]),d.push(new n(b,S));else{if(g!==7)throw new Error("unknown command "+g);d&&d.push(d[0].clone())}}return d&&E.push(d),E},e.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var d=l.readVarint()+l.pos,f=1,g=0,x=0,b=0,S=1/0,E=-1/0,I=1/0,D=-1/0;l.pos<d;){if(g<=0){var z=l.readVarint();f=7&z,g=z>>3}if(g--,f===1||f===2)(x+=l.readSVarint())<S&&(S=x),x>E&&(E=x),(b+=l.readSVarint())<I&&(I=b),b>D&&(D=b);else if(f!==7)throw new Error("unknown command "+f)}return[S,I,E,D]},e.prototype.toGeoJSON=function(l,d,f){var g,x,b=this.extent*Math.pow(2,f),S=this.extent*l,E=this.extent*d,I=this.loadGeometry(),D=e.types[this.type];function z(H){for(var ee=0;ee<H.length;ee++){var K=H[ee];H[ee]=[360*(K.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(K.y+E)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(g=0;g<I.length;g++)F[g]=I[g][0];z(I=F);break;case 2:for(g=0;g<I.length;g++)z(I[g]);break;case 3:for(I=function(H){var ee=H.length;if(ee<=1)return[H];for(var K,N,Z=[],Q=0;Q<ee;Q++){var re=o(H[Q]);re!==0&&(N===void 0&&(N=re<0),N===re<0?(K&&Z.push(K),K=[H[Q]]):K.push(H[Q]))}return K&&Z.push(K),Z}(I),g=0;g<I.length;g++)for(x=0;x<I[g].length;x++)z(I[g][x])}I.length===1?I=I[0]:D="Multi"+D;var $={type:"Feature",geometry:{type:D,coordinates:I},properties:this.properties};return"id"in this&&($.id=this.id),$},Py}function wb(){if(yb)return Ry;yb=1;var n=bb();function e(o,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,l),this.length=this._features.length}function i(o,l,d){o===15?l.version=d.readVarint():o===1?l.name=d.readString():o===5?l.extent=d.readVarint():o===2?l._features.push(d.pos):o===3?l._keys.push(d.readString()):o===4&&l._values.push(function(f){for(var g=null,x=f.readVarint()+f.pos;f.pos<x;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(d))}return Ry=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var l=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,l,this.extent,this._keys,this._values)},Ry}function Tb(){return vb||(vb=1,Xm.VectorTile=function(){if(xb)return Dy;xb=1;var n=wb();function e(i,o,l){if(i===3){var d=new n(l,l.readVarint()+l.pos);d.length&&(o[d.name]=d)}}return Dy=function(i,o){this.layers=i.readFields(e,{},o)},Dy}(),Xm.VectorTileFeature=bb(),Xm.VectorTileLayer=wb()),Xm}var Yl=Tb();const eu="3d_elevation_id",Sb="level";class yC{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,l){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?o(l?l(d):d):i&&(this._valid=!1),this}}class Eb{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const xC=new Eb((n,e,i)=>n.reset(e).require(eu,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},tu.decodeRelativeHeight).geometry(o=>{i.bounds=o},Sd).success(),(n,e,i)=>n.reset(e).require(eu,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},tu.decodeRelativeHeight).geometry(o=>{i.position=o},tu.getPoint).success()),vC=new Eb((n,e,i)=>n.reset(e).require(eu,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},tu.decodeMetricHeight).geometry(o=>{i.bounds=o},Sd).success(),(n,e,i)=>n.reset(e).require(eu,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},tu.decodeMetricHeight).geometry(o=>{i.position=o},tu.getPoint).success());class tu{static getPoint(e){return rs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],o=[],l=e.length,d=new yC;for(let g=0;g<l;g++){const x=e.feature(g),b=x.properties.hasOwnProperty("version")?String(x.properties.version):void 0,S=(f=b)?f==="1.0.1"?vC:void 0:xC;if(S===void 0){vi(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const E=x.properties.hasOwnProperty("type")?x.properties.type:void 0;if(E){if(Yl.VectorTileFeature.types[x.type]==="Point"&&E==="curve_point"){const I={};S.parseVertex(d,x,I)&&i.push(I)}else if(Yl.VectorTileFeature.types[x.type]==="Polygon"&&E==="curve_meta"){const I={};S.parseFeature(d,x,I)&&o.push(I)}}}var f;return{vertices:i,features:o}}}class Ab{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],l=-i[0],d=(e.extent+1)*this.metersToTile;return[new dt(Math.trunc(e.position[0]+o*d),Math.trunc(e.position[1]+l*d)),new dt(Math.trunc(e.position[0]-o*d),Math.trunc(e.position[1]-l*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class zy{constructor(e,i,o,l,d,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||l.length!==0)){this.vertices=l,this.edges=d,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((x=this.vertices[g.a].position)[0]===(b=this.vertices[g.b].position)[0]&&x[1]===b[1]);var x,b}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:rs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const x=this.vertices[g.a].position,b=this.vertices[g.b].position,S=us(Qi(),b,x),E=Mn(S),I=fi(Qi(),S,1/E);this.edgeProps.push({vec:S,dir:I,len:E});const D=this.vertexProps[g.a].dir,z=this.vertexProps[g.b].dir;cs(D,D,I),cs(z,z,I)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||cr(g.dir,g.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,l]=i;return((d,f,g)=>(1-g)*d+g*f)(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,l)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,l=0;const d=rs(e.x,e.y);for(let f=0;f<this.edges.length;f++){const g=this.edges[f],x=this.edgeProps[f].dir,b=new Po(d,this.edgeProps[f].dir),S=this.vertices[g.a].position,E=this.vertices[g.b].position,I=Qi(),D=Qi(),z=b.intersectsPlane(S,this.vertexProps[g.a].dir,I),F=b.intersectsPlane(E,this.vertexProps[g.b].dir,D);if(!z||!F)continue;const $=us(Qi(),D,I),H=us(Qi(),d,I),ee=Xi($,$),K=ee>0?Xi(H,$)/ee:0,N=ve(K,0,1),Z=Math.abs((K-N)*this.edgeProps[f].len),Q=us(Qi(),d,S),re=Z+Math.abs(Xi(Q,rs(x[1],-x[0])));re<o&&(i=f,o=re,l=N)}return[i,l]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const o=this.edges[i].a,l=this.edges[i].b,{position:d,height:f,extent:g}=this.vertices[o],{position:x,height:b,extent:S}=this.vertices[l],E=this.vertexProps[o].dir,I=this.vertexProps[l].dir,D=Jt(d[0]/e,d[1]/e,f),z=Jt(x[0]/e,x[1]/e,b),F=Jt(E[1],-E[0],0);ti(F,F,g);const $=Jt(I[1],-I[0],0);if(ti($,$,S),this.distSqLines(Jt(D[0]+.5*F[0],D[1]+.5*F[1],D[2]+.5*F[2]),Jt(z[0]-.5*$[0],z[1]-.5*$[1],z[2]-.5*$[2]),Jt(D[0]-.5*F[0],D[1]-.5*F[1],D[2]-.5*F[2]),Jt(z[0]+.5*$[0],z[1]+.5*$[1],z[2]+.5*$[2]))<=.0025000000000000005)continue;const H=this.vertices.length,ee=cs(Qi(),d,x);this.vertices.push({position:fi(ee,ee,.5),height:.5*(f+b),extent:.5*(g+S)});const K=cs(Qi(),E,I);this.vertexProps.push({dir:cr(K,K)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:o,b:H}),this.edges.push({a:H,b:l});const N=us(Qi(),this.vertices[H].position,d),Z=Mn(N),Q={vec:N,dir:fi(Qi(),N,1/Z),len:Z};this.edgeProps.push(Q),this.edgeProps.push(Q)}}distSqLines(e,i,o,l){const d=Vi(_i(),i,e),f=Vi(_i(),l,o),g=Vi(_i(),e,o),x=Ai(d,d),b=Ai(d,f),S=Ai(d,g),E=Ai(f,f),I=Ai(f,g),D=x*E-b*b;if(D===0){const $=Ai(g,f)/Ai(f,f);return rr(Br(_i(),o,l,$),e)}const z=(b*I-S*E)/D,F=(x*I-b*S)/D;return rr(Br(_i(),e,i,z),Br(_i(),o,l,F))}}class Ly{static parseFrom(e,i){const o=tu.parse(e);if(!o)return[];let{vertices:l,features:d}=o;const f=1/Se(i);d.sort((S,E)=>S.id-E.id),l.sort((S,E)=>S.id-E.id||S.idx-E.idx),l=l.filter((S,E,I)=>E===I.findIndex(D=>D.id===S.id&&D.idx===S.idx));const g=new Array;let x=0;const b=l.length;for(const S of d){if(S.constantHeight){g.push(new zy(S.id,S.bounds,S.constantHeight));continue}for(;x!==b&&l[x].id<S.id;)x++;if(x===b||l[x].id!==S.id)continue;const E=new Array,I=new Array,D=x;for(;x!==b&&l[x].id===S.id;){const z=l[x];if(E.push({position:z.position,height:z.height,extent:z.extent}),x!==D&&l[x-1].idx===z.idx-1){const F=x-D;I.push({a:F-1,b:F})}x++}g.push(new zy(S.id,S.bounds,void 0,E,I,f))}return g}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[eu];return Number.isNaN(o)?void 0:i.find(l=>l.id===o)}}class Ib{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*pt,this.yOffset=(e.y*this.zScale-i.y)*pt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const l=this.constantElevation(i,o);return l??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*be(0,i,e>=0?e:Math.abs(.5*e))}}Tt(zy,"ElevationFeature");class Cb{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class iu{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new iu;let i=[];for(const b of e)i.push(...b.portals);if(i.length===0)return new iu;const o=(b,S)=>b<=0&&S<=0||b>=pt&&S>=pt;for(const b of i){const S=b.va,E=b.vb;(o(S.x,E.x)||o(S.y,E.y))&&(b.type="border")}const l=i.filter(b=>b.type!=="unevaluated"),d=i.filter(b=>b.type==="unevaluated");if(d.length===0)return new iu;d.sort((b,S)=>b.hash===S.hash?b.isTunnel===S.isTunnel?0:b.isTunnel?-1:1:b.hash<S.hash?1:-1),i=l.concat(d);let f=l.length,g=f,x=f;do if(g++,g===i.length||i[f].hash!==i[g].hash){if(g-f==2){x<f&&(i[x]=i[f],i[f]=null);const b=i[x],S=i[g-1];b.type=b.isTunnel!==S.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:S.connection.a},x++}f=g}while(f!==i.length);return i.splice(x),i.sort((b,S)=>b.hash<S.hash?1:-1),{portals:i}}}Tt(iu,"ElevationPortalGraph"),Tt(Cb,"ElevationPolygons");class bC{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,o){let l=e[2];o!=null&&(l*=o);const d=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),f=this.vertexLookup.get(d);if(f!=null)return f;const g=this.outPositions.length;this.vertexLookup.set(d,g);const x=Math.trunc(16384*i[0]),b=Math.trunc(16384*i[1]),S=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],l),this.outNormals.emplaceBack(x,b,S),g}addVertices(e,i,...o){const l=[];for(const d of o){const f=this.addVertex(d,e,i);l.push(f)}return l}addTriangles(e,i,o){if(i&&o){const l=o.length===1,d=Jt(0,0,0);for(let f=0;f<e.length;f+=3){const g=i[e[f+0]],x=i[e[f+1]],b=i[e[f+2]],S=l?o[0]:o[e[f+1]],E=l?o[0]:o[e[f+2]],I=this.addVertex(Jt(g.x,g.y,l?o[0]:o[e[f+0]]),d),D=this.addVertex(Jt(x.x,x.y,S),d),z=this.addVertex(Jt(b.x,b.y,E),d);this.outIndices.emplaceBack(I,D,z)}}else for(let l=0;l<e.length;l+=3)this.outIndices.emplaceBack(e[l+0],e[l+1],e[l+2])}addQuad(e,i){const o=this.addVertices(i,void 0,...e.map(x=>Jt(x.coord.x,x.coord.y,x.height))),[l,d,f,g]=o;this.addTriangles([l,d,f,f,g,l])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class io{constructor(e){this.unevaluatedPortals=new iu,this.portalPolygons=new Cb,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new _h,this.vertexNormals=new jl,this.indexArray=new Ar,this.tileToMeters=Se(e)}addVertices(e,i){const o=this.unevalVertices.length;for(let l=0;l<e.length;l++)this.unevalVertices.push(e[l]),this.unevalHeights.push(i[l]);return o}addTriangles(e,i,o){const l=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)l.push(d+i)}addRenderableRing(e,i,o,l,d){const f=[new dt(d.min.x,d.min.y),new dt(d.max.x,d.min.y),new dt(d.max.x,d.max.y),new dt(d.min.x,d.max.y)];for(let g=0;g<o-1;g++){const x=i+g,b=x+1,S=this.unevalVertices[x],E=this.unevalVertices[b];if(!(S.x>=d.min.x&&S.x<=d.max.x&&S.y>=d.min.y&&S.y<=d.max.y||E.x>=d.min.x&&E.x<=d.max.x&&E.y>=d.min.y&&E.y<=d.max.y||Gn(S,E,f))||this.isOnBorder(S.x,E.x)||this.isOnBorder(S.y,E.y))continue;const I=io.computeEdgeHash(this.unevalVertices[x],this.unevalVertices[b]);let D,z=this.vertexHashLookup.get(io.computePosHash(S));z!=null?D=z.next:(z=this.vertexHashLookup.get(io.computePosHash(E)),D=z!=null?z.prev:I),this.unevalEdges.push({polygonIdx:e,a:x,b,hash:I,portalHash:D,isTunnel:l,type:"unevaluated"})}}addPortalCandidates(e,i,o,l,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const f=i[0];this.vertexHashLookup.clear();let g=io.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let x=0;x<f.length-1;x++){const b=f[x+0],S=f[x+1],E=rs(S.x-b.x,S.y-b.y),I=Mn(E);if(I===0)continue;let D="unevaluated";const z=l.pointElevation(b),F=l.pointElevation(S);Math.abs(z)<.01&&Math.abs(F)<.01?D="entrance":(this.isOnBorder(b.x,S.x)||this.isOnBorder(b.y,S.y))&&(D="border");const $=io.computeEdgeHash(b,S);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:b,vb:S,vab:E,length:I,hash:$,isTunnel:o,type:D});const H=io.computePosHash(b);this.vertexHashLookup.set(H,{prev:g,next:$}),g=$}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=E=>{E.primitiveLength=this.indexArray.length-E.primitiveOffset},l=new bC(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),f=i(),g=i(),x=(E,I)=>{E.sort((z,F)=>z.type===I&&F.type!==I?-1:z.type!==I&&F.type===I?1:0);const D=E.findIndex(z=>z.type!==I);return D>=0?D:E.length};let b=0;this.unevalEdges.length>0&&(b=x(this.unevalEdges,"none"),this.constructBridgeStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:b},this.tileToMeters));const S=i();if(this.unevalEdges.length>0){const E=this.unevalEdges.splice(b),I=x(E,"tunnel")+b;this.unevalEdges.push(...E),this.constructTunnelStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:b},{min:b,max:I})}o(g),l.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(S),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(f),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(d),this.maskSegments=kn.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.depthSegments=kn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=kn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.shadowCasterSegments=kn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,oC.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,aC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,i,o,l,d){const f=new Map;for(let g=l;g<d;g++){const x=o[g],b=x.a,S=x.b,E=io.computePosHash(e[b]),I=io.computePosHash(e[S]);f.has(E)||f.set(E,{}),f.has(I)||f.set(I,{});const D=f.get(E),z=f.get(I);i[b]<=0&&i[S]<=0||(D.to=S,z.from=b)}return f}constructBridgeStructures(e,i,o,l,d,f){const g=this.computeVertexConnections(i,o,l,d.min,d.max),x=1/f,b=.5*x,S=I=>Jt(i[I].x,i[I].y,o[I]*x),E=I=>{const D=g.get(io.computePosHash(i[I])),z=D.from,F=D.to;if(!z||!F)return;const $=S(z),H=S(I),ee=S(F),K=Jt(0,0,0);if(!Zn($,H)){const Z=Ui(_i(),H,$);Pi(K,K,xi(Z,Z))}if(!Zn(ee,H)){const Z=Ui(_i(),ee,H);Pi(K,K,xi(Z,Z))}const N=lr(K);return N>0?ti(K,K,1/N):void 0};for(let I=d.min;I<d.max;I++){const D=l[I],z=this.prepareEdgePoints(i,o,D,(st,Zt)=>st>Zt);if(z==null)continue;const F=z[0],$=z[1],H=Jt(F.coord.x,F.coord.y,x*F.height),ee=Jt($.coord.x,$.coord.y,x*$.height);if(Zn(H,ee))continue;const K=Ui(_i(),ee,H);xi(K,K);const N=st=>xi(st,st),Z=E(D.a)||K,Q=E(D.b)||K,re=N(Jt(Z[1],-Z[0],0)),pe=N(Jt(Q[1],-Q[0],0)),_e=N(ji(_i(),re,Z)),xe=N(ji(_i(),pe,Q)),Te=_i(),Be=[Pi(_i(),H,ti(Te,Ui(Te,re,_e),b)),Pi(_i(),H,ti(Te,Pi(Te,re,_e),b)),Pi(_i(),H,ti(Te,_e,b)),H],Je=[Pi(_i(),ee,ti(Te,Ui(Te,pe,xe),b)),Pi(_i(),ee,ti(Te,Pi(Te,pe,xe),b)),Pi(_i(),ee,ti(Te,xe,b)),ee],[Ze,Ye]=e.addVertices(re,f,Be[0],Be[1]),[rt,Oe]=e.addVertices(pe,f,Je[0],Je[1]);e.addTriangles([Ze,Ye,rt,Ye,Oe,rt]);const[Ke,Le]=e.addVertices(_e,f,Be[1],Be[2]),[Fe,at]=e.addVertices(xe,f,Je[1],Je[2]);e.addTriangles([Ke,Le,Fe,Le,at,Fe]);const[lt,kt]=e.addVertices(Qn(re,re),f,Be[2],Be[3]),[Et,gt]=e.addVertices(Qn(pe,pe),f,Je[2],Je[3]);e.addTriangles([lt,kt,Et,kt,gt,Et])}}constructTunnelStructures(e,i,o,l,d,f){const g=x=>xi(x,x);for(let x=d.min;x<d.max;x++){const b=this.prepareEdgePoints(i,o,l[x],(D,z)=>D<z);if(b==null)continue;const[S,E]=b,I=g(Jt(E.coord.y-S.coord.y,-(E.coord.x-S.coord.x),0));e.addQuad([S,E,{coord:E.coord,height:l[x].isTunnel?-.1:0},{coord:S.coord,height:l[x].isTunnel?-.1:0}],I)}for(let x=f.min;x<f.max;x++){const b=l[x],S=i[b.a],E=i[b.b],I=g(Jt(E.y-S.y,-(E.x-S.x),0));e.addQuad([{coord:E,height:0},{coord:S,height:0},{coord:S,height:o[b.a]+4},{coord:E,height:o[b.b]+4}],I),e.addQuad([{coord:S,height:0},{coord:E,height:0},{coord:E,height:o[b.b]+4},{coord:S,height:o[b.a]+4}],I)}}prepareEdgePoints(e,i,o,l){let d=i[o.a],f=i[o.b];const g=l(d,0),x=l(f,0);if(g&&x)return[{coord:e[o.a],height:d},{coord:e[o.b],height:f}];if(!g&&!x)return;const b=e[o.a].clone(),S=e[o.b].clone();if(g){if(!x){const E=f/(f-d);S.x=Nt(S.x,b.x,E),S.y=Nt(S.y,b.y,E),f=Nt(f,d,E)}}else{const E=d/(d-f);b.x=Nt(b.x,S.x,E),b.y=Nt(b.y,S.y,E),d=Nt(d,f,E)}return[{coord:b,height:d},{coord:S,height:f}]}prepareEdges(e,i){if(i.length===0)return;i.sort((g,x)=>g.hash===x.hash?x.polygonIdx-g.polygonIdx:x.hash>g.hash?1:-1);let o=0,l=0,d=0,f=i[o].polygonIdx;do l++,(l===i.length||i[o].hash!==i[l].hash)&&((l-o==1||i[l-1].polygonIdx!==f)&&(d<o&&(i[d]=i[o],i[o]=null),i[d].type="none",d++),o=l,o!==i.length&&(f=i[o].polygonIdx));while(o!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((b,S)=>b.portalHash<S.portalHash?1:-1);let g=0,x=0;for(;g!==i.length&&x!==e.length;){const b=i[g],S=e[x];b.portalHash>S.hash?g++:S.hash>b.portalHash?x++:(b.type=S.type,g++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=pt&&i>=pt}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(io.computePosHash(e))<<32n|BigInt(io.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Mb,Pb={exports:{}},Rb=(Mb||(Mb=1,function(n,e){(function(i){function o(te,se){return te>se?1:te<se?-1:0}var l=function(te,se){te===void 0&&(te=o),se===void 0&&(se=!1),this._compare=te,this._root=null,this._size=0,this._noDuplicates=!!se},d={size:{configurable:!0}};function f(te,se,Ve,ht,xt){var _t=xt-ht;if(_t>0){var zt=ht+Math.floor(_t/2),Gt={key:se[zt],data:Ve[zt],parent:te};return Gt.left=f(Gt,se,Ve,ht,zt),Gt.right=f(Gt,se,Ve,zt+1,xt),Gt}return null}function g(te,se,Ve,ht,xt){if(!(Ve>=ht)){for(var _t=te[Ve+ht>>1],zt=Ve-1,Gt=ht+1;;){do zt++;while(xt(te[zt],_t)<0);do Gt--;while(xt(te[Gt],_t)>0);if(zt>=Gt)break;var wi=te[zt];te[zt]=te[Gt],te[Gt]=wi,wi=se[zt],se[zt]=se[Gt],se[Gt]=wi}g(te,se,Ve,Gt,xt),g(te,se,Gt+1,ht,xt)}}l.prototype.rotateLeft=function(te){var se=te.right;se&&(te.right=se.left,se.left&&(se.left.parent=te),se.parent=te.parent),te.parent?te===te.parent.left?te.parent.left=se:te.parent.right=se:this._root=se,se&&(se.left=te),te.parent=se},l.prototype.rotateRight=function(te){var se=te.left;se&&(te.left=se.right,se.right&&(se.right.parent=te),se.parent=te.parent),te.parent?te===te.parent.left?te.parent.left=se:te.parent.right=se:this._root=se,se&&(se.right=te),te.parent=se},l.prototype._splay=function(te){for(;te.parent;){var se=te.parent;se.parent?se.left===te&&se.parent.left===se?(this.rotateRight(se.parent),this.rotateRight(se)):se.right===te&&se.parent.right===se?(this.rotateLeft(se.parent),this.rotateLeft(se)):se.left===te&&se.parent.right===se?(this.rotateRight(se),this.rotateLeft(se)):(this.rotateLeft(se),this.rotateRight(se)):se.left===te?this.rotateRight(se):this.rotateLeft(se)}},l.prototype.splay=function(te){for(var se,Ve,ht,xt,_t;te.parent;)(Ve=(se=te.parent).parent)&&Ve.parent?((ht=Ve.parent).left===Ve?ht.left=te:ht.right=te,te.parent=ht):(te.parent=null,this._root=te),xt=te.left,_t=te.right,te===se.left?(Ve&&(Ve.left===se?(se.right?(Ve.left=se.right,Ve.left.parent=Ve):Ve.left=null,se.right=Ve,Ve.parent=se):(xt?(Ve.right=xt,xt.parent=Ve):Ve.right=null,te.left=Ve,Ve.parent=te)),_t?(se.left=_t,_t.parent=se):se.left=null,te.right=se,se.parent=te):(Ve&&(Ve.right===se?(se.left?(Ve.right=se.left,Ve.right.parent=Ve):Ve.right=null,se.left=Ve,Ve.parent=se):(_t?(Ve.left=_t,_t.parent=Ve):Ve.left=null,te.right=Ve,Ve.parent=te)),xt?(se.right=xt,xt.parent=se):se.right=null,te.left=se,se.parent=te)},l.prototype.replace=function(te,se){te.parent?te===te.parent.left?te.parent.left=se:te.parent.right=se:this._root=se,se&&(se.parent=te.parent)},l.prototype.minNode=function(te){if(te===void 0&&(te=this._root),te)for(;te.left;)te=te.left;return te},l.prototype.maxNode=function(te){if(te===void 0&&(te=this._root),te)for(;te.right;)te=te.right;return te},l.prototype.insert=function(te,se){var Ve=this._root,ht=null,xt=this._compare;if(this._noDuplicates)for(;Ve;){if(ht=Ve,xt(Ve.key,te)===0)return;Ve=xt(Ve.key,te)<0?Ve.right:Ve.left}else for(;Ve;)ht=Ve,Ve=xt(Ve.key,te)<0?Ve.right:Ve.left;return Ve={key:te,data:se,left:null,right:null,parent:ht},ht?xt(ht.key,Ve.key)<0?ht.right=Ve:ht.left=Ve:this._root=Ve,this.splay(Ve),this._size++,Ve},l.prototype.find=function(te){for(var se=this._root,Ve=this._compare;se;){var ht=Ve(se.key,te);if(ht<0)se=se.right;else{if(!(ht>0))return se;se=se.left}}return null},l.prototype.contains=function(te){for(var se=this._root,Ve=this._compare;se;){var ht=Ve(te,se.key);if(ht===0)return!0;se=ht<0?se.left:se.right}return!1},l.prototype.remove=function(te){var se=this.find(te);if(!se)return!1;if(this.splay(se),se.left)if(se.right){var Ve=this.minNode(se.right);Ve.parent!==se&&(this.replace(Ve,Ve.right),Ve.right=se.right,Ve.right.parent=Ve),this.replace(se,Ve),Ve.left=se.left,Ve.left.parent=Ve}else this.replace(se,se.left);else this.replace(se,se.right);return this._size--,!0},l.prototype.removeNode=function(te){if(!te)return!1;if(this.splay(te),te.left)if(te.right){var se=this.minNode(te.right);se.parent!==te&&(this.replace(se,se.right),se.right=te.right,se.right.parent=se),this.replace(te,se),se.left=te.left,se.left.parent=se}else this.replace(te,te.left);else this.replace(te,te.right);return this._size--,!0},l.prototype.erase=function(te){var se=this.find(te);if(se){this.splay(se);var Ve=se.left,ht=se.right,xt=null;Ve&&(Ve.parent=null,xt=this.maxNode(Ve),this.splay(xt),this._root=xt),ht&&(Ve?xt.right=ht:this._root=ht,ht.parent=xt),this._size--}},l.prototype.pop=function(){var te=this._root,se=null;if(te){for(;te.left;)te=te.left;se={key:te.key,data:te.data},this.remove(te.key)}return se},l.prototype.next=function(te){var se=te;if(se)if(se.right)for(se=se.right;se&&se.left;)se=se.left;else for(se=te.parent;se&&se.right===te;)te=se,se=se.parent;return se},l.prototype.prev=function(te){var se=te;if(se)if(se.left)for(se=se.left;se&&se.right;)se=se.right;else for(se=te.parent;se&&se.left===te;)te=se,se=se.parent;return se},l.prototype.forEach=function(te){for(var se=this._root,Ve=[],ht=!1,xt=0;!ht;)se?(Ve.push(se),se=se.left):Ve.length>0?(te(se=Ve.pop(),xt++),se=se.right):ht=!0;return this},l.prototype.range=function(te,se,Ve,ht){for(var xt=[],_t=this._compare,zt=this._root;xt.length!==0||zt;)if(zt)xt.push(zt),zt=zt.left;else{if(_t((zt=xt.pop()).key,se)>0)break;if(_t(zt.key,te)>=0&&Ve.call(ht,zt))return this;zt=zt.right}return this},l.prototype.keys=function(){for(var te=this._root,se=[],Ve=[],ht=!1;!ht;)te?(se.push(te),te=te.left):se.length>0?(te=se.pop(),Ve.push(te.key),te=te.right):ht=!0;return Ve},l.prototype.values=function(){for(var te=this._root,se=[],Ve=[],ht=!1;!ht;)te?(se.push(te),te=te.left):se.length>0?(te=se.pop(),Ve.push(te.data),te=te.right):ht=!0;return Ve},l.prototype.at=function(te){for(var se=this._root,Ve=[],ht=!1,xt=0;!ht;)if(se)Ve.push(se),se=se.left;else if(Ve.length>0){if(se=Ve.pop(),xt===te)return se;xt++,se=se.right}else ht=!0;return null},l.prototype.load=function(te,se,Ve){if(te===void 0&&(te=[]),se===void 0&&(se=[]),Ve===void 0&&(Ve=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ht=te.length;return Ve&&g(te,se,0,ht-1,this._compare),this._root=f(null,te,se,0,ht),this._size=ht,this},l.prototype.min=function(){var te=this.minNode(this._root);return te?te.key:null},l.prototype.max=function(){var te=this.maxNode(this._root);return te?te.key:null},l.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},l.createTree=function(te,se,Ve,ht,xt){return new l(Ve,xt).load(te,se,ht)},Object.defineProperties(l.prototype,d);var x=0,b=1,S=2,E=3,I=0,D=1,z=2,F=3;function $(te,se,Ve){se===null?(te.inOut=!1,te.otherInOut=!0):(te.isSubject===se.isSubject?(te.inOut=!se.inOut,te.otherInOut=se.otherInOut):(te.inOut=!se.otherInOut,te.otherInOut=se.isVertical()?!se.inOut:se.inOut),se&&(te.prevInResult=!H(se,Ve)||se.isVertical()?se.prevInResult:se));var ht=H(te,Ve);te.resultTransition=ht?function(xt,_t){var zt,Gt=!xt.inOut,wi=!xt.otherInOut;switch(_t){case I:zt=Gt&&wi;break;case D:zt=Gt||wi;break;case F:zt=Gt^wi;break;case z:zt=xt.isSubject?Gt&&!wi:wi&&!Gt}return zt?1:-1}(te,Ve):0}function H(te,se){switch(te.type){case x:switch(se){case I:return!te.otherInOut;case D:return te.otherInOut;case z:return te.isSubject&&te.otherInOut||!te.isSubject&&!te.otherInOut;case F:return!0}break;case S:return se===I||se===D;case E:return se===z;case b:return!1}return!1}var ee=function(te,se,Ve,ht,xt){this.left=se,this.point=te,this.otherEvent=Ve,this.isSubject=ht,this.type=xt||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},K={inResult:{configurable:!0}};function N(te,se){return te[0]===se[0]&&te[1]===se[1]}ee.prototype.isBelow=function(te){var se=this.point,Ve=this.otherEvent.point;return this.left?(se[0]-te[0])*(Ve[1]-te[1])-(Ve[0]-te[0])*(se[1]-te[1])>0:(Ve[0]-te[0])*(se[1]-te[1])-(se[0]-te[0])*(Ve[1]-te[1])>0},ee.prototype.isAbove=function(te){return!this.isBelow(te)},ee.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},K.inResult.get=function(){return this.resultTransition!==0},ee.prototype.clone=function(){var te=new ee(this.point,this.left,this.otherEvent,this.isSubject,this.type);return te.contourId=this.contourId,te.resultTransition=this.resultTransition,te.prevInResult=this.prevInResult,te.isExteriorRing=this.isExteriorRing,te.inOut=this.inOut,te.otherInOut=this.otherInOut,te},Object.defineProperties(ee.prototype,K);var Z=11102230246251565e-32,Q=134217729,re=(3+8*Z)*Z;function pe(te,se,Ve,ht,xt){var _t,zt,Gt,wi,Ti=se[0],oi=ht[0],Ji=0,mn=0;oi>Ti==oi>-Ti?(_t=Ti,Ti=se[++Ji]):(_t=oi,oi=ht[++mn]);var Si=0;if(Ji<te&&mn<Ve)for(oi>Ti==oi>-Ti?(Gt=_t-((zt=Ti+_t)-Ti),Ti=se[++Ji]):(Gt=_t-((zt=oi+_t)-oi),oi=ht[++mn]),_t=zt,Gt!==0&&(xt[Si++]=Gt);Ji<te&&mn<Ve;)oi>Ti==oi>-Ti?(Gt=_t-((zt=_t+Ti)-(wi=zt-_t))+(Ti-wi),Ti=se[++Ji]):(Gt=_t-((zt=_t+oi)-(wi=zt-_t))+(oi-wi),oi=ht[++mn]),_t=zt,Gt!==0&&(xt[Si++]=Gt);for(;Ji<te;)Gt=_t-((zt=_t+Ti)-(wi=zt-_t))+(Ti-wi),Ti=se[++Ji],_t=zt,Gt!==0&&(xt[Si++]=Gt);for(;mn<Ve;)Gt=_t-((zt=_t+oi)-(wi=zt-_t))+(oi-wi),oi=ht[++mn],_t=zt,Gt!==0&&(xt[Si++]=Gt);return _t===0&&Si!==0||(xt[Si++]=_t),Si}function _e(te){return new Float64Array(te)}var xe=33306690738754716e-32,Te=22204460492503146e-32,Be=11093356479670487e-47,Je=_e(4),Ze=_e(8),Ye=_e(12),rt=_e(16),Oe=_e(4);function Ke(te,se,Ve){var ht=function(xt,_t,zt,Gt,wi,Ti){var oi=(_t-Ti)*(zt-wi),Ji=(xt-wi)*(Gt-Ti),mn=oi-Ji;if(oi===0||Ji===0||oi>0!=Ji>0)return mn;var Si=Math.abs(oi+Ji);return Math.abs(mn)>=xe*Si?mn:-function(On,vn,Zi,Hn,wn,gn,bn){var en,ui,on,Fn,$t,Di,Tn,jn,Cn,gr,un,hr,ks,Qr,Gr,Os,Ta,_r,wr=On-wn,es=Zi-wn,ys=vn-gn,ls=Hn-gn;Je[0]=(Gr=(jn=wr-(Tn=(Di=Q*wr)-(Di-wr)))*(gr=ls-(Cn=(Di=Q*ls)-(Di-ls)))-((Qr=wr*ls)-Tn*Cn-jn*Cn-Tn*gr))-((un=Gr-(Ta=(jn=ys-(Tn=(Di=Q*ys)-(Di-ys)))*(gr=es-(Cn=(Di=Q*es)-(Di-es)))-((Os=ys*es)-Tn*Cn-jn*Cn-Tn*gr)))+($t=Gr-un))+($t-Ta),Je[1]=(ks=Qr-((hr=Qr+un)-($t=hr-Qr))+(un-$t))-((un=ks-Os)+($t=ks-un))+($t-Os),Je[2]=hr-((_r=hr+un)-($t=_r-hr))+(un-$t),Je[3]=_r;var nc=function(aV,k2){for(var O2=k2[0],Bx=1;Bx<4;Bx++)O2+=k2[Bx];return O2}(0,Je),ip=Te*bn;if(nc>=ip||-nc>=ip||(en=On-(wr+($t=On-wr))+($t-wn),on=Zi-(es+($t=Zi-es))+($t-wn),ui=vn-(ys+($t=vn-ys))+($t-gn),Fn=Hn-(ls+($t=Hn-ls))+($t-gn),en===0&&ui===0&&on===0&&Fn===0)||(ip=Be*bn+re*Math.abs(nc),(nc+=wr*Fn+ls*en-(ys*on+es*ui))>=ip||-nc>=ip))return nc;Oe[0]=(Gr=(jn=en-(Tn=(Di=Q*en)-(Di-en)))*(gr=ls-(Cn=(Di=Q*ls)-(Di-ls)))-((Qr=en*ls)-Tn*Cn-jn*Cn-Tn*gr))-((un=Gr-(Ta=(jn=ui-(Tn=(Di=Q*ui)-(Di-ui)))*(gr=es-(Cn=(Di=Q*es)-(Di-es)))-((Os=ui*es)-Tn*Cn-jn*Cn-Tn*gr)))+($t=Gr-un))+($t-Ta),Oe[1]=(ks=Qr-((hr=Qr+un)-($t=hr-Qr))+(un-$t))-((un=ks-Os)+($t=ks-un))+($t-Os),Oe[2]=hr-((_r=hr+un)-($t=_r-hr))+(un-$t),Oe[3]=_r;var sR=pe(4,Je,4,Oe,Ze);Oe[0]=(Gr=(jn=wr-(Tn=(Di=Q*wr)-(Di-wr)))*(gr=Fn-(Cn=(Di=Q*Fn)-(Di-Fn)))-((Qr=wr*Fn)-Tn*Cn-jn*Cn-Tn*gr))-((un=Gr-(Ta=(jn=ys-(Tn=(Di=Q*ys)-(Di-ys)))*(gr=on-(Cn=(Di=Q*on)-(Di-on)))-((Os=ys*on)-Tn*Cn-jn*Cn-Tn*gr)))+($t=Gr-un))+($t-Ta),Oe[1]=(ks=Qr-((hr=Qr+un)-($t=hr-Qr))+(un-$t))-((un=ks-Os)+($t=ks-un))+($t-Os),Oe[2]=hr-((_r=hr+un)-($t=_r-hr))+(un-$t),Oe[3]=_r;var oR=pe(sR,Ze,4,Oe,Ye);Oe[0]=(Gr=(jn=en-(Tn=(Di=Q*en)-(Di-en)))*(gr=Fn-(Cn=(Di=Q*Fn)-(Di-Fn)))-((Qr=en*Fn)-Tn*Cn-jn*Cn-Tn*gr))-((un=Gr-(Ta=(jn=ui-(Tn=(Di=Q*ui)-(Di-ui)))*(gr=on-(Cn=(Di=Q*on)-(Di-on)))-((Os=ui*on)-Tn*Cn-jn*Cn-Tn*gr)))+($t=Gr-un))+($t-Ta),Oe[1]=(ks=Qr-((hr=Qr+un)-($t=hr-Qr))+(un-$t))-((un=ks-Os)+($t=ks-un))+($t-Os),Oe[2]=hr-((_r=hr+un)-($t=_r-hr))+(un-$t),Oe[3]=_r;var aR=pe(oR,Ye,4,Oe,rt);return rt[aR-1]}(xt,_t,zt,Gt,wi,Ti,Si)}(te[0],te[1],se[0],se[1],Ve[0],Ve[1]);return ht>0?-1:ht<0?1:0}function Le(te,se){var Ve=te.point,ht=se.point;return Ve[0]>ht[0]?1:Ve[0]<ht[0]?-1:Ve[1]!==ht[1]?Ve[1]>ht[1]?1:-1:function(xt,_t,zt,Gt){return xt.left!==_t.left?xt.left?1:-1:Ke(zt,xt.otherEvent.point,_t.otherEvent.point)!==0?xt.isBelow(_t.otherEvent.point)?-1:1:!xt.isSubject&&_t.isSubject?1:-1}(te,se,Ve)}function Fe(te,se,Ve){var ht=new ee(se,!1,te,te.isSubject),xt=new ee(se,!0,te.otherEvent,te.isSubject);return N(te.point,te.otherEvent.point)&&console.warn("what is that, a collapsed segment?",te),ht.contourId=xt.contourId=te.contourId,Le(xt,te.otherEvent)>0&&(te.otherEvent.left=!0,xt.left=!1),te.otherEvent.otherEvent=xt,te.otherEvent=ht,Ve.push(xt),Ve.push(ht),Ve}function at(te,se){return te[0]*se[1]-te[1]*se[0]}function lt(te,se){return te[0]*se[0]+te[1]*se[1]}function kt(te,se,Ve){var ht=function(wi,Ti,oi,Ji,mn){var Si=[Ti[0]-wi[0],Ti[1]-wi[1]],On=[Ji[0]-oi[0],Ji[1]-oi[1]];function vn(Di,Tn,jn){return[Di[0]+Tn*jn[0],Di[1]+Tn*jn[1]]}var Zi=[oi[0]-wi[0],oi[1]-wi[1]],Hn=at(Si,On),wn=Hn*Hn,gn=lt(Si,Si);if(wn>0){var bn=at(Zi,On)/Hn;if(bn<0||bn>1)return null;var en=at(Zi,Si)/Hn;return en<0||en>1?null:bn===0||bn===1?[vn(wi,bn,Si)]:en===0||en===1?[vn(oi,en,On)]:[vn(wi,bn,Si)]}if((wn=(Hn=at(Zi,Si))*Hn)>0)return null;var ui=lt(Si,Zi)/gn,on=ui+lt(Si,On)/gn,Fn=Math.min(ui,on),$t=Math.max(ui,on);return Fn<=1&&$t>=0?Fn===1?[vn(wi,Fn>0?Fn:0,Si)]:$t===0?[vn(wi,$t<1?$t:1,Si)]:[vn(wi,Fn>0?Fn:0,Si),vn(wi,$t<1?$t:1,Si)]:null}(te.point,te.otherEvent.point,se.point,se.otherEvent.point),xt=ht?ht.length:0;if(xt===0||xt===1&&(N(te.point,se.point)||N(te.otherEvent.point,se.otherEvent.point))||xt===2&&te.isSubject===se.isSubject)return 0;if(xt===1)return N(te.point,ht[0])||N(te.otherEvent.point,ht[0])||Fe(te,ht[0],Ve),N(se.point,ht[0])||N(se.otherEvent.point,ht[0])||Fe(se,ht[0],Ve),1;var _t=[],zt=!1,Gt=!1;return N(te.point,se.point)?zt=!0:Le(te,se)===1?_t.push(se,te):_t.push(te,se),N(te.otherEvent.point,se.otherEvent.point)?Gt=!0:Le(te.otherEvent,se.otherEvent)===1?_t.push(se.otherEvent,te.otherEvent):_t.push(te.otherEvent,se.otherEvent),zt&&Gt||zt?(se.type=b,te.type=se.inOut===te.inOut?S:E,zt&&!Gt&&Fe(_t[1].otherEvent,_t[0].point,Ve),2):Gt?(Fe(_t[0],_t[1].point,Ve),3):_t[0]!==_t[3].otherEvent?(Fe(_t[0],_t[1].point,Ve),Fe(_t[1],_t[2].point,Ve),3):(Fe(_t[0],_t[1].point,Ve),Fe(_t[3].otherEvent,_t[2].point,Ve),3)}function Et(te,se){if(te===se)return 0;if(Ke(te.point,te.otherEvent.point,se.point)!==0||Ke(te.point,te.otherEvent.point,se.otherEvent.point)!==0)return N(te.point,se.point)?te.isBelow(se.otherEvent.point)?-1:1:te.point[0]===se.point[0]?te.point[1]<se.point[1]?-1:1:Le(te,se)===1?se.isAbove(te.point)?-1:1:te.isBelow(se.point)?-1:1;if(te.isSubject!==se.isSubject)return te.isSubject?-1:1;var Ve=te.point,ht=se.point;return Ve[0]===ht[0]&&Ve[1]===ht[1]?(Ve=te.otherEvent.point)[0]===(ht=se.otherEvent.point)[0]&&Ve[1]===ht[1]?0:te.contourId>se.contourId?1:-1:Le(te,se)===1?1:-1}var gt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function st(te,se,Ve,ht){var xt,_t=te+1,zt=se[te].point,Gt=se.length;for(_t<Gt&&(xt=se[_t].point);_t<Gt&&xt[0]===zt[0]&&xt[1]===zt[1];){if(!Ve[_t])return _t;++_t<Gt&&(xt=se[_t].point)}for(_t=te-1;Ve[_t]&&_t>ht;)_t--;return _t}gt.prototype.isExterior=function(){return this.holeOf==null};var Zt=Rt,Pt=Rt;function Rt(te,se){if(!(this instanceof Rt))return new Rt(te,se);if(this.data=te||[],this.length=this.data.length,this.compare=se||Ht,this.length>0)for(var Ve=(this.length>>1)-1;Ve>=0;Ve--)this._down(Ve)}function Ht(te,se){return te<se?-1:te>se?1:0}Rt.prototype={push:function(te){this.data.push(te),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var te=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),te}},peek:function(){return this.data[0]},_up:function(te){for(var se=this.data,Ve=this.compare,ht=se[te];te>0;){var xt=te-1>>1,_t=se[xt];if(Ve(ht,_t)>=0)break;se[te]=_t,te=xt}se[te]=ht},_down:function(te){for(var se=this.data,Ve=this.compare,ht=this.length>>1,xt=se[te];te<ht;){var _t=1+(te<<1),zt=_t+1,Gt=se[_t];if(zt<this.length&&Ve(se[zt],Gt)<0&&(_t=zt,Gt=se[zt]),Ve(Gt,xt)>=0)break;se[te]=Gt,te=_t}se[te]=xt}},Zt.default=Pt;var ei=Math.max,ni=Math.min,di=0;function ai(te,se,Ve,ht,xt,_t){var zt,Gt,wi,Ti,oi,Ji;for(zt=0,Gt=te.length-1;zt<Gt;zt++)if(Ti=te[zt+1],oi=new ee(wi=te[zt],!1,void 0,se),Ji=new ee(Ti,!1,oi,se),oi.otherEvent=Ji,wi[0]!==Ti[0]||wi[1]!==Ti[1]){oi.contourId=Ji.contourId=Ve,_t||(oi.isExteriorRing=!1,Ji.isExteriorRing=!1),Le(oi,Ji)>0?Ji.left=!0:oi.left=!0;var mn=wi[0],Si=wi[1];xt[0]=ni(xt[0],mn),xt[1]=ni(xt[1],Si),xt[2]=ei(xt[2],mn),xt[3]=ei(xt[3],Si),ht.push(oi),ht.push(Ji)}}var si=[];function cn(te,se,Ve){typeof te[0][0][0]=="number"&&(te=[te]),typeof se[0][0][0]=="number"&&(se=[se]);var ht=function(Si,On,vn){var Zi=null;return Si.length*On.length==0&&(vn===I?Zi=si:vn===z?Zi=Si:vn!==D&&vn!==F||(Zi=Si.length===0?On:Si)),Zi}(te,se,Ve);if(ht)return ht===si?null:ht;var xt=[1/0,1/0,-1/0,-1/0],_t=[1/0,1/0,-1/0,-1/0],zt=function(Si,On,vn,Zi,Hn){var wn,gn,bn,en,ui,on,Fn=new Zt(null,Le);for(bn=0,en=Si.length;bn<en;bn++)for(ui=0,on=(wn=Si[bn]).length;ui<on;ui++)(gn=ui===0)&&di++,ai(wn[ui],!0,di,Fn,vn,gn);for(bn=0,en=On.length;bn<en;bn++)for(ui=0,on=(wn=On[bn]).length;ui<on;ui++)gn=ui===0,Hn===z&&(gn=!1),gn&&di++,ai(wn[ui],!1,di,Fn,Zi,gn);return Fn}(te,se,xt,_t,Ve);if(ht=function(Si,On,vn,Zi,Hn){var wn=null;return(vn[0]>Zi[2]||Zi[0]>vn[2]||vn[1]>Zi[3]||Zi[1]>vn[3])&&(Hn===I?wn=si:Hn===z?wn=Si:Hn!==D&&Hn!==F||(wn=Si.concat(On))),wn}(te,se,xt,_t,Ve))return ht===si?null:ht;for(var Gt=function(Si){var On,vn,Zi=function(bn){var en,ui,on,Fn,$t=[];for(ui=0,on=bn.length;ui<on;ui++)((en=bn[ui]).left&&en.inResult||!en.left&&en.otherEvent.inResult)&&$t.push(en);for(var Di=!1;!Di;)for(Di=!0,ui=0,on=$t.length;ui<on;ui++)ui+1<on&&Le($t[ui],$t[ui+1])===1&&(Fn=$t[ui],$t[ui]=$t[ui+1],$t[ui+1]=Fn,Di=!1);for(ui=0,on=$t.length;ui<on;ui++)(en=$t[ui]).otherPos=ui;for(ui=0,on=$t.length;ui<on;ui++)(en=$t[ui]).left||(Fn=en.otherPos,en.otherPos=en.otherEvent.otherPos,en.otherEvent.otherPos=Fn);return $t}(Si),Hn={},wn=[],gn=function(){if(!Hn[On]){var bn=wn.length,en=function($t,Di,Tn){var jn=new gt;if($t.prevInResult!=null){var Cn=$t.prevInResult,gr=Cn.outputContourId;if(Cn.resultTransition>0){var un=Di[gr];if(un.holeOf!=null){var hr=un.holeOf;Di[hr].holeIds.push(Tn),jn.holeOf=hr,jn.depth=Di[gr].depth}else Di[gr].holeIds.push(Tn),jn.holeOf=gr,jn.depth=Di[gr].depth+1}else jn.holeOf=null,jn.depth=Di[gr].depth}else jn.holeOf=null,jn.depth=0;return jn}(Zi[On],wn,bn),ui=function($t){Hn[$t]=!0,$t<Zi.length&&Zi[$t]&&(Zi[$t].outputContourId=bn)},on=On,Fn=On;for(en.points.push(Zi[On].point);ui(on),ui(on=Zi[on].otherPos),en.points.push(Zi[on].point),!((on=st(on,Zi,Hn,Fn))==Fn||on>=Zi.length)&&Zi[on];);wn.push(en)}};for(On=0,vn=Zi.length;On<vn;On++)gn();return wn}(function(Si,On,vn,Zi,Hn,wn){for(var gn,bn,en,ui=new l(Et),on=[],Fn=Math.min(Zi[2],Hn[2]);Si.length!==0;){var $t=Si.pop();if(on.push($t),wn===I&&$t.point[0]>Fn||wn===z&&$t.point[0]>Zi[2])break;if($t.left){bn=gn=ui.insert($t),gn=gn!==(en=ui.minNode())?ui.prev(gn):null,bn=ui.next(bn);var Di=gn?gn.key:null;if($($t,Di,wn),bn&&kt($t,bn.key,Si)===2&&($($t,Di,wn),$(bn.key,$t,wn)),gn&&kt(gn.key,$t,Si)===2){var Tn=gn;$(Di,(Tn=Tn!==en?ui.prev(Tn):null)?Tn.key:null,wn),$($t,Di,wn)}}else bn=gn=ui.find($t=$t.otherEvent),gn&&bn&&(gn=gn!==en?ui.prev(gn):null,bn=ui.next(bn),ui.remove($t),bn&&gn&&kt(gn.key,bn.key,Si))}return on}(zt,0,0,xt,_t,Ve)),wi=[],Ti=0;Ti<Gt.length;Ti++){var oi=Gt[Ti];if(oi.isExterior()){for(var Ji=[oi.points],mn=0;mn<oi.holeIds.length;mn++)Ji.push(Gt[oi.holeIds[mn]].points);wi.push(Ji)}}return wi}var xn={UNION:D,DIFFERENCE:z,INTERSECTION:I,XOR:F};i.diff=function(te,se){return cn(te,se,z)},i.intersection=function(te,se){return cn(te,se,I)},i.operations=xn,i.union=function(te,se){return cn(te,se,D)},i.xor=function(te,se){return cn(te,se,F)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Pb.exports)),Pb.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Km(n,e,i,o){const l=[],d=o===0?(f,g,x,b,S,E)=>{f.push(new dt(E,x+(E-g)/(b-g)*(S-x)))}:(f,g,x,b,S,E)=>{f.push(new dt(g+(E-x)/(S-x)*(b-g),E))};for(const f of n){const g=[];for(const x of f){if(x.length<=2)continue;const b=[];for(let I=0;I<x.length-1;I++){const D=x[I].x,z=x[I].y,F=x[I+1].x,$=x[I+1].y,H=o===0?D:z,ee=o===0?F:$;H<e?ee>e&&d(b,D,z,F,$,e):H>i?ee<i&&d(b,D,z,F,$,i):b.push(x[I]),ee<e&&H>=e&&d(b,D,z,F,$,e),ee>i&&H<=i&&d(b,D,z,F,$,i)}let S=x[x.length-1];const E=o===0?S.x:S.y;E>=e&&E<=i&&b.push(S),b.length&&(S=b[b.length-1],b[0].x===S.x&&b[0].y===S.y||b.push(b[0]),g.push(b))}g.length&&l.push(g)}return l}function wC(n,e){const i=ky(n),o=ky([e]),l=Rb.intersection(i,o);return l==null?[]:Db(l)}function TC(n,e){let o=ky(n,65536);for(;e.valid();e.next()){const[l,d]=e.get(),f=l.x*65536,g=l.y*65536,x=d.x*65536,b=d.y*65536,S=x-f,E=b-g,I=Math.hypot(S,E),D=Math.trunc(E/I*3),z=-Math.trunc(S/I*3);o=Rb.diff(o,[[[f,g],[x,b],[x+D,b+z],[f+D,g+z],[f,g]]])}return Db(o,1/65536)}function ky(n,e=1){return[n.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function Db(n,e=1){return n.map(i=>i.map((o,l)=>{const d=o.map(f=>new dt(f[0]*e,f[1]*e).round());return l>0&&d.reverse(),d}))}class Oy{constructor(e,i){this.layoutVertexArray=new Ho,this.indexArray=new Ar,this.lineIndexArray=new _a,this.triangleSegments=new kn,this.lineSegments=new kn,this.programConfigurations=new rl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Vl)}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,sC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,l,d,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,d,f)}}class Fy{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Oy(e,!1),this.elevationBufferData=new Oy(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=Cy("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:x,index:b,sourceLayerIndex:S}of e){const E=this.layers[0]._featureFilter.needGeometry,I=Ot(g,E);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),I,o))continue;const D=d?d.evaluate(I,{},o,i.availableImages):void 0,z={id:x,properties:g.properties,type:g.type,sourceLayerIndex:S,index:b,geometry:E?I.geometry:At(g,o,l),patterns:{},sortKey:D};f.push(z)}d&&f.sort((g,x)=>g.sortKey-x.sortKey);for(const g of f){const{geometry:x,index:b,sourceLayerIndex:S}=g;if(this.hasPattern){const E=My("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(E)}else this.addFeature(g,x,b,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[b].feature,x,b,S,this.index)}}update(e,i,o,l,d,f,g){this.bufferData.update(e,i,o,l,d,f,g),this.elevationBufferData.update(e,i,o,l,d,f,g)}addFeatures(e,i,o,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,l,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,l,d,f=[],g,x){const b=Zm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,b,l,o,x):this.addGeometry(b,this.bufferData),this.bufferData.populatePaintArrays(e,o,d,f,l,g),this.elevationBufferData.populatePaintArrays(e,o,d,f,l,g)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,i,o,l,d){const f=new Array,g=Ly.getElevationFeature(e,d);if(g){{const x=this.clipPolygonsToTile(i,1);x.length>0&&f.push({polygons:x,elevationFeature:g,elevationTileID:o})}for(const x of f)if(x.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new io(x.elevationTileID));const S=x.elevationFeature.isTunnel();let E=0;e.properties.hasOwnProperty(Sb)&&(E=+e.properties[Sb]);for(const I of x.polygons)this.elevatedStructures.addPortalCandidates(x.elevationFeature.id,I,S,x.elevationFeature,E)}x.elevationFeature.constantHeight==null&&(x.polygons=this.prepareElevatedPolygons(x.polygons,x.elevationFeature,x.elevationTileID));const b=new Ib(o,x.elevationTileID);this.addElevatedGeometry(x.polygons,b,x.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,l)}}else this.addGeometry(i,this.bufferData)}addElevatedGeometry(e,i,o,l,d){const f={elevation:o,elevationSampler:i,bias:l,index:d},[g,x]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:g,max:x}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,g),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,x))}addGeometry(e,i,o){let l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=null;o&&(f=o.elevationSampler.constantElevation(o.elevation,o.bias),f!=null&&(l=f,d=f));const g=(x,b,S)=>{if(o!=null)if(b.push(x),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),S.push(f);else{const E=o.elevationSampler.pointElevation(x,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(E),S.push(E),l=Math.min(l,E),d=Math.max(d,E)}};for(const x of e){let b=0;for(const K of x)b+=K.length;const S=i.triangleSegments.prepareSegment(b,i.layoutVertexArray,i.indexArray),E=S.vertexLength,I=[],D=[],z=[],F=[],$=[],H=i.layoutVertexArray.length;for(const K of x){if(K.length===0)continue;K!==x[0]&&D.push(I.length/2);const N=i.lineSegments.prepareSegment(K.length,i.layoutVertexArray,i.lineIndexArray),Z=N.vertexLength;o&&$.push(i.layoutVertexArray.length-H),g(K[0],z,F),i.layoutVertexArray.emplaceBack(K[0].x,K[0].y),i.lineIndexArray.emplaceBack(Z+K.length-1,Z),I.push(K[0].x),I.push(K[0].y);for(let Q=1;Q<K.length;Q++)g(K[Q],z,F),i.layoutVertexArray.emplaceBack(K[Q].x,K[Q].y),i.lineIndexArray.emplaceBack(Z+Q-1,Z+Q),I.push(K[Q].x),I.push(K[Q].y);N.vertexLength+=K.length,N.primitiveLength+=K.length}const ee=Sf(I,D);for(let K=0;K<ee.length;K+=3)i.indexArray.emplaceBack(E+ee[K],E+ee[K+1],E+ee[K+2]);if(ee.length>0&&o&&this.elevationMode==="hd-road-base"){const K=o.elevation.isTunnel(),N=o.elevation.safeArea,Z=this.elevatedStructures.addVertices(z,F);this.elevatedStructures.addTriangles(ee,Z,K);const Q=$.length;if(Q>0){for(let re=0;re<Q-1;re++)this.elevatedStructures.addRenderableRing(o.index,$[re]+Z,$[re+1]-$[re],K,N);this.elevatedStructures.addRenderableRing(o.index,$[Q-1]+Z,z.length-$[Q-1],K,N)}}S.vertexLength+=b,S.primitiveLength+=ee.length/3}return[l,d]}prepareElevatedPolygons(e,i,o){const l=1/Se(o),d=[];for(const f of e){const g=TC(f,new Ab(i,l));d.push(...g)}return d}clipPolygonsToTile(e,i){const o=-i,l=-i,d=pt+i,f=pt+i;let g=0;const x=[],b=[];for(;g<e.length;g++){const I=e[g],D=Sd(I);(D.min.x>=o&&D.max.x<=d&&D.min.y>=l&&D.max.y<=f?x:b).push(I)}if(x.length===e.length)return e;const S=[new dt(o,l),new dt(d,l),new dt(d,f),new dt(o,f),new dt(o,l)],E=x;for(const I of b)E.push(...wC(I,S));return E}}let zb,Lb,kb,Ob;Tt(Fy,"FillBucket",{omit:["layers","patternFeatures"]}),Tt(Oy,"FillBufferData"),Tt(io,"ElevatedStructures");class By{constructor(e,i,o,l){if(this.triangleCount=i.length/3,this.min=new dt(0,0),this.max=new dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let E=1;E<e.length;++E){const I=e[E];d.x=Math.min(d.x,I.x),d.y=Math.min(d.y,I.y),f.x=Math.max(f.x,I.x),f.y=Math.max(f.y,I.y)}if(l){const E=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/l);o=Math.max(o,E)}if(o===0)return;this.min=d,this.max=f;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const x=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/x)),this.cellsY=Math.max(1,Math.ceil(g.y/x)),this.xScale=1/x,this.yScale=1/x;const b=[];for(let E=0;E<this.triangleCount;E++){const I=e[i[3*E+0]].sub(this.min),D=e[i[3*E+1]].sub(this.min),z=e[i[3*E+2]].sub(this.min),F=ba(Math.floor(Math.min(I.x,D.x,z.x)),this.xScale,this.cellsX),$=ba(Math.floor(Math.max(I.x,D.x,z.x)),this.xScale,this.cellsX),H=ba(Math.floor(Math.min(I.y,D.y,z.y)),this.yScale,this.cellsY),ee=ba(Math.floor(Math.max(I.y,D.y,z.y)),this.yScale,this.cellsY),K=new dt(0,0),N=new dt(0,0),Z=new dt(0,0),Q=new dt(0,0);for(let re=H;re<=ee;++re){K.y=N.y=re*x,Z.y=Q.y=(re+1)*x;for(let pe=F;pe<=$;++pe)K.x=Z.x=pe*x,N.x=Q.x=(pe+1)*x,(Rn(I,D,z,K,N,Q)||Rn(I,D,z,K,Q,Z))&&b.push({cellIdx:re*this.cellsX+pe,triIdx:E})}}if(b.length===0)return;b.sort((E,I)=>E.cellIdx-I.cellIdx||E.triIdx-I.triIdx);let S=0;for(;S<b.length;){const E=b[S].cellIdx,I={start:this.payload.length,len:0};for(;S<b.length&&b[S].cellIdx===E;)++I.len,this.payload.push(b[S++].triIdx);this.cells[E]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=ba(e.x-this.min.x,this.xScale,this.cellsX),l=ba(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[l*this.cellsX+o];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const g=this.payload[d.start+f],x=Math.floor(g/8),b=1<<g%8;if(!(this.lookup[x]&b)&&(this.lookup[x]|=b,i.push(g),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const l=ba(e.x-this.min.x,this.xScale,this.cellsX),d=ba(i.x-this.min.x,this.xScale,this.cellsX),f=ba(e.y-this.min.y,this.yScale,this.cellsY),g=ba(i.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=g;x++)for(let b=l;b<=d;b++){const S=this.cells[x*this.cellsX+b];if(S)for(let E=0;E<S.len;E++){const I=this.payload[S.start+E],D=Math.floor(I/8),z=1<<I%8;if(!(this.lookup[D]&z)&&(this.lookup[D]|=z,o.push(I),o.length===this.triangleCount))return}}}}function ba(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}Tt(By,"TriangleGridIndex");class Fb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[]}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,l){const d=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,E=Ot(f,S);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),E,o))continue;const I={id:g,properties:f.properties,type:f.type,sourceLayerIndex:b,index:x,geometry:S?E.geometry:At(f,o,l),patterns:{}};d.push(I)}for(const f of d){const{geometry:g,index:x,sourceLayerIndex:b}=f;this.addFeature(f,g,x,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[x].feature,g,x,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,l,d,f,g){}destroy(){}addFeature(e,i,o,l,d,f=[],g){for(const x of Zm(i,2)){const b=[],S=[],E=[],I=new dt(1/0,1/0),D=new dt(-1/0,-1/0);for(const $ of x)if($.length!==0){$!==x[0]&&E.push(S.length/2);for(let H=0;H<$.length;H++)S.push($[H].x),S.push($[H].y),b.push($[H]),I.x=Math.min(I.x,$[H].x),I.y=Math.min(I.y,$[H].y),D.x=Math.max(D.x,$[H].x),D.y=Math.max(D.y,$[H].y)}const z=Sf(S,E),F=new By(b,z,8,256);this.footprints.push({vertices:b,indices:z,grid:F,min:I,max:D})}}}Tt(Fb,"ClipBucket",{omit:["layers"]});const SC=Ni([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),EC=Ni([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),AC=Ni([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IC=Ni([{name:"a_join_normal_inside",components:3,type:"Int16"}]),CC=Ni([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),MC=Ni([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:PC}=SC,Ym=Number.MAX_SAFE_INTEGER;function Bb(n,e,i,o){return n.order<e||n.order===Ym||!(n.clipMask&i)||function(l,d){return d.length!==0&&d.find(f=>f===l)===void 0}(o,n.clipScope)}function Jm(n,e){return n.x-e.x||n.y-e.y}function Nb(n,e){return Jm(n.min,e.min)===0&&Jm(n.max,e.max)===0}function Ny(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function Vy(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!Nb(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ao(n[i].clipScope,e[i].clipScope))return!1;return!0}function Vb(n,e,i){const o=1/pt,l=1/(1<<i.canonical.z),d=(e.x*o+i.canonical.x)*l+i.wrap,f=(e.y*o+i.canonical.y)*l;return{min:new dt((n.x*o+i.canonical.x)*l+i.wrap,(n.y*o+i.canonical.y)*l),max:new dt(d,f)}}function RC(n,e,i){const o=1<<i.canonical.z,l=((e.x-i.wrap)*o-i.canonical.x)*pt,d=(e.y*o-i.canonical.y)*pt;return{min:new dt(((n.x-i.wrap)*o-i.canonical.x)*pt,(n.y*o-i.canonical.y)*pt),max:new dt(l,d)}}function jb(n,e,i,o,l,d,f){const g=n.indices,x=n.vertices,b=[];for(let S=o;S<o+l;S+=3){const E=e[i[S+0]+d],I=e[i[S+1]+d],D=e[i[S+2]+d],z=Math.min(E.x,I.x,D.x),F=Math.max(E.x,I.x,D.x),$=Math.min(E.y,I.y,D.y),H=Math.max(E.y,I.y,D.y);b.length=0,n.grid.query(new dt(z,$),new dt(F,H),b);for(let ee=0;ee<b.length;ee++){const K=b[ee];if(Rn(x[g[3*K+0]],x[g[3*K+1]],x[g[3*K+2]],E,I,D,f))return!0}}return!1}function Ub(n,e,i,o){if(!n||!i)return!1;let l=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return Ub(i,o,n,e);const d=e.canonical,f=o.canonical,g=Math.pow(2,f.z-d.z);l=n.vertices.map(x=>new dt((x.x+d.x*pt)*g-f.x*pt,(x.y+d.y*pt)*g-f.y*pt))}return jb(i,l,n.indices,0,n.indices.length,0,0)}function $b(n,e,i,o){const l=Math.pow(2,o.z-i.z);return new dt((n+i.x*pt)*l-o.x*pt,(e+i.y*pt)*l-o.y*pt)}function Gb(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,l=e.vertices;for(let d=0;d<i.length;d++){const f=i[d];if(sn([l[o[3*f+0]],l[o[3*f+1]],l[o[3*f+2]]],n))return!0}return!1}const jy=[new dt(0,0),new dt(pt,0),new dt(pt,pt),new dt(0,pt)];function Hb(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return Gn(n[0],n[1],jy)?[n]:[];for(let l=0;l<n.length+2;l++){const d=n[l%n.length],f=n[(l+1)%n.length],g=Gn(l===0?n[n.length-1]:n[(l-1)%n.length],d,jy),x=Gn(d,f,jy),b=g||x;b&&o.push(d),b&&x||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const Uy=Yl.VectorTileFeature.types,DC=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],zC=["fill-extrusion-flood-light-ground-radius"],LC=Math.pow(2,13),kC=Math.pow(2,15)-1,qb=new dt(0,1),Jl=2147483648;function Mf(n,e,i,o,l,d,f,g){n.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(o*LC)<<1)+l,Math.round(g))}function Pf(n,e,i){n.emplaceBack(e.x*pt,e.y*pt,i?1:0)}function Qm(n,e,i,o,l,d){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+l,d)}function Rf(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Wb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Zb{constructor(){this.centroidXY=new dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Xb{constructor(){this.acc=new dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===pt)&&i.x===o.x)!=((i.y===0||i.y===pt)&&i.y===o.y)&&this.processBorderOverlap(i,o),l&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Nt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pt!=e.x>pt&&this.addBorderIntersection(1,Nt(i.y,e.y,(pt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Nt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pt!=e.y>pt&&this.addBorderIntersection(3,Nt(i.x,e.x,(pt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new dt(0,0):new dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Kb(n,e){const i=n.add(e)._unit(),o=ve(n.x*i.x+n.y*i.y,-1,1);var l,d,f;return l=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(l)))/4*kC*((d=n).x*(f=e).y-d.y*f.x<0?-1:1)}const OC=[n=>n.x<0,n=>n.x>pt,n=>n.y<0,n=>n.y>pt];function FC(n,e,i,o){const l=[4];if(o===0)return l;i._mult(o);const d=n.sub(i),f=e.sub(i),g=[n,e,d,f];for(let x=0;x<4;x++)for(const b of g)if(OC[x](b)){l.push(x);break}return l}class Yb{constructor(e){this.vertexArray=new cf,this.indexArray=new Ar,this.programConfigurations=new rl(e.layers,{zoom:e.zoom,lut:e.lut},i=>zC.includes(i)),this._segments=new kn,this.hiddenByLandmarkVertexArray=new bh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new kn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,l=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const b=e[0],S=e[1];x=Kb(b.sub(e[d-1])._perp()._unit(),S.sub(b)._perp()._unit())}for(let b=0;b<d;b++){const S=b===d-1?0:b+1,E=e[b],I=e[S],D=e[S===d-1?0:S+1],z=I.sub(E)._perp()._unit(),F=Kb(z,D.sub(I)._perp()._unit()),$=x,H=F;if($y(E,I,i)||l&&ew(E,i)&&ew(I,i)){x=F;continue}const ee=g.vertexLength;Qm(this.vertexArray,E,I,1,1,$),Qm(this.vertexArray,E,I,1,0,$),Qm(this.vertexArray,E,I,0,1,H),Qm(this.vertexArray,E,I,0,0,H),g.vertexLength+=4;const K=FC(E,I,z,o);for(const N of K)this._segmentToGroundQuads[f].push({id:ee,region:N}),this._segmentToRegionTriCounts[f][N]+=2,g.primitiveLength+=2;x=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((l,d)=>l.region-d.region);for(let o=0;o<i;o++){const l=this._segmentToGroundQuads[o],d=e[o],f=this._segmentToRegionTriCounts[o];f.reduce((x,b)=>x+b,0);let g=0;for(let x=0;x<=4;x++){const b=f[x];if(b!==0){let S=this.regionSegments[x];S||(S=this.regionSegments[x]=new kn);const E={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+g,vertexLength:d.vertexLength,primitiveLength:b};S.get().push(E)}g+=b}for(let x=0;x<l.length;x++){const b=l[x].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,l,d,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,l,d,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,EC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,l,d,f,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,l,d,f,g)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Jl?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,CC.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class eg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ar,this.footprintVertices=new Ho,this.footprintSegments=[],this.layoutVertexArray=new tl,this.centroidVertexArray=new Om,this.wallVertexArray=new Bm,this.indexArray=new Ar,this.programConfigurations=new rl(e.layers,{zoom:e.zoom,lut:e.lut},i=>DC.includes(i)),this.segments=new kn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Yb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,i){}populate(e,i,o,l){this.features=[],this.hasPattern=Cy("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Se(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:f,index:g,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,S=Ot(d,b);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),S,o))continue;const E={id:f,sourceLayerIndex:x,index:g,geometry:b?S.geometry:At(d,o,l),properties:d.properties,type:d.type,patterns:{}},I=this.layoutVertexArray.length,D=Uy[E.type]==="Polygon";if(this.hasPattern)this.features.push(My("fill-extrusion",this.layers,E,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const z of E.geometry)for(const F of Hb(z,D))this.addFeature(E,[F],g,o,{},i.availableImages,l,i.brightness);else this.addFeature(E,E.geometry,g,o,{},i.availableImages,l,i.brightness);i.featureIndex.insert(d,E.geometry,g,x,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,l,d,f){for(const g of this.features){const x=Uy[g.type]==="Polygon",{geometry:b}=g;if(this.wallMode)for(const S of b)for(const E of Hb(S,x))this.addFeature(g,[E],g.index,i,o,l,d,f);else this.addFeature(g,b,g.index,i,o,l,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g),this.groundEffect.update(e,i,d,o,l,f,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PC),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,IC.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,MC.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,AC.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,l,d,f,g,x){const b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,S=[new dt(0,0),new dt(pt,pt)],E=g.projection,I=E.name==="globe",D=this.wallMode||Uy[e.type]==="Polygon",z=new Xb;z.centroidDataIndex=this.centroidData.length;const F=new Zb,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,H=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);let ee;if(F.height=H,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new il),this.wallMode){if(I)return void vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;ee=function(xe){const Te=xe[0].x===xe[xe.length-1].x&&xe[0].y===xe[xe.length-1].y;(function(gt){let st=0;const Zt=gt.length;for(let Pt=0;Pt<Zt;Pt++)st+=(gt[(Pt+1)%Zt].x-gt[Pt].x)*(gt[(Pt+1)%Zt].y+gt[Pt].y);return st>=0})(xe)||(xe=xe.reverse());const Je={geometry:[],joinNormals:[],indices:[]},Ze=[],Ye=[],rt=[];let Oe=xe.length;for(;Oe>=2&&xe[Oe-1].equals(xe[Oe-2]);)Oe--;if(Oe<(Te?3:2))return Je;let Ke,Le,Fe,at,lt,kt=0;for(;kt<Oe-1&&xe[kt].equals(xe[kt+1]);)kt++;Te&&(Ke=xe[Oe-2],lt=xe[kt].sub(Ke)._unit()._perp());for(let gt=kt;gt<Oe;gt++){if(Fe=gt===Oe-1?Te?xe[kt+1]:void 0:xe[gt+1],Fe&&xe[gt].equals(Fe))continue;lt&&(at=lt),Ke&&(Le=Ke),Ke=xe[gt],lt=Fe?Fe.sub(Ke)._unit()._perp():at,at=at||lt;let st=at.add(lt);st.x===0&&st.y===0||st._unit();const Zt=st.x*lt.x+st.y*lt.y,Pt=Zt!==0?1/Zt:1/0,Rt=at.x*lt.y-at.y*lt.x>0;let Ht="miter";const ei=2;Ht==="miter"&&Pt>ei&&(Ht="bevel"),Ht==="bevel"&&(Pt>100&&(Ht="flipbevel"),Pt<ei&&(Ht="miter"));const ni=(di,ai,si,cn)=>{const xn=new dt(di.x,di.y),te=new dt(di.x,di.y);xn.x+=ai.x*cn,xn.y+=ai.y*cn,te.x-=ai.x*Math.max(si,1),te.y-=ai.y*Math.max(si,1),rt.push(ai),Ze.push(xn),Ye.push(te)};if(Ht==="miter")st._mult(Pt),ni(Ke,st,0,0);else if(Ht==="flipbevel")st=lt.mult(-1),ni(Ke,st,0,0),ni(Ke,st.mult(-1),0,0);else{const di=-Math.sqrt(Pt*Pt-1),ai=Rt?di:0,si=Rt?0:di;Le&&ni(Ke,at,ai,si),Fe&&ni(Ke,lt,ai,si)}}Je.geometry=[...Ze,...Ye.reverse(),Ze[0]],Je.joinNormals=[...rt,...rt.reverse(),rt[rt.length-1]];const Et=Je.geometry.length-1;for(let gt=0;gt<Et/2;gt++)if(gt+1<Et/2){let st=gt,Zt=gt+1,Pt=Et-1-gt,Rt=Et-2-gt;st=st===0?Et-1:st-1,Zt=Zt===0?Et-1:Zt-1,Pt=Pt===0?Et-1:Pt-1,Rt=Rt===0?Et-1:Rt-1,Je.indices.push(Pt),Je.indices.push(Zt),Je.indices.push(st),Je.indices.push(Pt),Je.indices.push(Rt),Je.indices.push(Zt)}return Je}(i[0]),i=[ee.geometry]}const K=(xe,Te)=>xe<(Te.length-1)/2||xe===Te.length-1,N=this.wallMode?[i]:Zm(i,500);for(let xe=N.length-1;xe>=0;xe--){const Te=N[xe];(Te.length===0||(Z=Te[0]).every(Be=>Be.x<=0)||Z.every(Be=>Be.x>=pt)||Z.every(Be=>Be.y<=0)||Z.every(Be=>Be.y>=pt))&&N.splice(xe,1)}var Z;let Q;if(I)Q=rw(N,S,l);else{Q=[];for(const xe of N)Q.push({polygon:xe,bounds:S})}const re=D?this.edgeRadius:0,pe=re>0&&this.zoom<17,_e=(xe,Te)=>{if(xe.length===0)return!1;const Be=xe[xe.length-1];return Te.x===Be.x&&Te.y===Be.y};for(const{polygon:xe,bounds:Te}of Q){let Be=0,Je=0;for(const Oe of xe)D&&!Oe[0].equals(Oe[Oe.length-1])&&Oe.push(Oe[0]),Je+=D?Oe.length-1:Oe.length;const Ze=this.segments.prepareSegment((D?5:4)*Je,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const Ye={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},rt=new Wb;if(rt.vertexOffset=this.footprintVertices.length,rt.indexOffset=3*this.footprintIndices.length,rt.ringIndices=[],D){const Oe=[],Ke=[];Be=Ze.vertexLength;for(let Fe=0;Fe<xe.length;Fe++){const at=xe[Fe];at.length&&Fe!==0&&Ke.push(Oe.length/2);const lt=[];let kt,Et;kt=at[1].sub(at[0])._perp()._unit(),rt.ringIndices.push(at.length-1);for(let gt=1;gt<at.length;gt++){const st=at[gt],Zt=at[gt===at.length-1?1:gt+1],Pt=st.clone();if(re){Et=Zt.sub(st)._perp()._unit();const Rt=kt.add(Et)._unit(),Ht=re*Math.min(4,1/(kt.x*Rt.x+kt.y*Rt.y));Pt.x+=Ht*Rt.x,Pt.y+=Ht*Rt.y,Pt.x=Math.round(Pt.x),Pt.y=Math.round(Pt.y),kt=Et}if(!$||re!==0&&!pe||_e(lt,Pt)||lt.push(Pt),Mf(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),this.wallMode){const Rt=K(gt,at);Pf(this.wallVertexArray,ee.joinNormals[gt],!Rt)}Ze.vertexLength++,this.footprintVertices.emplaceBack(st.x,st.y),Oe.push(st.x,st.y),I&&Rf(this.layoutVertexExtArray,E.projectTilePoint(Pt.x,Pt.y,l),E.upVector(l,Pt.x,Pt.y))}$&&(re===0||pe)&&(lt.length!==0&&_e(lt,lt[0])&&lt.pop(),this.groundEffect.addData(lt,Te,b))}const Le=this.wallMode?ee.indices:Sf(Oe,Ke);for(let Fe=0;Fe<Le.length;Fe+=3)this.footprintIndices.emplaceBack(rt.vertexOffset+Le[Fe+0],rt.vertexOffset+Le[Fe+1],rt.vertexOffset+Le[Fe+2]),this.indexArray.emplaceBack(Be+Le[Fe],Be+Le[Fe+2],Be+Le[Fe+1]),Ze.primitiveLength++;rt.indexCount+=Le.length,rt.vertexCount+=this.footprintVertices.length-rt.vertexOffset}for(let Oe=0;Oe<xe.length;Oe++){const Ke=xe[Oe];z.startRing(F,Ke[0]);let Le=Ke.length>4&&tw(Ke[Ke.length-2],Ke[0],Ke[1]),Fe=re?BC(Ke[Ke.length-2],Ke[0],Ke[1],re):0;const at=[];let lt,kt,Et;kt=Ke[1].sub(Ke[0])._perp()._unit();let gt=!0;for(let st=1,Zt=0;st<Ke.length;st++){let Pt=Ke[st-1],Rt=Ke[st];const Ht=Ke[st===Ke.length-1?1:st+1];if(z.appendEdge(F,Rt,Pt),$y(Rt,Pt,Te)){re&&(kt=Ht.sub(Rt)._perp()._unit(),gt=!gt);continue}const ei=Rt.sub(Pt)._perp(),ni=ei.x/(Math.abs(ei.x)+Math.abs(ei.y)),di=ei.y>0?1:0,ai=Pt.dist(Rt);if(Zt+ai>32768&&(Zt=0),re){Et=Ht.sub(Rt)._perp()._unit();let te=Qb(Pt,Rt,Ht,Jb(kt,Et),re);isNaN(te)&&(te=0);const se=Rt.sub(Pt)._unit();Pt=Pt.add(se.mult(Fe))._round(),Rt=Rt.add(se.mult(-te))._round(),Fe=te,kt=Et,$&&this.zoom>=17&&(_e(at,Pt)||at.push(Pt),_e(at,Rt)||at.push(Rt))}const si=Ze.vertexLength,cn=Ke.length>4&&tw(Pt,Rt,Ht);let xn=iw(Zt,Le,gt);if(Mf(this.layoutVertexArray,Pt.x,Pt.y,ni,di,0,0,xn),Mf(this.layoutVertexArray,Pt.x,Pt.y,ni,di,0,1,xn),this.wallMode){const te=K(st-1,Ke),se=ee.joinNormals[st-1];Pf(this.wallVertexArray,se,te),Pf(this.wallVertexArray,se,te)}if(Zt+=ai,xn=iw(Zt,cn,!gt),Le=cn,Mf(this.layoutVertexArray,Rt.x,Rt.y,ni,di,0,0,xn),Mf(this.layoutVertexArray,Rt.x,Rt.y,ni,di,0,1,xn),this.wallMode){const te=K(st,Ke),se=ee.joinNormals[st];Pf(this.wallVertexArray,se,te),Pf(this.wallVertexArray,se,te)}if(Ze.vertexLength+=4,this.indexArray.emplaceBack(si+0,si+1,si+2),this.indexArray.emplaceBack(si+1,si+3,si+2),Ze.primitiveLength+=2,re){const te=Be+(st===1?Ke.length-2:st-2),se=st===1?Be:te+1;if(this.indexArray.emplaceBack(si+1,te,si+3),this.indexArray.emplaceBack(te,se,si+3),Ze.primitiveLength+=2,lt===void 0&&(lt=si),!$y(Ht,Ke[st],Te)){const Ve=st===Ke.length-1?lt:Ze.vertexLength;this.indexArray.emplaceBack(si+2,si+3,Ve),this.indexArray.emplaceBack(si+3,Ve+1,Ve),this.indexArray.emplaceBack(si+3,se,Ve+1),Ze.primitiveLength+=3}gt=!gt}if(I){const te=this.layoutVertexExtArray,se=E.projectTilePoint(Pt.x,Pt.y,l),Ve=E.projectTilePoint(Rt.x,Rt.y,l),ht=E.upVector(l,Pt.x,Pt.y),xt=E.upVector(l,Rt.x,Rt.y);Rf(te,se,ht),Rf(te,se,ht),Rf(te,Ve,xt),Rf(te,Ve,xt)}}D&&(Be+=Ke.length-1),$&&re&&this.zoom>=17&&(at.length!==0&&_e(at,at[0])&&at.pop(),this.groundEffect.addData(at,Te,b,re>0))}this.footprintSegments.push(rt),Ye.triangleCount=this.indexArray.length-Ye.triangleArrayOffset,this.polygonSegments.push(Ye),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=z.borders?qb:this.encodeCentroid(z,F),this.centroidData.push(F),z.borders){this.featuresOnBorder.push(z);const xe=this.featuresOnBorder.length-1;for(let Te=0;Te<z.borders.length;Te++)z.borders[Te][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Te].push(xe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,x),this.groundEffect.addPaintPropertiesData(e,o,d,f,l,x),this.maxHeight=Math.max(this.maxHeight,H)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const x=this.centroidData[g],b=+(x.min.y+x.max.y>pt),S=2*b+(+(x.min.x+x.max.x>pt)^b);for(let E=0;E<x.polygonSegLen;E++){const I=x.polygonSegIdx+E;e.push({centroidIdx:g,subtile:S,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const i=new Ar;e.sort((g,x)=>g.triangleSegmentIdx===x.triangleSegmentIdx?g.subtile-x.subtile:g.triangleSegmentIdx-x.triangleSegmentIdx);let o=0,l=0,d=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;d++}const f=e.length;for(;l!==e.length;){o=e[l].triangleSegmentIdx;let g=0,x=l,b=l;for(let S=x;S<d&&e[S].subtile===g;S++)b++;for(;x!==d;){const S=e[x];g=S.subtile;const E=this.centroidData[S.centroidIdx].min.clone(),I=this.centroidData[S.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=x;z<b;z++){const F=e[z],$=this.polygonSegments[F.polygonSegmentIdx],H=this.centroidData[F.centroidIdx].min,ee=this.centroidData[F.centroidIdx].max,K=this.indexArray.uint16;for(let N=$.triangleArrayOffset;N<$.triangleArrayOffset+$.triangleCount;N++)i.emplaceBack(K[3*N],K[3*N+1],K[3*N+2]);D.primitiveLength+=$.triangleCount,E.x=Math.min(E.x,H.x),E.y=Math.min(E.y,H.y),I.x=Math.max(I.x,ee.x),I.y=Math.max(I.y,ee.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:E,max:I}),x=b;for(let z=x;z<d&&e[z].subtile===e[x].subtile;z++)b++}l=d;for(let S=l;S<f&&e[S].triangleSegmentIdx===e[l].triangleSegmentIdx;S++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const l=new kn;if(this.wallMode){for(const F of this.triangleSubSegments)l.segments.push(F.segment);return l}let d=0,f=0;const g=1<<e.canonical.z;if(i){const F=i.getMinMaxForTile(e);F&&(d=F.min,f=F.max)}f+=this.maxHeight;const x=e.toUnwrapped();let b;const S=[x.canonical.x/g+x.wrap,x.canonical.y/g],E=[(x.canonical.x+1)/g+x.wrap,(x.canonical.y+1)/g],I=(F,$,H)=>[F[0]*(1-H[0])+$[0]*H[0],F[1]*(1-H[1])+$[1]*H[1]],D=[],z=[];for(const F of this.triangleSubSegments){D[0]=F.min.x/pt,D[1]=F.min.y/pt,z[0]=F.max.x/pt,z[1]=F.max.y/pt;const $=I(S,E,D),H=I(S,E,z);if(new In([$[0],$[1],d],[H[0],H[1],f]).intersectsPrecise(o)===0){b&&(l.segments.push(b),b=void 0);continue}const ee=F.segment;b&&b.vertexOffset!==ee.vertexOffset&&(l.segments.push(b),b=void 0),b?(b.vertexLength+=ee.vertexLength,b.primitiveLength+=ee.primitiveLength):b={vertexOffset:ee.vertexOffset,primitiveLength:ee.primitiveLength,vertexLength:ee.vertexLength,primitiveOffset:ee.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&l.segments.push(b),l}encodeCentroid(e,i){const o=e.centroid(),l=i.span(),d=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new dt(ve(o.x,1,pt-1)<<3|d,ve(o.y,1,pt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new dt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const l=i[0][0]!==o?0:1;return new dt(6|(i[0][0]!==o?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==o?2:3;return new dt((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Jl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,l=e.flags&Jl?qb:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||d!==l.x){for(let f=i;f<o;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(Vy(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<o)continue;const g=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const x of this.centroidData)if(!(x.flags&Jl||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let b=0;b<x.footprintSegLen;b++){const S=this.footprintSegments[x.footprintSegIdx+b];if(d.length=0,NC(this.footprintVertices,S.vertexOffset,S.vertexCount,f.footprintTileId.canonical,e.canonical,d),jb(f.footprint,d,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-g)){x.flags|=Jl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let l=!1;for(let d=0;d<o.footprintSegLen;d++){const f=this.footprintSegments[o.footprintSegIdx+d];let g=0;for(const x of f.ringIndices){for(let b=g,S=x+g-1;b<x+g;S=b++){const E=this.footprintVertices.int16[2*(b+f.vertexOffset)+0],I=this.footprintVertices.int16[2*(b+f.vertexOffset)+1],D=this.footprintVertices.int16[2*(S+f.vertexOffset)+1];I>i!=D>i&&e<(this.footprintVertices.int16[2*(S+f.vertexOffset)+0]-E)*(i-I)/(D-I)+E&&(l=!l)}g=x}}return l}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,l=!0;const d=4*(e+pt)*pt+(i+pt);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&Jl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>o&&(o=f.height,this.partLookup[d]=f,l=!!(f.flags&Jl));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:l};this.partLookup[d]=void 0}}function Jb(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function BC(n,e,i,o){const l=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return Qb(n,e,i,Jb(l,d),o)}function Qb(n,e,i,o,l){const d=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,l*d/o)}function $y(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function ew(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function tw(n,e,i){if(n.x<0||n.x>=pt||e.x<0||e.x>=pt||i.x<0||i.x>=pt)return!1;const o=i.sub(e),l=o.perp(),d=n.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function iw(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function nw(){const n=Math.PI/32,e=Math.tan(n),i=V;return i*Math.sqrt(1+2*e*e)-i}function rw(n,e,i){const o=1<<i.z,l=me(i.x/o),d=me((i.x+1)/o),f=ge(i.y/o),g=ge((i.y+1)/o);return function(x,b,S,E,I=0,D){const z=[];if(!x.length||!S||!E)return z;const F=(Q,re)=>{for(const pe of Q)z.push({polygon:pe,bounds:re})},$=Math.ceil(Math.log2(S)),H=Math.ceil(Math.log2(E)),ee=$-H,K=[];for(let Q=0;Q<Math.abs(ee);Q++)K.push(ee>0?0:1);for(let Q=0;Q<Math.min($,H);Q++)K.push(0),K.push(1);let N=x;if(N=Km(N,b[0].y-I,b[1].y+I,1),N=Km(N,b[0].x-I,b[1].x+I,0),!N.length)return z;const Z=[];for(K.length?Z.push({polygons:N,bounds:b,depth:0}):F(N,b);Z.length;){const Q=Z.pop(),re=Q.depth,pe=K[re],_e=Q.bounds[0],xe=Q.bounds[1],Te=pe===0?_e.x:_e.y,Be=pe===0?xe.x:xe.y,Je=D?D(pe,Te,Be):.5*(Te+Be),Ze=Km(Q.polygons,Te-I,Je+I,pe),Ye=Km(Q.polygons,Je-I,Be+I,pe);if(Ze.length){const rt=[_e,new dt(pe===0?Je:xe.x,pe===1?Je:xe.y)];K.length>re+1?Z.push({polygons:Ze,bounds:rt,depth:re+1}):F(Ze,rt)}if(Ye.length){const rt=[new dt(pe===0?Je:_e.x,pe===1?Je:_e.y),xe];K.length>re+1?Z.push({polygons:Ye,bounds:rt,depth:re+1}):F(Ye,rt)}}return z}(n,e,Math.ceil((d-l)/11.25),Math.ceil((f-g)/11.25),1,(x,b,S)=>{if(x===0)return .5*(b+S);{const E=ge((i.y+b/pt)/o);return(ce(.5*(ge((i.y+S/pt)/o)+E))*o-i.y)*pt}})}function NC(n,e,i,o,l,d){const f=Math.pow(2,o.z-l.z);for(let g=0;g<i;g++){let x=n.int16[2*(g+e)+0],b=n.int16[2*(g+e)+1];x=(x+l.x*pt)*f-o.x*pt,b=(b+l.y*pt)*f-o.y*pt,d.push(new dt(x,b))}}let sw,ow;Tt(eg,"FillExtrusionBucket",{omit:["layers","features"]}),Tt(Zb,"PartData"),Tt(Wb,"FootprintSegment"),Tt(Xb,"BorderCentroidData"),Tt(Yb,"GroundEffect");class nu extends dt{constructor(e,i,o){super(e,i),this.z=o}}class aw extends nu{constructor(e,i,o,l){super(e,i,o),this.w=l}}function lw(n,e,i,o){const l=i==="x"?"y":"x",d=(o-n[i])/(e[i]-n[i]);n[l]=Math.round(n[l]+(e[l]-n[l])*d),n[i]=o,n.hasOwnProperty("z")&&(n.z=Nt(n.z,e.z,d)),n.hasOwnProperty("w")&&(n.w=Nt(n.w,e.w,d))}function cw(n,e,i,o){const l=i,d=o;for(const f of["x","y"]){let g=n,x=e;g[f]>=x[f]&&(g=e,x=n),g[f]<l&&x[f]>l&&lw(g,x,f,l),g[f]<d&&x[f]>d&&lw(x,g,f,d)}}function tg(n,e,i,o,l,d){const f=[];for(let g=0;g<n.length;g++){const x=n[g];let b;const S=f.length;let E=0;for(let I=0;I<x.length-1;I++){let D=x[I],z=x[I+1],F=0;const $=E;let H,ee;d&&(F=Math.hypot(z.x-D.x,z.y-D.y),E+=F,H=D,ee=z),D.x<e&&z.x<e||(D.x<e?D=new dt(e,D.y+(e-D.x)/(z.x-D.x)*(z.y-D.y))._round():z.x<e&&(z=new dt(e,D.y+(e-D.x)/(z.x-D.x)*(z.y-D.y))._round()),D.y<i&&z.y<i||(D.y<i?D=new dt(D.x+(i-D.y)/(z.y-D.y)*(z.x-D.x),i)._round():z.y<i&&(z=new dt(D.x+(i-D.y)/(z.y-D.y)*(z.x-D.x),i)._round()),D.x>=o&&z.x>=o||(D.x>=o?D=new dt(o,D.y+(o-D.x)/(z.x-D.x)*(z.y-D.y))._round():z.x>=o&&(z=new dt(o,D.y+(o-D.x)/(z.x-D.x)*(z.y-D.y))._round()),D.y>=l&&z.y>=l||(D.y>=l?D=new dt(D.x+(l-D.y)/(z.y-D.y)*(z.x-D.x),l)._round():z.y>=l&&(z=new dt(D.x+(l-D.y)/(z.y-D.y)*(z.x-D.x),l)._round()),b&&D.equals(b[b.length-1])||(b=[D],f.push(b),d&&d.push({progress:{min:$+uw(H,ee,D)*F,max:1},parentIndex:g,prevPoint:H,nextPoint:ee})),b.push(z),d&&(d[d.length-1].progress.max=$+uw(H,ee,z)*F,d[d.length-1].nextPoint=ee)))))}if(d&&E>0)for(let I=S;I<f.length;I++)d[I].progress.min/=E,d[I].progress.max/=E}return f}function VC(n,e,i,o,l){if(n.length<2)return void o.push(n);const d=[];for(;e.valid();){const[b,S]=e.get();for(let E=0;E<n.length-1;E++){const I=n[E],D=n[E+1],z=Ln(I,D,b,S);if(z){const[F]=z,$=new dt(Nt(I.x,D.x,F),Nt(I.y,D.y,F));d.push({t:E+F,distance:0,point:$})}}e.next()}if(d.length===0)return void o.push(n);d.sort((b,S)=>b.t-S.t);let f=0,g=0,x=[];for(o.push(x);f!==n.length;){if(g===d.length){for(;f!==n.length;)x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++;break}d[g].t<=f?(x.length!==0&&x[x.length-1].equals(d[g].point)||x.push(d[g].point),Math.trunc(d[g].t),g++):(x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++)}}function uw(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Df(n,e){return n.x*e.x+n.y*e.y}function hw(n,e){if(n.length===1){let i=0;const o=e[i++];let l;for(;!l||o.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const d=e[i],f=n[0],g=l.sub(o),x=d.sub(o),b=f.sub(o),S=Df(g,g),E=Df(g,x),I=Df(x,x),D=Df(b,g),z=Df(b,x),F=S*I-E*E,$=(I*D-E*z)/F,H=(S*z-E*D)/F,ee=o.z*(1-$-H)+l.z*$+d.z*H;if(isFinite(ee))return ee}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function dw(n,e,i,o,l,d,f,g){const x=f*l.getElevationAt(n,e,!0,!0),b=d[0]!==0,S=b?d[1]===0?f*(d[0]/7-450):f*function(E,I,D){const z=Math.floor(I[0]/8),F=Math.floor(I[1]/8),$=10*(I[0]-8*z),H=10*(I[1]-8*F),ee=E.getElevationAt(z,F,!0,!0),K=E.getMeterToDEM(D),N=Math.floor(.5*($*K-1)),Z=Math.floor(.5*(H*K-1)),Q=E.tileCoordToPixel(z,F),re=2*N+1,pe=2*Z+1,_e=function(Ye,rt,Oe,Ke,Le){return[Ye.getElevationAtPixel(rt,Oe,!0),Ye.getElevationAtPixel(rt+Le,Oe,!0),Ye.getElevationAtPixel(rt,Oe+Le,!0),Ye.getElevationAtPixel(rt+Ke,Oe+Le,!0)]}(E,Q.x-N,Q.y-Z,re,pe),xe=Math.abs(_e[0]-_e[1]),Te=Math.abs(_e[2]-_e[3]),Be=Math.abs(_e[0]-_e[2])+Math.abs(_e[1]-_e[3]),Je=Math.min(.25,.5*K*(xe+Te)/re),Ze=Math.min(.25,.5*K*Be/pe);return ee+Math.max(Je*$,Ze*H)}(l,d,g):x;return{base:x+(i===0?-1:i),top:b?Math.max(S+o,x+i+2):x+o}}const jC=Ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),UC=Ni([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$C}=jC,GC=Ni([{name:"a_packed",components:3,type:"Float32"}]),{members:HC}=GC,qC=Ni([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:WC}=qC;class fw{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Kl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Lt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const l=[];let d=e.length%2==1?-e[e.length-1]*o:0,f=e[0]*o,g=!0;l.push({left:d,right:f,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){g=!g;const S=e[b];d=x*o,x+=S,f=x*o,l.push({left:d,right:f,isDash:g,zeroLength:S===0})}return l}addRoundDash(e,i,o){const l=i/2;for(let d=-o;d<=o;d++){const f=this.width*(this.nextRow+o+d);let g=0,x=e[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++g]);const S=Math.abs(b-x.left),E=Math.abs(b-x.right),I=Math.min(S,E);let D;const z=d/o*(l+1);if(x.isDash){const F=l-Math.abs(z);D=Math.sqrt(I*I+F*F)}else D=l-Math.sqrt(I*I+z*z);this.image.data[f+b]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const b=e[x],S=e[x+1];b.zeroLength?e.splice(x,1):S&&S.isDash===b.isDash&&(S.left=b.left,e.splice(x,1))}const o=e[0],l=e[e.length-1];o.isDash===l.isDash&&(o.left=l.left-this.width,l.right=o.right+this.width);const d=this.width*this.nextRow;let f=0,g=e[f];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++f]);const b=Math.abs(x-g.left),S=Math.abs(x-g.right),E=Math.min(b,S);this.image.data[d+x]=Math.max(0,Math.min(255,(g.isDash?E:-E)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const l=i==="round",d=l?7:0,f=2*d+1;if(this.nextRow+f>this.height)return vi("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let S=0;S<e.length;S++)e[S]<0&&(vi("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),g+=e[S];if(g!==0){const S=this.width/g,E=this.getDashRanges(e,this.width,S);l?this.addRoundDash(E,S,d):this.addRegularDash(E,i==="square"?.5*S:0)}const x=this.nextRow+d;this.nextRow+=f;const b={tl:[x,d],br:[g,0]};return this.positions[o]=b,b}}Tt(fw,"LineAtlas");const ZC=Yl.VectorTileFeature.types,XC=Math.cos(Math.PI/180*37.5),KC=Math.cos(Math.PI/180*5);class Gy{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new uf,this.layoutVertexArray2=new Ao,this.patternVertexArray=new Ao,this.indexArray=new Ar,this.programConfigurations=new rl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new kn,this.maxLineLength=0,this.zOffsetVertexArray=new Ao,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:pt/64}updateFootprints(e,i){}populate(e,i,o,l){this.hasPattern=Cy("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Se(o);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const I=this.layers[0].layout.get("line-z-offset"),D=I.isConstant()&&!I.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&f==="none"&&vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const x=[];for(const{feature:I,id:D,index:z,sourceLayerIndex:F}of e){const $=this.layers[0]._featureFilter.needGeometry,H=Ot(I,$);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),H,o))continue;const ee=d?d.evaluate(H,{},o):void 0,K={id:D,properties:I.properties,type:I.type,sourceLayerIndex:F,index:z,geometry:$?H.geometry:At(I,o,l),patterns:{},sortKey:ee};x.push(K)}d&&x.sort((I,D)=>I.sortKey-D.sortKey);const{lineAtlas:b,featureIndex:S}=i,E=this.addConstantDashes(b);for(const I of x){const{geometry:D,index:z,sourceLayerIndex:F}=I;if(E&&this.addFeatureDashes(I,b),this.hasPattern){const $=My("line",this.layers,I,this.zoom,this.pixelRatio,i);this.patternFeatures.push($)}else this.addFeature(I,D,z,o,b.positions,i.availableImages,i.brightness,i.elevationFeatures);S.insert(e[z].feature,D,z,F,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const l=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,g=l.value;if(!g)continue;e.addDash(g,f)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let g,x;if(d.kind==="constant"){if(g=d.value,!g)continue}else g=d.evaluate({zoom:o},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:o},e),i.addDash(g,x),e.patterns[l.id]=[i.getKey(g,x)]}}update(e,i,o,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}addFeatures(e,i,o,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,o,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,HC)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,WC)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,UC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$C),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,l,d,f,g,x){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),E=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),D=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const z=this.layers[0].paint.get("line-width").value;if(z.kind!=="constant"&&z.isLineProgressConstant===!1&&(this.variableWidthValue=z),this.elevationType==="road"){const F=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,l,x,S,E,I,D)){const[$,H]=this.clipRuntimeLinesToTile(i,1);for(let ee=0;ee<$.length;ee++){const K=$[ee],N=H[ee],Z={progress:{min:N.progress.min,max:N.progress.max},nextDir:this.computeSegNextDir(N,K),prevDir:this.computeSegPrevDir(N,K)};this.addLine(K,e,l,S,E,I,D,Z)}this.fillNonElevatedRoadSegment(F)}}else for(const F of i)this.addLine(F,e,l,S,E,I,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,f,l,g)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return tg(e,-i,-i,pt+i,pt+i)}clipRuntimeLinesToTile(e,i){const o=[];return[tg(e,-i,-i,pt+i,pt+i,o),o]}addElevatedRoadFeature(e,i,o,l,d,f,g,x){const b=[],S=Ly.getElevationFeature(e,l);if(S){const E=this.clipLinesToTile(i,1),I=this.prepareElevatedLines(E,S,o);for(const D of I)b.push({geometry:D,elevation:S,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(b.length===0)return!1;for(const E of b){const I=this.layoutVertexArray.length;this.addLine(E.geometry,e,o,d,f,g,x);const D=new Ib(o,E.elevationTileID);if(E.elevation)for(let z=I;z<this.layoutVertexArray.length;z++){const F=new dt(this.layoutVertexArray.int16[6*z]>>1,this.layoutVertexArray.int16[6*z+1]>>1),$=D.pointElevation(F,E.elevation,.05);this.updateHeightRange($),this.zOffsetVertexArray.emplaceBack($,0,0)}else this.fillNonElevatedRoadSegment(I)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const l=[],d=1/Se(o);for(const f of e)VC(f,new Ab(i,d),0,l);return l}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,l,d,f,g,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=l==="none";this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const S=x&&x.progress.min>0,E=x&&x.progress.max<1;if(this.lineClips){let pe={min:this.lineClips.start,max:this.lineClips.end},_e=1;if(x){const Be=this.lineClips.end-this.lineClips.start;pe=function(Je,Ze,Ye){return{min:zr(Je.min,Ze,Ye),max:zr(Je.max,Ze,Ye)}}(x.progress,{min:0,max:1},pe),Be>0&&(_e=(pe.max-pe.min)/Be)}const xe=+i.properties.mapbox_clip_feature_len,Te=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(xe)||Number.isNaN(Te)){for(let Je=0;Je<e.length-1;Je++)this.totalDistance+=e[Je].dist(e[Je+1]);const Be=this.totalDistance/(pe.max-pe.min);this.totalFeatureLength=Number.isFinite(Be)?Be:0,this.lineClips.start=pe.min,this.lineClips.end=pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=xe,this.distance=Te*_e,this.lineClips.start=pe.min,this.lineClips.end=pe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const I=ZC[i.type]==="Polygon";let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let z=0;for(;z<D-1&&e[z].equals(e[z+1]);)z++;if(D<(I?3:2))return;l==="bevel"&&(f=1.05);const F=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let $,H,ee,K,N,Z,Q,re;x&&x.prevDir&&(Z=x.prevDir.perp()),x&&x.nextDir&&(Q=x.nextDir.perp()),this.e1=this.e2=-1,I&&($=e[D-2],N=e[z].sub($)._unit()._perp());for(let pe=z;pe<D;pe++){if(ee=pe===D-1?I?e[z+1]:void 0:e[pe+1],ee&&e[pe].equals(ee))continue;N&&(K=N),$&&(H=$),$=e[pe],re=this.evaluateLineProgressFeatures(H?H.dist($):0),N=ee?ee.sub($)._unit()._perp():K,K=K||N;const _e=H&&ee;let xe=_e?l:I||b?"butt":d;const Te=K.x*N.x+K.y*N.y;if(b){const Le=function(Fe){if(Fe.patternJoinNone){const at=Fe.segmentPoints.length/2,lt=Fe.lineSoFar-Fe.segmentStart;for(let kt=0;kt<at;++kt){const Et=Fe.segmentPoints[2*kt+1],gt=Math.round(Fe.segmentPoints[2*kt])+.5+.25*Et;Fe.patternVertexArray.emplaceBack(gt,lt,Fe.segmentStart),Fe.patternVertexArray.emplaceBack(gt,lt,Fe.segmentStart)}Fe.segmentPoints.length=0}Fe.e1=Fe.e2=-1};if(_e&&Te<KC){this.updateDistance(H,$),this.addCurrentVertex($,K,1,1,F,re),Le(this),this.addCurrentVertex($,N,-1,-1,F,re);continue}if(H){if(!ee){this.updateDistance(H,$),this.addCurrentVertex($,K,1,1,F,re),Le(this);continue}xe="miter"}}let Be=K.add(N);Be.x===0&&Be.y===0||Be._unit();const Je=Be.x*N.x+Be.y*N.y,Ze=Je!==0?1/Je:1/0,Ye=2*Math.sqrt(2-2*Je),rt=Je<XC&&H&&ee,Oe=K.x*N.y-K.y*N.x>0,Ke=this.overscaling<=16?15*pt/(512*this.overscaling):0;if(_e&&xe==="round"){if(Ze<g)xe="miter";else if(Ze<=2){const Le=Hy($,-10,pt+10);xe=this.elevationType==="offset"&&(Le||this.hasCrossSlope)?"miter":"fakeround"}}if(xe==="miter"&&Ze>f&&(xe="bevel"),xe==="bevel"&&(Ze>2&&(xe="flipbevel"),Ze<f&&(xe="miter")),H&&!(xe==="miter"&&rt)&&this.updateDistance(H,$),xe==="miter")if(rt){const Le=$.dist(H);if(Le>2*Ke){const at=$.sub($.sub(H)._mult(Ke/Le)._round());this.updateDistance(H,at),this.addCurrentVertex(at,K,0,0,F,re),H=at}this.updateDistance(H,$),Be._mult(Ze),this.addCurrentVertex($,Be,0,0,F,re);const Fe=$.dist(ee);if(Fe>2*Ke){const at=$.add(ee.sub($)._mult(Ke/Fe)._round());this.updateDistance($,at),this.addCurrentVertex(at,N,0,0,F,re),$=at}}else Be._mult(Ze),this.addCurrentVertex($,Be,0,0,F,re);else if(xe==="flipbevel"){if(Ze>100)Be=N.mult(-1);else{const Le=Ze*K.add(N).mag()/K.sub(N).mag();Be._perp()._mult(Le*(Oe?-1:1))}this.addCurrentVertex($,Be,0,0,F,re),this.addCurrentVertex($,Be.mult(-1),0,0,F,re)}else if(xe==="bevel"||xe==="fakeround"){re!=null&&H&&this.addCurrentVertex($,Q||K,-1,-1,F,re);const Le=$.dist(H)<=2*Ke&&xe!=="bevel",Fe=Be.mult(Oe?1:-1);Fe._mult(Ze);const at=N.mult(Oe?-1:1),lt=K.mult(Oe?-1:1),kt=this.evaluateLineProgressFeatures(this.distance);if(re==null&&(this.addHalfVertex($,Fe.x,Fe.y,!1,!Oe,0,F,kt),Le||this.addHalfVertex($,Fe.x+2*lt.x,Fe.y+2*lt.y,!1,Oe,0,F,kt)),xe==="fakeround"){const Et=Math.round(180*Ye/Math.PI/20);this.addHalfVertex($,lt.x,lt.y,!1,Oe,0,F,kt);for(let gt=0;gt<Et;gt++){let st=gt/Et;if(st!==.5){const Pt=st-.5;st+=st*Pt*(st-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*Pt*Pt+(.848013+Te*(.215638*Te-1.06021)))}const Zt=at.sub(lt)._mult(st)._add(lt)._unit();this.addHalfVertex($,Zt.x,Zt.y,!1,Oe,0,F,kt)}this.addHalfVertex($,at.x,at.y,!1,Oe,0,F,kt)}Le||re!=null||this.addHalfVertex($,Fe.x+2*at.x,Fe.y+2*at.y,!1,Oe,0,F,kt),re!=null&&ee&&this.addCurrentVertex($,Z||N,1,1,F,re)}else if(xe==="butt")this.addCurrentVertex($,Be,0,0,F,re);else if(xe==="square"){if(!H){const Le=S?0:-1;this.addCurrentVertex($,Be,Le,Le,F,re)}if(this.addCurrentVertex($,Be,0,0,F,re),H){const Le=E?0:1;this.addCurrentVertex($,Be,Le,Le,F,re)}}else if(xe==="round"){if(H){const Le=!_e&&Q?Q:K;this.addCurrentVertex($,Le,0,0,F,re),!_e&&E||this.addCurrentVertex($,Le,1,1,F,re,!0)}if(ee){const Le=!_e&&Z?Z:N;!_e&&S||this.addCurrentVertex($,Le,-1,-1,F,re,!0),this.addCurrentVertex($,Le,0,0,F,re)}}}}addVerticesTo(e,i,o,l,d,f,g,x,b,S){const E=(i.w-e.w)/this.tessellationStep|0;let I=0;const D=this.scaledDistance;if(E>1){this.lineSoFar=e.w;const F=(i.x-e.x)/E,$=(i.y-e.y)/E,H=(i.z-e.z)/E,ee=(i.w-e.w)/E;for(let K=1;K<E;++K){e.x+=F,e.y+=$,e.z+=H,this.lineSoFar+=ee,I+=ee;const N=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,o,l,S,!1,g,b,N),this.addHalfVertex(e,d,f,S,!0,-x,b,N)}}this.lineSoFar=i.w,this.scaledDistance=D;const z=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,l,S,!1,g,b,z),this.addHalfVertex(i,d,f,S,!0,-x,b,z)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):vi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,l,d,f,g=!1){const x=i.x+i.y*o,b=i.y-i.x*o,S=i.y*l-i.x,E=-i.y-i.x*l;if(f!=null){const I=this.elevationType==="offset",D=-10,z=pt+10,F=f.zOffset,$=new aw(e.x,e.y,F,this.lineSoFar),H=!!I&&Hy(e,D,z),ee=this.lineSoFar,K=this.distance;if(this.currentVertex)if(H){const N=this.currentVertexIsOutside,Z=this.currentVertex,Q=new aw(e.x,e.y,F,this.lineSoFar);if(cw(Z,Q,D,z),!Hy(Q,D,z)){if(N){this.e1=this.e2=-1,this.distance-=Z.dist($),this.lineSoFar=Z.w;const re=this.evaluateLineProgressFeatures(Z.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Z,x,b,g,!1,o,d,re),this.addHalfVertex(Z,S,E,g,!0,-l,d,re),this.prevDistance=this.distance}this.distance=this.prevDistance+Z.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Z,Q,x,b,S,E,o,l,d,g),this.distance=K,this.scaledDistance=this.distance/this.totalDistance}}else{const N=this.currentVertex;if(this.currentVertexIsOutside){cw(N,$,D,z),this.e1=this.e2=-1,this.distance-=N.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=N.w;const Z=this.evaluateLineProgressFeatures(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,x,b,g,!1,o,d,Z),this.addHalfVertex(N,S,E,g,!0,-l,d,Z),this.prevDistance=this.distance,this.distance=K,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(N,$,x,b,S,E,o,l,d,g)}else H||(this.addHalfVertex(e,x,b,g,!1,o,d,f),this.addHalfVertex(e,S,E,g,!0,-l,d,f));this.currentVertex=$,this.currentVertexIsOutside=H,this.lineSoFar=ee}else this.addHalfVertex(e,x,b,g,!1,o,d,f),this.addHalfVertex(e,S,E,g,!0,-l,d,f)}addHalfVertex({x:e,y:i},o,l,d,f,g,x,b){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*o)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const E=Nt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,E)}const S=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),x.primitiveLength++),f?this.e2=S:this.e1=S,b!=null&&this.zOffsetVertexArray.emplaceBack(b.zOffset,b.variableWidth,b.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Hy(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let pw,mw;function gw(n,e,i){return e*(pt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Tt(Gy,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const _w=(n,e,i)=>(1-i)*n+i*e;function yw(n,e){return 1/gw(n,1,e.tileZoom)}function xw(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const vw=n=>{const e=[];bw(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",l=!!n.paint.get("line-pattern").constantOr(1);return o&&l&&e.push("LINE_JOIN_NONE"),e};function bw(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let qy;const ww=()=>qy||(qy={layout:pw||(pw=new $n({"line-cap":new wt(Ce.layout_line["line-cap"]),"line-join":new wt(Ce.layout_line["line-join"]),"line-miter-limit":new ut(Ce.layout_line["line-miter-limit"]),"line-round-limit":new ut(Ce.layout_line["line-round-limit"]),"line-sort-key":new wt(Ce.layout_line["line-sort-key"]),"line-z-offset":new wt(Ce.layout_line["line-z-offset"]),"line-elevation-reference":new ut(Ce.layout_line["line-elevation-reference"]),"line-cross-slope":new ut(Ce.layout_line["line-cross-slope"]),visibility:new ut(Ce.layout_line.visibility),"line-width-unit":new ut(Ce.layout_line["line-width-unit"])})),paint:mw||(mw=new $n({"line-opacity":new wt(Ce.paint_line["line-opacity"]),"line-color":new wt(Ce.paint_line["line-color"]),"line-translate":new ut(Ce.paint_line["line-translate"]),"line-translate-anchor":new ut(Ce.paint_line["line-translate-anchor"]),"line-width":new wt(Ce.paint_line["line-width"]),"line-gap-width":new wt(Ce.paint_line["line-gap-width"]),"line-offset":new wt(Ce.paint_line["line-offset"]),"line-blur":new wt(Ce.paint_line["line-blur"]),"line-dasharray":new wt(Ce.paint_line["line-dasharray"]),"line-pattern":new wt(Ce.paint_line["line-pattern"]),"line-pattern-cross-fade":new ut(Ce.paint_line["line-pattern-cross-fade"]),"line-gradient":new Qa(Ce.paint_line["line-gradient"]),"line-trim-offset":new ut(Ce.paint_line["line-trim-offset"]),"line-trim-fade-range":new ut(Ce.paint_line["line-trim-fade-range"]),"line-trim-color":new ut(Ce.paint_line["line-trim-color"]),"line-emissive-strength":new ut(Ce.paint_line["line-emissive-strength"]),"line-border-width":new wt(Ce.paint_line["line-border-width"]),"line-border-color":new wt(Ce.paint_line["line-border-color"]),"line-occlusion-opacity":new ut(Ce.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},qy);class YC extends wt{possiblyEvaluate(e,i){return i=new nn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,l){return i=ze({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,l)}}let zf;function Tw(n,e){return e>0?e+2*n:n}const JC=Ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),QC=Ni([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),eM=Ni([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tM=Ni([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),iM=Ni([{name:"a_texb",components:2,type:"Uint16"}]),nM=Ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),rM=Ni([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sw=Ni([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sM=Ni([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ni([{name:"triangle",components:3,type:"Uint16"}]),Ni([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ni([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ni([{type:"Float32",name:"offsetX"}]),Ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var kr=24;function oM(n,e,i){return n.sections.forEach(o=>{o.text=function(l,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),Qs.applyArabicShaping&&(l=Qs.applyArabicShaping(l)),l}(o.text,e,i)}),n}const Lf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function aM(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function lM(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var Ew,Wy,Aw,Zy={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function cM(){return Ew||(Ew=1,Zy.read=function(n,e,i,o,l){var d,f,g=8*l-o-1,x=(1<<g)-1,b=x>>1,S=-7,E=i?l-1:0,I=i?-1:1,D=n[e+E];for(E+=I,d=D&(1<<-S)-1,D>>=-S,S+=g;S>0;d=256*d+n[e+E],E+=I,S-=8);for(f=d&(1<<-S)-1,d>>=-S,S+=o;S>0;f=256*f+n[e+E],E+=I,S-=8);if(d===0)d=1-b;else{if(d===x)return f?NaN:1/0*(D?-1:1);f+=Math.pow(2,o),d-=b}return(D?-1:1)*f*Math.pow(2,d-o)},Zy.write=function(n,e,i,o,l,d){var f,g,x,b=8*d-l-1,S=(1<<b)-1,E=S>>1,I=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=o?0:d-1,z=o?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=S):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+E>=1?I/x:I*Math.pow(2,1-E))*x>=2&&(f++,x/=2),f+E>=S?(g=0,f=S):f+E>=1?(g=(e*x-1)*Math.pow(2,l),f+=E):(g=e*Math.pow(2,E-1)*Math.pow(2,l),f=0));l>=8;n[i+D]=255&g,D+=z,g/=256,l-=8);for(f=f<<l|g,b+=l;b>0;n[i+D]=255&f,D+=z,f/=256,b-=8);n[i+D-z]|=128*F}),Zy}function Iw(){if(Aw)return Wy;Aw=1,Wy=e;var n=cM();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,l=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function f(N,Z,Q){return Q?4294967296*Z+(N>>>0):4294967296*(Z>>>0)+(N>>>0)}function g(N,Z,Q){var re=Z<=16383?1:Z<=2097151?2:Z<=268435455?3:Math.floor(Math.log(Z)/(7*Math.LN2));Q.realloc(re);for(var pe=Q.pos-1;pe>=N;pe--)Q.buf[pe+re]=Q.buf[pe]}function x(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeVarint(N[Q])}function b(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeSVarint(N[Q])}function S(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeFloat(N[Q])}function E(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeDouble(N[Q])}function I(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeBoolean(N[Q])}function D(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeFixed32(N[Q])}function z(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeSFixed32(N[Q])}function F(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeFixed64(N[Q])}function $(N,Z){for(var Q=0;Q<N.length;Q++)Z.writeSFixed64(N[Q])}function H(N,Z){return(N[Z]|N[Z+1]<<8|N[Z+2]<<16)+16777216*N[Z+3]}function ee(N,Z,Q){N[Q]=Z,N[Q+1]=Z>>>8,N[Q+2]=Z>>>16,N[Q+3]=Z>>>24}function K(N,Z){return(N[Z]|N[Z+1]<<8|N[Z+2]<<16)+(N[Z+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,Z,Q){for(Q=Q||this.length;this.pos<Q;){var re=this.readVarint(),pe=re>>3,_e=this.pos;this.type=7&re,N(pe,Z,this),this.pos===_e&&this.skip(re)}return Z},readMessage:function(N,Z){return this.readFields(N,Z,this.readVarint()+this.pos)},readFixed32:function(){var N=H(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=K(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=H(this.buf,this.pos)+H(this.buf,this.pos+4)*i;return this.pos+=8,N},readSFixed64:function(){var N=H(this.buf,this.pos)+K(this.buf,this.pos+4)*i;return this.pos+=8,N},readFloat:function(){var N=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var Z,Q,re=this.buf;return Z=127&(Q=re[this.pos++]),Q<128?Z:(Z|=(127&(Q=re[this.pos++]))<<7,Q<128?Z:(Z|=(127&(Q=re[this.pos++]))<<14,Q<128?Z:(Z|=(127&(Q=re[this.pos++]))<<21,Q<128?Z:function(pe,_e,xe){var Te,Be,Je=xe.buf;if(Te=(112&(Be=Je[xe.pos++]))>>4,Be<128||(Te|=(127&(Be=Je[xe.pos++]))<<3,Be<128)||(Te|=(127&(Be=Je[xe.pos++]))<<10,Be<128)||(Te|=(127&(Be=Je[xe.pos++]))<<17,Be<128)||(Te|=(127&(Be=Je[xe.pos++]))<<24,Be<128)||(Te|=(1&(Be=Je[xe.pos++]))<<31,Be<128))return f(pe,Te,_e);throw new Error("Expected varint not more than 10 bytes")}(Z|=(15&(Q=re[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,Z=this.pos;return this.pos=N,N-Z>=12&&l?function(Q,re,pe){return l.decode(Q.subarray(re,pe))}(this.buf,Z,N):function(Q,re,pe){for(var _e="",xe=re;xe<pe;){var Te,Be,Je,Ze=Q[xe],Ye=null,rt=Ze>239?4:Ze>223?3:Ze>191?2:1;if(xe+rt>pe)break;rt===1?Ze<128&&(Ye=Ze):rt===2?(192&(Te=Q[xe+1]))==128&&(Ye=(31&Ze)<<6|63&Te)<=127&&(Ye=null):rt===3?(Be=Q[xe+2],(192&(Te=Q[xe+1]))==128&&(192&Be)==128&&((Ye=(15&Ze)<<12|(63&Te)<<6|63&Be)<=2047||Ye>=55296&&Ye<=57343)&&(Ye=null)):rt===4&&(Be=Q[xe+2],Je=Q[xe+3],(192&(Te=Q[xe+1]))==128&&(192&Be)==128&&(192&Je)==128&&((Ye=(15&Ze)<<18|(63&Te)<<12|(63&Be)<<6|63&Je)<=65535||Ye>=1114112)&&(Ye=null)),Ye===null?(Ye=65533,rt=1):Ye>65535&&(Ye-=65536,_e+=String.fromCharCode(Ye>>>10&1023|55296),Ye=56320|1023&Ye),_e+=String.fromCharCode(Ye),xe+=rt}return _e}(this.buf,Z,N)},readBytes:function(){var N=this.readVarint()+this.pos,Z=this.buf.subarray(this.pos,N);return this.pos=N,Z},readPackedVarint:function(N,Z){if(this.type!==e.Bytes)return N.push(this.readVarint(Z));var Q=d(this);for(N=N||[];this.pos<Q;)N.push(this.readVarint(Z));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var Z=d(this);for(N=N||[];this.pos<Z;)N.push(this.readSFixed64());return N},skip:function(N){var Z=7&N;if(Z===e.Varint)for(;this.buf[this.pos++]>127;);else if(Z===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Z===e.Fixed32)this.pos+=4;else{if(Z!==e.Fixed64)throw new Error("Unimplemented type: "+Z);this.pos+=8}},writeTag:function(N,Z){this.writeVarint(N<<3|Z)},realloc:function(N){for(var Z=this.length||16;Z<this.pos+N;)Z*=2;if(Z!==this.length){var Q=new Uint8Array(Z);Q.set(this.buf),this.buf=Q,this.length=Z}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),ee(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),ee(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),ee(this.buf,-1&N,this.pos),ee(this.buf,Math.floor(N*o),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),ee(this.buf,-1&N,this.pos),ee(this.buf,Math.floor(N*o),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(Z,Q){var re,pe;if(Z>=0?(re=Z%4294967296|0,pe=Z/4294967296|0):(pe=~(-Z/4294967296),4294967295^(re=~(-Z%4294967296))?re=re+1|0:(re=0,pe=pe+1|0)),Z>=18446744073709552e3||Z<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Q.realloc(10),function(_e,xe,Te){Te.buf[Te.pos++]=127&_e|128,_e>>>=7,Te.buf[Te.pos++]=127&_e|128,_e>>>=7,Te.buf[Te.pos++]=127&_e|128,_e>>>=7,Te.buf[Te.pos++]=127&_e|128,Te.buf[Te.pos]=127&(_e>>>=7)}(re,0,Q),function(_e,xe){var Te=(7&_e)<<4;xe.buf[xe.pos++]|=Te|((_e>>>=3)?128:0),_e&&(xe.buf[xe.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(xe.buf[xe.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(xe.buf[xe.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(xe.buf[xe.pos++]=127&_e|((_e>>>=7)?128:0),_e&&(xe.buf[xe.pos++]=127&_e)))))}(pe,Q)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var Z=this.pos;this.pos=function(re,pe,_e){for(var xe,Te,Be=0;Be<pe.length;Be++){if((xe=pe.charCodeAt(Be))>55295&&xe<57344){if(!Te){xe>56319||Be+1===pe.length?(re[_e++]=239,re[_e++]=191,re[_e++]=189):Te=xe;continue}if(xe<56320){re[_e++]=239,re[_e++]=191,re[_e++]=189,Te=xe;continue}xe=Te-55296<<10|xe-56320|65536,Te=null}else Te&&(re[_e++]=239,re[_e++]=191,re[_e++]=189,Te=null);xe<128?re[_e++]=xe:(xe<2048?re[_e++]=xe>>6|192:(xe<65536?re[_e++]=xe>>12|224:(re[_e++]=xe>>18|240,re[_e++]=xe>>12&63|128),re[_e++]=xe>>6&63|128),re[_e++]=63&xe|128)}return _e}(this.buf,N,this.pos);var Q=this.pos-Z;Q>=128&&g(Z,Q,this),this.pos=Z-1,this.writeVarint(Q),this.pos+=Q},writeFloat:function(N){this.realloc(4),n.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),n.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var Z=N.length;this.writeVarint(Z),this.realloc(Z);for(var Q=0;Q<Z;Q++)this.buf[this.pos++]=N[Q]},writeRawMessage:function(N,Z){this.pos++;var Q=this.pos;N(Z,this);var re=this.pos-Q;re>=128&&g(Q,re,this),this.pos=Q-1,this.writeVarint(re),this.pos+=re},writeMessage:function(N,Z,Q){this.writeTag(N,e.Bytes),this.writeRawMessage(Z,Q)},writePackedVarint:function(N,Z){Z.length&&this.writeMessage(N,x,Z)},writePackedSVarint:function(N,Z){Z.length&&this.writeMessage(N,b,Z)},writePackedBoolean:function(N,Z){Z.length&&this.writeMessage(N,I,Z)},writePackedFloat:function(N,Z){Z.length&&this.writeMessage(N,S,Z)},writePackedDouble:function(N,Z){Z.length&&this.writeMessage(N,E,Z)},writePackedFixed32:function(N,Z){Z.length&&this.writeMessage(N,D,Z)},writePackedSFixed32:function(N,Z){Z.length&&this.writeMessage(N,z,Z)},writePackedFixed64:function(N,Z){Z.length&&this.writeMessage(N,F,Z)},writePackedSFixed64:function(N,Z){Z.length&&this.writeMessage(N,$,Z)},writeBytesField:function(N,Z){this.writeTag(N,e.Bytes),this.writeBytes(Z)},writeFixed32Field:function(N,Z){this.writeTag(N,e.Fixed32),this.writeFixed32(Z)},writeSFixed32Field:function(N,Z){this.writeTag(N,e.Fixed32),this.writeSFixed32(Z)},writeFixed64Field:function(N,Z){this.writeTag(N,e.Fixed64),this.writeFixed64(Z)},writeSFixed64Field:function(N,Z){this.writeTag(N,e.Fixed64),this.writeSFixed64(Z)},writeVarintField:function(N,Z){this.writeTag(N,e.Varint),this.writeVarint(Z)},writeSVarintField:function(N,Z){this.writeTag(N,e.Varint),this.writeSVarint(Z)},writeStringField:function(N,Z){this.writeTag(N,e.Bytes),this.writeString(Z)},writeFloatField:function(N,Z){this.writeTag(N,e.Fixed32),this.writeFloat(Z)},writeDoubleField:function(N,Z){this.writeTag(N,e.Fixed64),this.writeDouble(Z)},writeBooleanField:function(N,Z){this.writeVarintField(N,!!Z)}},Wy}var ig=Kr(Iw());const Xy=3;function uM(n,e,i){e.glyphs=[],n===1&&i.readMessage(hM,e)}function hM(n,e,i){if(n===3){const{id:o,bitmap:l,width:d,height:f,left:g,top:x,advance:b}=i.readMessage(dM,{});e.glyphs.push({id:o,bitmap:new Kl({width:d+2*Xy,height:f+2*Xy},l),metrics:{width:d,height:f,left:g,top:x,advance:b}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function dM(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const fM=Xy,Gs={horizontal:1,vertical:2,horizontalOnly:3};class kf{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new kf;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new kf;return i.image=e,i}}class Ph{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const l=new Ph;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?l.addImageSection(f,o):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let l="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,g=i.charCodeAt(d-1)||null;l+=!o&&(f&&ym(f)&&!Lf[i[d+1]]||g&&ym(g)&&!Lf[i[d-1]])||!Lf[i[d]]?i[d]:Lf[i[d]]}return l}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&ng[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&ng[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Ph;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(kf.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void vi("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(kf.forImage(o)),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ky(n,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F=1){const $=Ph.fromFeature(n,l,F);E===Gs.vertical&&$.verticalizePunctuation(I);let H=[];const ee=function(re,pe,_e,xe,Te,Be){if(!re)return[];const Je=[],Ze=function(Ke,Le,Fe,at,lt,kt){let Et=0;for(let gt=0;gt<Ke.length();gt++){const st=Ke.getSection(gt);Et+=Cw(Ke.getCodePoint(gt),st,at,lt,Le,kt)}return Et/Math.max(1,Math.ceil(Et/Fe))}(re,pe,_e,xe,Te,Be),Ye=re.text.indexOf("​")>=0;let rt=0;for(let Ke=0;Ke<re.length();Ke++){const Le=re.getSection(Ke),Fe=re.getCodePoint(Ke);if(ng[Fe]||(rt+=Cw(Fe,Le,xe,Te,pe,Be)),Ke<re.length()-1){const at=!((Oe=Fe)<11904||!(jt["Bopomofo Extended"](Oe)||jt.Bopomofo(Oe)||jt["CJK Compatibility Forms"](Oe)||jt["CJK Compatibility Ideographs"](Oe)||jt["CJK Compatibility"](Oe)||jt["CJK Radicals Supplement"](Oe)||jt["CJK Strokes"](Oe)||jt["CJK Symbols and Punctuation"](Oe)||jt["CJK Unified Ideographs Extension A"](Oe)||jt["CJK Unified Ideographs"](Oe)||jt["Enclosed CJK Letters and Months"](Oe)||jt["Halfwidth and Fullwidth Forms"](Oe)||jt.Hiragana(Oe)||jt["Ideographic Description Characters"](Oe)||jt["Kangxi Radicals"](Oe)||jt["Katakana Phonetic Extensions"](Oe)||jt.Katakana(Oe)||jt["Vertical Forms"](Oe)||jt["Yi Radicals"](Oe)||jt["Yi Syllables"](Oe)));(pM[Fe]||at||Le.image)&&Je.push(Pw(Ke+1,rt,Ze,Je,mM(Fe,re.getCodePoint(Ke+1),at&&Ye),!1))}}var Oe;return Rw(Pw(re.length(),rt,Ze,Je,0,!0))}($,b,d,e,o,D),{processBidirectionalText:K,processStyledBidirectionalText:N}=Qs;if(K&&$.sections.length===1){const re=K($.toString(),ee);for(const pe of re){const _e=new Ph;_e.text=pe,_e.sections=$.sections;for(let xe=0;xe<pe.length;xe++)_e.sectionIndex.push(0);H.push(_e)}}else if(N){const re=N($.text,$.sectionIndex,ee);for(const pe of re){const _e=new Ph;_e.text=pe[0],_e.sectionIndex=pe[1],_e.sections=$.sections,H.push(_e)}}else H=function(re,pe){const _e=[],xe=re.text;let Te=0;for(const Be of pe)_e.push(re.substring(Te,Be)),Te=Be;return Te<xe.length&&_e.push(re.substring(Te,xe.length)),_e}($,ee);const Z=[],Q={positionedLines:Z,text:$.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(re,pe,_e,xe,Te,Be,Je,Ze,Ye,rt,Oe,Ke){let Le=0,Fe=0,at=0;const lt=Ze==="right"?1:Ze==="left"?0:.5;let kt=!1;for(const Rt of Te){const Ht=Rt.getSections();for(const ei of Ht){if(ei.image)continue;const ni=pe[ei.fontStack];if(ni&&(kt=ni.ascender!==void 0&&ni.descender!==void 0,!kt))break}if(!kt)break}let Et=0;for(const Rt of Te){Rt.trim();const Ht=Rt.getMaxScale(),ei=(Ht-1)*kr,ni={positionedGlyphs:[],lineOffset:0};re.positionedLines[Et]=ni;const di=ni.positionedGlyphs;let ai=0;if(!Rt.length()){Fe+=Be,++Et;continue}let si=0,cn=0;for(let te=0;te<Rt.length();te++){const se=Rt.getSection(te),Ve=Rt.getSectionIndex(te),ht=Rt.getCodePoint(te);let xt=se.scale,_t=null,zt=null,Gt=null,wi=kr,Ti=0;Ye===Gs.vertical&&((gt=ht)===12312||gt===12313||gt===12316||gt===12540||gt===12448)&&(Ye=Gs.horizontal);const oi=!(Ye===Gs.horizontal||!Oe&&!Nc(ht)||Oe&&(ng[ht]||ly(ht)));if(se.image){const Ji=xe.get(se.image.toString());if(!Ji)continue;Gt=se.image,re.iconsInText=re.iconsInText||!0,zt=Ji.paddedRect;const mn=Ji.displaySize;xt=xt*kr/Ke,_t={width:mn[0],height:mn[1],left:0,top:-3,advance:oi?mn[1]:mn[0],localGlyph:!1},Ti=kt?-_t.height*xt:Ht*kr-17-mn[1]*xt,wi=_t.advance;const Si=(oi?mn[0]:mn[1])*xt-kr*Ht;Si>0&&Si>ai&&(ai=Si)}else{const Ji=_e[se.fontStack];if(!Ji)continue;Ji[ht]&&(zt=Ji[ht]);const mn=pe[se.fontStack];if(!mn)continue;const Si=mn.glyphs[ht];if(!Si)continue;if(_t=Si.metrics,wi=ht!==8203?kr:0,kt){const On=mn.ascender!==void 0?Math.abs(mn.ascender):0,vn=mn.descender!==void 0?Math.abs(mn.descender):0,Zi=(On+vn)*xt;si<Zi&&(si=Zi,cn=(On-vn)/2*xt),Ti=-On*xt}else Ti=(Ht-xt)*kr-17}oi?(re.verticalizable=!0,di.push({glyph:ht,image:Gt,x:Le,y:Fe+Ti,vertical:oi,scale:xt,localGlyph:_t.localGlyph,fontStack:se.fontStack,sectionIndex:Ve,metrics:_t,rect:zt}),Le+=wi*xt+rt):(di.push({glyph:ht,image:Gt,x:Le,y:Fe+Ti,vertical:oi,scale:xt,localGlyph:_t.localGlyph,fontStack:se.fontStack,sectionIndex:Ve,metrics:_t,rect:zt}),Le+=_t.advance*xt+rt)}di.length!==0&&(at=Math.max(Le-rt,at),kt?Dw(di,lt,ai,cn,Be*Ht/2):Dw(di,lt,ai,0,Be/2)),Le=0;const xn=Be*Ht+ai;ni.lineOffset=Math.max(ai,ei),Fe+=xn,++Et}var gt;const st=Fe,{horizontalAlign:Zt,verticalAlign:Pt}=Yy(Je);(function(Rt,Ht,ei,ni,di,ai){const si=(Ht-ei)*di,cn=-ai*ni;for(const xn of Rt)for(const te of xn.positionedGlyphs)te.x+=si,te.y+=cn})(re.positionedLines,lt,Zt,Pt,at,st),re.top+=-Pt*st,re.bottom=re.top+st,re.left+=-Zt*at,re.right=re.left+at,re.hasBaseline=kt}(Q,e,i,o,H,f,g,x,E,b,I,z),!function(re){for(const pe of re)if(pe.positionedGlyphs.length!==0)return!1;return!0}(Z))return Q}const ng={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Cw(n,e,i,o,l,d){if(e.image){const f=o.get(e.image.toString());return f?f.displaySize[0]*e.scale*kr/d+l:0}{const f=i[e.fontStack],g=f&&f.glyphs[n];return g?g.metrics.advance*e.scale+l:0}}function Mw(n,e,i,o){const l=Math.pow(n-e,2);return o?n<e?l/2:2*l:l+Math.abs(i)*i}function mM(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Pw(n,e,i,o,l,d){let f=null,g=Mw(e,i,l,d);for(const x of o){const b=Mw(e-x.x,i,l,d)+x.badness;b<=g&&(f=x,g=b)}return{index:n,x:e,priorBreak:f,badness:g}}function Rw(n){return n?Rw(n.priorBreak).concat(n.index):[]}function Yy(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Dw(n,e,i,o,l){if(!(e||i||o||l))return;const d=n.length-1,f=n[d],g=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)n[x].x-=g,n[x].y+=i+o+l}function zw(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function gM(n,e,i,o){const{horizontalAlign:l,verticalAlign:d}=Yy(o),f=i[0]-n.displaySize[0]*l,g=i[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Lw(n,e,i,o,l,d){const f=n.imagePrimary;let g;if(f.content){const $=f.content,H=f.pixelRatio||1;g=[$[0]/H,$[1]/H,f.displaySize[0]-$[2]/H,f.displaySize[1]-$[3]/H]}const x=e.left*d,b=e.right*d;let S,E,I,D;i==="width"||i==="both"?(D=l[0]+x-o[3],E=l[0]+b+o[1]):(D=l[0]+(x+b-f.displaySize[0])/2,E=D+f.displaySize[0]);const z=e.top*d,F=e.bottom*d;return i==="height"||i==="both"?(S=l[1]+z-o[0],I=l[1]+F+o[2]):(S=l[1]+(z+F-f.displaySize[1])/2,I=S+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:S,right:E,bottom:I,left:D,collisionPadding:g}}function kw(n){return!n.imagePrimary.stretchX}function Ow(n){return!n.imagePrimary.stretchY}function Fw(n){return{width:n.right-n.left,height:n.bottom-n.top}}const wa=128;function Bw(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new nn(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:l}=i;let d=0;for(;d<o.length&&o[d]<=n;)d++;d=Math.max(0,d-1);let f=d;for(;f<o.length&&o[f]<n+1;)f++;f=Math.min(o.length-1,f);const g=o[d],x=o[f];return i.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:x,interpolationType:l}:{kind:"camera",minZoom:g,maxZoom:x,minSize:i.evaluate(new nn(g)),maxSize:i.evaluate(new nn(x)),interpolationType:l}}}function Jy(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:l}){return n.kind==="source"?o/wa:n.kind==="composite"?Nt(o/wa,l/wa,i):e}function Of(n,e,i=1){let o=0,l=0;if(n.kind==="constant")l=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:g}=n,x=d?ve(Es.interpolationFactor(d,e,f,g),0,1):0;n.kind==="camera"?l=Nt(n.minSize,n.maxSize,x)*i:o=x*i}return{uSizeT:o,uSize:l}}class al extends dt{constructor(e,i,o,l,d){super(e,i),this.angle=l,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new al(this.x,this.y,this.z,this.angle,this.segment)}}function Nw(n,e,i,o,l){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-i/2;){if(f--,f<0)return!1;g-=n[f].dist(d),d=n[f]}g+=n[f].dist(n[f+1]),f++;const x=[];let b=0;for(;g<i/2;){const S=n[f],E=n[f+1];if(!E)return!1;let I=n[f-1].angleTo(S)-S.angleTo(E);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:I}),b+=I;g-x[0].distance>o;)b-=x.shift().angleDelta;if(b>l)return!1;f++,g+=S.dist(E)}return!0}function Vw(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function jw(n,e,i){return n?.6*e*i:0}function Uw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function _M(n,e,i,o,l,d){const f=jw(i,l,d),g=Uw(i,o)*d;let x=0;const b=Vw(n)/2;for(let S=0;S<n.length-1;S++){const E=n[S],I=n[S+1],D=E.dist(I);if(x+D>b){const z=(b-x)/D,F=Nt(E.x,I.x,z),$=Nt(E.y,I.y,z),H=new al(F,$,0,I.angleTo(E),S);return!f||Nw(n,H,g,f,e)?H:void 0}x+=D}}function yM(n,e,i,o,l,d,f,g,x){const b=jw(o,d,f),S=Uw(o,l),E=S*f,I=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-E<e/4&&(e=E+e/4),$w(n,I?e/2*g%e:(S/2+2*d)*f*g%e,e,b,i,E,I,!1,x)}function $w(n,e,i,o,l,d,f,g,x){const b=d/2,S=Vw(n);let E=0,I=e-i,D=[];for(let z=0;z<n.length-1;z++){const F=n[z],$=n[z+1],H=F.dist($),ee=$.angleTo(F);for(;I+i<E+H;){I+=i;const K=(I-E)/H,N=Nt(F.x,$.x,K),Z=Nt(F.y,$.y,K);if(N>=0&&N<x&&Z>=0&&Z<x&&I-b>=0&&I+b<=S){const Q=new al(N,Z,0,ee,z);o&&!Nw(n,Q,d,o,l)||D.push(Q)}}E+=H}return g||D.length||f||(D=$w(n,E/2,i,o,l,d,f,!0,x)),D}function Gw(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,g)=>g.h-f.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,d=0;for(const f of n)for(let g=o.length-1;g>=0;g--){const x=o[g];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===x.w&&f.h===x.h){const b=o.pop();g<o.length&&(o[g]=b)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(o.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}Tt(al,"Anchor");const ru=1;class Ff{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const l=e.options.transform;return{x:l.a,y:l.d}}return{x:o,y:o}}constructor(e,i,o,l){this.paddedRect=e;const{pixelRatio:d,version:f,stretchX:g,stretchY:x,content:b,sdf:S,usvg:E}=i;this.pixelRatio=d,this.stretchX=g,this.stretchY=x,this.content=b,this.version=f,this.padding=o,this.sdf=S,this.scale=Ff.getImagePositionScale(l,E,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Qy(n,e,i){const o=ho.parse(n),l=function(d,f,g=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*g[0])+2*f,h:(d.data?d.data.height:d.height*g[1])+2*f}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:l,imagePosition:new Ff(l,e,i,o),imageVariant:o}}class Hw{constructor(e,i,o){const l=new Map,d=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,ru,f),this.addImages(i,d,2,f);const{w:g,h:x}=Gw(f),b=new Jr({width:g||1,height:x||1});for(const[S,E]of e.entries()){const I=l.get(S).paddedRect;Jr.copy(E.data,b,{x:0,y:0},{x:I.x+ru,y:I.y+ru},E.data,o,E.sdf)}for(const[S,E]of i.entries()){const I=d.get(S),D=I.paddedRect;let z=I.padding;const F=D.x+z,$=D.y+z,H=E.data.width,ee=E.data.height;z=z>1?z-1:z,Jr.copy(E.data,b,{x:0,y:0},{x:F,y:$},E.data,o),Jr.copy(E.data,b,{x:0,y:ee-z},{x:F,y:$-z},{width:H,height:z},o),Jr.copy(E.data,b,{x:0,y:0},{x:F,y:$+ee},{width:H,height:z},o),Jr.copy(E.data,b,{x:H-z,y:0},{x:F-z,y:$},{width:z,height:ee},o),Jr.copy(E.data,b,{x:0,y:0},{x:F+H,y:$},{width:z,height:ee},o),Jr.copy(E.data,b,{x:H-z,y:ee-z},{x:F-z,y:$-z},{width:z,height:z},o),Jr.copy(E.data,b,{x:0,y:ee-z},{x:F+H,y:$-z},{width:z,height:z},o),Jr.copy(E.data,b,{x:0,y:0},{x:F+H,y:$+ee},{width:z,height:z},o),Jr.copy(E.data,b,{x:H-z,y:0},{x:F-z,y:$+ee},{width:z,height:z},o)}this.lut=o,this.image=b,this.iconPositions=l,this.patternPositions=d}addImages(e,i,o,l){for(const[d,f]of e.entries()){const{bin:g,imagePosition:x,imageVariant:b}=Qy(d,f,o);i.set(d,x),l.push(g),f.hasRenderCallback&&this.haveRenderCallbacks.push(b.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const l of e.getUpdatedImages(o)){for(const d of this.iconPositions.keys()){const f=ho.parse(d);if(Ds.isEqual(f.id,l)){const g=e.getImage(l,o);this.patchUpdatedImage(this.iconPositions.get(d),g,i)}}for(const d of this.patternPositions.keys()){const f=ho.parse(d);if(Ds.isEqual(f.id,l)){const g=e.getImage(l,o);this.patchUpdatedImage(this.patternPositions.get(d),g,i)}}}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,d]=e.tl,f=e.sdf;if(this.lut||f){const g={width:i.data.width,height:i.data.height},x=new Jr(g);Jr.copy(i.data,x,{x:0,y:0},{x:0,y:0},g,this.lut,f),o.update(x,{position:{x:l,y:d}})}else o.update(i.data,{position:{x:l,y:d}})}}Tt(Ff,"ImagePosition"),Tt(Hw,"ImageAtlas");const rg=1e20;function qw(n,e,i,o,l,d,f,g,x){for(let b=e;b<e+o;b++)Ww(n,i*d+b,d,l,f,g,x);for(let b=i;b<i+l;b++)Ww(n,b*d+e,1,o,f,g,x)}function Ww(n,e,i,o,l,d,f){d[0]=0,f[0]=-1e20,f[1]=rg,l[0]=n[e];for(let g=1,x=0,b=0;g<o;g++){l[g]=n[e+g*i];const S=g*g;do{const E=d[x];b=(l[g]-l[E]+S-E*E)/(g-E)/2}while(b<=f[x]&&--x>-1);x++,d[x]=g,f[x]=b,f[x+1]=rg}for(let g=0,x=0;g<o;g++){for(;f[x+1]<g;)x++;const b=d[x],S=g-b;n[e+g*i]=l[b]+S*S}}const Xo=2,ex={none:0,ideographs:1,all:2};class Rh{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const l=[],d=this.urls[i]||Yr.GLYPHS_URL;for(const f in e)for(const g of e[f])l.push({stack:f,id:g});Ge(l,({stack:f,id:g},x)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[g];if(S!==void 0)return void x(null,{stack:f,id:g,glyph:S});if(S=this._tinySDF(b,f,g),S)return b.glyphs[g]=S,void x(null,{stack:f,id:g,glyph:S});const E=Math.floor(g/256);if(256*E>65535)return vi("glyphs > 65535 not supported"),void x(null,{stack:f,id:g,glyph:S});if(b.ranges[E])return void x(null,{stack:f,id:g,glyph:S});let I=b.requests[E];I||(I=b.requests[E]=[],Rh.loadGlyphRange(f,E,d,this.requestManager,(D,z)=>{if(z){b.ascender=z.ascender,b.descender=z.descender;for(const F in z.glyphs)this._doesCharSupportLocalGlyph(+F)||(b.glyphs[+F]=z.glyphs[+F]);b.ranges[E]=!0}for(const F of I)F(D,z);delete b.requests[E]})),I.push((D,z)=>{D?x(D):z&&x(null,{stack:f,id:g,glyph:z.glyphs[g]||null})})},(f,g)=>{if(f)o(f);else if(g){const x={};for(const{stack:b,id:S,glyph:E}of g)x[b]===void 0&&(x[b]={}),x[b].glyphs===void 0&&(x[b].glyphs={}),x[b].glyphs[S]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},x[b].ascender=this.entries[b].ascender,x[b].descender=this.entries[b].descender;o(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ex.none&&(this.localGlyphMode===ex.all?!!this.localFontFamily:!!this.localFontFamily&&(jt["CJK Unified Ideographs"](e)||jt["Hangul Syllables"](e)||jt.Hiragana(e)||jt.Katakana(e)||jt["CJK Symbols and Punctuation"](e)||jt["CJK Unified Ideographs Extension A"](e)||jt["CJK Unified Ideographs Extension B"](e)||jt.Osage(e)))}_tinySDF(e,i,o){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),d=e.tinySDF=new Rh.TinySDF({fontFamily:l,fontWeight:F,fontSize:24*Xo,buffer:3*Xo,radius:8*Xo}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const f=String.fromCodePoint(o),{data:g,width:x,height:b,glyphWidth:S,glyphHeight:E,glyphLeft:I,glyphTop:D,glyphAdvance:z}=d.draw(f);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new Kl({width:x,height:b},g),metrics:{width:S/Xo,height:E/Xo,left:I/Xo,top:D/Xo-27,advance:z/Xo,localGlyph:!0}}}}Rh.loadGlyphRange=function(n,e,i,o,l){const d=256*e,f=d+255,g=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),Mu.Glyphs);_l(g,(x,b)=>{if(x)l(x);else if(b){const S={},E=function(I){return new ig(I).readFields(uM,{})}(b);for(const I of E.glyphs)S[I.id]=I;l(null,{glyphs:S,ascender:E.ascender,descender:E.descender})}})},Rh.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const g=this.size=n+4*e,x=this._createCanvas(g),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${d} ${n}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),x=Math.min(this.size-this.buffer,f+Math.ceil(o)),b=g+2*this.buffer,S=x+2*this.buffer,E=Math.max(b*S,0),I=new Uint8ClampedArray(E),D={data:I,width:b,height:S,glyphWidth:g,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return D;const{ctx:z,buffer:F,gridInner:$,gridOuter:H}=this;z.clearRect(F,F,g,x),z.fillText(n,F,F+f);const ee=z.getImageData(F,F,g,x);H.fill(rg,0,E),$.fill(0,0,E);for(let K=0;K<x;K++)for(let N=0;N<g;N++){const Z=ee.data[4*(K*g+N)+3]/255;if(Z===0)continue;const Q=(K+F)*b+N+F;if(Z===1)H[Q]=0,$[Q]=rg;else{const re=.5-Z;H[Q]=re>0?re*re:0,$[Q]=re<0?re*re:0}}qw(H,0,0,b,S,b,this.f,this.v,this.z),qw($,F,F,g,x,b,this.f,this.v,this.z);for(let K=0;K<E;K++){const N=Math.sqrt(H[K])-Math.sqrt($[K]);I[K]=Math.round(255-255*(N/this.radius+this.cutoff))}return D}};const su=ru;function Zw(n,e){return n+e[1]-e[0]}function Xw(n,e,i,o,l=1){const d=[],f=n.imagePrimary,g=f.pixelRatio,x=f.paddedRect.w-2*su,b=f.paddedRect.h-2*su,S=(n.right-n.left)*l,E=(n.bottom-n.top)*l,I=f.stretchX||[[0,x]],D=f.stretchY||[[0,b]],z=I.reduce(Zw,0),F=D.reduce(Zw,0),$=x-z,H=b-F;let ee=0,K=z,N=0,Z=F,Q=0,re=$,pe=0,_e=H;if(f.content&&o){const Te=f.content;ee=sg(I,0,Te[0]),N=sg(D,0,Te[1]),K=sg(I,Te[0],Te[2]),Z=sg(D,Te[1],Te[3]),Q=Te[0]-ee,pe=Te[1]-N,re=Te[2]-Te[0]-K,_e=Te[3]-Te[1]-Z}const xe=(Te,Be,Je,Ze)=>{const Ye=og(Te.stretch-ee,K,S,n.left*l),rt=ag(Te.fixed-Q,re,Te.stretch,z),Oe=og(Be.stretch-N,Z,E,n.top*l),Ke=ag(Be.fixed-pe,_e,Be.stretch,F),Le=og(Je.stretch-ee,K,S,n.left*l),Fe=ag(Je.fixed-Q,re,Je.stretch,z),at=og(Ze.stretch-N,Z,E,n.top*l),lt=ag(Ze.fixed-pe,_e,Ze.stretch,F),kt=new dt(Ye,Oe),Et=new dt(Le,Oe),gt=new dt(Le,at),st=new dt(Ye,at),Zt=new dt(rt/g,Ke/g),Pt=new dt(Fe/g,lt/g),Rt=e*Math.PI/180;if(Rt){const si=Math.sin(Rt),cn=Math.cos(Rt),xn=[cn,-si,si,cn];kt._matMult(xn),Et._matMult(xn),st._matMult(xn),gt._matMult(xn)}const Ht=Te.stretch+Te.fixed,ei=Je.stretch+Je.fixed,ni=Be.stretch+Be.fixed,di=Ze.stretch+Ze.fixed,ai=n.imageSecondary;return{tl:kt,tr:Et,bl:st,br:gt,texPrimary:{x:f.paddedRect.x+su+Ht,y:f.paddedRect.y+su+ni,w:ei-Ht,h:di-ni},texSecondary:ai?{x:ai.paddedRect.x+su+Ht,y:ai.paddedRect.y+su+ni,w:ei-Ht,h:di-ni}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zt,pixelOffsetBR:Pt,minFontScaleX:re/g/S,minFontScaleY:_e/g/E,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Te=Kw(I,$,z),Be=Kw(D,H,F);for(let Je=0;Je<Te.length-1;Je++){const Ze=Te[Je],Ye=Te[Je+1];for(let rt=0;rt<Be.length-1;rt++)d.push(xe(Ze,Be[rt],Ye,Be[rt+1]))}}else d.push(xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return d}function sg(n,e,i){let o=0;for(const l of n)o+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return o}function Kw(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[l,d]of n){const f=o[o.length-1];o.push({fixed:l-f.stretch,stretch:f.stretch}),o.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return o.push({fixed:e+su,stretch:i}),o}function og(n,e,i,o){return n/e*i+o}function ag(n,e,i,o){return n-e*i/o}function xM(n,e,i,o){const l=e+n.positionedLines[o].lineOffset;return o===0?i+l/2:i+(l+(e+n.positionedLines[o-1].lineOffset))/2}function vM(n,e=1,i=!1){let o=1/0,l=1/0,d=-1/0,f=-1/0;const g=n[0];for(let D=0;D<g.length;D++){const z=g[D];(!D||z.x<o)&&(o=z.x),(!D||z.y<l)&&(l=z.y),(!D||z.x>d)&&(d=z.x),(!D||z.y>f)&&(f=z.y)}const x=Math.min(d-o,f-l);let b=x/2;const S=new Vu([],bM);if(x===0)return new dt(o,l);for(let D=o;D<d;D+=x)for(let z=l;z<f;z+=x)S.push(new Dh(D+b,z+b,b,n));let E=function(D){let z=0,F=0,$=0;const H=D[0];for(let ee=0,K=H.length,N=K-1;ee<K;N=ee++){const Z=H[ee],Q=H[N],re=Z.x*Q.y-Q.x*Z.y;F+=(Z.x+Q.x)*re,$+=(Z.y+Q.y)*re,z+=3*re}return new Dh(F/z,$/z,0,D)}(n),I=S.length;for(;S.length;){const D=S.pop();(D.d>E.d||!E.d)&&(E=D,i&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,I)),D.max-E.d<=e||(b=D.h/2,S.push(new Dh(D.p.x-b,D.p.y-b,b,n)),S.push(new Dh(D.p.x+b,D.p.y-b,b,n)),S.push(new Dh(D.p.x-b,D.p.y+b,b,n)),S.push(new Dh(D.p.x+b,D.p.y+b,b,n)),I+=4)}return i&&(console.log(`num probes: ${I}`),console.log(`best distance: ${E.d}`)),E.p}function bM(n,e){return e.max-n.max}class Dh{constructor(e,i,o,l){this.p=new dt(e,i),this.h=o,this.d=function(d,f){let g=!1,x=1/0;for(let b=0;b<f.length;b++){const S=f[b];for(let E=0,I=S.length,D=I-1;E<I;D=E++){const z=S[E],F=S[D];z.y>d.y!=F.y>d.y&&d.x<(F.x-z.x)*(d.y-z.y)/(F.y-z.y)+z.x&&(g=!g),x=Math.min(x,Mi(d,z,F))}}return(g?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const wM=Object.keys,tx=Number.POSITIVE_INFINITY,TM=Math.sqrt(2);function Yw(n,[e,i]){let o=0,l=0;if(i===tx){e<0&&(e=0);const d=e/TM;switch(n){case"top-right":case"top-left":l=d-7;break;case"bottom-right":case"bottom-left":l=7-d;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(n){case"top-right":case"bottom-right":o=-d;break;case"top-left":case"bottom-left":o=d;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,l]}function lg(n,e,i,o,l,d,f,g,x){if(!e||!e.usvg)return;const b=Fw(o),S=Fw(l),E=d!=="both"&&d!=="width"||!kw(o)?1:Math.max(1,S.width/b.width),I=d!=="both"&&d!=="height"||!Ow(o)?1:Math.max(1,S.height/b.height);i.scaleSelf(E,I);const D=i.toString();f.set(D,i),g.set(D,e);const{imagePosition:z}=Qy(D,e,ru);x.set(D,z)}function Jw(n,e,i,o,l,d,f,g){if(!n)return;const x=function(b,S,E,I,D){if(b.kind==="camera")return b.maxSize;if(b.kind==="composite"){const z=S.possiblyEvaluate(new nn(b.maxZoom),E).evaluate(D,{},E),F=S.possiblyEvaluate(new nn(b.minZoom),E).evaluate(D,{},E);return Math.max(z,F)}return S.possiblyEvaluate(new nn(I)).evaluate(D,{},E)}(e,i,o,l,d);return n.scaleSelf(x*g*f)}function Qw(n,e,i,o,l,d,f,g){return{iconPrimary:Jw(n.getPrimary(),e,i,o,l,d,f,g),iconSecondary:Jw(n.getSecondary(),e,i,o,l,d,f,g)}}function e1(n,e,i,o){if(!n)return;const l=e.get(i.toString());if(n.imagePrimary=l,o){const d=e.get(o.toString());n.imageSecondary=d}}function SM(n,e){for(const i in n.horizontal)t1(n.horizontal[i],e);t1(n.vertical,e)}function t1(n,e){if(n){for(const i of n.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const l=o.image.toString();o.rect=e.get(l).paddedRect}}}function ix(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EM(n,e,i,o,l,d,f,g,x){const b=nx(d.horizontal)||d.vertical,S=i.get("icon-text-fit-padding").evaluate(o,{},l);let E,I=e;return e&&x!=="none"&&(n.allowVerticalPlacement&&d.vertical&&(E=Lw(e,d.vertical,x,S,g,f)),b&&(I=Lw(e,b,x,S,g,f))),{defaultShapedIcon:I,verticallyShapedIcon:E}}function AM(n,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H,ee,K){let N=f.textMaxSize.evaluate(e,{},I);N===void 0?N=g*f.textScaleFactor:N*=f.textScaleFactor;const Z=n.layers[0].layout,Q=nx(i.horizontal)||i.vertical,re=D.name==="globe",pe=kr,_e=n.tilePixelRatio*N/pe,xe=(rt=n.overscaling,n.zoom>18&&rt>2&&(rt>>=1),Math.max(pt/(512*rt),1)*Z.get("symbol-spacing")),Te=Z.get("text-padding")*n.tilePixelRatio,Be=Z.get("icon-padding")*n.tilePixelRatio,Je=B(Z.get("text-max-angle")),Ze=Z.get("icon-rotation-alignment")==="map"&&K!=="point",Ye=xe/2;var rt;n.hasAnyIconTextFit===!1&&$!=="none"&&(n.hasAnyIconTextFit=!0);const Oe=e.properties?+e.properties[eu]:null,Ke=Oe&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Oe):65535,Le=(Fe,at,lt)=>{if(at.x<0||at.x>=pt||at.y<0||at.y>=pt)return;let kt=null;if(re){const{x:Et,y:gt,z:st}=D.projectTilePoint(at.x,at.y,lt);kt={anchor:new al(Et,gt,st,0,void 0),up:D.upVector(lt,at.x,at.y)}}(function(Et,gt,st,Zt,Pt,Rt,Ht,ei,ni,di,ai,si,cn,xn,te,se,Ve,ht,xt,_t,zt,Gt,wi,Ti,oi,Ji,mn,Si,On){const vn=Et.addToLineVertexArray(gt,Zt);let Zi,Hn,wn,gn,bn,en,ui,on=0,Fn=0,$t=0,Di=0,Tn=-1,jn=-1;const Cn={};let gr=Rs("");const un=st?st.anchor:gt,hr=Si!=="none";let ks=0,Qr=0;if(ni._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _r=ni.layout.get("text-offset").evaluate(zt,{},oi);ks=_r[0]*kr,Qr=_r[1]*kr}else ks=ni.layout.get("text-radial-offset").evaluate(zt,{},oi)*kr,Qr=tx;if(Et.allowVerticalPlacement&&Pt.vertical){const _r=Pt.vertical;if(te)en=rx(_r),ei&&(ui=rx(ei));else{const wr=ni.layout.get("text-rotate").evaluate(zt,{},oi)+90;wn=cg(di,un,gt,ai,si,cn,_r,xn,wr,se),ei&&(gn=cg(di,un,gt,ai,si,cn,ei,ht,wr))}}if(Rt){const _r=Et.iconSizeData,wr=ni.layout.get("icon-rotate").evaluate(zt,{},oi),es=Xw(Rt,wr,wi,hr,Gt.iconScaleFactor),ys=ei?Xw(ei,wr,wi,hr,Gt.iconScaleFactor):void 0;Hn=cg(di,un,gt,ai,si,cn,Rt,ht,wr,null),on=4*es.length;let ls=null;_r.kind==="source"?(ls=[wa*ni.layout.get("icon-size").evaluate(zt,{},oi)*Gt.iconScaleFactor],ls[0]>Ql&&vi(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Bf}. Reduce your "icon-size".`)):_r.kind==="composite"&&(ls=[wa*Gt.compositeIconSizes[0].evaluate(zt,{},oi)*Gt.iconScaleFactor,wa*Gt.compositeIconSizes[1].evaluate(zt,{},oi)*Gt.iconScaleFactor],(ls[0]>Ql||ls[1]>Ql)&&vi(`${Et.layerIds[0]}: Value for "icon-size" is >= ${Bf}. Reduce your "icon-size".`)),Et.addSymbols(Et.icon,es,ls,_t,xt,zt,void 0,st,gt,vn.lineStartIndex,vn.lineLength,-1,Ti,oi,Ji,mn),Tn=Et.icon.placedSymbolArray.length-1,ys&&(Fn=4*ys.length,Et.addSymbols(Et.icon,ys,ls,_t,xt,zt,Gs.vertical,st,gt,vn.lineStartIndex,vn.lineLength,-1,Ti,oi,Ji,mn),jn=Et.icon.placedSymbolArray.length-1)}for(const _r in Pt.horizontal){const wr=_r,es=Pt.horizontal[wr];Zi||(gr=Rs(es.text),te?bn=rx(es):Zi=cg(di,un,gt,ai,si,cn,es,xn,ni.layout.get("text-rotate").evaluate(zt,{},oi),se));const ys=es.positionedLines.length===1;if($t+=i1(Et,st,gt,es,Ht,ni,te,zt,se,vn,Pt.vertical?Gs.horizontal:Gs.horizontalOnly,ys?wM(Pt.horizontal):[wr],Cn,Tn,Gt,Ti,oi,Ji),ys)break}Pt.vertical&&(Di+=i1(Et,st,gt,Pt.vertical,Ht,ni,te,zt,se,vn,Gs.vertical,["vertical"],Cn,jn,Gt,Ti,oi,Ji));let Gr=-1;const Os=(_r,wr)=>_r?Math.max(_r,wr):wr;Gr=Os(bn,Gr),Gr=Os(en,Gr),Gr=Os(ui,Gr);const Ta=Gr>-1?1:0;Et.glyphOffsetArray.length>=65535&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zt.sortKey!==void 0&&Et.addToSortKeyRanges(Et.symbolInstances.length,zt.sortKey),Et.symbolInstances.emplaceBack(gt.x,gt.y,un.x,un.y,un.z,Cn.right>=0?Cn.right:-1,Cn.center>=0?Cn.center:-1,Cn.left>=0?Cn.left:-1,Cn.vertical>=0?Cn.vertical:-1,Tn,jn,gr,Zi!==void 0?Zi:Et.collisionBoxArray.length,Zi!==void 0?Zi+1:Et.collisionBoxArray.length,wn!==void 0?wn:Et.collisionBoxArray.length,wn!==void 0?wn+1:Et.collisionBoxArray.length,Hn!==void 0?Hn:Et.collisionBoxArray.length,Hn!==void 0?Hn+1:Et.collisionBoxArray.length,gn||Et.collisionBoxArray.length,gn?gn+1:Et.collisionBoxArray.length,ai,$t,Di,on,Fn,Ta,0,ks,Qr,Gr,0,hr?1:0,On)})(n,at,kt,Fe,i,o,d,l,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Te,ee,b,0,Be,Ze,H,e,f,S,E,I,z,F,$,Ke)};if(K==="line")for(const Fe of tg(e.geometry,0,0,pt,pt)){const at=yM(Fe,xe,Je,i.vertical||Q,o,pe,_e,n.overscaling,pt);for(const lt of at)Q&&IM(n,Q.text,Ye,lt)||Le(Fe,lt,I)}else if(K==="line-center"){for(const Fe of e.geometry)if(Fe.length>1){const at=_M(Fe,Je,i.vertical||Q,o,pe,_e);at&&Le(Fe,at,I)}}else if(e.type==="Polygon")for(const Fe of Zm(e.geometry,0)){const at=vM(Fe,16);Le(Fe[0],new al(at.x,at.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Fe of e.geometry)Le(Fe,new al(Fe[0].x,Fe[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Fe of e.geometry)for(const at of Fe)Le([at],new al(at.x,at.y,0,0,void 0),I)}const Bf=255,Ql=Bf*wa;function i1(n,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$,H){const ee=function(Z,Q,re,pe,_e,xe,Te,Be){const Je=[];if(Q.positionedLines.length===0)return Je;const Ze=pe.layout.get("text-rotate").evaluate(xe,{})*Math.PI/180,Ye=function(Fe){const at=Fe[0],lt=Fe[1],kt=at*lt;return kt>0?[at,-lt]:kt<0?[-at,lt]:at===0?[lt,at]:[lt,-at]}(re);let rt=Math.abs(Q.top-Q.bottom);for(const Fe of Q.positionedLines)rt-=Fe.lineOffset;const Oe=Q.positionedLines.length,Ke=rt/Oe;let Le=Q.top-re[1];for(let Fe=0;Fe<Oe;++Fe){const at=Q.positionedLines[Fe];Le=xM(Q,Ke,Le,Fe);for(const lt of at.positionedGlyphs){if(!lt.rect)continue;const kt=lt.rect||{};let Et=fM+1,gt=!0,st=1,Zt=0;if(lt.image){const zt=Te.get(lt.image.toString());if(!zt)continue;if(zt.sdf){vi("SDF images are not supported in formatted text and will be ignored.");continue}gt=!1,st=zt.pixelRatio,Et=ru/st}const Pt=(_e||Be)&&lt.vertical,Rt=lt.metrics.advance*lt.scale/2,Ht=lt.metrics,ei=lt.rect;if(ei===null)continue;Be&&Q.verticalizable&&(Zt=lt.image?Rt-lt.metrics.width*lt.scale/2:0);const ni=_e?[lt.x+Rt,lt.y]:[0,0];let di=[0,0],ai=[0,0],si=!1;_e||(Pt?(ai=[lt.x+Rt+Ye[0],lt.y+Ye[1]-Zt],si=!0):di=[lt.x+Rt+re[0],lt.y+re[1]-Zt]);const cn=ei.w*lt.scale/(st*(lt.localGlyph?Xo:1)),xn=ei.h*lt.scale/(st*(lt.localGlyph?Xo:1));let te,se,Ve,ht;if(Pt){const zt=lt.y-Le,Gt=new dt(-Rt,Rt-zt),wi=-Math.PI/2,Ti=new dt(...ai);te=new dt(-Rt+di[0],di[1]),te._rotateAround(wi,Gt)._add(Ti),te.x+=-zt+Rt,te.y-=(Ht.left-Et)*lt.scale;const oi=lt.image?Ht.advance*lt.scale:kr*lt.scale,Ji=String.fromCodePoint(lt.glyph);aM(Ji)?te.x+=(1-Et)*lt.scale:lM(Ji)?te.x+=oi-Ht.height*lt.scale+(-Et-1)*lt.scale:te.x+=lt.image||Ht.width+2*Et===ei.w&&Ht.height+2*Et===ei.h?(oi-xn)/2:(oi-(Ht.height+2*Et)*lt.scale)/2,se=new dt(te.x,te.y-cn),Ve=new dt(te.x+xn,te.y),ht=new dt(te.x+xn,te.y-cn)}else{const zt=(Ht.left-Et)*lt.scale-Rt+di[0],Gt=(-Ht.top-Et)*lt.scale+di[1],wi=zt+cn,Ti=Gt+xn;te=new dt(zt,Gt),se=new dt(wi,Gt),Ve=new dt(zt,Ti),ht=new dt(wi,Ti)}if(Ze){let zt;zt=_e?new dt(0,0):si?new dt(Ye[0],Ye[1]):new dt(re[0],re[1]),te._rotateAround(Ze,zt),se._rotateAround(Ze,zt),Ve._rotateAround(Ze,zt),ht._rotateAround(Ze,zt)}const xt=new dt(0,0),_t=new dt(0,0);Je.push({tl:te,tr:se,bl:Ve,br:ht,texPrimary:kt,texSecondary:void 0,writingMode:Q.writingMode,glyphOffset:ni,sectionIndex:lt.sectionIndex,isSDF:gt,pixelOffsetTL:xt,pixelOffsetBR:_t,minFontScaleX:0,minFontScaleY:0})}}return Je}(0,o,x,d,f,g,l,n.allowVerticalPlacement),K=n.textSizeData;let N=null;K.kind==="source"?(N=[wa*d.layout.get("text-size").evaluate(g,{},$)*z.textScaleFactor],N[0]>Ql&&vi(`${n.layerIds[0]}: Value for "text-size" is >= ${Bf}. Reduce your "text-size".`)):K.kind==="composite"&&(N=[wa*z.compositeTextSizes[0].evaluate(g,{},$)*z.textScaleFactor,wa*z.compositeTextSizes[1].evaluate(g,{},$)*z.textScaleFactor],(N[0]>Ql||N[1]>Ql)&&vi(`${n.layerIds[0]}: Value for "text-size" is >= ${Bf}. Reduce your "text-size".`)),n.addSymbols(n.text,ee,N,x,f,g,S,e,i,b.lineStartIndex,b.lineLength,D,F,$,H,!1);for(const Z of E)I[Z]=n.text.placedSymbolArray.length-1;return 4*ee.length}function nx(n){for(const e in n)return n[e];return null}function cg(n,e,i,o,l,d,f,g,x,b){let S=f.top,E=f.bottom,I=f.left,D=f.right;if(zw(f)&&f.collisionPadding){const z=f.collisionPadding;I-=z[0],S-=z[1],D+=z[2],E+=z[3]}if(x){const z=new dt(I,S),F=new dt(D,S),$=new dt(I,E),H=new dt(D,E),ee=B(x);let K=new dt(0,0);b&&(K=new dt(b[0],b[1])),z._rotateAround(ee,K),F._rotateAround(ee,K),$._rotateAround(ee,K),H._rotateAround(ee,K),I=Math.min(z.x,F.x,$.x,H.x),D=Math.max(z.x,F.x,$.x,H.x),S=Math.min(z.y,F.y,$.y,H.y),E=Math.max(z.y,F.y,$.y,H.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,I,S,D,E,g,o,l,d),n.length-1}function rx(n){zw(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function IM(n,e,i,o){const l=n.compareText;if(e in l){const d=l[e];for(let f=d.length-1;f>=0;f--)if(o.dist(d[f])<i)return!0}else l[e]=[];return l[e].push(o),!1}function n1(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,l=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),d=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let f=Math.sin(n._pitch)*d+l;const g=l*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let x=Math.max(n.zoom-17,0);n.isOrthographic&&(x/=10),f*=1+x}return Math.min(1.01*f,g)}function Nf(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,l=(n.x+1)*i,d=n.y*i,f=(n.y+1)*i,g=me(o),x=me(l),b=ge(d),S=ge(f),E=e.project(g,b),I=e.project(x,b),D=e.project(x,S),z=e.project(g,S);let F=Math.min(E.x,I.x,D.x,z.x),$=Math.min(E.y,I.y,D.y,z.y),H=Math.max(E.x,I.x,D.x,z.x),ee=Math.max(E.y,I.y,D.y,z.y);const K=i/16;function N(Q,re,pe,_e,xe,Te){const Be=(pe+xe)/2,Je=(_e+Te)/2,Ze=e.project(me(Be),ge(Je)),Ye=Math.max(0,F-Ze.x,$-Ze.y,Ze.x-H,Ze.y-ee);F=Math.min(F,Ze.x),H=Math.max(H,Ze.x),$=Math.min($,Ze.y),ee=Math.max(ee,Ze.y),Ye>K&&(N(Q,Ze,pe,_e,Be,Je),N(Ze,re,Be,Je,xe,Te))}N(E,I,o,d,l,d),N(I,D,l,d,l,f),N(D,z,l,f,o,f),N(z,E,o,f,o,d),F-=K,$-=K,H+=K,ee+=K;const Z=1/Math.max(H-F,ee-$);return{scale:Z,x:F*Z,y:$*Z,x2:H*Z,y2:ee*Z,projection:e}}function r1(n,{x:e,y:i},o=0){return new dt(((e-o)*n.scale-n.x)*pt,(i*n.scale-n.y)*pt)}const CM=Re(new Float32Array(16));class ec{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new U(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,l=!0){return e._coordinatePoint(e.locationCoordinate(i,o),l)}pixelsPerMeter(e,i){return ae(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return n1(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,l){const d=e.horizonLineFromTop(!1),f=new dt(i,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,i,o){const l=new dt(i,o);if(e.elevation)return e.elevation.pointCoordinate(l);{const d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return CM}createTileMatrix(e,i,o){let l,d,f;const g=o.canonical,x=Re(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Nf(g,this);l=1,d=b.x+o.wrap*b.scale,f=b.y,ot(x,x,[l/b.scale,l/b.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*o.wrap)*l,f=g.y*l;return vt(x,x,[d,f,0]),ot(x,x,[l/pt,l/pt,1]),x}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class MM extends ec{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(B(i));this.n=(l+Math.sin(B(o)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:l,r0:d}=this,f=B(e-this.center[0]),g=B(i),x=Math.sqrt(l-2*o*Math.sin(g))/o;return{x:x*Math.sin(f*o),y:x*Math.cos(f*o)-d,z:0}}unproject(e,i){const{n:o,c:l,r0:d}=this,f=d+i;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const x=B(this.center[0])*o;g=De(g,-Math.PI-x,Math.PI-x);const b=ve(q(g/o)+this.center[0],-180,180),S=Math.asin(ve((l-(e*e+f*f)*o*o)/(2*o),-1,1)),E=ve(q(S),-85.051129,Ee);return new U(b,E)}}const Vf=1.340264,jf=-.081106,Uf=893e-6,$f=.003796,ug=Math.sqrt(3)/2;class PM extends ec{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(ug*Math.sin(i)),l=o*o,d=l*l*l;return{x:.5*(e*Math.cos(o)/(ug*(Vf+3*jf*l+d*(7*Uf+9*$f*l)))/Math.PI+.5),y:1-.5*(o*(Vf+jf*l+d*(Uf+$f*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=o*o,d=l*l*l;for(let S,E,I,D=0;D<12&&(E=o*(Vf+jf*l+d*(Uf+$f*l))-i,I=Vf+3*jf*l+d*(7*Uf+9*$f*l),S=E/I,o=ve(o-S,-Math.PI/3,Math.PI/3),l=o*o,d=l*l*l,!(Math.abs(S)<1e-12));++D);const f=ug*e*(Vf+3*jf*l+d*(7*Uf+9*$f*l))/Math.cos(o),g=Math.asin(Math.sin(o)/ug),x=ve(180*f/Math.PI,-180,180),b=ve(180*g/Math.PI,-85.051129,Ee);return new U(x,b)}}class RM extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),l=ve(360*(.5-i),-85.051129,Ee);return new U(o,l)}}const zh=Math.PI/2;function hg(n){return Math.tan((zh+n)/2)}class DM extends ec{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let l=B(i),d=B(o);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);const f=Math.cos(l),g=hg(l);this.n=l===d?Math.sin(l):Math.log(f/Math.cos(d))/Math.log(hg(d)/g),this.f=f*Math.pow(hg(l),this.n)/this.n}project(e,i){i=B(i),this.southernCenter&&(i=-i),e=B(e-this.center[0]);const o=1e-6,{n:l,f:d}=this;d>0?i<-zh+o&&(i=-zh+o):i>zh-o&&(i=zh-o);const f=d/Math.pow(hg(i),l);let g=f*Math.sin(l*e),x=d-f*Math.cos(l*e);return g=.5*(g/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:g,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:l}=this,d=l-i,f=Math.sign(d),g=Math.sign(o)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*o<0&&(x-=Math.PI*Math.sign(e)*f);const b=ve(q(x/o)+this.center[0],-180,180),S=ve(q(2*Math.atan(Math.pow(l/g,1/o))-zh),-85.051129,Ee);return new U(b,this.southernCenter?-S:S)}}class s1 extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:le(e),y:ce(i),z:0}}unproject(e,i){const o=me(e),l=ge(i);return new U(o,l)}}const o1=B(Ee);class zM extends ec{project(e,i){const o=(i=B(i))*i,l=o*o;return{x:.5*((e=B(e))*(.8707-.131979*o+l*(l*(.003971*o-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+l*(.028874*o-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,l=25,d=0,f=o*o;do{f=o*o;const b=f*f;d=(o*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-i)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),o=ve(o-d,-o1,o1)}while(Math.abs(d)>1e-6&&--l>0);f=o*o;const g=ve(q(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=q(o);return new U(g,x)}}const a1=B(Ee);class LM extends ec{project(e,i){i=B(i),e=B(e);const o=Math.cos(i),l=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),f=Math.sin(d)/d,g=.5*(e*l+2*o*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let g=0,x=0;do{const b=Math.cos(l),S=Math.sin(l),E=2*S*b,I=S*S,D=b*b,z=Math.cos(o/2),F=Math.sin(o/2),$=2*z*F,H=F*F,ee=1-D*z*z,K=ee?1/ee:0,N=ee?Math.acos(b*z)*Math.sqrt(1/ee):0,Z=.5*(2*N*b*F+2*o/Math.PI)-e,Q=.5*(N*S+l)-i,re=.5*K*(D*H+N*b*z*I)+1/Math.PI,pe=K*($*E/4-N*S*F),_e=.125*K*(E*F-N*S*D*$),xe=.5*K*(I*z+N*H*b)+.5,Te=pe*_e-xe*re;g=(Q*pe-Z*xe)/Te,x=(Z*_e-Q*re)/Te,o=ve(o-g,-Math.PI,Math.PI),l=ve(l-x,-a1,a1)}while((Math.abs(g)>f||Math.abs(x)>f)&&--d>0);return new U(q(o),q(l))}}class l1 extends ec{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(B(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:l}=this;return{x:B(e)*l*o+.5,y:-Math.sin(B(i))/l*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:l}=this,d=-(i-.5)/o,f=ve(q((e-.5)/o)/l,-180,180),g=Math.asin(ve(d*l,-1,1)),x=ve(q(g),-85.051129,Ee);return new U(f,x)}}class kM extends s1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const l=wf(e,i,o);return zi(l,l,Hm(va(o))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i,o){const l=j(i.lat,i.lng),d=xi([],l),f=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;tn(l,l,d,ae(1,0)*pt*f);const g=Re(new Float64Array(16));return et(g,e.pixelMatrix,e.globeMatrix),zi(l,l,g),new dt(l[0],l[1])}pixelsPerMeter(e,i){return ae(1,0)*i}pixelSpaceConversion(e,i,o){const l=ae(1,e)*i,d=Nt(ae(1,45)*i,l,o);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,o){const l=wy(va(o.canonical));return et(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:o}=e,l=Hm(va(i));return Dt(l,l,B(o.lng)),Ct(l,l,B(o.lat)),ot(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,o,l){return qv(e,i,o,!0)||new Pe(0,0)}pointCoordinate3D(e,i,o){const l=this.pointCoordinate(e,i,o,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!qv(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,d){const f=l.cameraToCenterDistance,g=l._centerAltitude*d,x=l._camera,b=l._camera.forward(),S=Pi([],ti([],b,-f),[0,0,g]),E=l.worldSize/(2*Math.PI),I=[0,0,-E],D=l.width/l.height,z=Math.tan(l.fovAboveCenter),F=ti([],x.up(),z),$=ti([],x.right(),z*D),H=xi([],Pi([],Pi([],b,F),$)),ee=[];let K;if(new xo(S,H).closestPointOnSphere(I,E,ee)){const N=Pi([],ee,I),Z=Ui([],N,S);K=Math.cos(l.fovAboveCenter)*yi(Z)}else{const N=Ui([],S,I),Z=Ui([],I,S);xi(Z,Z);const Q=yi(N)-E;K=Math.sqrt(Q*(Q+2*E));const re=Math.acos(K/(E+Q))-Math.acos(Ai(b,Z));K*=Math.cos(re)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Xl(e.zoom);if(o>0){const l=n1(e,ae(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Nt(i,l+d*(1-Math.cos(f)),Math.pow(o,10))}return i}upVector(e,i,o){return wf(i,o,e,1)}upVectorScale(e){return{metersToTile:Zl(Gm(va(e)))}}}function c1(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new s1(n);case"equirectangular":return new RM(n);case"naturalEarth":return new zM(n);case"equalEarth":return new PM(n);case"winkelTripel":return new LM(n);case"albers":return i?new l1(n):new MM(n);case"lambertConformalConic":return i?new l1(n):new DM(n);case"globe":return new kM(n)}throw new Error(`Invalid projection name: ${n.name}`)}const OM=Yl.VectorTileFeature.types,FM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function dg(n,e,i,o,l,d,f,g,x,b,S,E,I){const D=g?Math.min(Ql,Math.round(g[0])):0,z=g?Math.min(Ql,Math.round(g[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*l),d,f,(D<<1)+(x?1:0),z,16*b,16*S,256*E,256*I)}function fg(n,e,i){n.emplaceBack(e,i)}function pg(n,e,i,o,l,d,f){n.emplaceBack(e,i,o,l,d,f)}function mg(n,e,i,o,l){n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l),n.emplaceBack(e,i,o,l)}function BM(n){for(const e of n.sections)if(uy(e.text))return!0;return!1}class sx{constructor(e){this.layoutVertexArray=new Ul,this.indexArray=new Ar,this.programConfigurations=e,this.segments=new kn,this.dynamicLayoutVertexArray=new Io,this.opacityVertexArray=new hf,this.placedSymbolArray=new Pm,this.iconTransitioningVertexArray=new _a,this.globeExtVertexArray=new As,this.zOffsetVertexArray=new Vl}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,l,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,eM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,FM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,iM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,QC.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,tM.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Tt(sx,"SymbolBuffers");class ox{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new kn,this.collisionVertexArray=new ff,this.collisionVertexArrayExt=new Io}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,nM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,rM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tt(ox,"CollisionBuffers");class gg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Re([]),this.placementViewportMatrix=Re([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bw(this.zoom,i["text-size"]),this.iconSizeData=Bw(this.zoom,i["icon-size"]);const o=this.layers[0].layout,l=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(f=>Gs[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new sx(new rl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new sx(new rl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new xf,this.lineVertexArray=new zm,this.symbolInstances=new Dm}calculateGlyphDependencies(e,i,o,l,d){for(const f of e){const g=f.codePointAt(0);if(g===void 0)break;if(i[g]=!0,l&&d&&g<=65535){const x=Lf[f];x&&(i[x.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Vy(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,l){const d=this.layers[0],f=d.layout,g=this.projection.name==="globe",x=f.get("text-font"),b=f.get("text-field"),S=f.get("icon-image"),[E,I]=f.get("icon-size-scale-range"),D=ve(i.scaleFactor||1,E,I),z=(b.value.kind!=="constant"||b.value.value instanceof fs&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),F=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,$=f.get("symbol-sort-key");if(this.features=[],!z&&!F)return;const H=i.iconDependencies,ee=i.glyphDependencies,K=i.availableImages,N=new nn(this.zoom);for(const{feature:Z,id:Q,index:re,sourceLayerIndex:pe}of e){const _e=d._featureFilter.needGeometry,xe=Ot(Z,_e);if(!d._featureFilter.filter(N,xe,o))continue;if(_e||(xe.geometry=At(Z,o,l)),g&&Z.type!==1&&o.z<=5){const Ye=xe.geometry,rt=.98078528056,Oe=(Ke,Le)=>Ai(wf(Ke.x,Ke.y,o,1),wf(Le.x,Le.y,o,1))<rt;for(let Ke=0;Ke<Ye.length;Ke++)Ye[Ke]=Qe(Ye[Ke],Oe)}let Te,Be;if(z){const Ye=d.getValueAndResolveTokens("text-field",xe,o,K),rt=fs.factory(Ye);BM(rt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fl()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&(Te=oM(rt,d,xe))}if(F){const Ye=d.getValueAndResolveTokens("icon-image",xe,o,K);Be=typeof Ye=="string"?Ss.build(Ye):Ye}if(!Te&&!Be)continue;const Je=this.sortFeaturesByKey?$.evaluate(xe,{},o):void 0,Ze={id:Q,text:Te,icon:Be,index:re,sourceLayerIndex:pe,geometry:xe.geometry,properties:Z.properties,type:OM[Z.type],sortKey:Je};if(this.features.push(Ze),Be){const Ye=this.layers[0]._unevaluatedLayout._values,{iconPrimary:rt,iconSecondary:Oe}=Qw(Be,this.iconSizeData,Ye["icon-size"],o,this.zoom,Ze,this.pixelRatio,D),Ke=rt.id.toString();if(H.has(Ke)?H.get(Ke).push(rt):H.set(Ke,[rt]),Oe){const Le=Oe.id.toString();H.has(Le)?H.get(Le).push(Oe):H.set(Le,[Oe])}}if(Te){const Ye=x.evaluate(xe,{},o).join(","),rt=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gs.vertical)>=0;for(const Oe of Te.sections)if(Oe.image){const Ke=Oe.image.getPrimary().scaleSelf(this.pixelRatio),Le=Ke.id.toString(),Fe=H.get(Le)||[];Fe.push(Ke),H.set(Le,Fe)}else{const Ke=Jd(Te.toString()),Le=Oe.fontStack||Ye,Fe=ee[Le]=ee[Le]||{};this.calculateGlyphDependencies(Oe.text,Fe,rt,this.allowVerticalPlacement,Ke)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(Z){const Q={},re={},pe=[];let _e=0;function xe(Ze){pe.push(Z[Ze]),_e++}function Te(Ze,Ye,rt){const Oe=re[Ze];return delete re[Ze],re[Ye]=Oe,pe[Oe].geometry[0].pop(),pe[Oe].geometry[0]=pe[Oe].geometry[0].concat(rt[0]),Oe}function Be(Ze,Ye,rt){const Oe=Q[Ye];return delete Q[Ye],Q[Ze]=Oe,pe[Oe].geometry[0].shift(),pe[Oe].geometry[0]=rt[0].concat(pe[Oe].geometry[0]),Oe}function Je(Ze,Ye,rt){const Oe=rt?Ye[0][Ye[0].length-1]:Ye[0][0];return`${Ze}:${Oe.x}:${Oe.y}`}for(let Ze=0;Ze<Z.length;Ze++){const Ye=Z[Ze],rt=Ye.geometry,Oe=Ye.text?Ye.text.toString():null;if(!Oe){xe(Ze);continue}const Ke=Je(Oe,rt),Le=Je(Oe,rt,!0);if(Ke in re&&Le in Q&&re[Ke]!==Q[Le]){const Fe=Be(Ke,Le,rt),at=Te(Ke,Le,pe[Fe].geometry);delete Q[Ke],delete re[Le],re[Je(Oe,pe[at].geometry,!0)]=at,pe[Fe].geometry=null}else Ke in re?Te(Ke,Le,rt):Le in Q?Be(Ke,Le,rt):(xe(Ze),Q[Ke]=_e-1,re[Le]=_e-1)}return pe.filter(Ze=>Ze.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Z of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Z.id,this.elevationFeatures.length),this.elevationFeatures.push(Z)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Z,Q)=>Z.sortKey-Q.sortKey)}update(e,i,o,l,d,f,g){this.text.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g),this.icon.programConfigurations.updatePaintArrays(e,i,d,o,l,f,g)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);if(o.elevationFeatureIndex===65535)continue;const l=this.elevationFeatures[o.elevationFeatureIndex];if(l){const d=.05+l.pointElevation(new dt(o.tileAnchorX,o.tileAnchorY));o.zOffset!==d&&(e=!0,o.zOffset=d)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,f,g)=>{o+=f,o>d.length&&d.resize(o);for(let x=-f;x<0;x++)d.emplace(x+o,g)},i=(d,f,g)=>{l+=f,l>d.length&&d.resize(l);for(let x=-f;x<0;x++)d.emplace(x+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,l=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:x,numIconVertices:b}=f,S=f.zOffset,E=b>0;if((g>0||x>0)&&(e(this.text.zOffsetVertexArray,g,S),e(this.text.zOffsetVertexArray,x,S)),E){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:D}=f;I>=0&&i(this.icon.zOffsetVertexArray,b,S),D>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=c1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:d}of i)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,l,d,f,g,x,b,S,E,I,D,z,F,$){const H=e.indexArray,ee=e.layoutVertexArray,K=e.globeExtVertexArray,N=e.segments.prepareSegment(4*i.length,ee,H,this.canOverlap?f.sortKey:void 0),Z=this.glyphOffsetArray.length,Q=N.vertexLength,re=this.allowVerticalPlacement&&g===Gs.vertical?Math.PI/2:0,pe=f.text&&f.text.sections;for(let xe=0;xe<i.length;xe++){const{tl:Te,tr:Be,bl:Je,br:Ze,texPrimary:Ye,texSecondary:rt,pixelOffsetTL:Oe,pixelOffsetBR:Ke,minFontScaleX:Le,minFontScaleY:Fe,glyphOffset:at,isSDF:lt,sectionIndex:kt}=i[xe],Et=N.vertexLength,gt=at[1];if(dg(ee,b.x,b.y,Te.x,gt+Te.y,Ye.x,Ye.y,o,lt,Oe.x,Oe.y,Le,Fe),dg(ee,b.x,b.y,Be.x,gt+Be.y,Ye.x+Ye.w,Ye.y,o,lt,Ke.x,Oe.y,Le,Fe),dg(ee,b.x,b.y,Je.x,gt+Je.y,Ye.x,Ye.y+Ye.h,o,lt,Oe.x,Ke.y,Le,Fe),dg(ee,b.x,b.y,Ze.x,gt+Ze.y,Ye.x+Ye.w,Ye.y+Ye.h,o,lt,Ke.x,Ke.y,Le,Fe),x){const{x:st,y:Zt,z:Pt}=x.anchor,[Rt,Ht,ei]=x.up;pg(K,st,Zt,Pt,Rt,Ht,ei),pg(K,st,Zt,Pt,Rt,Ht,ei),pg(K,st,Zt,Pt,Rt,Ht,ei),pg(K,st,Zt,Pt,Rt,Ht,ei),mg(e.dynamicLayoutVertexArray,st,Zt,Pt,re)}else mg(e.dynamicLayoutVertexArray,b.x,b.y,b.z,re);if($){const st=rt||Ye;fg(e.iconTransitioningVertexArray,st.x,st.y),fg(e.iconTransitioningVertexArray,st.x+st.w,st.y),fg(e.iconTransitioningVertexArray,st.x,st.y+st.h),fg(e.iconTransitioningVertexArray,st.x+st.w,st.y+st.h)}H.emplaceBack(Et,Et+1,Et+2),H.emplaceBack(Et+1,Et+2,Et+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),xe!==i.length-1&&kt===i[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ee.length,f,f.index,{},D,z,F,pe&&pe[kt])}const _e=x?x.anchor:b;e.placedSymbolArray.emplaceBack(_e.x,_e.y,_e.z,b.x,b.y,Z,this.glyphOffsetArray.length-Z,Q,S,E,b.segment,o?o[0]:0,o?o[1]:0,l[0],l[1],g,0,0,0,I,0)}_commitLayoutVertex(e,i,o,l,d,f,g){e.emplaceBack(i,o,l,d,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,o,l,d,f,g){const x=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),b=x.vertexLength,S=g.tileAnchorX,E=g.tileAnchorY;for(let D=0;D<4;D++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,S,E,new dt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,S,E,new dt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,S,E,new dt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,l,d,f,S,E,new dt(e.x1,e.y2)),x.vertexLength+=4;const I=o.indexArray;I.emplaceBack(b,b+1),I.emplaceBack(b+1,b+2),I.emplaceBack(b+2,b+3),I.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,l,d,f){for(let g=l;g<d;g++){const x=o.get(g),b=this.getSymbolInstanceTextSize(e,f,i,g);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,o,l,d,f){for(let g=l;g<d;g++){const x=o.get(g),b=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ox(xh,Sw.members,_a),this.iconCollisionBox=new ox(xh,Sw.members,_a);const l=Of(this.iconSizeData,e),d=Of(this.textSizeData,e,o);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(d,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(d,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,o,l){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),f=Jy(this.textSizeData,e,d)/kr;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,o){const l=this.icon.placedSymbolArray.get(o),d=Jy(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,o,l){e.emplaceBack(i,-o,-o,l),e.emplaceBack(i,o,-o,l),e.emplaceBack(i,o,o,l),e.emplaceBack(i,-o,o,l)}_updateTextDebugCollisionBoxes(e,i,o,l,d,f,g){for(let x=l;x<d;x++){const b=o.get(x),S=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,b.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,l,d,f,g){for(let x=l;x<d;x++){const b=o.get(x),S=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,b.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Of(this.iconSizeData,e,l),f=Of(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x,o),this._updateTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,o),this._updateIconDebugCollisionBoxes(d,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x,l),this._updateIconDebugCollisionBoxes(d,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,l,d,f,g,x,b){const S={};if(i<o){const{x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N,featureIndex:Z}=e.get(i);S.textBox={x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N},S.textFeatureIndex=Z}if(l<d){const{x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N,featureIndex:Z}=e.get(l);S.verticalTextBox={x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N},S.verticalTextFeatureIndex=Z}if(f<g){const{x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N,featureIndex:Z}=e.get(f);S.iconBox={x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N},S.iconFeatureIndex=Z}if(x<b){const{x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N,featureIndex:Z}=e.get(x);S.verticalIconBox={x1:E,y1:I,x2:D,y2:z,padding:F,projectedAnchorX:$,projectedAnchorY:H,projectedAnchorZ:ee,tileAnchorX:K,tileAnchorY:N},S.verticalIconFeatureIndex=Z}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),l=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),l=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const x=this.symbolInstances.get(g);l.push(0|Math.round(i*x.tileAnchorX+o*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((g,x)=>l[g]-l[x]||d[x]-d[g]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=o;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let u1,h1,ax;Tt(gg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),gg.addDynamicAttributes=mg;class d1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ra,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt(d1,"FormatSectionOverride",{omit:["defaultValue"]});const lx=()=>ax||(ax={layout:u1||(u1=new $n({"symbol-placement":new ut(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Ce.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ut(Ce.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ut(Ce.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ut(Ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ut(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(Ce.layout_symbol["icon-size"]),"icon-size-scale-range":new ut(Ce.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new wt(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(Ce.layout_symbol["icon-image"]),"icon-rotate":new wt(Ce.layout_symbol["icon-rotate"]),"icon-padding":new ut(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(Ce.layout_symbol["icon-offset"]),"icon-anchor":new wt(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new wt(Ce.layout_symbol["text-field"]),"text-font":new wt(Ce.layout_symbol["text-font"]),"text-size":new wt(Ce.layout_symbol["text-size"]),"text-size-scale-range":new ut(Ce.layout_symbol["text-size-scale-range"]),"text-max-width":new wt(Ce.layout_symbol["text-max-width"]),"text-line-height":new wt(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new wt(Ce.layout_symbol["text-justify"]),"text-radial-offset":new wt(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Ce.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(Ce.layout_symbol["text-anchor"]),"text-max-angle":new ut(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new wt(Ce.layout_symbol["text-rotate"]),"text-padding":new ut(Ce.layout_symbol["text-padding"]),"text-keep-upright":new ut(Ce.layout_symbol["text-keep-upright"]),"text-transform":new wt(Ce.layout_symbol["text-transform"]),"text-offset":new wt(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ut(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Ce.layout_symbol["text-optional"]),visibility:new ut(Ce.layout_symbol.visibility)})),paint:h1||(h1=new $n({"icon-opacity":new wt(Ce.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new wt(Ce.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new wt(Ce.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new wt(Ce.paint_symbol["text-emissive-strength"]),"icon-color":new wt(Ce.paint_symbol["icon-color"]),"icon-halo-color":new wt(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Ce.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ut(Ce.paint_symbol["icon-image-cross-fade"]),"text-opacity":new wt(Ce.paint_symbol["text-opacity"]),"text-occlusion-opacity":new wt(Ce.paint_symbol["text-occlusion-opacity"]),"text-color":new wt(Ce.paint_symbol["text-color"],{runtimeType:Ts,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new wt(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new wt(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(Ce.paint_symbol["text-halo-blur"]),"text-translate":new ut(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Ce.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ut(Ce.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ut(Ce.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ut(Ce.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ut(Ce.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new wt(Ce.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},ax);class _g extends _s{constructor(e,i,o,l){super(e,lx(),i,o,l),this._colorAdjustmentMatrix=Re([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const l=[];for(const d of o)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(d,f,g,x){d=os(d),f=ss(f);const b=He(),S=d/3,E=1-2*S,I=[E,S,S,0,S,E,S,0,S,S,E,0,0,0,0,1],D=.5-.5*f,z=x-g;return et(b,[z,0,0,0,0,z,0,0,0,0,z,0,g,g,g,1],[f,0,0,0,0,f,0,0,0,0,f,0,D,D,D,1]),et(b,b,I),b}(e,i,o,l),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,l){const d=this.layout.get(e).evaluate(i,{},o,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||ah(f.value)||!d?d:function(g,x){return x.replace(/{([^{}]+)}/g,(b,S)=>S in g?String(g[S]):"")}(i.properties,d)}createBucket(e){return new gg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of lx().paint.overridableProperties){if(!_g.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new d1(i),l=new Xd(o,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Xa("source",l):new kl("composite",l,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Bl(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&_g.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),l=lx().paint.properties[i];let d=!1;const f=g=>{for(const x of g)if(l.overrides&&l.overrides.hasOverride(x))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof fs)f(o.value.value.sections);else if(o.value.kind==="source"){const g=b=>{d||(b instanceof ci&&br(b.value)===bc?f(b.value.sections):b instanceof Va?f(b.sections):b.eachChild(g))},x=o.value;x._styleExpression&&g(x._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new xa(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let f1,p1,m1,g1;var cx=Ni([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ux(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function hx(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class dx{constructor(e,i,o,l){this.context=e,this.format=o,this.useMipmap=l&&l.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:l&&l.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,l=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:f}=d,{x:g,y:x}=i&&i.position?i.position:{x:0,y:0},b=g+o,S=x+l;!this.size||this.size[0]===b&&this.size[1]===S||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const E=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&b>0&&S>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(b,S)))+1:1;f.texStorage2D(f.TEXTURE_2D,I,this.format,b,S),this.size=[b,S]}if(this.size)if(E)f.texSubImage2D(f.TEXTURE_2D,0,g,x,ux(this.format),hx(this.format),e);else{const I=e.data;I&&f.texSubImage2D(f.TEXTURE_2D,0,g,x,o,l,ux(this.format),hx(this.format),I)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,o=!1){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,l){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),i!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,o),this.wrapS=o),l!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class yg{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function xg(n,e,i,o,l,d,f,g){const x=[n,e,1,i,o,1,l,d,1],b=[f,g,1],S=Ie([],x),[E,I,D]=Sr(b,b,S);return je(x,x,[E,0,0,0,I,0,0,0,D])}function _1(n,e,i,o,l,d,f,g){const x=function(b,S,E,I,D,z,F,$){const H=xg(0,0,1,0,1,1,0,1),ee=xg(b,S,E,I,D,z,F,$);return je(ee,ee,Ie([],H))}(n,e,i,o,l,d,f,g);return[x[2]/x[8]/pt,x[5]/x[8]/pt]}function vg(n){return[n[0],Math.min(Math.max(n[1],-85.051129),Ee)]}class y1 extends Fa{constructor(e,i,o,l){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new na("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=yl(this.map._requestManager.transformRequest(this.url,Mu.Image),(o,l)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new xd(o)):l&&(this.image=l instanceof HTMLImageElement?lo.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new yg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new na("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof yg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const d of e)d[1]>o&&(o=d[1]),d[1]<i&&(i=d[1]);const l=(o+i)/2;if(l>Ee?this.onNorthPole=!0:l<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Pe.fromLngLat);this.tileID=function(f){let g=1/0,x=1/0,b=-1/0,S=-1/0;for(const F of f)g=Math.min(g,F.x),x=Math.min(x,F.y),b=Math.max(b,F.x),S=Math.max(S,F.y);const E=Math.max(b-g,S-x),I=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),D=Math.pow(2,I);let z=Math.floor((g+b)/2*D);return z>1&&(z-=1),new yn(I,z,Math.floor((x+S)/2*D))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new na("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const H in this.tiles){const ee=this.tiles[H];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Nf(new yn(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(H){const ee=H[1].x-H[0].x,K=H[1].y-H[0].y,N=H[2].x-H[1].x,Z=H[2].y-H[1].y,Q=H[3].x-H[2].x,re=H[3].y-H[2].y,pe=H[0].x-H[3].x,_e=H[0].y-H[3].y,xe=ee*Z-N*K,Te=N*re-Q*Z,Be=Q*_e-pe*re,Je=pe*K-ee*_e;return xe>0&&Te>0&&Be>0&&Je>0||xe<0&&Te<0&&Be<0&&Je<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=Nf(this.tileID,this.map.transform.projection),[d,f,g,x]=this.coordinates.map(H=>{const ee=l.projection.project(H[0],H[1]);return r1(l,ee)._round()});this.perspectiveTransform=_1(d.x,d.y,f.x,f.y,g.x,g.y,x.x,x.y);const b=this._boundsArray=new tl;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(f.x,f.y,pt,0),b.emplaceBack(x.x,x.y,0,pt),b.emplaceBack(g.x,g.y,pt,pt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,cx.members),this.boundsSegments=kn.simpleSegment(0,0,4,2);const S=[],E=[vg((I=this.coordinates)[0]),vg(I[1]),vg(I[2]),vg(I[3])];var I;const[D,z,F,$]=function(H){let ee=H[0][0],K=ee,N=H[0][1],Z=N;for(let Q=1;Q<H.length;Q++)H[Q][0]<ee?ee=H[Q][0]:H[Q][0]>K&&(K=H[Q][0]),H[Q][1]<N?N=H[Q][1]:H[Q][1]>Z&&(Z=H[Q][1]);return[ee,N,K-ee,Z-N]}(E);{const H=new tl,[ee,K,N,Z]=function(Oe){let Ke=Oe[0].x,Le=Ke,Fe=Oe[0].y,at=Fe;for(let lt=1;lt<Oe.length;lt++)Oe[lt].x<Ke?Ke=Oe[lt].x:Oe[lt].x>Le&&(Le=Oe[lt].x),Oe[lt].y<Fe?Fe=Oe[lt].y:Oe[lt].y>at&&(at=Oe[lt].y);return[Ke,Fe,Le-Ke,at-Fe]}(o),Q=Oe=>[(Oe.x-ee)/N,(Oe.y-K)/Z],[re,pe,_e,xe]=o.map(Q),Te=function(Oe,Ke,Le,Fe,at,lt,kt,Et){const gt=xg(0,0,1,0,1,1,0,1);return je(gt,gt,Ie([],xg(Oe,Ke,Le,Fe,at,lt,kt,Et)))}(re[0],re[1],pe[0],pe[1],_e[0],_e[1],xe[0],xe[1]);this.elevatedGlobePerspectiveTransform=_1(re[0],re[1],pe[0],pe[1],_e[0],_e[1],xe[0],xe[1]);const Be=(Oe,Ke)=>{S.push(Oe.lng);const Le=Math.round((Oe.lng-D)/F*pt),Fe=Math.round((Oe.lat-z)/$*pt),at=Q(Ke),lt=Sr([],[at[0],at[1],1],Te),kt=Math.round(lt[0]/lt[2]*pt),Et=Math.round(lt[1]/lt[2]*pt);H.emplaceBack(Le,Fe,kt,Et)},Je=o[3].x-o[0].x,Ze=o[3].y-o[0].y,Ye=o[2].x-o[1].x,rt=o[2].y-o[1].y;for(let Oe=0;Oe<65;Oe++){const Ke=Oe/64,Le=[o[0].x+Ke*Je,o[0].y+Ke*Ze],Fe=[o[1].x+Ke*Ye,o[1].y+Ke*rt],at=Fe[0]-Le[0],lt=Fe[1]-Le[1];for(let kt=0;kt<65;kt++){const Et=kt/64,gt={x:Le[0]+at*Et,y:Le[1]+lt*Et};Be(i.projection.unproject(gt.x,gt.y),gt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(H,cx.members)}{this.maxLongitudeTriangleSize=0;let H=[],ee=new Ar;const K=(N,Z,Q)=>{ee.emplaceBack(N,Z,Q);const re=S[N],pe=S[Z],_e=S[Q],xe=Math.min(Math.min(re,pe),_e),Te=Math.max(Math.max(re,pe),_e)-xe;Te>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Te),H.push(xe+Te/2)};for(let N=0;N<64;N++)for(let Z=0;Z<64;Z++){const Q=65*N+Z,re=Q+1,pe=Q+65,_e=pe+1;K(Q,pe,re),K(re,pe,_e)}[H,ee]=function(N,Z){const Q=Array.from({length:N.length},(_e,xe)=>xe);Q.sort((_e,xe)=>N[_e]-N[xe]);const re=[],pe=new Ar;for(let _e=0;_e<Q.length;_e++){const xe=Q[_e];re.push(N[xe]);const Te=3*xe,Be=Te+1;pe.emplaceBack(Z.uint16[Te],Z.uint16[Be],Z.uint16[Be+1])}return[re,pe]}(H,ee),this.elevatedGlobeTrianglesCenterLongitudes=H,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ee)}this.elevatedGlobeSegments=kn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/pt,0,$/pt,0,0,z,D,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof yg||(this.texture?this.texture.update(this.image):(this.texture=new dx(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let l=(d=e+180)+360*Math.round((o[0]-d)/360);var d;const f=new kn,g=(E,I)=>{f.segments.push({vertexOffset:0,primitiveOffset:E,vertexLength:i.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-l)<=x){const E=Bo(o,0,o.length,l+x);return E===o.length||g(E,Ur(o,E+1,o.length,l+360-x)-E),f}l<o[0]&&(l+=360);const b=Ur(o,0,o.length,l-x);if(b===o.length)return g(0,o.length),f;g(0,b-0);const S=Bo(o,b+1,o.length,l+x);return S!==o.length&&g(S,o.length-S),f}}const NM=(Math.pow(256,2)-1)/16907520;class x1 extends _s{constructor(e,i,o,l){super(e,{layout:m1||(m1=new $n({visibility:new ut(Ce.layout_raster.visibility)})),paint:g1||(g1=new $n({"raster-opacity":new ut(Ce.paint_raster["raster-opacity"]),"raster-color":new Qa(Ce.paint_raster["raster-color"]),"raster-color-mix":new ut(Ce.paint_raster["raster-color-mix"]),"raster-color-range":new ut(Ce.paint_raster["raster-color-range"]),"raster-hue-rotate":new ut(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Ce.paint_raster["raster-saturation"]),"raster-contrast":new ut(Ce.paint_raster["raster-contrast"]),"raster-resampling":new ut(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Ce.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ut(Ce.paint_raster["raster-emissive-strength"]),"raster-array-band":new ut(Ce.paint_raster["raster-array-band"]),"raster-elevation":new ut(Ce.paint_raster["raster-elevation"]),"raster-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof y1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(l)||o===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Tf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,l])}}let v1,b1,w1,T1,S1;class E1 extends _s{constructor(e,i,o,l){super(e,{layout:v1||(v1=new $n({visibility:new ut(Ce["layout_raster-particle"].visibility)})),paint:b1||(b1=new $n({"raster-particle-array-band":new ut(Ce["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ut(Ce["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Qa(Ce["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ut(Ce["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ut(Ce["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ut(Ce["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ut(Ce["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ut(Ce["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,l),this._updateColorRamp(),this.lastInvalidatedAt=lo.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Tf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=lo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class VM extends _s{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function fx(n,e,i){const o=[0,0,1],l=Dr([]);return Nr(l,l,i?-B(n)+Math.PI:B(n)),fr(l,l,-B(e)),Rr(o,o,l),xi(o,o)}function A1(n,e){const i=bg(n.projection,n.zoom,n.width,n.height),o=function(d,f,g,x,b){const S=new U(g.lng-180*tc,g.lat),E=new U(g.lng+180*tc,g.lat),I=d.project(S.lng,S.lat),D=d.project(E.lng,E.lat),z=-Math.atan2(D.y-I.y,D.x-I.x),F=Pe.fromLngLat(g);F.y=ve(F.y,-1+tc,1-tc);const $=F.toLngLat(),H=d.project($.lng,$.lat),ee=Pe.fromLngLat($);ee.x+=tc;const K=ee.toLngLat(),N=d.project(K.lng,K.lat),Z=C1(N.x-H.x,N.y-H.y,z),Q=Pe.fromLngLat($);Q.y+=tc;const re=Q.toLngLat(),pe=d.project(re.lng,re.lat),_e=C1(pe.x-H.x,pe.y-H.y,z),xe=Math.abs(Z.x)/Math.abs(_e.y),Te=Re([]);Vt(Te,Te,-z*(1-(b?0:x)));const Be=Re([]);return ot(Be,Be,[1,1-(1-xe)*x,1]),Be[4]=-_e.x/_e.y*x,Vt(Be,Be,z),et(Be,Te,Be),Be}(n.projection,0,n.center,i,e),l=I1(n);return ot(o,o,[l,l,1]),o}function I1(n){const e=n.projection,i=bg(n.projection,n.zoom,n.width,n.height),o=px(e,n.center),l=px(e,U.convert(e.center));return Math.pow(2,o*i+(1-i)*l)}function bg(n,e,i,o,l=1/0){const d=n.range;if(!d)return 0;const f=Math.min(l,Math.max(i,o)),g=Math.log(f/1024)/Math.LN2;return be(d[0]+g,d[1]+g,e)}const tc=1/4e4;function px(n,e){const i=ve(e.lat,-85.051129,Ee),o=new U(e.lng-180*tc,i),l=new U(e.lng+180*tc,i),d=n.project(o.lng,i),f=n.project(l.lng,i),g=Pe.fromLngLat(o),x=Pe.fromLngLat(l),b=f.x-d.x,S=f.y-d.y,E=x.x-g.x,I=x.y-g.y,D=Math.sqrt((E*E+I*I)/(b*b+S*S));return Math.log(D)/Math.LN2}function C1(n,e,i){const o=Math.cos(i),l=Math.sin(i);return{x:n*o-e*l,y:n*l+e*o}}function M1(n,e,i){Re(n),Vt(n,n,B(e[2])),Ct(n,n,B(e[0])),Dt(n,n,B(e[1])),ot(n,n,i),et(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function wg(n,e,i,o,l,d,f,g){const x=[i[0]-e[0],i[1]-e[1],0],b=[o[0]-e[0],o[1]-e[1],0];if(yi(x)<1e-12||yi(b)<1e-12)return Dr(n);const S=ji([],x,b);xi(S,S),Vi(b,o,e),x[2]=(d-l)*g,b[2]=(f-l)*g;const E=x;return ji(E,x,b),xi(E,E),jr(n,S,E)}function mx(n,e,i=!1){const o=Xl(e.zoom),l=function(d,f,g){const x=f.worldSize,b=[d[12],d[13],d[14]],S=ge(b[1]/x),E=me(b[0]/x),I=Re([]),D=ae(1,S)*x,z=ae(1,0)*x*$e(S,f.zoom),F=1/Ty(x);let $=z*F;if(g){const N=bg(f.projection,f.zoom,f.width,f.height,1024);$=F*f.projection.pixelSpaceConversion(f.center.lat,x,N)}const H=j(S,E);Pi(H,H,ti([],xi([],H),D*$*b[2]));const ee=function(N){const Z=[N[0],N[1],N[2]];let Q=[0,1,0];const re=ji([],Q,Z);return ji(Q,Z,re),Wn(Q)===0&&(Q=[0,1,0],ji(re,Z,Q)),xi(re,re),xi(Q,Q),xi(Z,Z),[re[0],re[1],re[2],0,Q[0],Q[1],Q[2],0,Z[0],Z[1],Z[2],0,N[0],N[1],N[2],1]}(H);ot(I,I,[$,$,$*D]),vt(I,I,[-b[0],-b[1],-b[2]]);const K=et([],f.globeMatrix,ee);return et(K,K,I),et(K,K,d),K}(n,e,i);if(o>0){const d=function(f,g){const x=g.worldSize,b=ae(1,0)*x*$e(g.center.lat,g.zoom)/Ty(x),S=ae(1,g.center.lat)*x,E=Re([]);return Dt(E,E,B(g.center.lng)),Ct(E,E,B(g.center.lat)),vt(E,E,[0,0,m]),ot(E,E,[b,b,b*S]),vt(E,E,[g.point.x-.5*x,g.point.y-.5*x,0]),et(E,E,f),et(E,g.globeMatrix,E)}(n,e);return function(f,g,x){const b=(z,F,$)=>{const H=yi(z),ee=yi(F),K=ol(z,F,$);return ti(K,K,1/yi(K)*Nt(H,ee,$))},S=b([f[0],f[1],f[2]],[g[0],g[1],g[2]],x),E=b([f[4],f[5],f[6]],[g[4],g[5],g[6]],x),I=b([f[8],f[9],f[10]],[g[8],g[9],g[10]],x),D=ol([f[12],f[13],f[14]],[g[12],g[13],g[14]],x);return[S[0],S[1],S[2],0,E[0],E[1],E[2],0,I[0],I[1],I[2],0,D[0],D[1],D[2],1]}(l,d,o)}return l}function P1(n,e,i,o){const l=In.projectAabbCorners(o,i);let d=Number.MAX_VALUE,f=-1;for(let b=0;b<l.length;++b){const S=l[b];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<d&&(f=b,d=S[2])}const g=b=>new dt(l[b][0],l[b][1]);let x;switch(f){case 0:case 6:x=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:x=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:x=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:x=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Ut(n,x))return d}const jM=Ni([{name:"a_pos_3f",components:3,type:"Float32"}]),UM=Ni([{name:"a_color_3f",components:3,type:"Float32"}]),$M=Ni([{name:"a_color_4f",components:4,type:"Float32"}]),GM=Ni([{name:"a_uv_2f",components:2,type:"Float32"}]),HM=Ni([{name:"a_normal_3f",components:3,type:"Float32"}]),qM=Ni([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),WM=Ni([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),R1={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Tg{constructor(e,i,o,l){this.message=(e?`${e}: `:"")+o,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function gx(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class D1{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class z1{constructor(){this.instancedDataArray=new $l,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class _x{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,l){this.tileToMeter=Se(o);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const S=g??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),E=Ot(f,d);if(!this.layers[0]._featureFilter.filter(new nn(this.zoom),E,o))continue;const I={id:S,sourceLayerIndex:b,index:x,geometry:d?E.geometry:At(f,o,l),properties:f.properties,type:f.type,patterns:{}},D=this.addFeature(I,I.geometry,E);D&&i.featureIndex.insert(f,I.geometry,x,b,this.index,this.instancesPerModel[D].instancedDataArray.length,pt/32)}this.lookup=null}update(e,i,o,l){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const g in e)f.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(f.features[f.idToFeaturesIndex[g]],e[g],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const l of o.features){const d=this.layers[0],f=l.feature,g=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},g),b=d.paint.get("model-scale").evaluate(f,{},g),S=d.paint.get("model-translation").evaluate(f,{},g);Zn(l.rotation,x)&&Zn(l.scale,b)&&Zn(l.translation,S)||(this.evaluate(l,l.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,l){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Vy(this.activeReplacements,d))return!1;this.activeReplacements=d;let f=!1;for(const g in this.instancesPerModel){const x=this.instancesPerModel[g],b=x.instancedDataArray;for(const S of x.features){const E=S.instancedDataOffset,I=S.instancedDataCount;for(let D=0;D<I;D++){const z=16*(D+E);let F=b.float32[z+0];const $=F>pt;F=$?F-pt:F;const H=Math.floor(F),ee=b.float32[z+1];let K=!1;for(const N of this.activeReplacements)if(!Bb(N,o,R1.Model,l)&&!(N.min.x>H||H>N.max.x||N.min.y>ee||ee>N.max.y)&&(K=Gb($b(H,ee,e.canonical,N.footprintTileId.canonical),N.footprint),K))break;b.float32[z]=K?F+pt:F,f=f||K!==$}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,qM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const l=this.layers[0],d=l.layout.get("model-id").evaluate(o,{},this.canonical);if(!d)return vi(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),d;(gx(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new z1);const f=this.instancesPerModel[d],g=f.instancedDataArray,x=new D1(o,g.length);for(const b of i)for(const S of b){if(S.x<0||S.x>=pt||S.y<0||S.y>=pt)continue;const E=(this.lookupDim-1)/pt,I=this.lookupDim*(S.y*E|0)+S.x*E|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const D=g.length;g.resize(D+1),f.instancesEvaluatedElevation.push(0),g.float32[16*D]=S.x,g.float32[16*D+1]=S.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,o,l){const d=this.layers[0],f=e.feature,g=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,i,g),b=e.scale=d.paint.get("model-scale").evaluate(f,i,g),S=e.translation=d.paint.get("model-translation").evaluate(f,i,g),E=d.paint.get("model-color").evaluate(f,i,g);E.a=d.paint.get("model-color-mix-intensity").evaluate(f,i,g);const I=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),M1(I,x,b);const D=Math.round(100*E.a)+E.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const F=e.instancedDataOffset+z,$=16*F,H=o.instancedDataArray.float32;let ee=0;l&&(ee=H[$+6]-o.instancesEvaluatedElevation[F]);const K=0|H[$+1];H[$]=(0|H[$])+E.r/1.05,H[$+1]=K+E.g/1.05,H[$+2]=D,H[$+3]=1/(g.z>10?this.tileToMeter:Se(g,K)),H[$+4]=S[0],H[$+5]=S[1],H[$+6]=S[2]+ee,H[$+7]=I[0],H[$+8]=I[1],H[$+9]=I[2],H[$+10]=I[4],H[$+11]=I[5],H[$+12]=I[6],H[$+13]=I[8],H[$+14]=I[9],H[$+15]=I[10],o.instancesEvaluatedElevation[F]=S[2]}}}let L1,k1;Tt(_x,"ModelBucket",{omit:["layers"]}),Tt(z1,"PerModelAttributes"),Tt(D1,"ModelFeature");const ou=64,Lh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function O1(n,e,i,o,l,d,f,g,x,b=!1){const S=i.zoom,E=i.project(o),I=$e(o.lat,S),D=1/I;Re(n),vt(n,n,[E.x+f[0]*D,E.y+f[1]*D,f[2]]);let z=1,F=1;const $=i.worldSize;if(b){if(i.projection.name==="mercator"){let N=0;i.elevation&&(N=i.elevation.getAtPointOrZero(new Pe(E.x/$,E.y/$),0));const Z=tr([],[E.x,E.y,N,1],i.projMatrix)[3]/i.cameraToCenterDistance;z=Z,F=Z*$e(i.center.lat,S)}else if(i.projection.name==="globe"){const N=mx(n,i),Z=[0,0,0,1];tr(Z,Z,et([],i.projMatrix,N));const Q=Z[3]/i.cameraToCenterDistance,re=Xl(S),pe=i.projection.pixelsPerMeter(o.lat,$)*$e(o.lat,S),_e=i.projection.pixelsPerMeter(i.center.lat,$)*$e(i.center.lat,S);z=Q/Nt(pe,qe(i.center.lat),re),F=Q*I/pe,z*=_e,F*=_e}}else z=D;ot(n,n,[z,z,F]);const H=[...n],ee=e.orientation,K=[];if(M1(K,[ee[0]+l[0],ee[1]+l[1],ee[2]+l[2]],d),et(n,H,K),g&&i.elevation){let N=0;const Z=[];if(x&&i.elevation){N=function(re,pe,_e,xe,Te){const Be=pe.elevation;if(!Be)return 0;const Je=In.projectAabbCorners(_e,xe),Ze=ae(1,Te.lat)*pe.worldSize,Ye=function(st,Zt){const Pt=[0,0,1],Rt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ht of Rt){const ei=st[Ht.corners[0]],ni=st[Ht.corners[1]],di=st[Ht.corners[2]],ai=[ni[0]-ei[0],ni[1]-ei[1],Zt*(ni[2]-ei[2])],si=ji(ai,ai,[di[0]-ei[0],di[1]-ei[1],Zt*(di[2]-ei[2])]);xi(si,si),Ht.dotProductWithUp=Ai(si,Pt)}return Rt.sort((Ht,ei)=>Ht.dotProductWithUp-ei.dotProductWithUp),Rt[0].corners}(Je,Ze),rt=Je[Ye[0]],Oe=Je[Ye[1]],Ke=Je[Ye[2]],Le=Je[Ye[3]],Fe=Be.getAtPointOrZero(new Pe(rt[0]/pe.worldSize,rt[1]/pe.worldSize),0),at=Be.getAtPointOrZero(new Pe(Oe[0]/pe.worldSize,Oe[1]/pe.worldSize),0),lt=Be.getAtPointOrZero(new Pe(Ke[0]/pe.worldSize,Ke[1]/pe.worldSize),0),kt=Be.getAtPointOrZero(new Pe(Le[0]/pe.worldSize,Le[1]/pe.worldSize),0),Et=(Fe+kt)/2,gt=(at+lt)/2;return Et>gt?at<lt?wg(re,Oe,Le,rt,at,kt,Fe,Ze):wg(re,Ke,rt,Le,lt,Fe,kt,Ze):Fe<kt?wg(re,rt,Oe,Ke,Fe,at,lt,Ze):wg(re,Le,Ke,Oe,kt,lt,at,Ze),Math.max(Et,gt)}(Z,i,e.aabb,n,o);const Q=et([],Ei([],Z),K);et(n,H,Q)}else N=i.elevation.getAtPointOrZero(new Pe(E.x/$,E.y/$),0);N!==0&&(n[14]+=N)}}function Gf(n,e,i=!1){n.uploaded||(n.gfxTexture=new dx(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function ZM(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,jM.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,HM.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,GM.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?UM:$M).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,WM.members,!0)),n.segments=kn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&Gf(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Gf(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Gf(o.normalTexture,e),o.occlusionTexture&&Gf(o.occlusionTexture,e,i),o.emissionTexture&&Gf(o.emissionTexture,e)}function yx(n,e,i){if(n.meshes)for(const o of n.meshes)ZM(o,e,i);if(n.children)for(const o of n.children)yx(o,e,i)}function Sg(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)Sg(e)}function xx(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)xx(i)}class kh{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const l=o||e.findDEMTileFor(i);if(!l||!l.dem)return;const d=l.dem,f=l.tileID,g=1<<i.canonical.z-f.canonical.z;return new kh(l,d.dim/pt/g,[(i.canonical.x/g-f.canonical.x)*d.dim,(i.canonical.y/g-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new dt(l,d)}getElevationAt(e,i,o,l){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],g=Math.floor(d),x=Math.floor(f),b=this._dem;return l=!!l,o?Nt(Nt(b.get(g,x,l),b.get(g,x+1,l),f-x),Nt(b.get(g+1,x,l),b.get(g+1,x+1,l),f-x),d-g):b.get(g,x,l)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ae(1,e)*this._dem.stride}}const vx=new Float32Array(262144),au=new Uint8Array(262144);function F1(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,F1(i));return e}function B1(n,e,i){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const l=In.applyTransform(o.aabb,n.matrix);i.insert(e,l.min[0],l.min[1],l.max[0],l.max[1])}if(n.children)for(const o of n.children)B1(o,e,i)}const N1=["","wall","door","roof","window","lamp","logo"];class V1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:F1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=In.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Eg{constructor(e,i,o,l,d,f,g){this.id=o,this.layers=e,this.layerIds=this.layers.map(x=>x.fqid),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.modelTraits|=Lh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=Lh.HasMapboxMeshFeatures),d&&(this.modelTraits|=Lh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const x of i)this.nodesInfo.push(new V1(x)),B1(x,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const l=o.node;l.footprint&&i.push({footprint:l.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!ao(e,this.states))for(const l of o)this.evaluate(l,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const l=o.node;this.uploaded?this.updatePbrBuffer(l):yx(l,e,!0)}for(const o of i)Sg(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const l=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;if(!this.uploaded||this.dirty||l.name!==this.projection.name||Hf(o.paint.get("model-color").value,f)||Hf(o.paint.get("model-color-mix-intensity").value,f)||Hf(o.paint.get("model-roughness").value,f)||Hf(o.paint.get("model-emissive-strength").value,f)||Hf(o.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=l,this.brightness=d;const g=this.getNodesInfo();for(const x of g)x.state=null;return!0}return!1}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),l=this.id.canonical;for(const d of o){const f=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e,i){const o=this.getNodesInfo();for(const l of o){if(!l.node.meshes)continue;const d=l.feature,f=i&&i[d.id];if(ao(f,l.state))continue;l.state=structuredClone(f);const g=l.node.meshes&&l.node.meshes[0].featureData,x=l.evaluatedColor[2],b=l.evaluatedRMEA[2],S=this.id.canonical;if(l.hasTranslucentParts=!1,g){for(let E=0;E<N1.length;E++){const I=N1[E];I.length&&(d.properties.part=I);const D=e.paint.get("model-color").evaluate(d,f,S).toRenderColor(null),z=e.paint.get("model-color-mix-intensity").evaluate(d,f,S);l.evaluatedColor[E]=[D.r,D.g,D.b,z],l.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(d,f,S),l.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(d,f,S),l.evaluatedRMEA[E][3]=D.a,l.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,f,S),!l.hasTranslucentParts&&D.a<1&&(l.hasTranslucentParts=!0)}delete d.properties.part,KM(l,x!==l.evaluatedColor[2]||b!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,f,S);l.evaluatedScale=e.paint.get("model-scale").evaluate(d,f,S),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,l){const d=e.findDEMTileFor(o);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=kh.create(e,o,d);if(!f)return;this.modelTraits&Lh.HasMapboxMeshFeatures&&this.updateDEM(e,f,o,l);for(const g of this.getNodesInfo()){const x=g.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const b=x.footprint.vertices;let S=f.getElevationAt(b[0].x,b[0].y,!0,!0);for(let E=1;E<b.length;E++)S=Math.min(S,f.getElevationAt(b[E].x,b[E].y,!0,!0));x.elevation=S}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,l){let d=i._dem._modifiedForSources[l];if(d===void 0&&(i._dem._modifiedForSources[l]=[],d=i._dem._modifiedForSources[l]),d.includes(o.canonical))return;const f=i._dem.dim;d.push(o.canonical);let g=!1;for(const x of this.getNodesInfo()){const b=x.node;if(!b.footprint||!b.footprint.grid)continue;const S=b.footprint.grid,E=i.tileCoordToPixel(S.min.x,S.min.y),I=i.tileCoordToPixel(S.max.x,S.max.y),D=Math.min(Math.min(f-I.y,E.x),Math.min(E.y,f-I.x));if(D<0)continue;const z=ve(D,2,5);let F=Math.max(0,E.x-z),$=Math.max(0,E.y-z),H=Math.min(I.x+z,f-1),ee=Math.min(I.y+z,f-1);for(let Q=$;Q<=ee;++Q)for(let re=F;re<=H;++re)au[Q*f+re]=255;let K=0,N=0;for(let Q=0;Q<S.cellsY;++Q)for(let re=0;re<S.cellsX;++re){if(!S.cells[Q*S.cellsX+re])continue;const pe=i.tileCoordToPixel(S.min.x+re/S.xScale,S.min.y+Q/S.yScale),_e=i.tileCoordToPixel(S.min.x+(re+1)/S.xScale,S.min.y+(Q+1)/S.yScale);for(let xe=pe.y;xe<=Math.min(_e.y+1,f-1);++xe)for(let Te=pe.x;Te<=Math.min(_e.x+1,f-1);++Te)au[xe*f+Te]===255&&(au[xe*f+Te]=0,K+=i.getElevationAtPixel(Te,xe),N++)}const Z=K/N;F=Math.max(1,E.x-z),$=Math.max(1,E.y-z),H=Math.min(I.x+z,f-2),ee=Math.min(I.y+z,f-2),g=!0;for(let Q=$;Q<=ee;++Q)for(let re=F;re<=H;++re)au[Q*f+re]===0&&(vx[Q*f+re]=i._dem.set(re,Q,Z));for(let Q=1;Q<z;++Q){F=Math.max(1,E.x-Q),$=Math.max(1,E.y-Q),H=Math.min(I.x+Q,f-2),ee=Math.min(I.y+Q,f-2);for(let re=$;re<=ee;++re)for(let pe=F;pe<=H;++pe){const _e=re*f+pe;if(au[_e]===255){let xe=0,Te=0,Be=-1,Je=-1;for(let Ze=-1;Ze<=1;++Ze)for(let Ye=-1;Ye<=1;++Ye){const rt=(re+Ze)*f+pe+Ye;if(au[rt]>=Q)continue;const Oe=vx[rt],Ke=Math.abs(Oe);Ke>Te&&(xe=Oe,Te=Ke,Be=Ye,Je=Ze)}if(Te>.1){const Ze=1-(Q+.5*Math.abs(Be*Je))/z;let Ye=i._dem.get(pe,re)+xe*Ze;const rt=i._dem.get(pe+Be,re+Je),Oe=i._dem.get(pe-Be,re-Je,!0);(Ye-rt)*(Ye-Oe)>0&&(Ye=(rt+Oe)/2),vx[_e]=i._dem.set(pe,re,Ye),au[_e]=Q}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=lo.now())}setFilter(e){this.filter=e?rf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new nn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Sg(i.node),xx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const f=l[d].node;l[d].hiddenByReplacement=!!f.footprint&&!o.find(g=>g.footprint===f.footprint)}}getHeightAtTileCoord(e,i){const o=this.getNodesInfo(),l=[],d=[0,0,0],f=Re([]);for(let g=0;g<this.nodesInfo.length;g++){const x=o[g],b=x.node.meshes[0],S=b.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};Ue(f,x.node.matrix),d[0]=e,d[1]=i,zi(d,d,f);const E=(d[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*ou|0,I=Math.min(63,(d[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*ou|0)*ou+Math.min(63,E),D=b.heightmap[I];if(!(D<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:D,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new dt(e,i),new dt(e,i),l),l.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function Hf(n,e){return n instanceof Xa&&!n.isLightConstant&&e}function XM(n,e,i,o,l,d,f,g){let x=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;i[3]>0&&(x=Nt(x,255*i[0],i[3]),b=Nt(b,255*i[1],i[3]),S=Nt(S,255*i[2],i[3]));const E=x<<8|b,I=S<<8|Math.floor(255*o[3]),D=function(Q){const re=ve(Q,0,2);return Math.min(Math.round(.5*re*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],z=ve(l[0],0,1),F=ve(l[1],0,1),$=ve(l[2],0,1),H=ve(l[3],0,1);let ee,K,N,Z;if(z!==F&&f!==d&&F!==z){const Q=f-d;K=1/(Q*(F-z)),N=-(d+Q*z)/(Q*(F-z));const re=ve(l[4],-1,1);Z=Math.pow(10,re),ee=255*$<<8|255*H}else ee=65535,K=0,N=1,Z=1;if(n.emplaceBack(E,I,D,ee,K,N,Z),g){const Q=g.length;g.clear();for(let re=0;re<Q;re++)g.emplaceBack(E,I,D,ee,K,N,Z)}}function KM(n,e,i){const o=n.node;let l=0;const d=i&Lh.HasMeshoptCompression;for(const f of o.meshes){if(o.lights&&o.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new qc,f.featureArray.reserve(f.featureData.length);let g=e;for(const x of f.featureData){const b=d?65535&x:x>>16&65535,S=d?x>>16&65535:65535&x,E=(15&S)<8?15&S:0,I=n.evaluatedRMEA[E],D=n.evaluatedColor[E],z=n.emissionHeightBasedParams[E];let F;if(g&&E===2&&o.lights&&(F=new qc,F.resize(10*o.lights.length)),XM(f.featureArray,b,D,I,z,f.aabb.min[2],f.aabb.max[2],F),F&&g){g=!1;const $=o.meshes[o.lightMeshIndex];$.featureArray=F,$.featureArray._trim()}}f.featureArray._trim(),l++}}function j1(n,e,i,o){const l=1<<n.z;e.lat=ge((o/pt+n.y)/l),e.lng=me((i/pt+n.x)/l)}Tt(Eg,"Tiled3dModelBucket",{omit:["layers"]}),Tt(V1,"Tiled3dModelFeature");const YM={circle:class extends _s{constructor(n,e,i,o){super(n,{layout:Gi||(Gi=new $n({"circle-sort-key":new wt(Ce.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ut(Ce.layout_circle["circle-elevation-reference"]),visibility:new ut(Ce.layout_circle.visibility)})),paint:Dn||(Dn=new $n({"circle-radius":new wt(Ce.paint_circle["circle-radius"]),"circle-color":new wt(Ce.paint_circle["circle-color"]),"circle-blur":new wt(Ce.paint_circle["circle-blur"]),"circle-opacity":new wt(Ce.paint_circle["circle-opacity"]),"circle-translate":new ut(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(Ce.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ut(Ce.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(n){return new Mt(n)}queryRadius(n){const e=n;return ri("circle-radius",this,e)+ri("circle-stroke-width",this,e)+En(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,l,d,f,g){const x=An(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return tb(n,o,d,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=eb(this);return{config:new xa(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends _s{createBucket(n){return new nb(n)}constructor(n,e,i,o){super(n,{layout:rb||(rb=new $n({visibility:new ut(Ce.layout_heatmap.visibility)})),paint:sb||(sb=new $n({"heatmap-radius":new wt(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qa(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Ce.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return ri("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,l,d,f,g){const x=this.paint.get("heatmap-radius").evaluate(e,i);return tb(n,o,d,f,g,!0,!0,new dt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new xa(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends _s{constructor(n,e,i,o){super(n,{layout:ob||(ob=new $n({visibility:new ut(Ce.layout_hillshade.visibility)})),paint:ab||(ab=new $n({"hillshade-illumination-direction":new ut(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Ce.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ut(Ce.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends _s{constructor(n,e,i,o){super(n,{layout:zb||(zb=new $n({"fill-sort-key":new wt(Ce.layout_fill["fill-sort-key"]),visibility:new ut(Ce.layout_fill.visibility),"fill-elevation-reference":new ut(Ce.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new wt(Ce.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Lb||(Lb=new $n({"fill-antialias":new ut(Ce.paint_fill["fill-antialias"]),"fill-opacity":new wt(Ce.paint_fill["fill-opacity"]),"fill-color":new wt(Ce.paint_fill["fill-color"]),"fill-outline-color":new wt(Ce.paint_fill["fill-outline-color"]),"fill-translate":new ut(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new wt(Ce.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ut(Ce.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ut(Ce.paint_fill["fill-emissive-strength"]),"fill-z-offset":new wt(Ce.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new wt(Ce.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new wt(Ce.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new xa(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Fy(n)}queryRadius(){return En(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,l,d){return!n.queryGeometry.isAboveHorizon&&mi(Li(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends _s{constructor(n,e,i,o){super(n,{layout:sw||(sw=new $n({visibility:new ut(Ce["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ut(Ce["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ow||(ow=new $n({"fill-extrusion-opacity":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new wt(Ce["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ut(Ce["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new eg(n)}queryRadius(){return En(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,l,d,f,g,x){const b=An(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),I=[0,0],D=g&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,F=n.tile.getBucket(this);if(D&&F instanceof eg){const N=F.centroidVertexArray,Z=x+1;Z<N.length&&(I[0]=N.geta_centroid_pos0(Z),I[1]=N.geta_centroid_pos1(Z))}if(I[0]===0&&I[1]===1)return!1;d.projection.name==="globe"&&(o=rw([o],[new dt(0,0),new dt(pt,pt)],n.tileID.canonical).map(N=>N.polygon).flat());const $=D?g:null,[H,ee]=function(N,Z,Q,re,pe,_e,xe,Te,Be,Je,Ze){return N.projection.name==="globe"?function(Ye,rt,Oe,Ke,Le,Fe,at,lt,kt,Et,gt){const st=[],Zt=[],Pt=Ye.projection.upVectorScale(gt,Ye.center.lat,Ye.worldSize).metersToTile,Rt=[0,0,0,1],Ht=[0,0,0,1],ei=(di,ai,si,cn)=>{di[0]=ai,di[1]=si,di[2]=cn,di[3]=1},ni=nw();Oe>0&&(Oe+=ni),Ke+=ni;for(const di of rt){const ai=[],si=[];for(const cn of di){const xn=cn.x+Le.x,te=cn.y+Le.y,se=Ye.projection.projectTilePoint(xn,te,gt),Ve=Ye.projection.upVector(gt,cn.x,cn.y);let ht=Oe,xt=Ke;if(at){const _t=dw(xn,te,Oe,Ke,at,lt,kt,Et);ht+=_t.base,xt+=_t.top}Oe!==0?ei(Rt,se.x+Ve[0]*Pt*ht,se.y+Ve[1]*Pt*ht,se.z+Ve[2]*Pt*ht):ei(Rt,se.x,se.y,se.z),ei(Ht,se.x+Ve[0]*Pt*xt,se.y+Ve[1]*Pt*xt,se.z+Ve[2]*Pt*xt),zi(Rt,Rt,Fe),zi(Ht,Ht,Fe),ai.push(new nu(Rt[0],Rt[1],Rt[2])),si.push(new nu(Ht[0],Ht[1],Ht[2]))}st.push(ai),Zt.push(si)}return[st,Zt]}(N,Z,Q,re,pe,_e,xe,Te,Be,Je,Ze):xe?function(Ye,rt,Oe,Ke,Le,Fe,at,lt,kt){const Et=[],gt=[],st=[0,0,0,1];for(const Zt of Ye){const Pt=[],Rt=[];for(const Ht of Zt){const ei=Ht.x+Ke.x,ni=Ht.y+Ke.y,di=dw(ei,ni,rt,Oe,Fe,at,lt,kt);st[0]=ei,st[1]=ni,st[2]=di.base,st[3]=1,tr(st,st,Le),st[3]=Math.max(st[3],1e-5);const ai=new nu(st[0]/st[3],st[1]/st[3],st[2]/st[3]);st[0]=ei,st[1]=ni,st[2]=di.top,st[3]=1,tr(st,st,Le),st[3]=Math.max(st[3],1e-5);const si=new nu(st[0]/st[3],st[1]/st[3],st[2]/st[3]);Pt.push(ai),Rt.push(si)}Et.push(Pt),gt.push(Rt)}return[Et,gt]}(Z,Q,re,pe,_e,xe,Te,Be,Je):function(Ye,rt,Oe,Ke,Le){const Fe=[],at=[],lt=Le[8]*rt,kt=Le[9]*rt,Et=Le[10]*rt,gt=Le[11]*rt,st=Le[8]*Oe,Zt=Le[9]*Oe,Pt=Le[10]*Oe,Rt=Le[11]*Oe;for(const Ht of Ye){const ei=[],ni=[];for(const di of Ht){const ai=di.x+Ke.x,si=di.y+Ke.y,cn=Le[0]*ai+Le[4]*si+Le[12],xn=Le[1]*ai+Le[5]*si+Le[13],te=Le[2]*ai+Le[6]*si+Le[14],se=Le[3]*ai+Le[7]*si+Le[15],Ve=cn+lt,ht=xn+kt,xt=te+Et,_t=Math.max(se+gt,1e-5),zt=cn+st,Gt=xn+Zt,wi=te+Pt,Ti=Math.max(se+Rt,1e-5);ei.push(new nu(Ve/_t,ht/_t,xt/_t)),ni.push(new nu(zt/Ti,Gt/Ti,wi/Ti))}Fe.push(ei),at.push(ni)}return[Fe,at]}(Z,Q,re,pe,_e)}(d,o,E,S,b,f,$,I,z,d.center.lat,n.tileID.canonical),K=n.queryGeometry;return function(N,Z,Q){let re=1/0;mi(Q,Z)&&(re=hw(Q,Z[0]));for(let pe=0;pe<Z.length;pe++){const _e=Z[pe],xe=N[pe];for(let Te=0;Te<_e.length-1;Te++){const Be=_e[Te],Je=[Be,_e[Te+1],xe[Te+1],xe[Te],Be];Ut(Q,Je)&&(re=Math.min(re,hw(Q,Je)))}}return re!==1/0&&re}(H,ee,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends _s{constructor(n,e,i,o){const l=ww();super(n,l,e,i,o),l.layout&&(this.layout=new Ja(l.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(zf)return zf;const i=ww();return zf=new YC(i.paint.properties["line-width"].specification),zf.useIntegerZoom=!0,zf})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Gy(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=vw(this);return{config:new xa(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=Tw(ri("line-width",this,e),ri("line-gap-width",this,e)),o=ri("line-offset",this,e);return i/2+Math.abs(o)+En(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,l,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=Li(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),g=n.pixelToTileUnitsFactor/2*Tw(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(o=function(b,S){const E=[],I=new dt(0,0);for(let D=0;D<b.length;D++){const z=b[D],F=[];for(let $=0;$<z.length;$++){const H=z[$],ee=z[$+1],K=$===0?I:H.sub(z[$-1])._unit()._perp(),N=$===z.length-1?I:ee.sub(H)._unit()._perp(),Z=K._add(N)._unit();Z._mult(1/(Z.x*N.x+Z.y*N.y)),F.push(Z._mult(S)._add(H))}E.push(F)}return E}(o,x*n.pixelToTileUnitsFactor)),function(b,S,E){for(let I=0;I<S.length;I++){const D=S[I];if(b.length>=3){for(let z=0;z<D.length;z++)if(sn(b,D[z]))return!0}if(rn(b,D,E))return!0}return!1}(f,o,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:_g,background:class extends _s{constructor(n,e,i,o){super(n,{layout:f1||(f1=new $n({visibility:new ut(Ce.layout_background.visibility)})),paint:p1||(p1=new $n({"background-pitch-alignment":new ut(Ce.paint_background["background-pitch-alignment"]),"background-color":new ut(Ce.paint_background["background-color"]),"background-pattern":new ut(Ce.paint_background["background-pattern"]),"background-opacity":new ut(Ce.paint_background["background-opacity"]),"background-emissive-strength":new ut(Ce.paint_background["background-emissive-strength"]),"background-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:x1,"raster-particle":E1,sky:class extends _s{constructor(n,e,i,o){super(n,{layout:w1||(w1=new $n({visibility:new ut(Ce.layout_sky.visibility)})),paint:T1||(T1=new $n({"sky-type":new ut(Ce.paint_sky["sky-type"]),"sky-atmosphere-sun":new ut(Ce.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ut(Ce.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ut(Ce.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ut(Ce.paint_sky["sky-gradient-radius"]),"sky-gradient":new Qa(Ce.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ut(Ce.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ut(Ce.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ut(Ce.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),l=!o,d=n.style.light,f=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?fx(f.azimuthal,90-f.polar,e):fx(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return fx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends _s{constructor(n,e,i,o){super(n,{paint:S1||(S1=new $n({}))},e,null)}},model:class extends _s{constructor(n,e,i,o){super(n,{layout:L1||(L1=new $n({visibility:new ut(Ce.layout_model.visibility),"model-id":new wt(Ce.layout_model["model-id"])})),paint:k1||(k1=new $n({"model-opacity":new wt(Ce.paint_model["model-opacity"]),"model-rotation":new wt(Ce.paint_model["model-rotation"]),"model-scale":new wt(Ce.paint_model["model-scale"]),"model-translation":new wt(Ce.paint_model["model-translation"]),"model-color":new wt(Ce.paint_model["model-color"]),"model-color-mix-intensity":new wt(Ce.paint_model["model-color-mix-intensity"]),"model-type":new ut(Ce.paint_model["model-type"]),"model-cast-shadows":new ut(Ce.paint_model["model-cast-shadows"]),"model-receive-shadows":new ut(Ce.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ut(Ce.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new wt(Ce.paint_model["model-emissive-strength"]),"model-roughness":new wt(Ce.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new wt(Ce.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ut(Ce.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ut(Ce.paint_model["model-front-cutoff"]),"model-color-use-theme":new wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new _x(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof Eg?pt-1:0}queryIntersectsFeature(n,e,i,o,l,d){if(!this.modelManager)return!1;const f=this.modelManager,g=n.tile.getBucket(this);if(!(g&&g instanceof _x))return!1;for(const x in g.instancesPerModel){const b=g.instancesPerModel[x],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(b.idToFeaturesIndex.hasOwnProperty(S)){const E=b.features[b.idToFeaturesIndex[S]],I=f.getModel(x,this.scope);if(!I)return!1;let D=He();const z=new U(0,0),F=g.canonical;let $=Number.MAX_VALUE;for(let H=0;H<E.instancedDataCount;++H){const ee=16*(E.instancedDataOffset+H),K=b.instancedDataArray.float32,N=[K[ee+4],K[ee+5],K[ee+6]];j1(F,z,K[ee],0|K[ee+1]),O1(D,I,d,z,E.rotation,E.scale,N,!1,!1,!1),d.projection.name==="globe"&&(D=mx(D,d));const Z=et([],d.projMatrix,D),Q=n.queryGeometry,re=P1(Q.isPointQuery()?Q.screenBounds:Q.screenGeometry,d,Z,I.aabb);re!=null&&($=Math.min(re,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof kl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends _s{constructor(n,e,i,o){super(n,{layout:kb||(kb=new $n({"clip-layer-types":new ut(Ce.layout_clip["clip-layer-types"]),"clip-layer-scope":new ut(Ce.layout_clip["clip-layer-scope"])})),paint:Ob||(Ob=new $n({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new Fb(n)}is3D(n){return!0}}};class JM{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QM{constructor(){this.tasks={},this.taskQueue=[],Yt(["process"],this),this.invoker=new JM(this.process),this.nextId=0}add(e,i){const o=this.nextId++,l=function({type:d,isSymbolTile:f,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-g:d==="maybePrepare"&&f?400-g:500:200-g:100-g}(i);if(l===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:l,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const d=this.tasks[this.taskQueue[l]];d.priority<i&&(i=d.priority,e=l)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class U1{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new QM}send(e,i,o,l,d=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=f,this.callbacks[g]=o);const x=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:da(i,x)},x),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(i.mustQueue||_n(self)){const l=this.callbacks[o],d=this.scheduler.add(()=>this.processTask(o,i),l&&l.metadata||{type:"message"});d&&(this.cancelCallbacks[o]=d)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(fa(i.error)):o(null,fa(i.data)))}else{const o=new Set,l=i.hasCallback?(f,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?da(f):null,data:da(g,o)},o)}:()=>{},d=fa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,l);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:g,scope:x}=d;this.parent.getWorkerSource(i.sourceMapId,f[0],g,x)[f[1]](d,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var qf={workerUrl:"",workerClass:null,workerParams:void 0};const bx="mapboxgl_preloaded_worker_pool";class lu{constructor(){this.active={}}acquire(e,i=lu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(qf.workerClass!=null?new qf.workerClass:new self.Worker(qf.workerUrl,qf.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[bx]}numActive(){return Object.keys(this.active).length}}lu.workerCount=2;class Oh{constructor(e,i,o="Worker",l=lu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=bt();const d=this.workerPool.acquire(this.id,l);for(let f=0;f<d.length;f++){const g=new Oh.Actor(d[f],i,this.id);g.name=`${o} ${f}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Ge(this.actors,(l,d)=>{l.send(e,i,d)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Wf,wx;function Ag(){return Wf||(Wf=new lu),Wf}Oh.Actor=U1;const Tx=new $i(0,0,0),Sx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Ex={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Ig={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},eP={PAINT_ORDER_FILL_AND_STROKE:1},Zf={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},$1={MASK_TYPE_LUMINANCE:1};function tP(n,e,i){n===1&&e.icons.push(function(o,l){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:f}=d;if(f.content_area){const{content_area:g}=f;g.top==null&&(g.top=g.left),g.width==null&&(g.width=d.usvg_tree.width),g.height==null&&(g.height=g.width)}return f.stretch_x&&f.stretch_x.length&&G1(f,"x"),f.stretch_y&&f.stretch_y.length&&G1(f,"y"),d}(o.readFields(iP,{name:void 0},l))}(i,i.readVarint()+i.pos))}function G1(n,e){const i=[],o=n[`stretch_${e}`];let l=null;for(let d=0;d<o.length;d++)l===null?l=i.length===0?o[0]:i[i.length-1][1]+o[d]:(i.push([l,l+o[d]]),l=null);n[`stretch_${e}_areas`]=i}function iP(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(o,l){return o.readFields(nP,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},l)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(o,l){return o.readFields(oP,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},l)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function nP(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(o,l){return o.readFields(rP,{left:0},l)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(o,l){return o.readFields(sP,{name:void 0},l)}(i,i.readVarint()+i.pos))}function rP(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function sP(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=Pg(i.readVarint()),e.value="rgb_color")}function oP(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Cg(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(o,l){return o.readFields(fP,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},l)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(o,l){return o.readFields(mP,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},l)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(o,l){return o.readFields(gP,{children:[]},l)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(o,l){const d=o.readFields(_P,{left:0,width:20,mask_type:$1.MASK_TYPE_LUMINANCE,children:[]},l);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function Cg(n,e){return n.readFields(aP,{},e)}function aP(n,e,i){n===1?(e.group=function(o,l){return o.readFields(lP,{opacity:255,children:[]},l)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(o,l){return o.readFields(uP,{paint_order:1,commands:[],step:1,diffs:[],rule:Sx.PATH_RULE_NON_ZERO},l)}(i,i.readVarint()+i.pos),e.node="path")}function lP(n,e,i){n===1?e.transform=Mg(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Cg(i,i.readVarint()+i.pos))}function Mg(n,e){return n.readFields(cP,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function cP(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function uP(n,e,i){n===1?e.fill=function(o,l){return o.readFields(hP,{rgb_color:Tx,paint:"rgb_color",opacity:255},l)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(o,l){return o.readFields(dP,{rgb_color:Tx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},l)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function hP(n,e,i){n===1?(e.rgb_color=Pg(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function Pg(n){return new $i((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function dP(n,e,i){n===1?(e.rgb_color=Pg(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function fP(n,e,i){n===1?e.transform=Mg(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(H1(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function H1(n,e){return n.readFields(pP,{offset:0,opacity:255,rgb_color:Tx},e)}function pP(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=Pg(i.readVarint()))}function mP(n,e,i){n===1?e.transform=Mg(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(H1(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function gP(n,e,i){n===1?e.transform=Mg(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Cg(i,i.readVarint()+i.pos))}function _P(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Cg(i,i.readVarint()+i.pos))}class yP{static calculate(e={},i=[]){const o=new Map,l=new Map;if(Object.keys(e).length===0)return o;i.forEach(d=>{l.set(d.name,d.rgb_color||new $i(0,0,0))});for(const[d,f]of Object.entries(e))l.has(d)?o.set(l.get(d).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${d}"`);return o}}function Fh(n,e=255,i){const o=e/255,l=n.toStringPremultipliedAlpha(),d=i.has(l)?i.get(l).clone():n.clone();return d.a*=o,d.toString()}function Xf(n,e){if(!fd()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function xP(n,e){const i=yP.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,l=o.width,d=o.height,f=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(l*f.a)),x=Math.max(1,Math.round(d*f.d)),b=new DOMMatrix([g/l,0,0,x/d,0,0]),S=Xf(g,x).getContext("2d");return Ax(S,b,o,o,i),S.getImageData(0,0,g,x)}function Ax(n,e,i,o,l){for(const d of o.children)q1(n,e,i,d,l)}function q1(n,e,i,o,l){o.group?(n.save(),function(d,f,g,x,b){const S=x.mask_idx!=null?g.masks[x.mask_idx]:null,E=x.clip_path_idx!=null?g.clip_paths[x.clip_path_idx]:null;if(x.transform&&(f=Rg(x.transform).preMultiplySelf(f)),!function(z,F,$){return z.opacity!==255||F||$}(x,E!=null,S!=null))return void Ax(d,f,g,x,b);const I=Xf(d.canvas.width,d.canvas.height),D=I.getContext("2d");Ax(D,f,g,x,b),E&&Q1(D,f,g,E),S&&e2(D,f,g,S,b),d.globalAlpha=x.opacity/255,d.drawImage(I,0,0)}(n,e,i,o.group,l),n.restore()):o.path&&(n.save(),function(d,f,g,x,b){const S=t2(x);d.setTransform(f),x.paint_order===eP.PAINT_ORDER_FILL_AND_STROKE?(W1(d,g,x,S,b),X1(d,g,x,S,b)):(X1(d,g,x,S,b),W1(d,g,x,S,b))}(n,e,i,o.path,l),n.restore())}function W1(n,e,i,o,l){const d=i.fill;if(!d)return;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.fillStyle=Fh(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":n.fillStyle=K1(n,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":n.fillStyle=Y1(n,e.radial_gradients[d.radial_gradient_idx],f,l)}n.fill(o,Z1(i))}function Z1(n){return n.rule===Sx.PATH_RULE_NON_ZERO?"nonzero":n.rule===Sx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function X1(n,e,i,o,l){const d=i.stroke;if(!d)return;n.lineWidth=d.width,n.miterLimit=d.miterlimit,n.setLineDash(d.dasharray),n.lineDashOffset=d.dashoffset;const f=d.opacity/255;switch(d.paint){case"rgb_color":n.strokeStyle=Fh(d.rgb_color,d.opacity,l);break;case"linear_gradient_idx":n.strokeStyle=K1(n,e.linear_gradients[d.linear_gradient_idx],f,l);break;case"radial_gradient_idx":n.strokeStyle=Y1(n,e.radial_gradients[d.radial_gradient_idx],f,l)}switch(d.linejoin){case Ig.LINE_JOIN_MITER_CLIP:case Ig.LINE_JOIN_MITER:n.lineJoin="miter";break;case Ig.LINE_JOIN_ROUND:n.lineJoin="round";break;case Ig.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(d.linecap){case Ex.LINE_CAP_BUTT:n.lineCap="butt";break;case Ex.LINE_CAP_ROUND:n.lineCap="round";break;case Ex.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(o)}function K1(n,e,i,o){if(e.stops.length===1){const I=e.stops[0];return Fh(I.rgb_color,I.opacity*i,o)}const l=Rg(e.transform),{x1:d,y1:f,x2:g,y2:x}=e,b=l.transformPoint(new DOMPoint(d,f)),S=l.transformPoint(new DOMPoint(g,x)),E=n.createLinearGradient(b.x,b.y,S.x,S.y);for(const I of e.stops)E.addColorStop(I.offset,Fh(I.rgb_color,I.opacity*i,o));return E}function Y1(n,e,i,o){if(e.stops.length===1){const I=e.stops[0];return Fh(I.rgb_color,I.opacity*i,o)}const l=Rg(e.transform),{fx:d,fy:f,cx:g,cy:x}=e,b=l.transformPoint(new DOMPoint(d,f)),S=l.transformPoint(new DOMPoint(g,x)),E=n.createRadialGradient(b.x,b.y,0,S.x,S.y,e.r*((l.a+l.d)/2));for(const I of e.stops)E.addColorStop(I.offset,Fh(I.rgb_color,I.opacity*i,o));return E}function J1(n,e,i,o){const l=o.transform?Rg(o.transform).preMultiplySelf(e):e,d=Xf(n.canvas.width,n.canvas.height),f=d.getContext("2d");for(const x of o.children)if(x.group)J1(f,l,i,x.group);else if(x.path){const b=x.path,S=new Path2D;S.addPath(t2(b),l),f.fill(S,Z1(b))}const g=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;g&&Q1(f,l,i,g),n.globalCompositeOperation="source-over",n.drawImage(d,0,0)}function Q1(n,e,i,o){const l=Xf(n.canvas.width,n.canvas.height);J1(l.getContext("2d"),e,i,o),n.globalCompositeOperation="destination-in",n.drawImage(l,0,0)}function e2(n,e,i,o,l){if(o.children.length===0)return;const d=o.mask_idx!=null?i.masks[o.mask_idx]:null;d&&e2(n,e,i,d,l);const f=n.canvas.width,g=n.canvas.height,x=Xf(f,g),b=x.getContext("2d"),S=o.width,E=o.height,I=o.left,D=o.top,z=new Path2D,F=new Path2D;F.rect(I,D,S,E),z.addPath(F,e),b.clip(z);for(const ee of o.children)q1(b,e,i,ee,l);const $=b.getImageData(0,0,f,g),H=$.data;if(o.mask_type===$1.MASK_TYPE_LUMINANCE)for(let ee=0;ee<H.length;ee+=4)H[ee+3]=H[ee+3]/255*(.2126*H[ee]+.7152*H[ee+1]+.0722*H[ee+2]);b.putImageData($,0,0),n.globalCompositeOperation="destination-in",n.drawImage(x,0,0)}function Rg(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function t2(n){const e=new Path2D,i=n.step;let o=n.diffs[0]*i,l=n.diffs[1]*i;e.moveTo(o,l);for(let d=0,f=2;d<n.commands.length;d++)switch(n.commands[d]){case Zf.PATH_COMMAND_MOVE:o+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.moveTo(o,l);break;case Zf.PATH_COMMAND_LINE:o+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.lineTo(o,l);break;case Zf.PATH_COMMAND_QUAD:{const g=o+n.diffs[f++]*i,x=l+n.diffs[f++]*i;o=g+n.diffs[f++]*i,l=x+n.diffs[f++]*i,e.quadraticCurveTo(g,x,o,l);break}case Zf.PATH_COMMAND_CUBIC:{const g=o+n.diffs[f++]*i,x=l+n.diffs[f++]*i,b=g+n.diffs[f++]*i,S=x+n.diffs[f++]*i;o=b+n.diffs[f++]*i,l=S+n.diffs[f++]*i,e.bezierCurveTo(g,x,b,S,o,l);break}case Zf.PATH_COMMAND_CLOSE:e.closePath()}return e}class Dg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Tt(Dg,"LRUCache");class Ix{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Jr(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new Dg(150)),this.cacheMap.get(o).get(el(e.toString(),i))}setInCache(e,i,o,l){this.cacheDependenciesMap.has(l)||this.cacheDependenciesMap.set(l,new Map),this.cacheMap.has(l)||this.cacheMap.set(l,new Dg(150));const d=this.cacheDependenciesMap.get(l),f=el(e.id.toString(),o);d.get(f)||d.set(f,new Set);const g=this.cacheMap.get(l),x=e.toString();d.get(f).add(x),g.put(el(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const l=this.cacheMap.get(o),d=this.cacheDependenciesMap.get(o);for(const f of e){const g=el(f.toString(),i);if(d.has(g)){for(const x of d.get(g))l.delete(x);d.delete(g)}}}rasterize(e,i,o,l,d=xP){const f=this.getFromCache(e,o,l);if(f)return f.clone();const g=d(i.icon,e.options),x=Ix._getImage(g);return this.setInCache(e,x,o,l),x.clone()}}class i2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function n2(n,e,i,o){let l=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(o[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const g=1/o[f];let x=(n[f]-i[f])*g,b=(e[f]-i[f])*g;if(x>b){const S=x;x=b,b=S}if(x>l&&(l=x),b<d&&(d=b),l>d)return null}return l}function r2(n,e,i,o,l,d,f,g,x,b,S){const E=o-n,I=l-e,D=d-i,z=f-n,F=g-e,$=x-i,H=S[1]*$-S[2]*F,ee=S[2]*z-S[0]*$,K=S[0]*F-S[1]*z,N=E*H+I*ee+D*K;if(Math.abs(N)<1e-15)return null;const Z=1/N,Q=b[0]-n,re=b[1]-e,pe=b[2]-i,_e=(Q*H+re*ee+pe*K)*Z;if(_e<0||_e>1)return null;const xe=re*D-pe*I,Te=pe*E-Q*D,Be=Q*I-re*E,Je=(S[0]*xe+S[1]*Te+S[2]*Be)*Z;return Je<0||_e+Je>1?null:(z*xe+F*Te+$*Be)*Z}function s2(n,e,i){return(n-e)/(i-e)}function o2(n,e,i,o,l,d,f,g,x){const b=1<<i,S=d-o,E=f-l,I=(n+1)/b*S+o,D=(e+0)/b*E+l,z=(e+1)/b*E+l;g[0]=(n+0)/b*S+o,g[1]=D,x[0]=I,x[1]=z}class a2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),g=[];let x=Math.ceil(Math.pow(2,f));const b=1/x,S=(D,z,F,$,H)=>{const ee=$?1:0,K=(D+1)*F-ee,N=z*F,Z=(z+1)*F-ee;H[0]=D*F,H[1]=N,H[2]=K,H[3]=Z};let E=new i2(x);const I=[];for(let D=0;D<x*x;D++){S(D%x,Math.floor(D/x),b,!1,I);const z=ic(I[0],I[1],d),F=ic(I[2],I[1],d),$=ic(I[2],I[3],d),H=ic(I[0],I[3],d);E.minimums.push(Math.min(z,F,$,H)),E.maximums.push(Math.max(z,F,$,H)),E.leaves.push(1)}for(g.push(E),x/=2;x>=1;x/=2){const D=g[g.length-1];E=new i2(x);for(let z=0;z<x*x;z++){S(z%x,Math.floor(z/x),2,!0,I);const F=D.getElevation(I[0],I[1]),$=D.getElevation(I[2],I[1]),H=D.getElevation(I[2],I[3]),ee=D.getElevation(I[0],I[3]),K=D.isLeaf(I[0],I[1]),N=D.isLeaf(I[2],I[1]),Z=D.isLeaf(I[2],I[3]),Q=D.isLeaf(I[0],I[3]),re=Math.min(F.min,$.min,H.min,ee.min),pe=Math.max(F.max,$.max,H.max,ee.max),_e=K&&N&&Z&&Q;E.maximums.push(pe),E.minimums.push(re),E.leaves.push(pe-re<=5&&_e?1:0)}g.push(E)}return g}(this.dem),o=i.length-1,l=i[o];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,l,d,f,g=1){return n2([e,i,-100],[o,l,this.maximums[0]*g],d,f)}raycast(e,i,o,l,d,f,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,o,l,d,f,g);if(x==null)return null;const b=[],S=[],E=[],I=[],D=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:z,t:F,nodex:$,nodey:H,depth:ee}=D.pop();if(this.leaves[z]){o2($,H,ee,e,i,o,l,E,I);const N=1<<ee,Z=($+0)/N,Q=($+1)/N,re=(H+0)/N,pe=(H+1)/N,_e=ic(Z,re,this.dem)*g,xe=ic(Q,re,this.dem)*g,Te=ic(Q,pe,this.dem)*g,Be=ic(Z,pe,this.dem)*g,Je=r2(E[0],E[1],_e,I[0],E[1],xe,I[0],I[1],Te,d,f),Ze=r2(I[0],I[1],Te,E[0],I[1],Be,E[0],E[1],_e,d,f),Ye=Math.min(Je!==null?Je:Number.MAX_VALUE,Ze!==null?Ze:Number.MAX_VALUE);if(Ye!==Number.MAX_VALUE)return Ye;{const rt=tn([],d,f,F);if(l2(_e,xe,Be,Te,s2(rt[0],E[0],I[0]),s2(rt[1],E[1],I[1]))>=rt[2])return F}continue}let K=0;for(let N=0;N<this._siblingOffset.length;N++){o2(($<<1)+this._siblingOffset[N][0],(H<<1)+this._siblingOffset[N][1],ee+1,e,i,o,l,E,I),E[2]=-100,I[2]=this.maximums[this.childOffsets[z]+N]*g;const Z=n2(E,I,d,f);if(Z!=null){const Q=Z;b[N]=Q;let re=!1;for(let pe=0;pe<K&&!re;pe++)Q>=b[S[pe]]&&(S.splice(pe,0,N),re=!0);re||(S[K]=N),K++}}for(let N=0;N<K;N++){const Z=S[N];D.push({idx:this.childOffsets[z]+Z,t:b[Z],nodex:($<<1)+this._siblingOffset[Z][0],nodey:(H<<1)+this._siblingOffset[Z][1],depth:ee+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,l,d){if(e[l].isLeaf(i,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=l-1,g=e[f];let x=0,b=0;for(let S=0;S<this._siblingOffset.length;S++){const E=2*i+this._siblingOffset[S][0],I=2*o+this._siblingOffset[S][1],D=g.getElevation(E,I),z=g.isLeaf(E,I),F=this._addNode(D.min,D.max,z);z&&(x|=1<<S),b||(b=F)}for(let S=0;S<this._siblingOffset.length;S++)x&1<<S||this._construct(e,2*i+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],f,b+S)}}function l2(n,e,i,o,l,d){return Nt(Nt(n,i,d),Nt(e,o,d),l)}function ic(n,e,i){const o=i.dim,l=ve(n*o-.5,0,o-1),d=ve(e*o-.5,0,o-1),f=Math.floor(l),g=Math.floor(d),x=Math.min(f+1,o-1),b=Math.min(g+1,o-1);return l2(i.get(f,g),i.get(x,g),i.get(f,b),i.get(x,b),l-f,d-g)}const vP={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function bP(n,e,i){return(256*n*256+256*e+i)/10-1e4}function wP(n,e,i){return 256*n+e+i/256-32768}class zg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void vi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const g=o==="terrarium"?wP:bP;for(let x=0;x<f.length;++x){const b=4*x;this.floatView[x]=g(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=lo.now()}_buildQuadTree(){this._tree=new a2(this)}get(e,i,o=!1){o&&(e=ve(e,-1,this.dim),i=ve(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,o){const l=this._idx(e,i),d=this.floatView[l];return this.floatView[l]=o,o-d}static getUnpackVector(e){return vP[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],l=zg.getUnpackVector(i);let d=Math.floor((e+l[3])/l[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new ub({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=o*this.dim,g=o*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(o){case-1:f=g-1;break;case 1:g=f+1}const x=-i*this.dim,b=-o*this.dim;for(let S=f;S<g;S++)for(let E=l;E<d;E++){const I=4*this._idx(E,S),D=4*this._idx(E+x,S+b);this.pixels[I+0]=e.pixels[D+0],this.pixels[I+1]=e.pixels[D+1],this.pixels[I+2]=e.pixels[D+2],this.pixels[I+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function TP(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(o,l){return o.readFields(CP,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},l)}(i,i.readVarint()+i.pos))}function SP(n,e,i){n===1?(e.delta_filter=function(o,l){return o.readFields(EP,{blockSize:0},l)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function EP(n,e,i){n===1&&(e.blockSize=i.readVarint())}function AP(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function IP(n,e,i){let o=0,l=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(d,f){return d.readFields(SP,{},f)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(d,f){return d.readFields(AP,{},f)}(i,i.readVarint()+i.pos):n===5?l=i.readFloat():n===6?o=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=l),e.scale===0&&(e.scale=o)}function CP(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(o,l){return o.readFields(IP,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},l)}(i,i.readVarint()+i.pos))}function MP(n,e,i){if(n===2)(function(o,l,d){o.readFields(PP,d,l)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function PP(n,e,i){if(n===1){let o=0;const l=i.readVarint()+i.pos;for(;i.pos<l;)e[o++]=i.readVarint()}}function RP(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const l=o===1?1:0,d=o===2?1:0;for(let f=0;f<e[0];f++){const g=e[1]*f;for(let x=l;x<e[1];x++){const b=e[2]*(x+g);for(let S=d;S<e[2];S++){const E=e[3]*(S+b);for(let I=0;I<e[3];I++){const D=E+I;n[D]+=n[D-i]}}}}i*=e[o]}return n}function DP(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function zP(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],l=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&l)<<4|61440&l,n[i+1]=15&o|(3840&o)>>4|(15&l)<<8|(3840&l)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],l=n[i+1],d=n[i+2],f=n[i+3];n[i+0]=(192&o)>>6|(192&l)>>4|(192&d)>>2|192&f,n[i+1]=(48&o)>>4|(48&l)>>2|48&d|(48&f)<<2,n[i+2]=(12&o)>>2|12&l|(12&d)<<2|(12&f)<<4,n[i+3]=3&o|(3&l)<<2|(3&d)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Tt(zg,"DEMData"),Tt(a2,"DemMinMaxQuadTree",{omit:["dem"]});var vo=Uint8Array,Kf=Uint16Array,LP=Int32Array,c2=new vo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u2=new vo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kP=new vo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h2=function(n,e){for(var i=new Kf(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var l=new LP(i[30]);for(o=1;o<30;++o)for(var d=i[o];d<i[o+1];++d)l[d]=d-i[o]<<5|o;return{b:i,r:l}},d2=h2(c2,2),f2=d2.b,OP=d2.r;f2[28]=258,OP[258]=28;for(var FP=h2(u2,0).b,p2=new Kf(32768),xr=0;xr<32768;++xr){var Bh=(43690&xr)>>1|(21845&xr)<<1;p2[xr]=((65280&(Bh=(61680&(Bh=(52428&Bh)>>2|(13107&Bh)<<2))>>4|(3855&Bh)<<4))>>8|(255&Bh)<<8)>>1}var Yf=function(n,e,i){for(var o=n.length,l=0,d=new Kf(e);l<o;++l)n[l]&&++d[n[l]-1];var f,g=new Kf(e);for(l=1;l<e;++l)g[l]=g[l-1]+d[l-1]<<1;f=new Kf(1<<e);var x=15-e;for(l=0;l<o;++l)if(n[l])for(var b=l<<4|n[l],S=e-n[l],E=g[n[l]-1]++<<S,I=E|(1<<S)-1;E<=I;++E)f[p2[E]>>x]=b;return f},Jf=new vo(288);for(xr=0;xr<144;++xr)Jf[xr]=8;for(xr=144;xr<256;++xr)Jf[xr]=9;for(xr=256;xr<280;++xr)Jf[xr]=7;for(xr=280;xr<288;++xr)Jf[xr]=8;var m2=new vo(32);for(xr=0;xr<32;++xr)m2[xr]=5;var BP=Yf(Jf,9),NP=Yf(m2,5),Cx=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},Ko=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},Mx=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},VP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Yo=function(n,e,i){var o=new Error(e||VP[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,Yo),!i)throw o;return o},jP=new vo(0),UP=typeof TextDecoder<"u"&&new TextDecoder;try{UP.decode(jP,{stream:!0})}catch{}const $P={gzip_data:"gzip"};class Ro extends Error{constructor(e){super(e),this.name="MRTError"}}const GP={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},g2={uint32:1,uint16:2,uint8:4},HP={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Px;class Lg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Ro(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new Ro("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new Ro(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const l=function(d,f){return d.readFields(TP,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Px(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new Ro(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const d of l.layers)this.layers[d.name]=new _2(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let l of e.blockIndices){const d=o.dataIndex[l],f=d.firstByte-e.firstByte,g=d.lastByte-e.firstByte;if(o._blocksInProgress.has(l))continue;const x={layerName:o.name,firstByte:f,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:l,blockShape:[d.bands.length].concat(o.bandShape),buffer:o.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};o._blocksInProgress.add(l),i.push(x)}return new y2(i,()=>{i.forEach(l=>o._blocksInProgress.delete(l.blockIndex))},(l,d)=>{if(i.forEach(f=>o._blocksInProgress.delete(f.blockIndex)),l)throw l;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class _2{constructor({version:e,name:i,units:o,tileSize:l,pixelFormat:d,buffer:f,dataIndex:g},x){if(this.version=e,this.version!==1)throw new Ro(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=l,this.buffer=f,this.pixelFormat=GP[d],this.dataIndex=g,this.bandShape=[l+2*f,l+2*f,g2[this.pixelFormat]],this._decodedBlocks=new Dg(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return g2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,l]of this.dataIndex.entries()){for(const[d,f]of l.bands.entries())if(f===e)return{bandIndex:i+d,blockIndex:o,blockBandIndex:d};i+=l.bands.length}break;case"number":for(const[o,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new Ro(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const l=[],d=new Set;for(const f of e){const{blockIndex:g}=this.getBlockForBand(f);if(g<0)throw new Ro(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[g];l.includes(g)||l.push(g),d.add(g),i=Math.min(i,x.firstByte),o=Math.max(o,x.lastByte)}if(d.size>this.cacheSize)throw new Ro(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new Ro(`Band not found: ${JSON.stringify(e)}`);const l=this._decodedBlocks.get(i.toString());if(!l)throw new Ro(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],f=this.bandShape.reduce((b,S)=>b*S,1),g=o*f,x=l.subarray(g,g+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}Lg.setPbf=function(n){Px=n};class y2{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Lg.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:l,firstByte:d,lastByte:f,pixelFormat:g,blockShape:x,blockIndex:b,filters:S,codec:E}=o,I=i.subarray(d,f+1),D=new Uint32Array(x[0]*x[1]*x[2]);let z;if(E!=="gzip_data")throw new Ro(`Unhandled codec: ${E}`);return z=function(F,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((N=function(re){re[0]==31&&re[1]==139&&re[2]==8||Yo(6,"invalid gzip data");var pe=re[3],_e=10;4&pe&&(_e+=2+(re[10]|re[11]<<8));for(var xe=(pe>>3&1)+(pe>>4&1);xe>0;xe-=!re[_e++]);return _e+(2&pe)}(K=F))+8>K.length&&Yo(6,"invalid gzip data"),function(re,pe,_e,xe){var Te=re.length;if(!Te||pe.f&&!pe.l)return _e||new vo(0);var Be=!_e,Je=Be||pe.i!=2,Ze=pe.i;Be&&(_e=new vo(3*Te));var Ye,rt,Oe=function(Hn){var wn=_e.length;if(Hn>wn){var gn=new vo(Math.max(2*wn,Hn));gn.set(_e),_e=gn}},Ke=pe.f||0,Le=pe.p||0,Fe=pe.b||0,at=pe.l,lt=pe.d,kt=pe.m,Et=pe.n,gt=8*Te;do{if(!at){Ke=Ko(re,Le,1);var st=Ko(re,Le+1,3);if(Le+=3,!st){var Zt=re[(te=4+((Le+7)/8|0))-4]|re[te-3]<<8,Pt=te+Zt;if(Pt>Te){Ze&&Yo(0);break}Je&&Oe(Fe+Zt),_e.set(re.subarray(te,Pt),Fe),pe.b=Fe+=Zt,pe.p=Le=8*Pt,pe.f=Ke;continue}if(st==1)at=BP,lt=NP,kt=9,Et=5;else if(st==2){var Rt=Ko(re,Le,31)+257,Ht=Ko(re,Le+10,15)+4,ei=Rt+Ko(re,Le+5,31)+1;Le+=14;for(var ni=new vo(ei),di=new vo(19),ai=0;ai<Ht;++ai)di[kP[ai]]=Ko(re,Le+3*ai,7);Le+=3*Ht;var si=Cx(di),cn=(1<<si)-1,xn=Yf(di,si);for(ai=0;ai<ei;){var te,se=xn[Ko(re,Le,cn)];if(Le+=15&se,(te=se>>4)<16)ni[ai++]=te;else{var Ve=0,ht=0;for(te==16?(ht=3+Ko(re,Le,3),Le+=2,Ve=ni[ai-1]):te==17?(ht=3+Ko(re,Le,7),Le+=3):te==18&&(ht=11+Ko(re,Le,127),Le+=7);ht--;)ni[ai++]=Ve}}var xt=ni.subarray(0,Rt),_t=ni.subarray(Rt);kt=Cx(xt),Et=Cx(_t),at=Yf(xt,kt),lt=Yf(_t,Et)}else Yo(1);if(Le>gt){Ze&&Yo(0);break}}Je&&Oe(Fe+131072);for(var zt=(1<<kt)-1,Gt=(1<<Et)-1,wi=Le;;wi=Le){var Ti=(Ve=at[Mx(re,Le)&zt])>>4;if((Le+=15&Ve)>gt){Ze&&Yo(0);break}if(Ve||Yo(2),Ti<256)_e[Fe++]=Ti;else{if(Ti==256){wi=Le,at=null;break}var oi=Ti-254;Ti>264&&(oi=Ko(re,Le,(1<<(Si=c2[ai=Ti-257]))-1)+f2[ai],Le+=Si);var Ji=lt[Mx(re,Le)&Gt],mn=Ji>>4;if(Ji||Yo(3),Le+=15&Ji,_t=FP[mn],mn>3){var Si=u2[mn];_t+=Mx(re,Le)&(1<<Si)-1,Le+=Si}if(Le>gt){Ze&&Yo(0);break}Je&&Oe(Fe+131072);var On=Fe+oi;if(Fe<_t){var vn=0-_t,Zi=Math.min(_t,On);for(vn+Fe<0&&Yo(3);Fe<Zi;++Fe)_e[Fe]=(void 0)[vn+Fe]}for(;Fe<On;++Fe)_e[Fe]=_e[Fe-_t]}}pe.l=at,pe.p=wi,pe.b=Fe,pe.f=Ke,at&&(Ke=1,pe.m=kt,pe.d=lt,pe.n=Et)}while(!Ke);return Fe!=_e.length&&Be?(Ye=_e,((rt=Fe)==null||rt>Ye.length)&&(rt=Ye.length),new vo(Ye.subarray(0,rt))):_e.subarray(0,Fe)}(K.subarray(N,-8),{i:2},new vo(((H=K)[(ee=H.length)-4]|H[ee-3]<<8|H[ee-2]<<16|H[ee-1]<<24)>>>0))));var H,ee,K,N;const Z=$P[$];if(!Z)throw new Error(`Unhandled codec: ${$}`);const Q=new globalThis.DecompressionStream(Z);return new Response(new Blob([F]).stream().pipeThrough(Q)).arrayBuffer().then(re=>new Uint8Array(re))}(I,E).then(F=>(function($,H){$.readFields(MP,H)}(new Px(F),D),new HP[g](D.buffer))),z.then(F=>{for(let $=S.length-1;$>=0;$--)switch(S[$]){case"delta_filter":RP(F,x);break;case"zigzag_filter":DP(F);break;case"bitshuffle_filter":zP(F,g);break;default:throw new Ro(`Unhandled filter "${S[$]}"`)}return{layerName:l,blockIndex:b,data:F}}).catch(F=>{throw F})}))},Tt(y2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Tt(Lg,"MapboxRasterTile"),Tt(_2,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Qf,Rx,Jo,Nh,Dx,Vh=null;function x2(){return _n(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Rx||Yr.DRACO_URL}function v2(){if(_n(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Nh)return Nh;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Nh=WebAssembly.validate(n)?Yr.MESHOPT_SIMD_URL:Yr.MESHOPT_URL,Nh}const kg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qP={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},ep={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function b2(n,e,i){const o=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:l,byteLength:n.byteLength},i.buffers[l]=n}const zx="KHR_draco_mesh_compression";function WP(n,e){const i=n.extensions&&n.extensions[zx];if(!i)return;const o=new Jo.Decoder,l=E2(e,i.bufferView),d=new Jo.Mesh;if(!o.DecodeArrayToMesh(l,l.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],g=kg[f.componentType],x=f.count*g.BYTES_PER_ELEMENT,b=Jo._malloc(x);g===Uint16Array?o.GetTrianglesUInt16Array(d,x,b):o.GetTrianglesUInt32Array(d,x,b),b2(Jo.memory.buffer.slice(b,b+x),f,e),Jo._free(b);for(const S of Object.keys(i.attributes)){const E=o.GetAttributeByUniqueId(d,i.attributes[S]),I=e.json.accessors[n.attributes[S]],D=qP[I.componentType],z=I.count*ep[I.type]*kg[I.componentType].BYTES_PER_ELEMENT,F=Jo._malloc(z);o.GetAttributeDataArrayForAllPoints(d,E,Jo[D],z,F),b2(Jo.memory.buffer.slice(F,F+z),I,e),Jo._free(F)}o.destroy(),d.destroy(),delete n.extensions[zx]}const Og="EXT_meshopt_compression";function ZP(n,e){if(!n.extensions||!n.extensions[Og])return;const i=n.extensions[Og],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);Dx.decodeGltfBuffer(l,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=l.buffer,delete n.extensions[Og]}const w2=1179937895,T2=new TextDecoder("utf8");function S2(n,e){return new URL(n,e).href}function XP(n,e,i,o){return fetch(S2(n.uri,o)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function E2(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function KP(n,e,i,o){if(n.uri){const l=S2(n.uri,o);return fetch(l).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(n.bufferView!==void 0){const l=E2(e,n.bufferView),d=new Blob([l],{type:n.mimeType});return createImageBitmap(d).then(f=>{e.images[i]=f})}}function A2(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===w2){const S=new Uint32Array(n,e);let E=2;const I=(S[E++]>>2)-3,D=S[E++]>>2;if(E++,o.json=JSON.parse(T2.decode(S.subarray(E,E+D))),E+=D,E<I){const z=S[E++];E++;const F=e+(E<<2);o.buffers[0]=n.slice(F,F+z)}}else o.json=JSON.parse(T2.decode(new Uint8Array(n,e)));const{buffers:l,images:d,meshes:f,extensionsUsed:g,bufferViews:x}=o.json;let b=Promise.resolve();if(l){const S=[];for(let E=0;E<l.length;E++){const I=l[E];I.uri?S.push(XP(I,o,E,i)):o.buffers[E]||(o.buffers[E]=null)}b=Promise.all(S)}return b.then(()=>{const S=[],E=g&&g.includes(zx),I=g&&g.includes(Og);if(E&&S.push(function(){if(!Jo)return Qf??(Qf=function(D){let z,F=null;function $(){z=new Uint8Array(F.buffer)}function H(){throw new Error("Unexpected Draco error.")}const ee={a:{a:H,d:function(K,N,Z){return z.copyWithin(K,N,N+Z)},c:function(K){const N=z.length,Z=Math.max(K>>>0,Math.ceil(1.2*N)),Q=Math.ceil((Z-N)/65536);try{return F.grow(Q),$(),!0}catch{return!1}},b:H}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,ee):D.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,ee))).then(K=>{const{Rb:N,Qb:Z,P:Q,T:re,X:pe,Ja:_e,La:xe,Qa:Te,Va:Be,Wa:Je,eb:Ze,jb:Ye,f:rt,e:Oe,yb:Ke,zb:Le,Ab:Fe,Bb:at,Db:lt,Gb:kt}=K.instance.exports;F=Oe;const Et=(()=>{let gt=0,st=0,Zt=0,Pt=0;return Rt=>{Zt&&(N(Pt),N(gt),st+=Zt,Zt=gt=0),gt||(st+=128,gt=Z(st));const Ht=Rt.length+7&-8;let ei=gt;Ht>=st&&(Zt=Ht,ei=Pt=Z(Ht));for(let ni=0;ni<Rt.length;ni++)z[ei+ni]=Rt[ni];return ei}})();return $(),rt(),{memory:Oe,_free:N,_malloc:Z,Mesh:class{constructor(){this.ptr=Q()}destroy(){re(this.ptr)}},Decoder:class{constructor(){this.ptr=_e()}destroy(){Ye(this.ptr)}DecodeArrayToMesh(gt,st,Zt){const Pt=Et(gt),Rt=xe(this.ptr,Pt,st,Zt.ptr);return!!pe(Rt)}GetAttributeByUniqueId(gt,st){return{ptr:Te(this.ptr,gt.ptr,st)}}GetTrianglesUInt16Array(gt,st,Zt){Be(this.ptr,gt.ptr,st,Zt)}GetTrianglesUInt32Array(gt,st,Zt){Je(this.ptr,gt.ptr,st,Zt)}GetAttributeDataArrayForAllPoints(gt,st,Zt,Pt,Rt){Ze(this.ptr,gt.ptr,st.ptr,Zt,Pt,Rt)}},DT_INT8:Ke(),DT_UINT8:Le(),DT_INT16:Fe(),DT_UINT16:at(),DT_UINT32:lt(),DT_FLOAT32:kt()}})}(fetch(x2())),Qf.then(D=>{Jo=D,Qf=void 0}))}()),I&&S.push(function(){if(Dx)return;const D=function(z){let F;const $=WebAssembly.instantiateStreaming(z,{}).then(K=>{F=K.instance,F.exports.__wasm_call_ctors()}),H={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ee={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(K,N,Z,Q,re,pe){(function(_e,xe,Te,Be,Je,Ze,Ye){const rt=_e.exports.sbrk,Oe=Be+3&-4,Ke=rt(Oe*Je),Le=rt(Ze.length),Fe=new Uint8Array(_e.exports.memory.buffer);Fe.set(Ze,Le);const at=xe(Ke,Be,Je,Le,Ze.length);if(at===0&&Ye&&Ye(Ke,Oe,Je),Te.set(Fe.subarray(Ke,Ke+Be*Je)),rt(Ke-rt(0)),at!==0)throw new Error(`Malformed buffer data: ${at}`)})(F,F.exports[ee[re]],K,N,Z,Q,F.exports[H[pe]])}}}(fetch(v2()));return D.ready.then(()=>{Dx=D})}()),d)for(let D=0;D<d.length;D++)S.push(KP(d[D],o,D,i));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(E&&f)for(const{primitives:D}of f)for(const z of D)WP(z,o);if(I&&f&&x)for(const D of x)ZP(D,o);return o})})}function cu(n,e){const i=n.json.bufferViews[e.bufferView],o=kg[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==ep[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:ep[e.type]))}function Lx(n,e,i,o){const l=kg[e.componentType],d=function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=n.json.bufferViews[e.bufferView],g=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:ep[e.type],x=i.float32,b=x.length/i.capacity;for(let S=0,E=0;S<e.count*g;S+=g,E+=b)for(let I=0;I<b;I++)x[E+I]=o[S+I]*d;i._trim()}function YP(n,e,i){const o=n.indices,l=n.attributes,d={};d.indexArray=new Ar;const f=e.json.accessors[o],g=f.count/3;d.indexArray.reserve(g);const x=cu(e,f);for(let I=0;I<g;I++)d.indexArray.emplaceBack(x[3*I],x[3*I+1],x[3*I+2]);d.indexArray._trim(),d.vertexArray=new Ao;const b=e.json.accessors[l.POSITION];d.vertexArray.reserve(b.count);const S=cu(e,b);for(let I=0;I<b.count;I++)d.vertexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);if(d.vertexArray._trim(),d.aabb=new In(b.min,b.max),d.centroid=function(I,D){const z=[0,0,0],F=I.length;if(F>0){for(let $=0;$<F;$++){const H=3*I[$];z[0]+=D[H],z[1]+=D[H+1],z[2]+=D[H+2]}z[0]/=F,z[1]/=F,z[2]/=F}return z}(x,S),l.COLOR_0!==void 0){const I=e.json.accessors[l.COLOR_0],D=ep[I.type],z=cu(e,I);d.colorArray=D===3?new Ao:new Io,d.colorArray.resize(I.count),Lx(e,I,d.colorArray,z)}if(l.NORMAL!==void 0){d.normalArray=new Ao;const I=e.json.accessors[l.NORMAL];d.normalArray.resize(I.count);const D=cu(e,I);Lx(e,I,d.normalArray,D)}if(l.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new nl;const I=e.json.accessors[l.TEXCOORD_0];d.texcoordArray.resize(I.count);const D=cu(e,I);Lx(e,I,d.texcoordArray,D)}if(l._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=cu(e,I))}l._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(cu(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const E=n.material;return d.material=function(I,D){const{emissiveFactor:z=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:$=.5,normalTexture:H,occlusionTexture:ee,emissiveTexture:K,doubleSided:N}=I,{baseColorFactor:Z=[1,1,1,1],metallicFactor:Q=1,roughnessFactor:re=1,baseColorTexture:pe,metallicRoughnessTexture:_e}=I.pbrMetallicRoughness||{},xe=ee?D[ee.index]:void 0;if(ee&&ee.extensions&&ee.extensions.KHR_texture_transform&&xe){const Te=ee.extensions.KHR_texture_transform;xe.offsetScale=[Te.offset[0],Te.offset[1],Te.scale[0],Te.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new $i(...Z),metallicFactor:Q,roughnessFactor:re,baseColorTexture:pe?D[pe.index]:void 0,metallicRoughnessTexture:_e?D[_e.index]:void 0},doubleSided:N,emissiveFactor:z,alphaMode:F,alphaCutoff:$,normalTexture:H?D[H.index]:void 0,occlusionTexture:xe,emissionTexture:K?D[K.index]:void 0,defined:I.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),d}function I2(n,e,i){const{matrix:o,rotation:l,translation:d,scale:f,mesh:g,extras:x,children:b}=n,S={};if(S.matrix=o||function(E,I,D,z){var F=I[0],$=I[1],H=I[2],ee=I[3],K=F+F,N=$+$,Z=H+H,Q=F*K,re=F*N,pe=F*Z,_e=$*N,xe=$*Z,Te=H*Z,Be=ee*K,Je=ee*N,Ze=ee*Z,Ye=z[0],rt=z[1],Oe=z[2];return E[0]=(1-(_e+Te))*Ye,E[1]=(re+Ze)*Ye,E[2]=(pe-Je)*Ye,E[3]=0,E[4]=(re-Ze)*rt,E[5]=(1-(Q+Te))*rt,E[6]=(xe+Be)*rt,E[7]=0,E[8]=(pe+Je)*Oe,E[9]=(xe-Be)*Oe,E[10]=(1-(Q+_e))*Oe,E[11]=0,E[12]=D[0],E[13]=D[1],E[14]=D[2],E[15]=1,E}([],l||[0,0,0,1],d||[0,0,0],f||[1,1,1]),g!==void 0){S.meshes=i[g];const E=S.anchor=[0,0];for(const I of S.meshes){const{min:D,max:z}=I.aabb;E[0]+=D[0]+z[0],E[1]+=D[1]+z[1]}E[0]=Math.floor(E[0]/S.meshes.length/2),E[1]=Math.floor(E[1]/S.meshes.length/2)}if(x&&(x.id&&(S.id=x.id),x.lights&&(S.lights=function(E){if(!E.length)return[];const I=function(H){const ee=atob(H),K=new Uint8Array(ee.length);for(let N=0;N<ee.length;N++)K[N]=ee.codePointAt(N);return K}(E),D=[],z=I.length/24,F=new Uint16Array(I.buffer),$=new Float32Array(I.buffer);for(let H=0;H<z;H++){const ee=F[2*H*6]/30,K=F[2*H*6+1]/30,N=F[2*H*6+10]/100,Z=$[6*H+1],Q=$[6*H+2],re=$[6*H+3],pe=$[6*H+4],_e=re-Z,xe=pe-Q,Te=Math.hypot(_e,xe);D.push({pos:[Z+.5*_e,Q+.5*xe,K],normal:[xe/Te,-_e/Te,0],width:Te,height:ee,depth:N,points:[Z,Q,re,pe]})}return D}(x.lights))),b){const E=[];for(const I of b)E.push(I2(e.json.nodes[I],e,i));S.children=E}return S}function JP(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new By(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function QP(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const g=f[0],x=f[1];typeof g=="number"&&typeof x=="number"&&o.push(new dt(g,x))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let l=0;for(let f=0;f<o.length;f++){const g=o[f],x=o[(f+1)%o.length],b=o[(f+2)%o.length];l+=(g.x-x.x)*(b.y-x.y)-(b.x-x.x)*(g.y-x.y)}l>0&&o.reverse();const d=Sf(o.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:o,indices:d}}function eR(n,e){const i=[],o=[];let l=0;const d=[];for(const f of n){l=i.length;const g=f.vertexArray.float32,x=f.indexArray.uint16;for(let b=0;b<f.vertexArray.length;b++)d[0]=g[3*b+0],d[1]=g[3*b+1],d[2]=g[3*b+2],zi(d,d,e),i.push(new dt(d[0],d[1]));for(let b=0;b<3*f.indexArray.length;b++)o.push(x[b]+l)}if(o.length%3!=0)return null;for(let f=0;f<o.length;f+=3){const g=i[o[f+0]],x=i[o[f+1]],b=i[o[f+2]];(g.x-x.x)*(b.y-x.y)-(b.x-x.x)*(g.y-x.y)>0&&([o[f+1],o[f+2]]=[o[f+2],o[f+1]])}return{vertices:i,indices:o}}function C2(n){const e=function(x,b){const S=[],E=WebGL2RenderingContext;if(x.json.textures)for(const I of x.json.textures){const D={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};I.sampler!==void 0&&Object.assign(D,x.json.samplers[I.sampler]),S.push({image:b[I.source],sampler:D,uploaded:!1})}return S}(n,n.images),i=function(x,b){const S=[];for(const E of x.json.meshes){const I=[];for(const D of E.primitives)I.push(YP(D,x,b));S.push(I)}return S}(n,e),{scenes:o,scene:l,nodes:d}=n.json,f=o?o[l||0].nodes:d,g=[];for(const x of f)g.push(I2(d[x],n,i));return function(x,b,S){const E={},I=new Set;for(let D=0;D<x.length;D++){const z=S[b[D]];if(!z.extras)continue;const F=z.extras["mapbox:footprint:version"],$=z.extras["mapbox:footprint:id"];(F||$)&&I.add(D),F==="1.0.0"&&$&&(E[$]=D)}for(let D=0;D<x.length;D++){if(I.has(D))continue;const z=x[D],F=S[b[D]];if(!F.extras)continue;let $=null;z.id in E&&($=eR(x[E[z.id]].meshes,z.matrix)),$||($=QP(F)),$&&(z.footprint=JP($))}if(I.size>0){const D=Array.from(I.values()).sort((z,F)=>z-F);for(let z=D.length-1;z>=0;z--)x.splice(D[z],1)}}(g,f,n.json.nodes),g}function tR(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,l=ou/(n.aabb.max[0]-i+2),d=ou/(n.aabb.max[1]-o+2);for(let f=0;f<e.length;f+=3){const g=e[f+2],x=(e[f+0]-i)*l|0,b=(e[f+1]-o)*d|0;g>n.heightmap[b*ou+x]&&(n.heightmap[b*ou+x]=g)}}function iR(n,e){const i={};i.indexArray=new Ar,i.indexArray.reserve(4*n.length),i.vertexArray=new Ao,i.vertexArray.reserve(10*n.length),i.colorArray=new Io,i.vertexArray.reserve(10*n.length);let o=0;for(const f of n){const g=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],b=Math.min(.29,.1*f.width/f.depth),S=f.width-2*f.depth*e*(b+.01),E=tn([],f.pos,x,S/2),I=tn([],f.pos,x,-S/2),D=[E[0],E[1],E[2]+f.height],z=[I[0],I[1],I[2]+f.height],F=tn([],f.normal,x,b);ti(F,F,g);const $=tn([],f.normal,x,-b);ti($,$,g),Pi(F,E,F),Pi($,I,$),E[2]+=.1,I[2]+=.1,i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(I[0],I[1],I[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]);const H=S/g/2;i.colorArray.emplaceBack(-H-b,-1,H,.8),i.colorArray.emplaceBack(H+b,-1,H,.8),i.colorArray.emplaceBack(-H,0,H,1.3),i.colorArray.emplaceBack(H,0,H,1.3),i.colorArray.emplaceBack(H+b,-.8,H,.7),i.colorArray.emplaceBack(H+b,-.8,H,.7),i.colorArray.emplaceBack(0,0,H,1.3),i.colorArray.emplaceBack(0,0,H,1.3),i.colorArray.emplaceBack(H+b,-1.2,H,.8),i.colorArray.emplaceBack(H+b,-1.2,H,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const l={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=$i.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}class M2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const nR=["id","tile","layer","source","sourceLayer","state"];class jh{constructor(e,i,o,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=l,this.properties=e.properties,this.id=d}clone(){const e=new jh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of nR)this[i]!==void 0&&(e[i]=this[i]);return e}}class P2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(pt,16,0),this.featureIndexArray=new km,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,l,d,f=0,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,l,d,f);const b=this.grid;for(let S=0;S<i.length;S++){const E=i[S],I=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const z=E[D];I[0]=Math.min(I[0],z.x),I[1]=Math.min(I[1],z.y),I[2]=Math.max(I[2],z.x),I[3]=Math.max(I[3],z.y)}g!==0&&(I[0]-=g,I[1]-=g,I[2]+=g,I[3]+=g),I[0]<pt&&I[1]<pt&&I[2]>=0&&I[3]>=0&&b.insert(x,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yl.VectorTile(new ig(this.rawTileData)).layers,this.sourceLayerCoder=new M2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:l,tileTransform:d,pixelPosMatrix:f,availableImages:g}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const x=o.bufferedTilespaceBounds,b=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(D,z,F,$)=>ur(o.bufferedTilespaceGeometry,D,z,F,$));b.sort(rR);let S=null;l.elevation&&b.length>0&&(S=kh.create(l.elevation,this.tileID));const E={};let I;for(let D=0;D<b.length;D++){const z=b[D];if(z===I)continue;I=z;const F=this.featureIndexArray.get(z);let $=null;this.is3DTile?this.loadMatchingModelFeature(E,F,e,o,l):this.loadMatchingFeature(E,F,e,g,(H,ee,K,N=0)=>($||($=At(H,this.tileID.canonical,d)),ee.queryIntersectsFeature(o,H,K,$,this.z,l,f,S,N)))}return E}loadMatchingFeature(e,i,o,l,d){const{featureIndex:f,bucketIndex:g,sourceLayerIndex:x,layoutVertexArrayOffset:b}=i,S=this.bucketLayerIDs[g],E=o.layers,I=Object.keys(E);if(I.length&&!function(H,ee){for(let K=0;K<H.length;K++)if(ee.indexOf(H[K])>=0)return!0;return!1}(I,S))return;const D=o.sourceCache,z=this.sourceLayerCoder.decode(x),F=this.vtLayers[z].feature(f),$=this.getId(F,z);for(let H=0;H<S.length;H++){const ee=S[H];if(!E[ee])continue;const{styleLayer:K,targets:N}=E[ee];let Z={};$!==void 0&&(Z=D.getFeatureState(K.sourceLayer,$));const Q=!d||d(F,K,Z,b);if(!Q)continue;const re=new jh(F,this.z,this.x,this.y,$);re.tile=this.tileID.canonical,re.state=Z;let pe=this.serializedLayersCache.get(ee);pe||(pe=K.serialize(),pe.id=ee,this.serializedLayersCache.set(ee,pe)),re.source=pe.source,re.sourceLayer=pe["source-layer"],re.layer=ze({},pe),re.layer.paint=R2(pe.paint,K.paint,F,Z,l),re.layer.layout=R2(pe.layout,K.layout,F,Z,l);let _e=!1;for(const xe of N){this.updateFeatureProperties(re,xe);const{filter:Te}=xe;if(Te){if(F.properties=re.properties,Te.needGeometry){const Be=Ot(F,!0);if(!Te.filter(new nn(this.tileID.overscaledZ),Be,this.tileID.canonical))continue}else if(!Te.filter(new nn(this.tileID.overscaledZ),F))continue}_e=!0,xe.targetId&&this.addFeatureVariant(re,xe)}_e&&this.appendToResult(e,ee,f,re,Q)}}loadMatchingModelFeature(e,i,o,l,d){const f=this.bucketLayerIDs[0][0],g=o.layers;if(!g[f])return;const{styleLayer:x,targets:b}=g[f];if(x.type!=="model")return;const S=l.tile,E=i.featureIndex,I=S.getBucket(x);if(!(I&&I instanceof Eg))return;const D=function(pe,_e,xe,Te){const Be=pe.getNodesInfo()[_e];if(Be.hiddenByReplacement||!Be.node.meshes)return;let Je=Number.MAX_VALUE;const Ze=Be.node,Ye=xe.tile,rt=Te.calculatePosMatrix(Ye.tileID.toUnwrapped(),Te.worldSize),Oe=Be.evaluatedScale;let Ke=0;Te.elevation&&Ze.elevation&&(Ke=Ze.elevation*Te.elevation.exaggeration()),vt(rt,rt,[(Ze.anchor?Ze.anchor[0]:0)*(Oe[0]-1),(Ze.anchor?Ze.anchor[1]:0)*(Oe[1]-1),Ke]),ot(rt,rt,Oe);const Le=xe.queryGeometry,Fe=Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,at=function(kt){const Et=et([],rt,kt.matrix);et(Et,Te.expandedFarZProjMatrix,Et);for(let gt=0;gt<kt.meshes.length;++gt){const st=kt.meshes[gt];if(gt===kt.lightMeshIndex)continue;const Zt=P1(Fe,Te,Et,st.aabb);Zt!=null&&(Je=Math.min(Zt,Je))}if(kt.children)for(const gt of kt.children)at(gt)};if(at(Ze),Je===Number.MAX_VALUE)return;const lt=new U(0,0);return j1(Ye.tileID.canonical,lt,Be.node.anchor[0],Be.node.anchor[1]),{intersectionZ:Je,position:lt,feature:Be.feature}}(I,E,l,d);if(!D)return;const{z,x:F,y:$}=S.tileID.canonical,{feature:H,intersectionZ:ee,position:K}=D;let N={};H.id!==void 0&&(N=o.sourceCache.getFeatureState(x.sourceLayer,H.id));const Z=new jh({},z,F,$,H.id);Z.tile=this.tileID.canonical,Z.state=N,Z.properties=H.properties,Z.geometry={type:"Point",coordinates:[K.lng,K.lat]};let Q=this.serializedLayersCache.get(f);Q||(Q=x.serialize(),Q.id=f,this.serializedLayersCache.set(f,Q)),Z.source=Q.source,Z.sourceLayer=Q["source-layer"],Z.layer=ze({},Q);let re=!1;for(const pe of b){this.updateFeatureProperties(Z,pe);const{filter:_e}=pe;if(_e){if(H.properties=Z.properties,_e.needGeometry){if(!_e.filter(new nn(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!_e.filter(new nn(this.tileID.overscaledZ),H))continue}re=!0,pe.targetId&&this.addFeatureVariant(Z,pe)}re&&this.appendToResult(e,f,E,Z,ee)}updateFeatureProperties(e,i,o){if(i.properties){const l={};for(const d in i.properties){const f=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);f!=null&&(l[d]=f)}e.properties=l}}addFeatureVariant(e,i,o){const l={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(l.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(l)}appendToResult(e,i,o,l,d){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:o,feature:l,intersectionZ:d})}lookupSymbolFeatures(e,i,o,l,d){const f={};this.loadVTLayers();for(const g of e)this.loadMatchingFeature(f,{bucketIndex:i,sourceLayerIndex:o,featureIndex:g,layoutVertexArrayOffset:0},l,d);return f}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(o),d=this.vtFeatures[l];if(d[i])return d[i];const f=this.vtLayers[l].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const l=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(l!=null)if(Array.isArray(l)){if(!this.promoteIdExpression){const d=Ll(l);if(d.result!=="success"){const f=d.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void vi(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Fu),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[l];typeof o=="boolean"&&(o=Number(o))}return o}}function R2(n,e,i,o,l){return ii(n,(d,f)=>{const g=e instanceof Ja?e.get(f):null;return g&&g.evaluate?g.evaluate(i,o,void 0,l):g})}function rR(n,e){return e-n}Tt(P2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const D2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=o>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=D2[15&o];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new kx(g,f,d,e)}constructor(e,i=64,o=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=D2.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-g%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ox(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:g}=this,x=[0,d.length-1,0],b=[];for(;x.length;){const S=x.pop()||0,E=x.pop()||0,I=x.pop()||0;if(E-I<=g){for(let $=I;$<=E;$++){const H=f[2*$],ee=f[2*$+1];H>=e&&H<=o&&ee>=i&&ee<=l&&b.push(d[$])}continue}const D=I+E>>1,z=f[2*D],F=f[2*D+1];z>=e&&z<=o&&F>=i&&F<=l&&b.push(d[D]),(S===0?e<=z:i<=F)&&(x.push(I),x.push(D-1),x.push(1-S)),(S===0?o>=z:l>=F)&&(x.push(D+1),x.push(E),x.push(1-S))}return b}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,g=[0,l.length-1,0],x=[],b=o*o;for(;g.length;){const S=g.pop()||0,E=g.pop()||0,I=g.pop()||0;if(E-I<=f){for(let $=I;$<=E;$++)L2(d[2*$],d[2*$+1],e,i)<=b&&x.push(l[$]);continue}const D=I+E>>1,z=d[2*D],F=d[2*D+1];L2(z,F,e,i)<=b&&x.push(l[D]),(S===0?e-o<=z:i-o<=F)&&(g.push(I),g.push(D-1),g.push(1-S)),(S===0?e+o>=z:i+o>=F)&&(g.push(D+1),g.push(E),g.push(1-S))}return x}}function Ox(n,e,i,o,l,d){if(l-o<=i)return;const f=o+l>>1;z2(n,e,f,o,l,d),Ox(n,e,i,o,f-1,1-d),Ox(n,e,i,f+1,l,1-d)}function z2(n,e,i,o,l,d){for(;l>o;){if(l-o>600){const b=l-o+1,S=i-o+1,E=Math.log(b),I=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*I*(b-I)/b)*(S-b/2<0?-1:1);z2(n,e,i,Math.max(o,Math.floor(i-S*I/b+D)),Math.min(l,Math.floor(i+(b-S)*I/b+D)),d)}const f=e[2*i+d];let g=o,x=l;for(tp(n,e,o,i),e[2*l+d]>f&&tp(n,e,o,l);g<x;){for(tp(n,e,g,x),g++,x--;e[2*g+d]<f;)g++;for(;e[2*x+d]>f;)x--}e[2*o+d]===f?tp(n,e,o,x):(x++,tp(n,e,x,l)),x<=i&&(o=x+1),i<=x&&(l=x-1)}}function tp(n,e,i,o){Fx(n,i,o),Fx(e,2*i,2*o),Fx(e,2*i+1,2*o+1)}function Fx(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function L2(n,e,i,o){const l=n-i,d=e-o;return l*l+d*d}s.$=as,s.A=na,s.B=ho,s.C=el,s.D=Oh,s.E=Fa,s.F=2,s.G=Ff,s.H=Gw,s.I=Ds,s.J=class extends Tg{},s.K=Wt,s.L=vc,s.M=po,s.N=rh,s.O=nh,s.P=dt,s.Q=Zd,s.R=Mu,s.S=ah,s.T=dx,s.U=dh,s.V=Tg,s.W=kc,s.X=Ll,s.Y=Hu,s.Z=Ml,s._=Mc,s.a=function(n){return Yr.API_CDN_URL_REGEX.test(n)},s.a$=bt,s.a0=xc,s.a1=fh,s.a2=sh,s.a3=pm,s.a4=function(n){const e=n.value;let i=[];if(!e)return i;const o=Wt(e);return o!=="string"?(i=i.concat([new Tg(n.key,e,`string expected, "${o}" found`)]),i):(gx(e,!0)||(i=i.concat([new Tg(n.key,e,`invalid url "${e}"`)])),i)},s.a5=Ce,s.a6=bm,s.a7=$n,s.a8=ut,s.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return pn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Nt(n.x,e.x,i),y:Nt(n.y,e.y,i),z:Nt(n.z,e.z,i),azimuthal:Nt(n.azimuthal,e.azimuthal,i),polar:Nt(n.polar,e.polar,i)}}},s.aA=tr,s.aB=sn,s.aC=Xe,s.aD=ve,s.aE=m,s.aF=function(n,e){const i={};for(let o=0;o<e.length;o++){const l=e[o];l in n&&(i[l]=n[l])}return i},s.aG=J,s.aH=ce,s.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const l=this.entries[n]=this.entries[n]||{callbacks:[]};if(l.result){const[d,f]=l.result;return this.scheduler?this.scheduler.add(()=>{o(d,f)},e):o(d,f),()=>{}}return l.callbacks.push(o),l.cancel||(l.cancel=i((d,f)=>{l.result=[d,f];for(const g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(d,f)},e):g(d,f);setTimeout(()=>delete this.entries[n],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(d=>d!==o),l.callbacks.length||(l.cancel(),delete this.entries[n]))}}},s.aJ=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},l=>{const d=_l(n.request,(f,g,x,b)=>{f?l(f):g&&l(null,{vectorTile:i?void 0:new Yl.VectorTile(new ig(g)),rawData:g,cacheControl:x,expires:b})});return()=>{d.cancel(),l()}},e)},s.aK=function(n){gc++,gc>uo&&(n.getActor().send("enforceCacheSizeLimit",No),gc=0)},s.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.aM=ir,s.aN=x1,s.aO=E1,s.aP=y1,s.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const l=document.createElement("source");j_(n[o])||(i.crossOrigin="Anonymous"),l.src=n[o],i.appendChild(l)}return{cancel:()=>{}}},s.aR=yg,s.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>A2(e,0,n))},s.aT=C2,s.aU=class{constructor(n,e,i,o){this.id=n,this.position=e!=null?new U(e[0],e[1]):new U(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new In([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(et(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const o=In.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=Re([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,o,l,d,f=!1){O1(this.matrix,this,n.transform,this.position,e,i,o,l,d,f)}upload(n){if(!this.uploaded){for(const e of this.nodes)yx(e,n);for(const e of this.nodes)Sg(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)xx(n)}},s.aV=Yt,s.aW=Nf,s.aX=me,s.aY=ge,s.aZ=tl,s.a_=Ar,s.aa=nn,s.ab=kl,s.ac=Pe,s.ad=zi,s.ae=yi,s.af=be,s.ag=Ja,s.ah=Xl,s.ai=Nt,s.aj=pt,s.ak=Up,s.al=B,s.am=$i,s.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,o]){const l=pn([1,i,o]);return{x:l.x,y:l.y,z:l.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Nt(n.x,e.x,i),y:Nt(n.y,e.y,i),z:Nt(n.z,e.z,i)}}},s.ao=function(n,e,i=0,o=!0){const l=new dt(i,i),d=n.sub(l),f=e.add(l),g=[d,new dt(f.x,d.y),f,new dt(d.x,f.y)];return o&&g.push(d.clone()),g},s.ap=function(n,e){const i=[];for(let o=0;o<n.length;o++){const l=De(o-1,-1,n.length-1),d=De(o+1,-1,n.length-1),f=n[o],g=n[d],x=n[l].sub(f).unit(),b=g.sub(f).unit(),S=b.angleWithSep(x.x,x.y),E=x.add(b).unit().mult(-1*e/Math.sin(S/2));i.push(f.add(E))}return i},s.aq=r1,s.ar=ur,s.as=function(n,e,i=0){return Jt(((e.x-i)*n.scale-n.x)*pt,(e.y*n.scale-n.y)*pt,Me(e.z,e.y))},s.at=Ui,s.au=xi,s.av=xo,s.aw=gw,s.ax=function(n){let e=1/0,i=1/0,o=-1/0,l=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),l=Math.max(l,d.y);return{min:new dt(e,i),max:new dt(o,l)}},s.ay=le,s.az=et,s.b=function(n){return Yr.API_FONTS_REGEX.test(n)},s.b$=ti,s.b0=wh,s.b1=gg,s.b2=function(){Qs.isLoading()||Qs.isLoaded()||Fl()!=="deferred"||vm()},s.b3=rf,s.b4=Ot,s.b5=jh,s.b6=Yn,s.b7=Gy,s.b8=Fy,s.b9=At,s.bA=function(n,e){const{x:i,y:o}=n.point,l=Yv(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return et(l,l,wy(va(e)))},s.bB=Y,s.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},s.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.bE=Ai,s.bF=tn,s.bG=ji,s.bH=Of,s.bI=Gs,s.bJ=Jy,s.bK=function(n,e,i,o,l){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=o,n.float32[d+2]=l},s.bL=mg,s.bM=tg,s.bN=Ut,s.bO=kr,s.bP=Bb,s.bQ=R1,s.bR=$b,s.bS=Gb,s.bT=ix,s.bU=Yw,s.bV=Yy,s.bW=kx,s.bX=De,s.bY=Dr,s.bZ=function(n,e,i){i*=.5;var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=o*x+l*g,n[1]=l*x-o*g,n[2]=d*x+f*g,n[3]=f*x-d*g,n},s.b_=fr,s.ba=Ho,s.bb=Hc,s.bc=Mo,s.bd=kn,s.be=Sf,s.bf=cx,s.bg=function(n,e){const i=Xl(e.zoom);if(i===0)return va(n);const o=$m(n),l=by(o),d=le(o.getWest())*e.worldSize,f=le(o.getEast())*e.worldSize,g=ce(o.getNorth())*e.worldSize,x=ce(o.getSouth())*e.worldSize,b=[d,g,0],S=[f,g,0],E=[d,x,0],I=[f,x,0],D=Ue([],e.globeMatrix);return zi(b,b,D),zi(S,S,D),zi(E,E,D),zi(I,I,D),l[0]=ol(l[0],E,i),l[1]=ol(l[1],I,i),l[2]=ol(l[2],S,i),l[3]=ol(l[3],b,i),In.fromPoints(l)},s.bh=Hm,s.bi=Ue,s.bj=wf,s.bk=ol,s.bl=gh,s.bm=to,s.bn=hi,s.bo=vt,s.bp=Lg,s.bq=ig,s.br=_l,s.bs=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},s.bt=Ge,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=ao,s.bw=function(n){var e=new X(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.bx=Re,s.by=Vt,s.bz=He,s.c=za,s.c$=function(n){return n({pluginStatus:zs,pluginURL:pa}),hh.on("pluginStateChange",n),n},s.c0=lr,s.c1=Er,s.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.c3=Ei,s.c4=function(n,e,i,o,l){var d,f=1/Math.tan(e/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+o)*(d=1/(o-l)),n[14]=2*l*o*d):(n[10]=-1,n[14]=-2*o),n},s.c5=function(n,e,i,o,l,d,f){var g=1/(e-i),x=1/(o-l),b=1/(d-f);return n[0]=-2*g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+i)*g,n[13]=(l+o)*x,n[14]=(f+d)*b,n[15]=1,n},s.c6=ae,s.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},s.c8=Xc,s.c9=mo,s.cA=bg,s.cB=gi,s.cC=A1,s.cD=function(n){const e=A1(n,!0);return Y([],[e[0],e[1],e[4],e[5]])},s.cE=ot,s.cF=Wl,s.cG=Ct,s.cH=function(n){const{x:e,y:i}=n.point,{lng:o,lat:l}=n._center;return Yv(e,i,n.worldSize,o,l)},s.cI=Ii,s.cJ=q,s.cK=$r,s.cL=y,s.cM=function(n,e,i){let o=0;for(let l=0;l<2;++l)n[l]>0&&(o+=(n[l]-0)*(n[l]-0)),e[l]<0&&(o+=(0-e[l])*(0-e[l]));return o},s.cN=45,s.cO=Lu,s.cP=ue,s.cQ=Eh,s.cR=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),l=o>0?Math.acos(i/o)*Ne:0;let d=n!==0||e!==0?Math.atan2(-e,-n)*Ne+90:0;return d<0&&(d+=360),[o,d,l]},s.cS=Jt,s.cT=Se,s.cU=Pi,s.cV=In,s.cW=pn,s.cX=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},s.cY=Vi,s.cZ=gx,s.c_=function(n,e){return n.readFields(tP,{icons:[]},e)},s.ca=Zc,s.cb=or,s.cc=Sh,s.cd=U,s.ce=c1,s.cf=function(){var n=new X(4);return X!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},s.cg=function(n,e,i){var o=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=o*x+d*g,n[1]=l*x+f*g,n[2]=o*-g+d*x,n[3]=l*-g+f*x,n},s.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.ci=Zn,s.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.ck=Vr,s.cl=Rr,s.cm=Lr,s.cn=Jc,s.co=I1,s.cp=yn,s.cq=Zv,s.cr=function(n,e,i,o,l,d,f,g,x){if(x.name==="globe")return Zv(n,e,new yn(i,o,l),!1);const b=Nf({z:i,x:o,y:l},x);return new In([(d+b.x/b.scale)*e,e*(b.y/b.scale),f],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),g])},s.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},s.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},s.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return ie[e]},s.cv=Ee,s.cw=er,s.cx=v,s.cy=function(n){const e=Re(new Float64Array(16));et(e,n.pixelMatrix,n.globeMatrix);const i=[0,R,0],o=[0,P,0];return zi(i,i,e),zi(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Sy(n,new U(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!Sy(n,new U(n.center.lat,-90))]},s.cz=function(n,e){const{scale:i}=n.tileTransform,o=i*pt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(l,d,f){var g=d[1],x=d[2],b=d[3],S=f[0],E=f[1];return l[0]=d[0]*S,l[1]=g*S,l[2]=x*E,l[3]=b*E,l}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.d=function(n){return Yr.API_TILEJSON_REGEX.test(n)},s.d$=yf,s.d0=Ag,s.d1=Rh,s.d2=ex,s.d3=ki,s.d4=Ya,s.d5=Ps,s.d6=Rs,s.d7=pi,s.d8=function(n){const e=n.indexOf(jc);return e>=0?n.slice(0,e):n},s.d9=function(n){return n.indexOf(jc)>=0},s.dA=Kv,s.dB=os,s.dC=ss,s.dD=256,s.dE=function(n,e){const i=[0,0,0];return zi(i,i,Hm(va(e.canonical))),zi(i,i,n),i},s.dF=n=>({u_camera_to_center_distance:new or(n),u_extrude_scale:new eo(n),u_device_pixel_ratio:new or(n),u_matrix:new Xc(n),u_inv_rot_matrix:new Xc(n),u_merc_center:new mo(n),u_tile_id:new Zc(n),u_zoom_transition:new or(n),u_up_dir:new Zc(n),u_emissive_strength:new or(n)}),s.dG=n=>({u_matrix:new Xc(n),u_pixels_to_tile_units:new eo(n),u_device_pixel_ratio:new or(n),u_width_scale:new or(n),u_floor_width_scale:new or(n),u_units_to_pixels:new mo(n),u_dash_image:new Sh(n),u_gradient_image:new Sh(n),u_image_height:new or(n),u_texsize:new mo(n),u_tile_units_to_pixels:new or(n),u_alpha_discard_threshold:new or(n),u_trim_offset:new mo(n),u_trim_fade_range:new mo(n),u_trim_color:new Eh(n),u_emissive_strength:new or(n),u_zbias_factor:new or(n),u_tile_to_meter:new or(n),u_ground_shadow_factor:new Zc(n)}),s.dH=n=>({u_matrix:new Xc(n),u_texsize:new mo(n),u_pixels_to_tile_units:new eo(n),u_device_pixel_ratio:new or(n),u_width_scale:new or(n),u_floor_width_scale:new or(n),u_image:new Sh(n),u_units_to_pixels:new mo(n),u_tile_units_to_pixels:new or(n),u_alpha_discard_threshold:new or(n),u_trim_offset:new mo(n),u_trim_fade_range:new mo(n),u_trim_color:new Eh(n),u_emissive_strength:new or(n),u_zbias_factor:new or(n),u_tile_to_meter:new or(n),u_ground_shadow_factor:new Zc(n),u_pattern_transition:new or(n)}),s.dI=$c,s.dJ=sM,s.dK=eb,s.dL=(n,e,i,o,l,d)=>{const f=n.transform,g=f.projection.name==="globe";let x;if(d.paint.get("circle-pitch-alignment")==="map")if(g){const S=Kv(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([S,0,0,S])}else x=f.calculatePixelsToTileUnitsMatrix(i);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const b={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:lo.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:eC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(g){b.u_inv_rot_matrix=o,b.u_merc_center=l,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=Xl(f.zoom);const S=l[0]*pt,E=l[1]*pt;b.u_up_dir=f.projection.upVector(new yn(0,0,0),S,E)}return b},s.dM=vw,s.dN=Ss,s.dO=(n,e,i,o,l,d,f,g,x,b)=>{const S=n.transform,E=S.pitch<15?_w(.07,.7,ve((14-S.zoom)/5,0,1)):.07,I=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:xw(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:yw(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(I?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:E,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:b}},s.dP=(n,e,i,o,l,d,f,g,x,b)=>{const S=n.transform,E=S.calculatePixelsToTileUnitsMatrix(e),I=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=S.pitch<15?_w(.07,.7,ve((14-S.zoom)/5,0,1)):.07;return{u_matrix:xw(n,e,i,o),u_pixels_to_tile_units:E,u_device_pixel_ratio:d,u_width_scale:f,u_floor_width_scale:g,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:bw(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:yw(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toRenderColor(I?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:b}},s.dQ=Lt,s.dR=Tf,s.dS=Me,s.dT=nw,s.dU=yo,s.dV=eg,s.dW=Jl,s.dX=450,s.dY=7,s.dZ=NM,s.d_=Ni,s.da=function(n){const e=n.lastIndexOf(jc);return e>=0?n.slice(e+1):""},s.db=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dc=function(n,e,i,o){return n.type==="custom"?new VM(n,e):new YM[n.type](n,e,i,o)},s.dd=li,s.de=function(n){const e=n.indexOf(jc);return e>=0?n.slice(e+1):""},s.df=class extends jh{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},s.dg=hh,s.dh=gl,s.di=jm,s.dj=class extends Co{constructor(n){super(n),this.current=Um}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dk=he,s.dl=function(n,e,i){const o=Xl(i.zoom),l=n.style.map._antialias,d=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!l&&!d},s.dm=function(n){const e=n.pixelsPerMeter,i=e/ae(1,n.center.lat),o=Re(new Float64Array(16));return vt(o,o,[n.point.x,n.point.y,0]),ot(o,o,[i,i,e]),Float32Array.from(o)},s.dn=$m,s.dp=function(n){const e=Ee-5;n=ve(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(B(n))),3);return Math.round(i*(C.length-1))},s.dq=function(n,e,i,o){const l=e.getNorth(),d=e.getSouth(),f=e.getWest(),g=e.getEast(),x=1<<n.z,b=g-f,S=l-d,E=b/A,I=-S/C[i],D=[0,E,0,I,0,0,l,f,0];if(n.z>0){const z=180/o;je(D,D,[z/b+1,0,0,0,z/S+1,0,-.5*z/E,.5*z/I,1])}return D[2]=x,D[5]=n.x,D[8]=n.y,D},s.dr=va,s.ds=function(n,e,i){const o=Re(new Float64Array(16)),l=(e/(1<<n)-.5)*Math.PI*2;return Dt(o,i.globeMatrix,l),Float32Array.from(o)},s.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,l=Math.floor(n.x),d=Math.floor((n.x-l)*o),f=Math.floor(n.y*o),g=this.findDEMTileFor(new ir(i,l,i,d,f));return!(!g||!g.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const l=o.getSource().maxzoom,d=1<<l,f=Math.floor(n.x),g=n.x-f,x=new ir(l,f,l,Math.floor(g*d),Math.floor(n.y*d)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const S=b.dem,E=1<<b.tileID.canonical.z,I=(g*E-b.tileID.canonical.x)*S.dim,D=(n.y*E-b.tileID.canonical.y)*S.dim,z=Math.floor(I),F=Math.floor(D);return(i?this.exaggeration():1)*Nt(Nt(S.get(z,F),S.get(z,F+1),D-F),Nt(S.get(z+1,F),S.get(z+1,F+1),D-F),I-z)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new Pe(n.wrap+(n.canonical.x+e/pt)/o,(n.canonical.y+i/pt)/o))}getAtTileOffsetFunc(n,e,i,o){return l=>{const d=this.getAtTileOffset(n,l.x,l.y),f=o.upVector(n.canonical,l.x,l.y);return ti(f,f,d*o.upVectorScale(n.canonical,e,i).metersToTile),f}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const l=kh.create(this,n,o);return!!l&&(e.forEach(d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,l=1<<n.canonical.z-o.canonical.z;let d=n.canonical.x/l-o.canonical.x,f=n.canonical.y/l-o.canonical.y,g=0;for(let x=0;x<n.canonical.z-o.canonical.z&&!i.leaves[g];x++){d*=2,f*=2;const b=2*Math.floor(f)+Math.floor(d);g=i.childOffsets[g]+b,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const l of n){const d=this.getMinMaxForTile(l.tileID);d&&(i=Math.min(i,d.min),o=Math.max(o,d.max),e=!0)}return e?{min:i,max:o}:null}},s.du=ub,s.dv=Zl,s.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},s.dx=fe,s.dy=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.dz=Sr,s.e=Yr,s.e$=M2,s.e0=256,s.e1=wy,s.e2=Ao,s.e3=Dt,s.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.e5=ya,s.e6=Gc,s.e7=function(n,e,i,o,l){return ve((n-e)/(i-e)*(l-o)+o,o,l)},s.e8=Nr,s.e9=function(n,e){var i=e[0],o=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],S=e[8],E=S*f-g*b,I=-S*d+g*x,D=b*d-f*x,z=i*E+o*I+l*D;return z?(n[0]=E*(z=1/z),n[1]=(-S*o+l*b)*z,n[2]=(g*o-l*f)*z,n[3]=I*z,n[4]=(S*i-l*x)*z,n[5]=(-g*i+l*d)*z,n[6]=D*z,n[7]=(-b*i+o*x)*z,n[8]=(f*i-o*d)*z,n):null},s.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},s.eB=Un,s.eC=j,s.eD=Wn,s.eE=function(n,e,i,o){return n[0]=e,n[1]=i,n[2]=o,n},s.eF=function([n,e,i]){const o=Math.hypot(n,e,i),l=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/o);return new U(q(l),q(d))},s.eG=sr,s.eH=px,s.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(pr==null){const o=i.navigator?i.navigator.userAgent:null;pr=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return pr}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eJ=function(n,e){No=n,uo=e},s.eK=Sy,s.eL=Jv,s.eM=function(n){const e=[0,0,0],i=Re(new Float64Array(16));return et(i,n.pixelMatrix,n.globeMatrix),zi(e,e,i),new dt(e[0],e[1])},s.eN=function(n,e,i=!1){if(zs===Qd||zs===ef||zs===tf)throw new Error("setRTLTextPlugin cannot be called multiple times.");pa=lo.resolveURL(n),zs=Qd,nf=e,uh(),i||vm()},s.eO=Fl,s.eP=function(){Ag().acquire(bx)},s.eQ=function(){const n=Wf;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(bx),Wf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.eR=lu,s.eS=function(n){const e=md();if(!e)return;const i=e.delete(co);n&&i.then(()=>n()).catch(n)},s.eT=qf,s.eU=x2,s.eV=function(n){Rx=lo.resolveURL(n),Vh||(Vh=new Oh(Ag(),new Fa)),Vh.broadcast("setDracoUrl",Rx)},s.eW=v2,s.eX=function(n){Nh=lo.resolveURL(n),Vh||(Vh=new Oh(Ag(),new Fa)),Vh.broadcast("setMeshoptUrl",Nh)},s.eY=Tt,s.eZ=Kl,s.e_=Xo,s.ea=um,s.eb=Qn,s.ec=$e,s.ed=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[l,d,f]=this.size,{gl:g}=n;g.bindTexture(g.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,l,d,f,0,ux(this.format),hx(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},s.ee=function(n,e){if(n===e){var i=e[1],o=e[2],l=e[3],d=e[6],f=e[7],g=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=d,n[11]=e[14],n[12]=l,n[13]=f,n[14]=g}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},s.ef=mx,s.eg=_i,s.eh=[1,1,1],s.ei=function(n,e,i,o){var l=new X(4);return l[0]=n,l[1]=e,l[2]=i,l[3]=o,l},s.ej=Kn,s.ek=function(n,e,i,o){var l=e[0],d=e[1],f=e[2],g=e[3];return n[0]=l+o*(i[0]-l),n[1]=d+o*(i[1]-d),n[2]=f+o*(i[2]-f),n[3]=g+o*(i[3]-g),n},s.el=kh,s.em=Lh,s.en=_a,s.eo=nl,s.ep=function(n,e,i,o,l,d,f,g,x,b,S,E,I,D,z,F){var $=new X(16);return $[0]=n,$[1]=e,$[2]=i,$[3]=o,$[4]=l,$[5]=d,$[6]=f,$[7]=g,$[8]=x,$[9]=b,$[10]=S,$[11]=E,$[12]=I,$[13]=D,$[14]=z,$[15]=F,$},s.eq=V,s.er=vh,s.es=gf,s.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new dt(1/0,1/0),max:new dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=Vb(new dt(0,0),new dt(pt,pt),n),o=[];if(e&&!Ny(i,this._globalClipBounds))return o;for(const l of this._activeRegions){if(l.hiddenByOverlap||!Ny(i,l))continue;const d=RC(l.min,l.max,n);o.push({min:d.min,max:d.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask,clipScope:l.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(o).buckets[e.layer];l&&l.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),l=n.getClipScope();for(const d of e){if(!d.footprint)continue;const f=Vb(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:o,clipScope:l})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Jm(e.min,i.min)||Jm(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,l){const d=(f,g)=>f+g;return o.length-l.length||o.reduce(d,"").localeCompare(l.reduce(d,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!Nb(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!ao(i.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Ym&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const l=o[i].priority;for(;i<o.length&&o[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let l=i;const d=i;for(;l!==o;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let g=0;g<d;g++){const x=this._activeRegions[g];if(!x.hiddenByOverlap&&f.order===Ym&&Ny(f,x)&&(f.hiddenByOverlap=Ub(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++l}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},s.eu=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Ho,o=new Ar,l=[],d=n+1+2,f=e[0]+1,g=e[0]+1+(1+e.length),x=(b,S,E)=>{let I=b===d-1?b-2:b===0?b:b-1;return I+=E?24575:0,[I,S]};for(let b=0;b<d;++b)i.emplaceBack(...x(b,0,!0));for(let b=0;b<f;++b)for(let S=0;S<d;++S)i.emplaceBack(...x(S,b,(S===0||S===d-1)&&!0));for(let b=0;b<e.length;++b){const S=e[b];for(let E=0;E<d;++E)i.emplaceBack(...x(E,S,!0))}for(let b=0;b<e.length;++b){const S=o.length,E=e[b]+1+2,I=new Ar;for(let F=0;F<E-1;F++){const $=F===E-2,H=$?d*(g-e.length+b-F):d;for(let ee=0;ee<d-1;ee++){const K=F*d+ee;F===0||$||ee===0||ee===d-2?(I.emplaceBack(K+1,K,K+H),I.emplaceBack(K+H,K+H+1,K+1)):(o.emplaceBack(K+1,K,K+H),o.emplaceBack(K+H,K+H+1,K+1))}}const D=kn.simpleSegment(0,S,i.length,o.length-S);for(let F=0;F<I.uint16.length;F+=3)o.emplaceBack(I.uint16[F],I.uint16[F+1],I.uint16[F+2]);const z=kn.simpleSegment(0,S,i.length,o.length-S);l.push({withoutSkirts:D,withSkirts:z})}return{vertices:i,indices:o,segments:l}}_createGrid(n){const e=this._fillGridMeshWithLods(A,C);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Mo.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Ar;for(let f=0;f<=A;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new ya,o=new ya,l=new ya,d=new ya;this._poleSegments=[];for(let f=0,g=0;f<y;f++){const x=360/(1<<f);i.emplaceBack(0,-m,0,.5,0),o.emplaceBack(0,-m,0,.5,1),l.emplaceBack(0,-m,0,.5,.5),d.emplaceBack(0,-m,0,.5,.5);for(let b=0;b<=A;b++){let S=b/A,E=0;const I=Nt(0,x,S),[D,z,F]=L(JI,QI,I,m);i.emplaceBack(D,z,F,S,E),o.emplaceBack(D,z,F,S,1-E);const $=B(I);S=.5+.5*Math.sin($),E=.5+.5*Math.cos($),l.emplaceBack(D,z,F,S,E),d.emplaceBack(D,z,F,S,1-E)}this._poleSegments.push(kn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Ls,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,Ls,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(l,Ls,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,Ls,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},s.ev=Ym,s.ew=de,s.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.ey=ye,s.ez=ct,s.f=function(n){return n.indexOf("mapbox:")===0},s.f0=P2,s.f1=fw,s.f2=eu,s.f3="hd_road_elevation",s.f4=Ly,s.f5=ii,s.f6=iu,s.f7=Qy,s.f8=ru,s.f9=function(n,e,i,o,l,d,f,g=1,x,b){n.createArrays(),n.tilePixelRatio=pt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,E=n.layers[0]._unevaluatedLayout._values,I={};I.scaleFactor=g,I.textSizeScaleRange=S.get("text-size-scale-range"),I.iconSizeScaleRange=S.get("icon-size-scale-range");const[D,z]=I.textSizeScaleRange,[F,$]=I.iconSizeScaleRange;I.textScaleFactor=ve(I.scaleFactor,D,z),I.iconScaleFactor=ve(I.scaleFactor,F,$);const H=E["text-size"],ee=E["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:pe,maxZoom:_e}=n.textSizeData;I.compositeTextSizes=[H.possiblyEvaluate(new nn(pe),d),H.possiblyEvaluate(new nn(_e),d)]}if(n.iconSizeData.kind==="composite"){const{minZoom:pe,maxZoom:_e}=n.iconSizeData;I.compositeIconSizes=[ee.possiblyEvaluate(new nn(pe),d),ee.possiblyEvaluate(new nn(_e),d)]}I.layoutTextSize=H.possiblyEvaluate(new nn(f+1),d),I.layoutIconSize=ee.possiblyEvaluate(new nn(f+1),d),I.textMaxSize=H.possiblyEvaluate(new nn(18),d);const K=S.get("symbol-placement"),N=S.get("text-rotation-alignment")==="map"&&K!=="point",Z=S.get("text-size");let Q=!1;const re=[];for(const pe of n.features){const _e=S.get("text-font").evaluate(pe,{},d).join(","),xe=Z.evaluate(pe,{},d)*I.textScaleFactor,Te=I.layoutTextSize.evaluate(pe,{},d)*I.textScaleFactor,Be=I.layoutIconSize.evaluate(pe,{},d)*I.iconScaleFactor,Je={horizontal:{},vertical:void 0},Ze=pe.text;let Ye,rt=[0,0];if(Ze){const Rt=Ze.toString(),Ht=S.get("text-letter-spacing").evaluate(pe,{},d)*kr,ei=S.get("text-line-height").evaluate(pe,{},d)*kr,ni=ay(Rt)?Ht:0,di=S.get("text-anchor").evaluate(pe,{},d),ai=S.get("text-variable-anchor");if(!ai){const se=S.get("text-radial-offset").evaluate(pe,{},d);if(se)rt=Yw(di,[se*kr,tx]);else{const Ve=S.get("text-offset").evaluate(pe,{},d);rt=[Ve[0]*kr,Ve[1]*kr]}}let si=N?"center":S.get("text-justify").evaluate(pe,{},d);const cn=K==="point",xn=cn?S.get("text-max-width").evaluate(pe,{},d)*kr:1/0,te=se=>{n.allowVerticalPlacement&&Jd(Rt)&&(Je.vertical=Ky(Ze,e,i,l,_e,xn,ei,di,se,ni,rt,Gs.vertical,!0,Te,xe,x))};if(!N&&ai){const se=si==="auto"?ai.map(ht=>ix(ht)):[si];let Ve=!1;for(let ht=0;ht<se.length;ht++){const xt=se[ht];if(!Je.horizontal[xt])if(Ve)Je.horizontal[xt]=Je.horizontal[0];else{const _t=Ky(Ze,e,i,l,_e,xn,ei,"center",xt,ni,rt,Gs.horizontal,!1,Te,xe,x);_t&&(Je.horizontal[xt]=_t,Ve=_t.positionedLines.length===1)}}te("left")}else{if(si==="auto"&&(si=ix(di)),cn||S.get("text-writing-mode").indexOf("horizontal")>=0||!Jd(Rt)){const se=Ky(Ze,e,i,l,_e,xn,ei,di,si,ni,rt,Gs.horizontal,!1,Te,xe,x);se&&(Je.horizontal[si]=se)}te(cn?"left":si)}}let Oe,Ke,Le,Fe,at,lt,kt,Et=!1;if(pe.icon&&pe.icon.hasPrimary()){const Rt=Qw(pe.icon,n.iconSizeData,E["icon-size"],d,n.zoom,pe,x,I.iconScaleFactor);Oe=Rt.iconPrimary,Le=Rt.iconSecondary;const Ht=Oe.toString();if(Ke=o.get(Ht),Ke&&(at=S.get("icon-offset").evaluate(pe,{},d),lt=S.get("icon-anchor").evaluate(pe,{},d),kt=S.get("icon-text-fit").evaluate(pe,{},d),Ye=gM(l.get(Ht),Le?l.get(Le.toString()):void 0,at,lt),Et=Ke.sdf,n.sdfIcons===void 0?n.sdfIcons=Ke.sdf:n.sdfIcons!==Ke.sdf&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==n.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Le){const ei=Le.toString();Fe=o.get(ei)}}Q=Q||!(!pe.icon||!pe.icon.hasSecondary());const gt=nx(Je.horizontal)||Je.vertical;n.iconsInText||(n.iconsInText=!!gt&&gt.iconsInText);const st=Te*I.textScaleFactor/kr,{defaultShapedIcon:Zt,verticallyShapedIcon:Pt}=EM(n,Ye,S,pe,d,Je,st,at,kt);kt!=="none"&&Ye&&(kw(Ye)||Ow(Ye))&&(lg(0,Ke,Oe,Ye,Zt,kt,b,o,l),lg(0,Fe,Le,Ye,Zt,kt,b,o,l),Pt&&(lg(0,Ke,Oe,Ye,Pt,kt,b,o,l),lg(0,Fe,Le,Ye,Pt,kt,b,o,l))),Ye=Zt,re.push({feature:pe,shapedTextOrientations:Je,shapedText:gt,shapedIcon:Ye,iconPrimary:Oe,iconSecondary:Le,iconOffset:at,iconAnchor:lt,verticallyShapedIcon:Pt,layoutTextSize:Te,layoutIconSize:Be,textOffset:rt,isSDFIcon:Et,iconTextFit:kt})}return{featureData:re,sizes:I,hasAnySecondaryIcon:Q,textAlongLine:N,symbolPlacement:K}},s.fa=Hw,s.fb=function(n,e,i,o,l,d,f,g,x,b){const{featureData:S,hasAnySecondaryIcon:E,sizes:I,textAlongLine:D,symbolPlacement:z}=e;for(const F of S){const{shapedIcon:$,verticallyShapedIcon:H,feature:ee,shapedTextOrientations:K,shapedText:N,layoutTextSize:Z,textOffset:Q,isSDFIcon:re,iconPrimary:pe,iconSecondary:_e,iconTextFit:xe,iconOffset:Te}=F;e1($,b.iconPositions,pe,_e),e1(H,b.iconPositions,pe,_e),SM(K,b.iconPositions),(N||$)&&AM(n,ee,K,$,H,x,I,Z,0,Q,re,o,l,f,g,E,xe,Te,D,z)}i&&n.generateCollisionDebugBuffers(d,n.collisionBoxArray,I.textScaleFactor)},s.fc=Yl,s.fd=zg,s.fe=Da,s.ff=Tb,s.fg=Iw,s.fh=Kr,s.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==w2){const i=new Uint32Array(n,0,7),[,,o,l,d,f]=i;e=i.byteLength+l+d+f+d,(o!==n.byteLength||e>=n.byteLength)&&vi("Invalid b3dm header information.")}return A2(n,e)},s.fj=function(n,e){const i=C2(n);for(const o of i){for(const l of o.meshes)tR(l);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(iR(o.lights,e)))}return i},s.fk=Eg,s.fl=_n,s.fm=U1,s.fn=Qs,s.fo=function(n){jo(),Xs!=null&&Xs.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o]).catch(l=>vi(l.message))}).catch(i=>vi(i.message))}).catch(e=>vi(e.message))},s.g=function(n,e){return gl(ze(n,{method:"GET"}),e)},s.h=So,s.i=function(n){return Yr.API_STYLE_REGEX.test(n)&&!za(n)},s.j=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},s.l=ze,s.m=gd,s.n=function(n,e){return gl(ze(n,{type:"json"}),e)},s.o=yl,s.p=function(n,e){return gl(ze(n,{method:"POST"}),e)},s.q=lo,s.r=Jr,s.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=fd,s.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},s.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},s.w=vi,s.x=function(){return wx||(wx=new lu),wx},s.y=Ix,s.z=xd}),O(["./shared"],function(s){function W(Ne){const B=Ne?Ne.url.toString():void 0;return B?performance.getEntriesByName(B):[]}function X(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let q="[";for(const ie of Ne)q+=`${X(ie)},`;return`${q}]`}let B="{";for(const q of Object.keys(Ne).sort())B+=`${q}:${X(Ne[q])},`;return`${B}}`}function Y(Ne){let B="";for(const q of s.bu)(Ne.type!=="model"||q!=="minzoom"&&q!=="maxzoom")&&(B+=`/${X(Ne[q])}`);return B}class fe{constructor(B){this.keyCache={},this._layers={},this._layerConfigs={},B&&this.replace(B)}replace(B,q){this._layerConfigs={},this._layers={},this.update(B,[],q)}update(B,q,ie){this._options=ie;for(const de of B)this._layerConfigs[de.id]=de,(this._layers[de.id]=s.dc(de,this.scope,null,this._options)).compileFilter(ie),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of q)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const he=function(de,ye){const ve={};for(let De=0;De<de.length;De++){const Ge=de[De];let ze=ye&&ye[Ge.id];ze||(Ge.type==="symbol"?ze=Ge.id:(ze=Y(Ge),Ge.type==="line"&&Ge.paint&&function bt(Lt){return typeof Lt=="string"&&Lt==="line-progress"||(Array.isArray(Lt)?Lt.some(bt):!(!Lt||typeof Lt!="object")&&Object.values(Lt).some(bt))}(Ge.paint["line-width"])&&(ze+=`/${X(Ge.paint["line-width"])}`))),ye&&(ye[Ge.id]=ze);let ft=ve[ze];ft||(ft=ve[ze]=[]),ft.push(Ge)}const be=[];for(const De in ve)be.push(ve[De]);return be}(Object.values(this._layerConfigs),this.keyCache);for(const de of he){const ye=de.map(ft=>this._layers[ft.id]),ve=ye[0];if(ve.visibility==="none")continue;const be=ve.source||"";let De=this.familiesBySource[be];De||(De=this.familiesBySource[be]={});const Ge=ve.sourceLayer||"_geojsonTileLayer";let ze=De[Ge];ze||(ze=De[Ge]=[]),ze.push(ye)}}}const Ie=1*s.e_;class je{constructor(B){const q={},ie=[];for(const ve in B){const be=B[ve],De=q[ve]={};for(const Ge in be.glyphs){const ze=be.glyphs[+Ge];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const ft=ze.metrics.localGlyph?Ie:1,bt={x:0,y:0,w:ze.bitmap.width+2*ft,h:ze.bitmap.height+2*ft};ie.push(bt),De[Ge]=bt}}const{w:he,h:de}=s.H(ie),ye=new s.eZ({width:he||1,height:de||1});for(const ve in B){const be=B[ve];for(const De in be.glyphs){const Ge=be.glyphs[+De];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const ze=q[ve][De],ft=Ge.metrics.localGlyph?Ie:1;s.eZ.copy(Ge.bitmap,ye,{x:0,y:0},{x:ze.x+ft,y:ze.y+ft},Ge.bitmap)}}this.image=ye,this.positions=q}}s.eY(je,"GlyphAtlas");class He{constructor(B){this.tileID=new s.aM(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.tileZoom=B.tileZoom,this.uid=B.uid,this.zoom=B.zoom,this.lut=B.lut,this.canonical=B.tileID.canonical,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.scope=B.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.request&&B.request.collectResourceTiming,this.promoteId=B.promoteId,this.isSymbolTile=B.isSymbolTile,this.tileTransform=s.aW(B.tileID.canonical,B.projection),this.projection=B.projection,this.worldview=B.worldview,this.localizableLayerIds=B.localizableLayerIds,this.brightness=B.brightness,this.extraShadowCaster=!!B.extraShadowCaster,this.tessellationStep=B.tessellationStep,this.scaleFactor=B.scaleFactor}parse(B,q,ie,he,de,ye){this.status="parsing",this.data=B,this.collisionBoxArray=new s.b0;const ve=new s.e$(Object.keys(B.layers).sort()),be=new s.f0(this.tileID,this.promoteId);be.bucketLayerIDs=[];const De={},Ge=new s.f1(256,256),ze={featureIndex:be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ge,availableImages:ie,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},ft=q.familiesBySource[this.source];for(const Bi in ft){const pn=B.layers[Bi];if(!pn)continue;let _n=!1,Yn=!1,pr=!1;for(const ss of ft[Bi])ss[0].type==="symbol"?_n=!0:Yn=!0,ss[0].is3D()&&ss[0].type!=="model"&&(pr=!0);if(this.extraShadowCaster&&!pr||this.isSymbolTile===!0&&!_n||this.isSymbolTile===!1&&!Yn)continue;pn.version===1&&s.w(`Vector tile source "${this.source}" layer "${Bi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Er=ve.encode(Bi),Ur=[];let Bo=!1;for(let ss=0,os=0;ss<pn.length;ss++){const zr=pn.feature(ss),Yr=be.getId(zr,Bi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Bi)){const So=zr.properties?zr.properties.worldview:null;if(this.worldview&&typeof So=="string")if(So==="all")zr.properties.$localized=!0;else{if(!So.split(",").includes(this.worldview))continue;zr.properties.$localized=!0,zr.properties.worldview=this.worldview}}!Bo&&zr.properties&&zr.properties.hasOwnProperty(s.f2)&&(Bo=!0),Ur.push({feature:zr,id:Yr,index:os,sourceLayerIndex:Er}),os++}Bo&&!ze.elevationFeatures&&B.layers.hasOwnProperty(s.f3)&&(ze.elevationFeatures=s.f4.parseFrom(B.layers[s.f3],this.canonical));for(const ss of ft[Bi]){const os=ss[0];(!this.extraShadowCaster||os.is3D()&&os.type!=="model")&&(this.isSymbolTile!==void 0&&os.type==="symbol"!==this.isSymbolTile||os.minzoom&&this.zoom<Math.floor(os.minzoom)||os.maxzoom&&this.zoom>=os.maxzoom||os.visibility!=="none"&&(Re(ss,this.zoom,ze.brightness,ie),(De[os.id]=os.createBucket({index:be.bucketLayerIDs.length,layers:ss,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Er,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:he})).populate(Ur,ze,this.tileID.canonical,this.tileTransform),be.bucketLayerIDs.push(ss.map(zr=>s.C(zr.id,zr.scope)))))}}let bt,Lt,Yt,ii,li,pi;Ge.trim();const Bn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},vi=()=>{if(bt)return this.status="done",ye(bt);if(this.extraShadowCaster)this.status="done",ye(null,{buckets:Object.values(De).filter(Bi=>!Bi.isEmpty()),featureIndex:be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Lt&&Yt&&ii){const Bi=new je(Lt),pn=new Map;for(const[pr,Er]of Yt.entries()){const{imagePosition:Ur}=s.f7(pr,Er,s.f8);pn.set(pr,Ur)}const _n={};for(const pr in De){const Er=De[pr];Er instanceof s.b1&&(Re(Er.layers,this.zoom,ze.brightness,ie),_n[pr]=s.f9(Er,Lt,Bi.positions,Yt,pn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,li))}const Yn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(de,Yt,li,()=>{Yn.iconsPending=!1,fn(_n,Bi,Yn)}),this.rasterizeIfNeeded(de,ii,pi,()=>{Yn.patternsPending=!1,fn(_n,Bi,Yn)})}},fn=(Bi,pn,_n,Yn)=>{if(_n.iconsPending||_n.patternsPending)return;const pr=new s.fa(Yt,ii,this.lut);for(const Er in De){const Ur=De[Er];if(Er in Bi)s.fb(Ur,Bi[Er],this.showCollisionBoxes,ie,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Yt,pr);else if(Ur.hasPattern&&(Ur instanceof s.b7||Ur instanceof s.b8||Ur instanceof s.dV)){Re(Ur.layers,this.zoom,ze.brightness,ie);const Bo=Object.fromEntries(pr.patternPositions);Ur.addFeatures(ze,this.tileID.canonical,Bo,ie,this.tileTransform,this.brightness)}}this.status="done",ye(null,{buckets:Object.values(De).filter(Er=>!Er.isEmpty()),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pn.image,lineAtlas:Ge,imageAtlas:pr,brightness:ze.brightness})};if(!this.extraShadowCaster){const Bi=s.f5(ze.glyphDependencies,Yn=>Object.keys(Yn).map(Number));Object.keys(Bi).length?de.send("getGlyphs",{uid:this.uid,stacks:Bi,scope:this.scope},(Yn,pr)=>{bt||(bt=Yn,Lt=pr,vi())},void 0,!1,Bn):Lt={};const pn=Array.from(ze.iconDependencies.keys()).map(Yn=>s.I.parse(Yn));pn.length?de.send("getImages",{images:pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Yn,pr)=>{bt||(bt=Yn,Yt=new Map,li=this.updateImageMapAndGetImageTaskQueue(Yt,pr,ze.iconDependencies),vi())},void 0,!1,Bn):(Yt=new Map,li=new Map);const _n=Array.from(ze.patternDependencies.keys()).map(Yn=>s.I.parse(Yn));_n.length?de.send("getImages",{images:_n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Yn,pr)=>{bt||(bt=Yn,ii=new Map,pi=this.updateImageMapAndGetImageTaskQueue(ii,pr,ze.patternDependencies),vi())},void 0,!1,Bn):(ii=new Map,pi=new Map)}if(ze.elevationFeatures&&ze.elevationFeatures.length>0){const Bi=[];for(const _n of Object.values(De))if(_n instanceof s.b8){const Yn=_n.getUnevaluatedPortalGraph();Yn&&Bi.push(Yn)}const pn=s.f6.evaluate(Bi);for(const _n of Object.values(De))_n instanceof s.b8&&_n.setEvaluatedPortalGraph(pn)}vi()}rasterizeIfNeeded(B,q,ie,he){Array.from(q.values()).some(de=>de.usvg)?this.rasterize(B,q,ie,he):he()}updateImageMapAndGetImageTaskQueue(B,q,ie){const he=new Map;for(const de of q.keys()){const ye=ie.get(de)||[];for(const ve of ye){const be=ve.toString(),De=q.get(ve.id.toString());De.usvg?he.has(be)||(he.set(be,ve),B.set(be,Object.assign({},De))):B.set(be,De)}}return he}rasterize(B,q,ie,he){this.rasterizeTask=B.send("rasterizeImages",{scope:this.scope,tasks:ie},(de,ye)=>{if(!de)for(const[ve,be]of ye.entries()){const De=Object.assign(q.get(ve),{data:be});q.set(ve,De)}he()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Re(Ne,B,q,ie){const he=new s.aa(B,{brightness:q});for(const de of Ne)de.recalculate(he,ie)}class Ue extends s.E{constructor(B,q,ie,he,de,ye,ve){super(),this.actor=B,this.layerIndex=q,this.availableImages=ie,this.availableModels=he,this.loadVectorData=ye||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(B.scheduler),this.isSpriteLoaded=de,this.scheduler=B.scheduler,this.brightness=ve}loadTile(B,q){const ie=B.uid,he=B&&B.request,de=he&&he.collectResourceTiming,ye=this.loading[ie]=new He(B);ye.abort=this.loadVectorData(B,(ve,be)=>{const De=!this.loading[ie];if(delete this.loading[ie],ye.cancelRasterize(),De||ve||!be)return ye.status="done",De||(this.loaded[ie]=ye),q(ve);const Ge=be.rawData,ze={};be.expires&&(ze.expires=be.expires),be.cacheControl&&(ze.cacheControl=be.cacheControl),ye.vectorTile=be.vectorTile||new s.fc.VectorTile(new s.bq(Ge));const ft=()=>{ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(bt,Lt)=>{if(bt||!Lt)return q(bt);const Yt={};if(de){const ii=W(he);ii.length>0&&(Yt.resourceTiming=JSON.parse(JSON.stringify(ii)))}q(null,s.l({rawTileData:Ge.slice(0)},Lt,ze,Yt))})};this.isSpriteLoaded?ft():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ft,{type:"parseTile",isSymbolTile:B.isSymbolTile,zoom:B.tileZoom}):ft()}),this.loaded=this.loaded||{},this.loaded[ie]=ye})}reloadTile(B,q){const ie=this.loaded,he=B.uid;if(ie&&ie[he]){const de=ie[he];de.scaleFactor=B.scaleFactor,de.showCollisionBoxes=B.showCollisionBoxes,de.projection=B.projection,de.brightness=B.brightness,de.tileTransform=s.aW(B.tileID.canonical,B.projection),de.extraShadowCaster=B.extraShadowCaster,de.lut=B.lut;const ye=(ve,be)=>{const De=de.reloadCallback;De&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,De)),q(ve,be)};de.status==="parsing"?de.reloadCallback=ye:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ye):ye())}else q(null,void 0)}abortTile(B,q){const ie=B.uid,he=this.loading[ie];he&&(he.abort&&he.abort(),delete this.loading[ie]),q()}removeTile(B,q){const ie=this.loaded,he=B.uid;ie&&ie[he]&&delete ie[he],q()}}class et{loadTile(B,q){const{uid:ie,encoding:he,rawImageData:de,padding:ye}=B,ve=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,ye):de;q(null,new s.fd(ie,ve,he,ye<1))}reloadTile(B,q){q(null,null)}abortTile(B,q){q()}removeTile(B,q){q()}getImageData(B,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(B.width,B.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=B.width,this.offscreenCanvas.height=B.height,this.offscreenCanvasContext.drawImage(B,0,0,B.width,B.height);const ie=this.offscreenCanvasContext.getImageData(-q,-q,B.width+2*q,B.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}s.bp.setPbf(s.bq);class vt{constructor(B){this._mrt=new s.bp(B.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=B.uid,this.tileID=B.tileID,this.source=B.source}parse(B,q){const ie=this._mrt;this.status="parsing",this._entireBuffer=B;try{ie.parseHeader(B),this._isHeaderLoaded=!0;const he=[];for(const de in ie.layers){const ye=ie.getLayer(de),ve=ye.getDataRange(ye.getBandList()),be=ie.createDecodingTask(ve),De=B.slice(ve.firstByte,ve.lastByte+1),Ge=s.bp.performDecoding(De,be).then(ze=>be.complete(null,ze)).catch(ze=>be.complete(ze,null));he.push(Ge)}Promise.allSettled(he).then(()=>q(null,ie)).catch(de=>q(de))}catch(he){q(he)}}}class ot{constructor(B){this.actor=B,this.loading={},this.loaded={}}loadTile(B,q){const ie=B.uid,he=B.request,de=this.loading[ie]=new vt(B),{cancel:ye}=s.br(he,(ve,be,De,Ge)=>{const ze=!this.loading[ie];if(delete this.loading[ie],ze||ve||!be)return de.status="done",ze||(this.loaded[ie]=de),q(ve);de.parse(be,(ft,bt)=>{if(ft||!bt)return q(ft);q(null,bt,De,Ge)}),this.loaded[ie]=de});de.abort=ye}reloadTile(B,q){q(null,void 0)}abortTile(B,q){const ie=B.uid,he=this.loading[ie];he&&(he.abort&&he.abort(),delete this.loading[ie]),q()}removeTile(B,q){const ie=B.uid;this.loaded[ie]&&delete this.loaded[ie],q()}decodeRasterArray(B,q){s.bp.performDecoding(B.buffer,B.task).then(ie=>q(null,ie)).catch(ie=>q(ie))}}const Ct=s.fc.VectorTileFeature.prototype.toGeoJSON;class Dt{constructor(B){this._feature=B,this.extent=s.aj,this.type=B.type,this.properties=B.tags,"id"in B&&!isNaN(B.id)&&(this.id=parseInt(B.id,10))}loadGeometry(){if(this._feature.type===1){const B=[];for(const q of this._feature.geometry)B.push([new s.P(q[0],q[1])]);return B}{const B=[];for(const q of this._feature.geometry){const ie=[];for(const he of q)ie.push(new s.P(he[0],he[1]));B.push(ie)}return B}}toGeoJSON(B,q,ie){return Ct.call(this,B,q,ie)}}class Vt{constructor(B){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.aj,this.length=B.length,this._features=B}feature(B){return new Dt(this._features[B])}}const hi=64/4096,Kt=128;class Ei{constructor(){this.features=new Map}clear(){this.features.clear()}load(B=[],q){for(const ie of B){const he=ie.id;if(he==null)continue;let de=this.features.get(he);de&&this.updateCache(de,q),ie.geometry?(de=_i(ie),this.updateCache(de,q),this.features.set(he,de)):this.features.delete(he),this.updateCache(de,q)}}updateCache(B,q){for(const{canonical:ie,uid:he}of Object.values(q)){const{z:de,x:ye,y:ve}=ie;gi(B,Math.pow(2,de),ye,ve)&&delete q[he]}}getTile(B,q,ie){const he=Math.pow(2,B),de=[];for(const ye of this.features.values())gi(ye,he,q,ie)&&de.push(Pi(ye,he,q,ie));return{features:de}}getFeatures(){return[...this.features.values()]}}function gi({minX:Ne,minY:B,maxX:q,maxY:ie},he,de,ye){return Ne<(de+1+hi)/he&&B<(ye+1+hi)/he&&q>(de-hi)/he&&ie>(ye-hi)/he}function _i(Ne){const{id:B,geometry:q,properties:ie}=Ne;if(!q)return;if(q.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:he,coordinates:de}=q,ye={id:B,type:1,geometry:[],tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ve=ye.geometry;if(he==="Point")an(de,ve,ye);else if(he==="MultiPoint")for(const be of de)an(be,ve,ye);else if(he==="LineString")ye.type=2,yi(de,ve,ye);else if(he==="MultiLineString")ye.type=2,Jt(de,ve,ye);else if(he==="Polygon")ye.type=3,Jt(de,ve,ye,!0);else{if(he!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ye.type=3;for(const be of de)Jt(be,ve,ye,!0)}return ye}function an([Ne,B],q,ie){const he=s.ay(Ne);let de=s.aH(B);de=de<0?0:de>1?1:de,q.push(he,de),ie.minX=Math.min(ie.minX,he),ie.minY=Math.min(ie.minY,de),ie.maxX=Math.max(ie.maxX,he),ie.maxY=Math.max(ie.maxY,de)}function yi(Ne,B,q,ie=!1,he=!1){const de=[];for(const ye of Ne)an(ye,de,q);B.push(de),ie&&function(ye,ve){let be=0;for(let De=0,Ge=ye.length,ze=Ge-2;De<Ge;ze=De,De+=2)be+=(ye[De]-ye[ze])*(ye[De+1]+ye[ze+1]);if(be>0===ve)for(let De=0,Ge=ye.length;De<Ge/2;De+=2){const ze=ye[De],ft=ye[De+1];ye[De]=ye[Ge-2-De],ye[De+1]=ye[Ge-1-De],ye[Ge-2-De]=ze,ye[Ge-1-De]=ft}}(de,he)}function Jt(Ne,B,q,ie=!1){for(let he=0;he<Ne.length;he++)yi(Ne[he],B,q,ie,he===0)}function Pi(Ne,B,q,ie){const{id:he,type:de,geometry:ye,tags:ve}=Ne,be=[];if(de===1)(function(De,Ge,ze,ft,bt){for(let Lt=0;Lt<De.length;Lt+=2){const Yt=Math.round(s.aj*(De[Lt+0]*Ge-ze)),ii=Math.round(s.aj*(De[Lt+1]*Ge-ft));bt.push([Yt,ii])}})(ye,B,q,ie,be);else for(const De of ye)Vi(De,B,q,ie,be);return{id:he,type:de,geometry:be,tags:ve}}function Vi(Ne,B,q,ie,he){const ye=s.aj+Kt;let ve;for(let be=0;be<Ne.length-2;be+=2){let De=Math.round(s.aj*(Ne[be+0]*B-q)),Ge=Math.round(s.aj*(Ne[be+1]*B-ie)),ze=Math.round(s.aj*(Ne[be+2]*B-q)),ft=Math.round(s.aj*(Ne[be+3]*B-ie));const bt=ze-De,Lt=ft-Ge;De<-128&&ze<-128||(De<-128?(Ge+=Math.round(Lt*((-128-De)/bt)),De=-128):ze<-128&&(ft=Ge+Math.round(Lt*((-128-De)/bt)),ze=-128),Ge<-128&&ft<-128||(Ge<-128?(De+=Math.round(bt*((-128-Ge)/Lt)),Ge=-128):ft<-128&&(ze=De+Math.round(bt*((-128-Ge)/Lt)),ft=-128),De>=ye&&ze>=ye||(De>=ye?(Ge+=Math.round(Lt*((ye-De)/bt)),De=ye):ze>=ye&&(ft=Ge+Math.round(Lt*((ye-De)/bt)),ze=ye),Ge>=ye&&ft>=ye||(Ge>=ye?(De+=Math.round(bt*((ye-Ge)/Lt)),Ge=ye):ft>=ye&&(ze=De+Math.round(bt*((ye-Ge)/Lt)),ft=ye),ve&&De===ve[ve.length-1][0]&&Ge===ve[ve.length-1][1]||(ve=[[De,Ge]],he.push(ve)),ve.push([ze,ft])))))}}var Ii,Hi,Ci,ti={exports:{}},tn=function(){if(Ci)return ti.exports;Ci=1;var Ne=s.fg(),B=function(){if(Hi)return Ii;Hi=1;var Ge=s.fe(),ze=s.ff().VectorTileFeature;function ft(Lt,Yt){this.options=Yt||{},this.features=Lt,this.length=Lt.length}function bt(Lt,Yt){this.id=typeof Lt.id=="number"?Lt.id:void 0,this.type=Lt.type,this.rawGeometry=Lt.type===1?[Lt.geometry]:Lt.geometry,this.properties=Lt.tags,this.extent=Yt||4096}return Ii=ft,ft.prototype.feature=function(Lt){return new bt(this.features[Lt],this.options.extent)},bt.prototype.loadGeometry=function(){var Lt=this.rawGeometry;this.geometry=[];for(var Yt=0;Yt<Lt.length;Yt++){for(var ii=Lt[Yt],li=[],pi=0;pi<ii.length;pi++)li.push(new Ge(ii[pi][0],ii[pi][1]));this.geometry.push(li)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Lt=this.geometry,Yt=1/0,ii=-1/0,li=1/0,pi=-1/0,Bn=0;Bn<Lt.length;Bn++)for(var vi=Lt[Bn],fn=0;fn<vi.length;fn++){var Bi=vi[fn];Yt=Math.min(Yt,Bi.x),ii=Math.max(ii,Bi.x),li=Math.min(li,Bi.y),pi=Math.max(pi,Bi.y)}return[Yt,li,ii,pi]},bt.prototype.toGeoJSON=ze.prototype.toGeoJSON,Ii}();function q(Ge){var ze=new Ne;return function(ft,bt){for(var Lt in ft.layers)bt.writeMessage(3,ie,ft.layers[Lt])}(Ge,ze),ze.finish()}function ie(Ge,ze){var ft;ze.writeVarintField(15,Ge.version||1),ze.writeStringField(1,Ge.name||""),ze.writeVarintField(5,Ge.extent||4096);var bt={keys:[],values:[],keycache:{},valuecache:{}};for(ft=0;ft<Ge.length;ft++)bt.feature=Ge.feature(ft),ze.writeMessage(2,he,bt);var Lt=bt.keys;for(ft=0;ft<Lt.length;ft++)ze.writeStringField(3,Lt[ft]);var Yt=bt.values;for(ft=0;ft<Yt.length;ft++)ze.writeMessage(4,De,Yt[ft])}function he(Ge,ze){var ft=Ge.feature;ft.id!==void 0&&ze.writeVarintField(1,ft.id),ze.writeMessage(2,de,Ge),ze.writeVarintField(3,ft.type),ze.writeMessage(4,be,ft)}function de(Ge,ze){var ft=Ge.feature,bt=Ge.keys,Lt=Ge.values,Yt=Ge.keycache,ii=Ge.valuecache;for(var li in ft.properties){var pi=ft.properties[li],Bn=Yt[li];if(pi!==null){Bn===void 0&&(bt.push(li),Yt[li]=Bn=bt.length-1),ze.writeVarint(Bn);var vi=typeof pi;vi!=="string"&&vi!=="boolean"&&vi!=="number"&&(pi=JSON.stringify(pi));var fn=vi+":"+pi,Bi=ii[fn];Bi===void 0&&(Lt.push(pi),ii[fn]=Bi=Lt.length-1),ze.writeVarint(Bi)}}}function ye(Ge,ze){return(ze<<3)+(7&Ge)}function ve(Ge){return Ge<<1^Ge>>31}function be(Ge,ze){for(var ft=Ge.loadGeometry(),bt=Ge.type,Lt=0,Yt=0,ii=ft.length,li=0;li<ii;li++){var pi=ft[li],Bn=1;bt===1&&(Bn=pi.length),ze.writeVarint(ye(1,Bn));for(var vi=bt===3?pi.length-1:pi.length,fn=0;fn<vi;fn++){fn===1&&bt!==1&&ze.writeVarint(ye(2,vi-1));var Bi=pi[fn].x-Lt,pn=pi[fn].y-Yt;ze.writeVarint(ve(Bi)),ze.writeVarint(ve(pn)),Lt+=Bi,Yt+=pn}bt===3&&ze.writeVarint(ye(7,1))}}function De(Ge,ze){var ft=typeof Ge;ft==="string"?ze.writeStringField(1,Ge):ft==="boolean"?ze.writeBooleanField(7,Ge):ft==="number"&&(Ge%1!=0?ze.writeDoubleField(3,Ge):Ge<0?ze.writeSVarintField(6,Ge):ze.writeVarintField(5,Ge))}return ti.exports=q,ti.exports.fromVectorTileJs=q,ti.exports.fromGeojsonVt=function(Ge,ze){ze=ze||{};var ft={};for(var bt in Ge)ft[bt]=new B(Ge[bt].features,ze),ft[bt].name=bt,ft[bt].version=ze.version,ft[bt].extent=ze.extent;return q({layers:ft})},ti.exports.GeoJSONWrapper=B,ti.exports}(),rr=s.fh(tn);const Wn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},Qn=Math.fround||(xi=new Float32Array(1),Ne=>(xi[0]=+Ne,xi[0]));var xi;const Ai=3,ji=5,Br=6;class zi{constructor(B){this.options=Object.assign(Object.create(Wn),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:q,minZoom:ie,maxZoom:he}=this.options;q&&console.time("total time");const de=`prepare ${B.length} points`;q&&console.time(de),this.points=B;const ye=[];for(let be=0;be<B.length;be++){const De=B[be];if(!De.geometry)continue;const[Ge,ze]=De.geometry.coordinates,ft=Qn(Zn(Ge)),bt=Qn(Ui(ze));ye.push(ft,bt,1/0,be,-1,1),this.options.reduce&&ye.push(0)}let ve=this.trees[he+1]=this._createTree(ye);q&&console.timeEnd(de);for(let be=he;be>=ie;be--){const De=+Date.now();ve=this.trees[be]=this._createTree(this._cluster(ve,be)),q&&console.log("z%d: %d clusters in %dms",be,ve.numItems,+Date.now()-De)}return q&&console.timeEnd("total time"),this}getClusters(B,q){let ie=((B[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,B[1]));let de=B[2]===180?180:((B[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)ie=-180,de=180;else if(ie>de){const ze=this.getClusters([ie,he,180,ye],q),ft=this.getClusters([-180,he,de,ye],q);return ze.concat(ft)}const ve=this.trees[this._limitZoom(q)],be=ve.range(Zn(ie),Ui(ye),Zn(de),Ui(he)),De=ve.data,Ge=[];for(const ze of be){const ft=this.stride*ze;Ge.push(De[ft+ji]>1?Sr(De,ft,this.clusterProps):this.points[De[ft+Ai]])}return Ge}getChildren(B){const q=this._getOriginId(B),ie=this._getOriginZoom(B),he="No cluster with the specified id.",de=this.trees[ie];if(!de)throw new Error(he);const ye=de.data;if(q*this.stride>=ye.length)throw new Error(he);const ve=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),be=de.within(ye[q*this.stride],ye[q*this.stride+1],ve),De=[];for(const Ge of be){const ze=Ge*this.stride;ye[ze+4]===B&&De.push(ye[ze+ji]>1?Sr(ye,ze,this.clusterProps):this.points[ye[ze+Ai]])}if(De.length===0)throw new Error(he);return De}getLeaves(B,q,ie){const he=[];return this._appendLeaves(he,B,q=q||10,ie=ie||0,0),he}getTile(B,q,ie){const he=this.trees[this._limitZoom(B)],de=Math.pow(2,B),{extent:ye,radius:ve}=this.options,be=ve/ye,De=(ie-be)/de,Ge=(ie+1+be)/de,ze={features:[]};return this._addTileFeatures(he.range((q-be)/de,De,(q+1+be)/de,Ge),he.data,q,ie,de,ze),q===0&&this._addTileFeatures(he.range(1-be/de,De,1,Ge),he.data,de,ie,de,ze),q===de-1&&this._addTileFeatures(he.range(0,De,be/de,Ge),he.data,-1,ie,de,ze),ze.features.length?ze:null}getClusterExpansionZoom(B){let q=this._getOriginZoom(B)-1;for(;q<=this.options.maxZoom;){const ie=this.getChildren(B);if(q++,ie.length!==1)break;B=ie[0].properties.cluster_id}return q}_appendLeaves(B,q,ie,he,de){const ye=this.getChildren(q);for(const ve of ye){const be=ve.properties;if(be&&be.cluster?de+be.point_count<=he?de+=be.point_count:de=this._appendLeaves(B,be.cluster_id,ie,he,de):de<he?de++:B.push(ve),B.length===ie)break}return de}_createTree(B){const q=new s.bW(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<B.length;ie+=this.stride)q.add(B[ie],B[ie+1]);return q.finish(),q.data=B,q}_addTileFeatures(B,q,ie,he,de,ye){for(const ve of B){const be=ve*this.stride,De=q[be+ji]>1;let Ge,ze,ft;if(De)Ge=Rr(q,be,this.clusterProps),ze=q[be],ft=q[be+1];else{const Yt=this.points[q[be+Ai]];Ge=Yt.properties;const[ii,li]=Yt.geometry.coordinates;ze=Zn(ii),ft=Ui(li)}const bt={type:1,geometry:[[Math.round(this.options.extent*(ze*de-ie)),Math.round(this.options.extent*(ft*de-he))]],tags:Ge};let Lt;Lt=De||this.options.generateId?q[be+Ai]:this.points[q[be+Ai]].id,Lt!==void 0&&(bt.id=Lt),ye.features.push(bt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,q){const{radius:ie,extent:he,reduce:de,minPoints:ye}=this.options,ve=ie/(he*Math.pow(2,q)),be=B.data,De=[],Ge=this.stride;for(let ze=0;ze<be.length;ze+=Ge){if(be[ze+2]<=q)continue;be[ze+2]=q;const ft=be[ze],bt=be[ze+1],Lt=B.within(be[ze],be[ze+1],ve),Yt=be[ze+ji];let ii=Yt;for(const li of Lt){const pi=li*Ge;be[pi+2]>q&&(ii+=be[pi+ji])}if(ii>Yt&&ii>=ye){let li,pi=ft*Yt,Bn=bt*Yt,vi=-1;const fn=(ze/Ge<<5)+(q+1)+this.points.length;for(const Bi of Lt){const pn=Bi*Ge;if(be[pn+2]<=q)continue;be[pn+2]=q;const _n=be[pn+ji];pi+=be[pn]*_n,Bn+=be[pn+1]*_n,be[pn+4]=fn,de&&(li||(li=this._map(be,ze,!0),vi=this.clusterProps.length,this.clusterProps.push(li)),de(li,this._map(be,pn)))}be[ze+4]=fn,De.push(pi/ii,Bn/ii,1/0,fn,-1,ii),de&&De.push(vi)}else{for(let li=0;li<Ge;li++)De.push(be[ze+li]);if(ii>1)for(const li of Lt){const pi=li*Ge;if(!(be[pi+2]<=q)){be[pi+2]=q;for(let Bn=0;Bn<Ge;Bn++)De.push(be[pi+Bn])}}}}return De}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,q,ie){if(B[q+ji]>1){const ye=this.clusterProps[B[q+Br]];return ie?Object.assign({},ye):ye}const he=this.points[B[q+Ai]].properties,de=this.options.map(he);return ie&&de===he?Object.assign({},de):de}}function Sr(Ne,B,q){return{type:"Feature",id:Ne[B+Ai],properties:Rr(Ne,B,q),geometry:{type:"Point",coordinates:[(ie=Ne[B],360*(ie-.5)),Un(Ne[B+1])]}};var ie}function Rr(Ne,B,q){const ie=Ne[B+ji],he=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,de=Ne[B+Br],ye=de===-1?{}:Object.assign({},q[de]);return Object.assign(ye,{cluster:!0,cluster_id:Ne[B+Ai],point_count:ie,point_count_abbreviated:he})}function Zn(Ne){return Ne/360+.5}function Ui(Ne){const B=Math.sin(Ne*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function Un(Ne){const B=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function lr(Ne,B,q,ie){let he=ie;const de=B+(q-B>>1);let ye,ve=q-B;const be=Ne[B],De=Ne[B+1],Ge=Ne[q],ze=Ne[q+1];for(let ft=B+3;ft<q;ft+=3){const bt=Kn(Ne[ft],Ne[ft+1],be,De,Ge,ze);if(bt>he)ye=ft,he=bt;else if(bt===he){const Lt=Math.abs(ft-de);Lt<ve&&(ye=ft,ve=Lt)}}he>ie&&(ye-B>3&&lr(Ne,B,ye,ie),Ne[ye+2]=he,q-ye>3&&lr(Ne,ye,q,ie))}function Kn(Ne,B,q,ie,he,de){let ye=he-q,ve=de-ie;if(ye!==0||ve!==0){const be=((Ne-q)*ye+(B-ie)*ve)/(ye*ye+ve*ve);be>1?(q=he,ie=de):be>0&&(q+=ye*be,ie+=ve*be)}return ye=Ne-q,ve=B-ie,ye*ye+ve*ve}function er(Ne,B,q,ie){const he={id:Ne??null,type:B,geometry:q,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(B==="Point"||B==="MultiPoint"||B==="LineString")sr(he,q);else if(B==="Polygon")sr(he,q[0]);else if(B==="MultiLineString")for(const de of q)sr(he,de);else if(B==="MultiPolygon")for(const de of q)sr(he,de[0]);return he}function sr(Ne,B){for(let q=0;q<B.length;q+=3)Ne.minX=Math.min(Ne.minX,B[q]),Ne.minY=Math.min(Ne.minY,B[q+1]),Ne.maxX=Math.max(Ne.maxX,B[q]),Ne.maxY=Math.max(Ne.maxY,B[q+1])}function tr(Ne,B,q,ie){if(!B.geometry)return;const he=B.geometry.coordinates;if(he&&he.length===0)return;const de=B.geometry.type,ye=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2);let ve=[],be=B.id;if(q.promoteId?be=B.properties[q.promoteId]:q.generateId&&(be=ie||0),de==="Point")dr(he,ve);else if(de==="MultiPoint")for(const De of he)dr(De,ve);else if(de==="LineString")Dr(he,ve,ye,!1);else if(de==="MultiLineString"){if(q.lineMetrics){for(const De of he)ve=[],Dr(De,ve,ye,!1),Ne.push(er(be,"LineString",ve,B.properties));return}fr(he,ve,ye,!1)}else if(de==="Polygon")fr(he,ve,ye,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const De of B.geometry.geometries)tr(Ne,{id:be,geometry:De,properties:B.properties},q,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const De of he){const Ge=[];fr(De,Ge,ye,!0),ve.push(Ge)}}Ne.push(er(be,de,ve,B.properties))}function dr(Ne,B){B.push(Nr(Ne[0]),Sn(Ne[1]),0)}function Dr(Ne,B,q,ie){let he,de,ye=0;for(let be=0;be<Ne.length;be++){const De=Nr(Ne[be][0]),Ge=Sn(Ne[be][1]);B.push(De,Ge,0),be>0&&(ye+=ie?(he*Ge-De*de)/2:Math.sqrt(Math.pow(De-he,2)+Math.pow(Ge-de,2))),he=De,de=Ge}const ve=B.length-3;B[2]=1,lr(B,0,ve,q),B[ve+2]=1,B.size=Math.abs(ye),B.start=0,B.end=B.size}function fr(Ne,B,q,ie){for(let he=0;he<Ne.length;he++){const de=[];Dr(Ne[he],de,q,ie),B.push(de)}}function Nr(Ne){return Ne/360+.5}function Sn(Ne){const B=Math.sin(Ne*Math.PI/180),q=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return q<0?0:q>1?1:q}function vr(Ne,B,q,ie,he,de,ye,ve){if(ie/=B,de>=(q/=B)&&ye<ie)return Ne;if(ye<q||de>=ie)return null;const be=[];for(const De of Ne){const Ge=De.geometry;let ze=De.type;const ft=he===0?De.minX:De.minY,bt=he===0?De.maxX:De.maxY;if(ft>=q&&bt<ie){be.push(De);continue}if(bt<q||ft>=ie)continue;let Lt=[];if(ze==="Point"||ze==="MultiPoint")js(Ge,Lt,q,ie,he);else if(ze==="LineString")ws(Ge,Lt,q,ie,he,!1,ve.lineMetrics);else if(ze==="MultiLineString")Vr(Ge,Lt,q,ie,he,!1);else if(ze==="Polygon")Vr(Ge,Lt,q,ie,he,!0);else if(ze==="MultiPolygon")for(const Yt of Ge){const ii=[];Vr(Yt,ii,q,ie,he,!0),ii.length&&Lt.push(ii)}if(Lt.length){if(ve.lineMetrics&&ze==="LineString"){for(const Yt of Lt)be.push(er(De.id,ze,Yt,De.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(Lt.length===1?(ze="LineString",Lt=Lt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=Lt.length===3?"Point":"MultiPoint"),be.push(er(De.id,ze,Lt,De.tags))}}return be.length?be:null}function js(Ne,B,q,ie,he){for(let de=0;de<Ne.length;de+=3){const ye=Ne[de+he];ye>=q&&ye<=ie&&jr(B,Ne[de],Ne[de+1],Ne[de+2])}}function ws(Ne,B,q,ie,he,de,ye){let ve=Xr(Ne);const be=he===0?Qi:rs;let De,Ge,ze=Ne.start;for(let ii=0;ii<Ne.length-3;ii+=3){const li=Ne[ii],pi=Ne[ii+1],Bn=Ne[ii+2],vi=Ne[ii+3],fn=Ne[ii+4],Bi=he===0?li:pi,pn=he===0?vi:fn;let _n=!1;ye&&(De=Math.sqrt(Math.pow(li-vi,2)+Math.pow(pi-fn,2))),Bi<q?pn>q&&(Ge=be(ve,li,pi,vi,fn,q),ye&&(ve.start=ze+De*Ge)):Bi>ie?pn<ie&&(Ge=be(ve,li,pi,vi,fn,ie),ye&&(ve.start=ze+De*Ge)):jr(ve,li,pi,Bn),pn<q&&Bi>=q&&(Ge=be(ve,li,pi,vi,fn,q),_n=!0),pn>ie&&Bi<=ie&&(Ge=be(ve,li,pi,vi,fn,ie),_n=!0),!de&&_n&&(ye&&(ve.end=ze+De*Ge),B.push(ve),ve=Xr(Ne)),ye&&(ze+=De)}let ft=Ne.length-3;const bt=Ne[ft],Lt=Ne[ft+1],Yt=he===0?bt:Lt;Yt>=q&&Yt<=ie&&jr(ve,bt,Lt,Ne[ft+2]),ft=ve.length-3,de&&ft>=3&&(ve[ft]!==ve[0]||ve[ft+1]!==ve[1])&&jr(ve,ve[0],ve[1],ve[2]),ve.length&&B.push(ve)}function Xr(Ne){const B=[];return B.size=Ne.size,B.start=Ne.start,B.end=Ne.end,B}function Vr(Ne,B,q,ie,he,de){for(const ye of Ne)ws(ye,B,q,ie,he,de,!1)}function jr(Ne,B,q,ie){Ne.push(B,q,ie)}function Qi(Ne,B,q,ie,he,de){const ye=(de-B)/(ie-B);return jr(Ne,de,q+(he-q)*ye,1),ye}function rs(Ne,B,q,ie,he,de){const ye=(de-q)/(he-q);return jr(Ne,B+(ie-B)*ye,de,1),ye}function cs(Ne,B){const q=[];for(let ie=0;ie<Ne.length;ie++){const he=Ne[ie],de=he.type;let ye;if(de==="Point"||de==="MultiPoint"||de==="LineString")ye=us(he.geometry,B);else if(de==="MultiLineString"||de==="Polygon"){ye=[];for(const ve of he.geometry)ye.push(us(ve,B))}else if(de==="MultiPolygon"){ye=[];for(const ve of he.geometry){const be=[];for(const De of ve)be.push(us(De,B));ye.push(be)}}q.push(er(he.id,de,ye,he.tags))}return q}function us(Ne,B){const q=[];q.size=Ne.size,Ne.start!==void 0&&(q.start=Ne.start,q.end=Ne.end);for(let ie=0;ie<Ne.length;ie+=3)q.push(Ne[ie]+B,Ne[ie+1],Ne[ie+2]);return q}function fi(Ne,B){if(Ne.transformed)return Ne;const q=1<<Ne.z,ie=Ne.x,he=Ne.y;for(const de of Ne.features){const ye=de.geometry,ve=de.type;if(de.geometry=[],ve===1)for(let be=0;be<ye.length;be+=2)de.geometry.push(Mn(ye[be],ye[be+1],B,q,ie,he));else for(let be=0;be<ye.length;be++){const De=[];for(let Ge=0;Ge<ye[be].length;Ge+=2)De.push(Mn(ye[be][Ge],ye[be][Ge+1],B,q,ie,he));de.geometry.push(De)}}return Ne.transformed=!0,Ne}function Mn(Ne,B,q,ie,he,de){return[Math.round(q*(Ne*ie-he)),Math.round(q*(B*ie-de))]}function cr(Ne,B,q,ie,he){const de=B===he.maxZoom?0:he.tolerance/((1<<B)*he.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:q,y:ie,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ve of Ne)Xi(ye,ve,de,he);return ye}function Xi(Ne,B,q,ie){const he=B.geometry,de=B.type,ye=[];if(Ne.minX=Math.min(Ne.minX,B.minX),Ne.minY=Math.min(Ne.minY,B.minY),Ne.maxX=Math.max(Ne.maxX,B.maxX),Ne.maxY=Math.max(Ne.maxY,B.maxY),de==="Point"||de==="MultiPoint")for(let ve=0;ve<he.length;ve+=3)ye.push(he[ve],he[ve+1]),Ne.numPoints++,Ne.numSimplified++;else if(de==="LineString")Kr(ye,he,Ne,q,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let ve=0;ve<he.length;ve++)Kr(ye,he[ve],Ne,q,de==="Polygon",ve===0);else if(de==="MultiPolygon")for(let ve=0;ve<he.length;ve++){const be=he[ve];for(let De=0;De<be.length;De++)Kr(ye,be[De],Ne,q,!0,De===0)}if(ye.length){let ve=B.tags||null;if(de==="LineString"&&ie.lineMetrics){ve={};for(const De in B.tags)ve[De]=B.tags[De];ve.mapbox_clip_start=he.start/he.size,ve.mapbox_clip_end=he.end/he.size}const be={geometry:ye,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:ve};B.id!==null&&(be.id=B.id),Ne.features.push(be)}}function Kr(Ne,B,q,ie,he,de){const ye=ie*ie;if(ie>0&&B.size<(he?ye:ie))return void(q.numPoints+=B.length/3);const ve=[];for(let be=0;be<B.length;be+=3)(ie===0||B[be+2]>ye)&&(q.numSimplified++,ve.push(B[be],B[be+1])),q.numPoints++;he&&function(be,De){let Ge=0;for(let ze=0,ft=be.length,bt=ft-2;ze<ft;bt=ze,ze+=2)Ge+=(be[ze]-be[bt])*(be[ze+1]+be[bt+1]);if(Ge>0===De)for(let ze=0,ft=be.length;ze<ft/2;ze+=2){const bt=be[ze],Lt=be[ze+1];be[ze]=be[ft-2-ze],be[ze+1]=be[ft-1-ze],be[ft-2-ze]=bt,be[ft-1-ze]=Lt}}(ve,de),Ne.push(ve)}const ta={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ms{constructor(B,q){const ie=(q=this.options=function(de,ye){for(const ve in ye)de[ve]=ye[ve];return de}(Object.create(ta),q)).debug;if(ie&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(de,ye){const ve=[];if(de.type==="FeatureCollection")for(let be=0;be<de.features.length;be++)tr(ve,de.features[be],ye,be);else tr(ve,de.type==="Feature"?de:{geometry:de},ye);return ve}(B,q);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(de,ye){const ve=ye.buffer/ye.extent;let be=de;const De=vr(de,1,-1-ve,ve,0,-1,2,ye),Ge=vr(de,1,1-ve,2+ve,0,-1,2,ye);return(De||Ge)&&(be=vr(de,1,-ve,1+ve,0,-1,2,ye)||[],De&&(be=cs(De,1).concat(be)),Ge&&(be=be.concat(cs(Ge,-1)))),be}(he,q),he.length&&this.splitTile(he,0,0,0),ie&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(B,q,ie,he,de,ye,ve){const be=[B,q,ie,he],De=this.options,Ge=De.debug;for(;be.length;){he=be.pop(),ie=be.pop(),q=be.pop(),B=be.pop();const ze=1<<q,ft=Fo(q,ie,he);let bt=this.tiles[ft];if(!bt&&(Ge>1&&console.time("creation"),bt=this.tiles[ft]=cr(B,q,ie,he,De),this.tileCoords.push({z:q,x:ie,y:he}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,ie,he,bt.numFeatures,bt.numPoints,bt.numSimplified),console.timeEnd("creation"));const _n=`z${q}`;this.stats[_n]=(this.stats[_n]||0)+1,this.total++}if(bt.source=B,de==null){if(q===De.indexMaxZoom||bt.numPoints<=De.indexMaxPoints)continue}else{if(q===De.maxZoom||q===de)continue;if(de!=null){const _n=de-q;if(ie!==ye>>_n||he!==ve>>_n)continue}}if(bt.source=null,B.length===0)continue;Ge>1&&console.time("clipping");const Lt=.5*De.buffer/De.extent,Yt=.5-Lt,ii=.5+Lt,li=1+Lt;let pi=null,Bn=null,vi=null,fn=null,Bi=vr(B,ze,ie-Lt,ie+ii,0,bt.minX,bt.maxX,De),pn=vr(B,ze,ie+Yt,ie+li,0,bt.minX,bt.maxX,De);B=null,Bi&&(pi=vr(Bi,ze,he-Lt,he+ii,1,bt.minY,bt.maxY,De),Bn=vr(Bi,ze,he+Yt,he+li,1,bt.minY,bt.maxY,De),Bi=null),pn&&(vi=vr(pn,ze,he-Lt,he+ii,1,bt.minY,bt.maxY,De),fn=vr(pn,ze,he+Yt,he+li,1,bt.minY,bt.maxY,De),pn=null),Ge>1&&console.timeEnd("clipping"),be.push(pi||[],q+1,2*ie,2*he),be.push(Bn||[],q+1,2*ie,2*he+1),be.push(vi||[],q+1,2*ie+1,2*he),be.push(fn||[],q+1,2*ie+1,2*he+1)}}getTile(B,q,ie){B=+B,q=+q,ie=+ie;const he=this.options,{extent:de,debug:ye}=he;if(B<0||B>24)return null;const ve=1<<B,be=Fo(B,q=q+ve&ve-1,ie);if(this.tiles[be])return fi(this.tiles[be],de);ye>1&&console.log("drilling down to z%d-%d-%d",B,q,ie);let De,Ge=B,ze=q,ft=ie;for(;!De&&Ge>0;)Ge--,ze>>=1,ft>>=1,De=this.tiles[Fo(Ge,ze,ft)];return De&&De.source?(ye>1&&(console.log("found parent tile z%d-%d-%d",Ge,ze,ft),console.time("drilling down")),this.splitTile(De.source,Ge,ze,ft,B,q,ie),ye>1&&console.timeEnd("drilling down"),this.tiles[be]?fi(this.tiles[be],de):null):null}}function Fo(Ne,B,q){return 32*((1<<Ne)*q+B)+Ne}function dl(Ne,B){const q=Ne.tileID.canonical;if(!this._geoJSONIndex)return void B(null,null);const ie=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ie)return void B(null,null);const he=new Vt(ie.features);let de=rr(he);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),B(null,{vectorTile:he,rawData:de.buffer})}class Da extends Ue{constructor(B,q,ie,he,de,ye,ve){super(B,q,ie,he,de,dl,ve),ye&&(this.loadGeoJSON=ye),this._dynamicIndex=new Ei}loadData(B,q){const ie=B&&B.request,he=ie&&ie.collectResourceTiming;this.loadGeoJSON(B,(de,ye)=>{if(de||!ye)return q(de);if(typeof ye!="object")return q(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{try{if(B.filter){const be=s.X(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(be.result==="error")throw new Error(be.value.map(De=>`${De.key}: ${De.message}`).join(", "));ye.features=ye.features.filter(De=>be.value.evaluate({zoom:0},De))}B.dynamic?(ye.type==="Feature"&&(ye={type:"FeatureCollection",features:[ye]}),B.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ye.features,this.loaded),B.cluster&&(ye.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=B.cluster?new zi(function({superclusterOptions:be,clusterProperties:De}){if(!De||!be)return be;const Ge={},ze={},ft={accumulated:null,zoom:0},bt={properties:null},Lt=Object.keys(De);for(const Yt of Lt){const[ii,li]=De[Yt],pi=s.X(li),Bn=s.X(typeof ii=="string"?[ii,["accumulated"],["get",Yt]]:ii);Ge[Yt]=pi.value,ze[Yt]=Bn.value}return be.map=Yt=>{bt.properties=Yt;const ii={};for(const li of Lt)ii[li]=Ge[li].evaluate(ft,bt);return ii},be.reduce=(Yt,ii)=>{bt.properties=ii;for(const li of Lt)ft.accumulated=Yt[li],Yt[li]=ze[li].evaluate(ft,bt)},be}(B)).load(ye.features):B.dynamic?this._dynamicIndex:function(be,De){return new Ms(be,De)}(ye,B.geojsonVtOptions)}catch(be){return q(be)}const ve={};if(he){const be=W(ie);be&&(ve.resourceTiming={},ve.resourceTiming[B.source]=JSON.parse(JSON.stringify(be)))}q(null,ve)}})}reloadTile(B,q){const ie=this.loaded;return ie&&ie[B.uid]?B.partial?q(null,void 0):super.reloadTile(B,q):this.loadTile(B,q)}loadGeoJSON(B,q){if(B.request)s.n(B.request,q);else{if(typeof B.data!="string")return q(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(B.data))}catch{return q(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(B,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(ie){q(ie)}}getClusterChildren(B,q){try{q(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(ie){q(ie)}}getClusterLeaves(B,q){try{q(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(ie){q(ie)}}}class dt{constructor(B,q){this.tileID=new s.aM(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.tileZoom=B.tileZoom,this.uid=B.uid,this.zoom=B.zoom,this.canonical=B.tileID.canonical,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=B.projection,this.brightness=q}parse(B,q,ie,he){this.status="parsing";const de=new s.aM(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),ye=[],ve=q.familiesBySource[ie.source],be=new s.f0(de,ie.promoteId);be.bucketLayerIDs=[],be.is3DTile=!0,s.fi(B).then(De=>{if(!De)return he(new Error("Could not parse tile"));const Ge=s.fj(De,1/s.cT(ie.tileID.canonical)),ze=De.json.extensionsUsed&&De.json.extensionsUsed.includes("MAPBOX_mesh_features")||De.json.asset.extras&&De.json.asset.extras.MAPBOX_mesh_features,ft=De.json.extensionsUsed&&De.json.extensionsUsed.includes("EXT_meshopt_compression"),bt=new s.aa(this.zoom,{brightness:this.brightness});for(const Lt in ve)for(const Yt of ve[Lt]){const ii=Yt[0];be.bucketLayerIDs.push(Yt.map(pi=>s.C(pi.id,pi.scope))),ii.recalculate(bt,[]);const li=new s.fk(Yt,Ge,de,ze,ft,this.brightness,be);ze||(li.needsUpload=!0),ye.push(li),li.evaluate(ii)}this.status="done",he(null,{buckets:ye,featureIndex:be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(De=>he(new Error(De.message)))}}class ao{constructor(B,q,ie,he,de,ye,ve){this.actor=B,this.layerIndex=q,this.availableImages=ie,this.availableModels=he,this.brightness=ve,this.loading={},this.loaded={}}loadTile(B,q){const ie=B.uid,he=this.loading[ie]=new dt(B,this.brightness);s.br(B.request,(de,ye)=>{const ve=!this.loading[ie];return delete this.loading[ie],ve||de?(he.status="done",ve||(this.loaded[ie]=he),q(de)):ye&&ye.byteLength!==0?void he.parse(ye,this.layerIndex,B,(be,De)=>{he.status="done",this.loaded=this.loaded||{},this.loaded[ie]=he,be||!De?q(be):q(null,De)}):(he.status="done",this.loaded[ie]=he,q())})}reloadTile(B,q){const ie=this.loaded,he=B.uid;if(ie&&ie[he]){const de=ie[he];de.projection=B.projection,de.brightness=B.brightness;const ye=(ve,be)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(B,q)),q(ve,be)};de.status==="parsing"?de.reloadCallback=ye:de.status==="done"&&this.loadTile(B,q)}}abortTile(B,q){const ie=B.uid;this.loading[ie]&&delete this.loading[ie],q()}removeTile(B,q){const ie=this.loaded,he=B.uid;ie&&ie[he]&&delete ie[he],q()}}class fl{constructor(B){this.self=B,this.actor=new s.fm(B,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.ce({name:"mercator"}),this.workerSourceTypes={vector:Ue,geojson:Da,"raster-dem":et,"raster-array":ot,"batched-model":ao},this.workerSources={},this.self.registerWorkerSource=(q,ie)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=ie},this.self.registerRTLTextPlugin=q=>{if(s.fn.isParsed())throw new Error("RTL text plugin already registered.");s.fn.applyArabicShaping=q.applyArabicShaping,s.fn.processBidirectionalText=q.processBidirectionalText,s.fn.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(B,q,ie){delete this.layerIndexes[B],delete this.availableImages[B],delete this.availableModels[B],delete this.workerSources[B],ie()}checkIfReady(B,q,ie){ie()}setReferrer(B,q){this.referrer=q}spriteLoaded(B,q){this.isSpriteLoaded[B]||(this.isSpriteLoaded[B]={});const{scope:ie,isLoaded:he}=q;if(this.isSpriteLoaded[B][ie]=he,this.workerSources[B]&&this.workerSources[B][ie])for(const de in this.workerSources[B][ie]){const ye=this.workerSources[B][ie][de];for(const ve in ye){const be=ye[ve];be instanceof Ue&&(be.isSpriteLoaded=he,be.fire(new s.A("isSpriteLoaded")))}}}setImages(B,q,ie){this.availableImages[B]||(this.availableImages[B]={});const{scope:he,images:de}=q;if(this.availableImages[B][he]=de,this.workerSources[B]&&this.workerSources[B][he]){for(const ye in this.workerSources[B][he]){const ve=this.workerSources[B][he][ye];for(const be in ve)ve[be].availableImages=de}ie()}else ie()}setModels(B,{scope:q,models:ie},he){if(this.availableModels[B]||(this.availableModels[B]={}),this.availableModels[B][q]=ie,this.workerSources[B]&&this.workerSources[B][q]){for(const de in this.workerSources[B][q]){const ye=this.workerSources[B][q][de];for(const ve in ye)ye[ve].availableModels=ie}he()}else he()}setProjection(B,q){this.projections[B]=s.ce(q)}setBrightness(B,q,ie){this.brightness=q,ie()}setLayers(B,q,ie){this.getLayerIndex(B,q.scope).replace(q.layers,q.options),ie()}updateLayers(B,q,ie){this.getLayerIndex(B,q.scope).update(q.layers,q.removedIds,q.options),ie()}loadTile(B,q,ie){q.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,q.type,q.source,q.scope).loadTile(q,ie)}decodeRasterArray(B,q,ie){this.getWorkerSource(B,q.type,q.source,q.scope).decodeRasterArray(q,ie)}reloadTile(B,q,ie){q.projection=this.projections[B]||this.defaultProjection,this.getWorkerSource(B,q.type,q.source,q.scope).reloadTile(q,ie)}abortTile(B,q,ie){this.getWorkerSource(B,q.type,q.source,q.scope).abortTile(q,ie)}removeTile(B,q,ie){this.getWorkerSource(B,q.type,q.source,q.scope).removeTile(q,ie)}removeSource(B,q,ie){if(!(this.workerSources[B]&&this.workerSources[B][q.scope]&&this.workerSources[B][q.scope][q.type]&&this.workerSources[B][q.scope][q.type][q.source]))return;const he=this.workerSources[B][q.scope][q.type][q.source];delete this.workerSources[B][q.scope][q.type][q.source],he.removeSource!==void 0?he.removeSource(q,ie):ie()}loadWorkerSource(B,q,ie){try{this.self.importScripts(q.url),ie()}catch(he){ie(he.toString())}}syncRTLPluginState(B,q,ie){try{s.fn.setState(q);const he=s.fn.getPluginURL();if(s.fn.isLoaded()&&!s.fn.isParsed()&&he!=null){this.self.importScripts(he);const de=s.fn.isParsed();ie(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),de)}}catch(he){ie(he.toString())}}setDracoUrl(B,q){this.dracoUrl=q}getAvailableImages(B,q){this.availableImages[B]||(this.availableImages[B]={});let ie=this.availableImages[B][q];return ie||(ie=[]),ie}getAvailableModels(B,q){this.availableModels[B]||(this.availableModels[B]={});let ie=this.availableModels[B][q];return ie||(ie={}),ie}getLayerIndex(B,q){this.layerIndexes[B]||(this.layerIndexes[B]={});let ie=this.layerIndexes[B][q];return ie||(ie=this.layerIndexes[B][q]=new fe,ie.scope=q),ie}getWorkerSource(B,q,ie,he){const de=this.workerSources;return de[B]||(de[B]={}),de[B][he]||(de[B][he]={}),de[B][he][q]||(de[B][he][q]={}),this.isSpriteLoaded[B]||(this.isSpriteLoaded[B]={}),de[B][he][q][ie]||(de[B][he][q][ie]=new this.workerSourceTypes[q]({send:(ye,ve,be,De,Ge,ze)=>this.actor.send(ye,ve,be,B,Ge,ze),scheduler:this.actor.scheduler},this.getLayerIndex(B,he),this.getAvailableImages(B,he),this.getAvailableModels(B,he),this.isSpriteLoaded[B][he],void 0,this.brightness)),de[B][he][q][ie]}rasterizeImagesWorker(B,q,ie){const he=new Map;for(const[de,{image:ye,imageVariant:ve}]of q.tasks.entries()){const be=this.imageRasterizer.rasterize(ve,ye,q.scope,B);he.set(de,be)}ie(void 0,he)}removeRasterizedImages(B,q,ie){this.imageRasterizer.removeImagesFromCacheByIds(q.imageIds,q.scope,B),ie()}enforceCacheSizeLimit(B,q){s.fo(q)}getWorkerPerformanceMetrics(B,q,ie){ie(void 0,void 0)}}return s.fl(self)&&(self.worker=new fl(self)),fl}),O(["./shared"],function(s){var W="3.12.0";const X={create:"create",load:"load",fullLoad:"fullLoad"},Y={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function fe(c){const t=c.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var Ie,je={},He=function(){if(Ie)return je;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{y=new Worker(T),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(T),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===m.width}()?(r[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(r[p]=function(m){var y,v=function(T){var A=document.createElement("canvas"),C=Object.create(c.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=T,A.getContext("webgl2",C)}(m);if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),v.getShaderParameter(y,v.COMPILE_STATUS)===!0)}(p)),r[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Ie=1,je.supported=c,je.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},je}();function Re(c,t,r){const u=document.createElement(c);return t!=null&&(u.className=t),r&&r.appendChild(u),u}function Ue(c,t,r){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return r&&r.appendChild(u),u}const et=typeof document<"u"?document.documentElement&&document.documentElement.style:null,vt=et&&et.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ot;function Ct(){et&&vt&&(ot=et[vt],et[vt]="none")}function Dt(){et&&vt&&(et[vt]=ot)}function Vt(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Vt,!0)}function hi(){window.addEventListener("click",Vt,!0),window.setTimeout(()=>{window.removeEventListener("click",Vt,!0)},0)}function Kt(c,t){const r=c.getBoundingClientRect();return _i(c,r,t)}function Ei(c,t){const r=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(_i(c,r,t[p]));return u}function gi(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function _i(c,t,r){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new s.P((r.clientX-t.left)*u,(r.clientY-t.top)*u)}const an="01",yi="NO_ACCESS_TOKEN";class Jt{constructor(t,r,u){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",an,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!s.f(t))return t;const u=Vi(t);return u.params.push(`sdk=js-${W}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!s.f(t))return t;const u=Vi(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeModelURL(t,r){if(!s.f(t))return t;const u=Vi(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(t,r,u,p){if(!s.f(t))return t;const m=Vi(t);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),u&&m.params.push(`language=${u}`),p&&m.params.push(`worldview=${p}`),this._makeAPIURL(m,this._customAccessToken||r)}normalizeIconsetURL(t,r){const u=Vi(t);return s.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||r)):Ii(u)}normalizeSpriteURL(t,r,u,p){const m=Vi(t);return s.f(t)?(m.path=`/styles/v1${m.path}/sprite${r}${u}`,this._makeAPIURL(m,this._customAccessToken||p)):(m.path+=`${r}${u}`,Ii(m))}normalizeTileURL(t,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.f(t))return t;const p=Vi(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&p.authority!=="raster"&&u===512?"@2x":""}${s.m.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${s.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${s.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${s.e.TILE_URL_VERSION}${p.path}`);const m=this._customAccessToken||function(y){for(const v of y){const T=v.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(p.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,m)}canonicalizeTileURL(t,r){const u=Vi(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let m=u.params;return r&&(m=m.filter(y=>!y.match(/^access_token=/))),m.length&&(p+=`?${m.join("&")}`),p}canonicalizeTileset(t,r){const u=!!r&&s.f(r),p=[];for(const m of t.tiles||[])s.h(m)?p.push(this.canonicalizeTileURL(m,u)):p.push(m);return p}_makeAPIURL(t,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=Vi(s.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return Ii(t);if(r=r||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(m=>m.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),Ii(t)}}const Pi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Vi(c){const t=c.match(Pi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ii(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const Hi="mapbox.eventData";function Ci(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.j(t[1]))}catch{return null}}class ti{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=Ci(s.e.ACCESS_TOKEN);let u="";return u=r&&r.u?s.k(r.u):s.e.ACCESS_TOKEN||"",t?`${Hi}.${t}:${u}`:`${Hi}:${u}`}fetchEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const m=localStorage.getItem(u);m&&(this.anonId=m)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!s.e.EVENTS_URL)return;const m=Vi(s.e.EVENTS_URL);m.params.push(`access_token=${p||s.e.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(t).toISOString()},v=r?s.l(y,r):y,T={url:Ii(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=s.p(T,A=>{this.pendingRequest=null,u(A),this.saveEventData(),this.processRequests(p)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const tn=new class extends ti{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(r=>s.f(r)||s.h(r))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ci(s.e.ACCESS_TOKEN),r=t?t.u:s.e.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(p),v=(p-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||m.getDate()!==y.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:an,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},c):this.processRequests()}},rr=tn.postTurnstileEvent.bind(tn),Wn=new class extends ti{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,u){this.skuToken=t,this.errorCb=u,s.e.EVENTS_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(yi)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:W,skuId:an,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},Qn=Wn.postMapLoadEvent.bind(Wn),xi=new class extends ti{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=s.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:u,importedStyles:p}=t;if(!s.e.EVENTS_URL||!c&&!s.e.ACCESS_TOKEN)return;const m=this.getMapInstanceId(r),y={mapInstanceId:m,eventId:this.getEventId(m),style:u};p.length&&(y.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:y},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},c)}},Ai=xi.postStyleLoadEvent.bind(xi),ji=new class extends ti{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){s.e.EVENTS_URL&&(c||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=function(p){const m=performance.getEntriesByType("resource"),y=performance.getEntriesByType("mark"),v=function(L){const j={};if(L){for(const V in L)if(V!=="other")for(const G of L[V]){const U=`${V}ResolveRangeMin`,J=`${V}ResolveRangeMax`,ne=`${V}RequestCount`,oe=`${V}RequestCachedCount`;j[U]=Math.min(j[U]||1/0,G.startTime),j[J]=Math.max(j[J]||-1/0,G.responseEnd);const ue=le=>{j[le]===void 0&&(j[le]=0),++j[le]};G.transferSize!==void 0&&G.transferSize===0&&ue(oe),ue(ne)}}return j}(function(L,j){const V={};if(L)for(const G of L){const U=j(G);V[U]===void 0&&(V[U]=[]),V[U].push(G)}return V}(m,fe)),T=window.devicePixelRatio,A=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=A?A.effectiveType:void 0,R={counters:[],metadata:[],attributes:[]},P=(L,j,V)=>{V!=null&&L.push({name:j,value:V.toString()})};for(const L in v)P(R.counters,L,v[L]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(P(R.counters,"interactionRangeMin",p.interactionRange[0]),P(R.counters,"interactionRangeMax",p.interactionRange[1])),y)for(const L of Object.keys(X)){const j=X[L],V=y.find(G=>G.name===j);V&&P(R.counters,j,V.startTime)}return P(R.counters,"visibilityHidden",p.visibilityHidden),P(R.attributes,"style",function(L){if(L)for(const j of L){const V=j.name.split("?")[0];if(s.i(V)){const G=V.split("/").slice(-2);if(G.length===2)return`mapbox://styles/${G[0]}/${G[1]}`}}}(m)),P(R.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),P(R.attributes,"fogEnabled",p.fogEnabled?"true":"false"),P(R.attributes,"projection",p.projection),P(R.attributes,"zoom",p.zoom),P(R.metadata,"devicePixelRatio",T),P(R.metadata,"connectionEffectiveType",C),P(R.metadata,"navigatorUserAgent",navigator.userAgent),P(R.metadata,"screenWidth",window.screen.width),P(R.metadata,"screenHeight",window.screen.height),P(R.metadata,"windowWidth",window.innerWidth),P(R.metadata,"windowHeight",window.innerHeight),P(R.metadata,"mapWidth",p.width/T),P(R.metadata,"mapHeight",p.height/T),P(R.metadata,"webglRenderer",p.renderer),P(R.metadata,"webglVendor",p.vendor),P(R.metadata,"sdkVersion",W),P(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},Br=ji.postPerformanceEvent.bind(ji),zi=new class extends ti{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,u){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const p=Vi(s.e.API_URL+s.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||s.e.ACCESS_TOKEN||""}`);const m={url:Ii(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(m,y=>{this.pendingRequest=null,r(y),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,r,u){this.skuToken=t,this.errorCb=u,s.e.SESSION_PATH&&s.e.API_URL&&(r||s.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(yi)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},Sr=zi.getSessionAPI.bind(zi),Rr=new Set;function Zn(c,t){t?Rr.add(c):Rr.delete(c)}class Ui{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Un(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class lr extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const u of r.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,r,p);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,u){this._validate(t,u)&&this.images.get(r).set(t.toString(),u)}_validate(t,r){let u=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(r.content,r)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,r){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||r<p[1])return!1;u=p[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,u){const p=this.images.get(r).get(t.toString());u.version=p.version+1,this.images.get(r).set(t.toString(),u),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const u=this.images.get(r),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(r=>s.I.from(r))}getImages(t,r,u){const p=[],m=[],y=this.imageProviders.get(r);for(const C of t){if(!C.iconsetId){p.push(C);continue}const R=y.get(C.iconsetId);R&&(this.getImage(C,r)?m.push(C):R.addPendingRequest(C))}if(p.length===0)return void this._notify(m,r,u);let v=!0;const T=!!this.loaded.get(r),A=this.images.get(r);if(!T)for(const C of p)A.has(C.toString())||(v=!1);T||v?this._notify(p,r,u):this.requestors.push({ids:p,scope:r,callback:u})}rasterizeImages(t,r){const u=new Map,{tasks:p,scope:m}=t;for(const[y,v]of p.entries()){const T=this.getImage(v.id,m);T&&u.set(y,{image:T,imageVariant:v})}this._rasterizeImages(m,u,r)}_rasterizeImages(t,r,u){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},u);else{const p=new Map;for(const[m,{image:y,imageVariant:v}]of r.entries())p.set(m,this.imageRasterizer.rasterize(v,y,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,u){const p=this.images.get(r),m=new Map;for(const y of t){if(!p.get(y.toString())){if(y.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:y.name}))}const v=p.get(y.toString());if(!v){s.w(`Image "${y.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const T={data:v.usvg?null:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,usvg:v.usvg,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)};v.usvg&&Object.assign(T,{width:v.icon.usvg_tree.width,height:v.icon.usvg_tree.height}),m.set(s.I.toString(y),T)}u(null,m)}getPixelSize(t){const{width:r,height:u}=this.atlasImage.get(t);return{width:r,height:u}}getPattern(t,r,u){const p=t.toString(),m=this.patterns.get(r),y=m.get(p),v=this.getImage(t,r);if(!v)return null;if(y){if(y.position.version===v.version)return y.position;y.position.version=v.version}else{if(v.usvg&&!v.data){const T=this.getPatternInFlightId(p,r);if(this.patternsInFlight.has(T))return null;this.patternsInFlight.add(T);const A=new s.B(t).scaleSelf(s.q.devicePixelRatio),C=new Map([[A.toString(),{image:v,imageVariant:A}]]);return this._rasterizeImages(r,C,(R,P)=>this.storePatternImage(A,r,v,u,P)),null}this.storePattern(t,r,v)}return this._updatePatternAtlas(r,u),m.get(p).position}getPatternInFlightId(t,r){return s.C(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,u,p,m){const y=t.toString(),v=m?m.get(y):void 0;v&&(u.data=v,this.storePattern(t.id,r,u),this._updatePatternAtlas(r,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,u){const p={w:u.data.width+2*s.F,h:u.data.height+2*s.F,x:0,y:0},m=new s.G(p,u,s.F);this.patterns.get(r).set(t.toString(),{bin:p,position:m})}bind(t,r){const u=t.gl;let p=this.atlasTexture.get(r);p?this.dirty&&(p.update(this.atlasImage.get(r)),this.dirty=!1):(p=new s.T(t,this.atlasImage.get(r),u.RGBA8),this.atlasTexture.set(r,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const u=this.patterns.get(t),p=Array.from(u.values()).map(({bin:A})=>A),{w:m,h:y}=s.H(p),v=this.atlasImage.get(t);v.resize({width:m||1,height:y||1});const T=this.images.get(t);for(const[A,{bin:C,position:R}]of u.entries()){let P=R.padding;const L=C.x+P,j=C.y+P,V=T.get(A).data,G=V.width,U=V.height;P=P>1?P-1:P,s.r.copy(V,v,{x:0,y:0},{x:L,y:j},{width:G,height:U},r),s.r.copy(V,v,{x:0,y:U-P},{x:L,y:j-P},{width:G,height:P},r),s.r.copy(V,v,{x:0,y:0},{x:L,y:j+U},{width:G,height:P},r),s.r.copy(V,v,{x:G-P,y:0},{x:L-P,y:j},{width:P,height:U},r),s.r.copy(V,v,{x:0,y:0},{x:L+G,y:j},{width:P,height:U},r),s.r.copy(V,v,{x:G-P,y:U-P},{x:L-P,y:j-P},{width:P,height:P},r),s.r.copy(V,v,{x:0,y:U-P},{x:L+G,y:j-P},{width:P,height:P},r),s.r.copy(V,v,{x:0,y:0},{x:L+G,y:j+U},{width:P,height:P},r),s.r.copy(V,v,{x:G-P,y:0},{x:L-P,y:j+U},{width:P,height:P},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const u=this.images.get(r);for(const p of t){if(this.callbackDispatchedThisFrame.get(r).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(p.toString());const m=u.get(p.toString());Un(m)&&this.updateImage(p,r,m)}}}function Kn(c){const t=c.key,r=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},m=c.style,y=c.styleSpec;let v=[];const T=s.K(r);if(T!=="object")return[new s.V(t,r,`object expected, ${T} found`)];for(const A in r){const C=A.split(".")[0];let R;p[C]?R=p[C]:u[C]?R=Xi:p["*"]?R=p["*"]:u["*"]&&(R=Xi),R?v=v.concat(R({key:(t&&`${t}.`)+A,value:r[A],valueSpec:u[C]||u["*"],style:m,styleSpec:y,object:r,objectKey:A},r)):v.push(new s.J(t,r[A],`unknown property "${A}"`))}for(const A in u)p[A]||u[A].required&&u[A].default===void 0&&r[A]===void 0&&v.push(new s.V(t,r,`missing required property "${A}"`));return v}function er(c){const t=c.value,r=c.valueSpec,u=c.style,p=c.styleSpec,m=c.key,y=c.arrayElementValidator||Xi;if(s.K(t)!=="array")return[new s.V(m,t,`array expected, ${s.K(t)} found`)];if(r.length&&t.length!==r.length)return[new s.V(m,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new s.V(m,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let v={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(v.function=r.function),s.K(r.value)==="object"&&(v=r.value);let T=[];for(let A=0;A<t.length;A++)T=T.concat(y({array:t,arrayIndex:A,value:t[A],valueSpec:v,style:u,styleSpec:p,key:`${m}[${A}]`},!0));return T}function sr(c){const t=c.key,r=c.value,u=c.valueSpec;let p=s.K(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new s.V(t,r,`number expected, ${p} found`)];if("minimum"in u){let m=u.minimum;if(s.K(u.minimum)==="array"&&(m=u.minimum[c.arrayIndex]),r<m)return[new s.V(t,r,`${r} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(s.K(u.maximum)==="array"&&(m=u.maximum[c.arrayIndex]),r>m)return[new s.V(t,r,`${r} is greater than the maximum value ${m}`)]}return[]}function tr(c){const t=c.valueSpec,r=s.M(c.value.type);let u,p,m,y={};const v=r!=="categorical"&&c.value.property===void 0,T=!v,A=s.K(c.value.stops)==="array"&&s.K(c.value.stops[0])==="array"&&s.K(c.value.stops[0][0])==="object",C=Kn({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new s.V(L.key,L.value,'identity function may not have a "stops" property')];let j=[];const V=L.value;return j=j.concat(er({key:L.key,value:V,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:R})),s.K(V)==="array"&&V.length===0&&j.push(new s.V(L.key,V,"array must have at least one stop")),j},default:function(L){return Xi({key:L.key,value:L.value,valueSpec:t,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&v&&C.push(new s.V(c.key,c.value,'missing required property "property"')),r==="identity"||c.value.stops||C.push(new s.V(c.key,c.value,'missing required property "stops"')),r==="exponential"&&c.valueSpec.expression&&!s.N(c.valueSpec)&&C.push(new s.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(T&&!s.O(c.valueSpec)?C.push(new s.V(c.key,c.value,"property functions not supported")):v&&!s.Q(c.valueSpec)&&C.push(new s.V(c.key,c.value,"zoom functions not supported"))),r!=="categorical"&&!A||c.value.property!==void 0||C.push(new s.V(c.key,c.value,'"property" property is required')),C;function R(L){let j=[];const V=L.value,G=L.key;if(s.K(V)!=="array")return[new s.V(G,V,`array expected, ${s.K(V)} found`)];if(V.length!==2)return[new s.V(G,V,`array length 2 expected, length ${V.length} found`)];if(A){if(s.K(V[0])!=="object")return[new s.V(G,V,`object expected, ${s.K(V[0])} found`)];if(V[0].zoom===void 0)return[new s.V(G,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new s.V(G,V,"object stop key must have value")];const U=s.M(V[0].zoom);if(typeof U!="number")return[new s.V(G,V[0].zoom,"stop zoom values must be numbers")];if(m&&m>U)return[new s.V(G,V[0].zoom,"stop zoom values must appear in ascending order")];U!==m&&(m=U,p=void 0,y={}),j=j.concat(Kn({key:`${G}[0]`,value:V[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:sr,value:P}}))}else j=j.concat(P({key:`${G}[0]`,value:V[0],style:L.style,styleSpec:L.styleSpec},V));return s.S(s.U(V[1]))?j.concat([new s.V(`${G}[1]`,V[1],"expressions are not allowed in function stops.")]):j.concat(Xi({key:`${G}[1]`,value:V[1],valueSpec:t,style:L.style,styleSpec:L.styleSpec}))}function P(L,j){const V=s.K(L.value),G=s.M(L.value),U=L.value!==null?L.value:j;if(u){if(V!==u)return[new s.V(L.key,U,`${V} stop domain type must match previous stop domain type ${u}`)]}else u=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new s.V(L.key,U,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&r!=="categorical"){let J=`number expected, ${V} found`;return s.O(t)&&r===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(L.key,U,J)]}return r!=="categorical"||V!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&V==="number"&&typeof G=="number"&&typeof p=="number"&&p!==void 0&&G<p?[new s.V(L.key,U,"stop domain values must appear in ascending order")]:(p=G,r==="categorical"&&G in y?[new s.V(L.key,U,"stop domain values must be unique")]:(y[G]=!0,[])):[new s.V(L.key,U,`integer expected, found ${String(G)}`)]}}function dr(c){const t=(c.expressionContext==="property"?s.W:s.X)(s.U(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new s.V(`${c.key}${u.key}`,c.value,u.message));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new s.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!s.Y(r))return[new s.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Dr(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!s.Z(r,["zoom","feature-state"]))return[new s.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!s._(r))return[new s.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dr(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return c instanceof s.$&&r.has(c.name)?[new s.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...Dr(p,t))}),u)}function fr(c){const t=c.key,r=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(s.M(r))===-1&&p.push(new s.V(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(s.M(r))===-1&&p.push(new s.V(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function Nr(c){return s.a1(s.U(c.value))?dr(s.L({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Sn(c)}function Sn(c){const t=c.value,r=c.key;if(s.K(t)!=="array")return[new s.V(r,t,`array expected, ${s.K(t)} found`)];const u=c.styleSpec;let p,m=[];if(t.length<1)return[new s.V(r,t,"filter array must have at least 1 element")];switch(m=m.concat(fr({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&m.push(new s.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=s.K(t[1]),p!=="string"&&m.push(new s.V(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let y=2;y<t.length;y++)p=s.K(t[y]),s.M(t[1])==="$type"?m=m.concat(fr({key:`${r}[${y}]`,value:t[y],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&m.push(new s.V(`${r}[${y}]`,t[y],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let y=1;y<t.length;y++)m=m.concat(Sn({key:`${r}[${y}]`,value:t[y],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=s.K(t[1]),t.length!==2?m.push(new s.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&m.push(new s.V(`${r}[1]`,t[1],`string expected, ${p} found`))}return m}function vr(c,t){const r=c.key,u=c.style,p=c.layer,m=c.styleSpec,y=c.value,v=c.objectKey,T=m[`${t}_${c.layerType}`];if(!T)return[];const A=v.match(/^(.*)-use-theme$/);if(t==="paint"&&A&&T[A[1]])return s.S(y)?[].concat(Xi({key:c.key,value:y,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v})):Xi({key:r,value:y,valueSpec:{type:"string"},style:u,styleSpec:m});const C=v.match(/^(.*)-transition$/);if(t==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return Xi({key:r,value:y,valueSpec:m.transition,style:u,styleSpec:m});const R=c.valueSpec||T[v];if(!R)return[new s.J(r,y,`unknown property "${v}"`)];let P;if(s.K(y)==="string"&&s.O(R)&&!R.tokens&&(P=/^{([^}]+)}$/.exec(y))){const j=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new s.V(r,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}const L=[];if(c.layerType==="symbol")v!=="text-field"||!u||u.glyphs||u.imports||L.push(new s.V(r,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&s.a2(s.U(y))&&s.M(y.type)==="identity"&&L.push(new s.V(r,y,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&s.O(R)&&(s.a3(R)||s.Q(R))){const j=s.W(s.U(y),R),V=j.value.expression||j.value._styleExpression.expression;V&&!s.Z(V,["measure-light"])&&(v==="model-emissive-strength"&&s._(V)&&s.Y(V)||L.push(new s.V(r,y,`${v} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return L.concat(Xi({key:c.key,value:y,valueSpec:R,style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v}))}function js(c){return vr(c,"paint")}function ws(c){return vr(c,"layout")}function Xr(c){let t=[];const r=c.value,u=c.key,p=c.style,m=c.styleSpec;r.type||r.ref||t.push(new s.V(u,r,'either "type" or "ref" is required'));let y=s.M(r.type);const v=s.M(r.ref);if(r.id){const T=s.M(r.id);for(let A=0;A<c.arrayIndex;A++){const C=p.layers[A];s.M(C.id)===T&&t.push(new s.V(u,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let T;["type","source","source-layer","filter","layout"].forEach(A=>{A in r&&t.push(new s.V(u,r[A],`"${A}" is prohibited for ref layers`))}),p.layers.forEach(A=>{s.M(A.id)===v&&(T=A)}),T?T.ref?t.push(new s.V(u,r.ref,"ref cannot reference another ref layer")):y=s.M(T.type):typeof v=="string"&&t.push(new s.V(u,r.ref,`ref layer "${v}" not found`))}else if(y!=="background"&&y!=="sky"&&y!=="slot")if(r.source){const T=p.sources&&p.sources[r.source],A=T&&s.M(T.type);T?A==="vector"&&y==="raster"?t.push(new s.V(u,r.source,`layer "${r.id}" requires a raster source`)):A==="raster"&&y!=="raster"?t.push(new s.V(u,r.source,`layer "${r.id}" requires a vector source`)):A!=="vector"||r["source-layer"]?A==="raster-dem"&&y!=="hillshade"?t.push(new s.V(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(y)?y==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&A==="geojson"&&!T.lineMetrics?t.push(new s.V(u,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):y==="raster-particle"&&A!=="raster-array"&&t.push(new s.V(u,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new s.V(u,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new s.V(u,r.source,`source "${r.source}" not found`))}else t.push(new s.V(u,r,'missing required property "source"'));return t=t.concat(Kn({key:u,value:r,valueSpec:m.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xi({key:`${u}.type`,value:r.type,valueSpec:m.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:T=>Nr(s.L({layerType:y},T)),layout:T=>Kn({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>ws(s.L({layerType:y},A))}}),paint:T=>Kn({layer:r,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":A=>js(s.L({layerType:y,layer:r},A))}})}})),t}function Vr(c){const t=c.value,r=c.key,u=s.K(t);return u!=="string"?[new s.V(r,t,`string expected, ${u} found`)]:[]}const jr={promoteId:function c({key:t,value:r}){if(s.K(r)==="string")return Vr({key:t,value:r});if(Array.isArray(r)){const u=[],p=s.U(r),m=s.X(p);return m.result==="error"&&m.value.forEach(y=>{u.push(new s.V(`${t}${y.key}`,null,`${y.message}`))}),s.Z(m.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in r)u.push(...c({key:`${t}.${p}`,value:r[p]}));return u}}};function Qi(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new s.V(r,t,'"type" is required')];const m=s.M(t.type);let y=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&(t.url||t.tiles||y.push(new s.J(r,t,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return y=y.concat(Kn({key:r,value:t,valueSpec:u[`source_${m.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:jr})),y;case"geojson":if(y=Kn({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:jr}),t.cluster)for(const v in t.clusterProperties){const[T,A]=t.clusterProperties[v],C=typeof T=="string"?[T,["accumulated"],["get",v]]:T;y.push(...dr({key:`${r}.${v}.map`,value:A,expressionContext:"cluster-map"})),y.push(...dr({key:`${r}.${v}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return Kn({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Kn({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new s.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fr({key:`${r}.type`,value:t.type,valueSpec:{values:rs(u)}})}}function rs(c){return c.source.reduce((t,r)=>{const u=c[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function cs(c){const t=c.value,r=c.styleSpec,u=r.light,p=c.style;let m=[];const y=s.K(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("light",t,`object expected, ${y} found`)]),m;for(const v in t){const T=v.match(/^(.*)-transition$/),A=v.match(/^(.*)-use-theme$/);m=m.concat(A&&u[A[1]]?Xi({key:v,value:t[v],valueSpec:{type:"string"},style:p,styleSpec:r}):T&&u[T[1]]&&u[T[1]].transition?Xi({key:v,value:t[v],valueSpec:r.transition,style:p,styleSpec:r}):u[v]?Xi({key:v,value:t[v],valueSpec:u[v],style:p,styleSpec:r}):[new s.V(v,t[v],`unknown property "${v}"`)])}return m}function us(c){const t=c.value;let r=[];if(!t)return r;const u=s.K(t);if(u!=="object")return r=r.concat([new s.V("light-3d",t,`object expected, ${u} found`)]),r;const p=c.styleSpec,m=p["light-3d"],y=c.key,v=c.style,T=c.style.lights;for(const R of["type","id"])if(!(R in t))return r=r.concat([new s.V("light-3d",t,`missing property ${R} on light`)]),r;if(t.type&&T)for(let R=0;R<c.arrayIndex;R++){const P=s.M(t.type),L=T[R];s.M(L.type)===P&&r.push(new s.V(y,t.id,`duplicate light type "${t.type}", previously defined at line ${L.id.__line__}`))}const A=`properties_light_${t.type}`;if(!(A in p))return r=r.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const C=p[A];for(const R in t)if(R==="properties"){const P=t[R],L=s.K(P);if(L!=="object")return r=r.concat([new s.V("properties",P,`object expected, ${L} found`)]),r;for(const j in P)r=r.concat(C[j]?Xi({key:j,value:P[j],valueSpec:C[j],style:v,styleSpec:p}):[new s.J(c.key,P[j],`unknown property "${j}"`)])}else{const P=R.match(/^(.*)-transition$/),L=R.match(/^(.*)-use-theme$/);r=r.concat(L&&m[L[1]]?Xi({key:R,value:t[R],valueSpec:{type:"string"},style:v,styleSpec:p}):P&&m[P[1]]&&m[P[1]].transition?Xi({key:R,value:t[R],valueSpec:p.transition,style:v,styleSpec:p}):m[R]?Xi({key:R,value:t[R],valueSpec:m[R],style:v,styleSpec:p}):[new s.J(R,t[R],`unknown property "${R}"`)])}return r}function fi(c){const t=c.value,r=c.key,u=c.style,p=c.styleSpec,m=p.terrain;let y=[];const v=s.K(t);if(t===void 0||v==="null")return y;if(v!=="object")return y=y.concat([new s.V("terrain",t,`object expected, ${v} found`)]),y;for(const T in t){const A=T.match(/^(.*)-transition$/),C=T.match(/^(.*)-use-theme$/);y=y.concat(C&&m[C[1]]?Xi({key:T,value:t[T],valueSpec:{type:"string"},style:u,styleSpec:p}):A&&m[A[1]]&&m[A[1]].transition?Xi({key:T,value:t[T],valueSpec:p.transition,style:u,styleSpec:p}):m[T]?Xi({key:T,value:t[T],valueSpec:m[T],style:u,styleSpec:p}):[new s.J(T,t[T],`unknown property "${T}"`)])}if(t.source){const T=u.sources&&u.sources[t.source],A=T&&s.M(T.type);T?A!=="raster-dem"&&y.push(new s.V(r,t.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):y.push(new s.V(r,t.source,`source "${t.source}" not found`))}else y.push(new s.V(r,t,'terrain is missing required property "source"'));return y}function Mn(c){const t=c.value,r=c.style,u=c.styleSpec,p=u.fog;let m=[];const y=s.K(t);if(t===void 0)return m;if(y!=="object")return m=m.concat([new s.V("fog",t,`object expected, ${y} found`)]),m;for(const v in t){const T=v.match(/^(.*)-transition$/),A=v.match(/^(.*)-use-theme$/);m=m.concat(A&&p[A[1]]?Xi({key:v,value:t[v],valueSpec:{type:"string"},style:r,styleSpec:u}):T&&p[T[1]]&&p[T[1]].transition?Xi({key:v,value:t[v],valueSpec:u.transition,style:r,styleSpec:u}):p[v]?Xi({key:v,value:t[v],valueSpec:p[v],style:r,styleSpec:u}):[new s.J(v,t[v],`unknown property "${v}"`)])}return m}const cr={"*":()=>[],array:er,boolean:function(c){const t=c.value,r=c.key,u=s.K(t);return u!=="boolean"?[new s.V(r,t,`boolean expected, ${u} found`)]:[]},number:sr,color:function(c){const t=c.key,r=c.value,u=s.K(r);return u!=="string"?[new s.V(t,r,`color expected, ${u} found`)]:s.a0.parseCSSColor(r)===null?[new s.V(t,r,`color expected, "${r}" found`)]:[]},enum:fr,filter:Nr,function:tr,layer:Xr,object:Kn,source:Qi,model:s.a4,light:cs,"light-3d":us,terrain:fi,fog:Mn,string:Vr,formatted:function(c){return Vr(c).length===0?[]:dr(c)},resolvedImage:function(c){return Vr(c).length===0?[]:dr(c)},projection:function(c){const t=c.value,r=c.styleSpec,u=r.projection,p=c.style;let m=[];const y=s.K(t);if(y==="object")for(const v in t)m=m.concat(Xi({key:v,value:t[v],valueSpec:u[v],style:p,styleSpec:r}));else y!=="string"&&(m=m.concat([new s.V("projection",t,`object or string expected, ${y} found`)]));return m},import:function(c){const{value:t,styleSpec:r}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let m=Kn(s.L({},c,{value:p,valueSpec:r.import}));return s.M(p.id)===""&&m.push(new s.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(m=m.concat(ta(u,r,{key:`${c.key}.data`}))),m},iconset:function(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new s.V(r,t,'"type" is required')];const m=s.M(t.type);let y=[];if(y=y.concat(Kn({key:r,value:t,valueSpec:u[`iconset_${m}`],style:p,styleSpec:u})),m==="source"&&t.source){const v=p.sources&&p.sources[t.source],T=v&&s.M(v.type);v?T!=="raster-array"&&y.push(new s.V(r,t.source,`iconset cannot be used with a source of type ${String(T)}, it only be used with a "raster-array" source type`)):y.push(new s.V(r,t.source,`source "${t.source}" not found`))}return y}};function Xi(c,t=!1){const r=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&s.a2(s.M(r)))return tr(c);if(u.expression&&s.S(s.U(r)))return dr(c);if(u.type&&cr[u.type]){const m=cr[u.type](c);return t===!0&&m.length>0&&s.K(c.value)==="array"?dr(c):m}return Kn(s.L({},c,{valueSpec:u.type?p[u.type]:u}))}function Kr(c){const t=c.value,r=c.key,u=Vr(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new s.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new s.V(r,t,'"glyphs" url must include a "{range}" token'))),u}function ta(c,t=s.a5,r={}){return Xi({key:r.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:Kr,"*":()=>[]}})}function Ms(c,t=s.a5){return ye(ta(c,t))}const Fo=c=>ye(Qi(c)),dl=c=>ye(cs(c)),Da=c=>ye(us(c)),dt=c=>ye(fi(c)),ao=c=>ye(Mn(c)),fl=c=>ye(function(t){const r=t.value,u=t.style,p=t.styleSpec,m=p.snow;let y=[];const v=s.K(r);if(r===void 0)return y;if(v!=="object")return y=y.concat([new s.V("snow",r,`object expected, ${v} found`)]),y;for(const T in r){const A=T.match(/^(.*)-transition$/);y=y.concat(A&&m[A[1]]&&m[A[1]].transition?Xi({key:T,value:r[T],valueSpec:p.transition,style:u,styleSpec:p}):m[T]?Xi({key:T,value:r[T],valueSpec:m[T],style:u,styleSpec:p}):[new s.J(T,r[T],`unknown property "${T}"`)])}return y}(c)),Ne=c=>ye(function(t){const r=t.value,u=t.style,p=t.styleSpec,m=p.rain;let y=[];const v=s.K(r);if(r===void 0)return y;if(v!=="object")return y=y.concat([new s.V("rain",r,`object expected, ${v} found`)]),y;for(const T in r){const A=T.match(/^(.*)-transition$/);y=y.concat(A&&m[A[1]]&&m[A[1]].transition?Xi({key:T,value:r[T],valueSpec:p.transition,style:u,styleSpec:p}):m[T]?Xi({key:T,value:r[T],valueSpec:m[T],style:u,styleSpec:p}):[new s.J(T,r[T],`unknown property "${T}"`)])}return y}(c)),B=c=>ye(Xr(c)),q=c=>ye(Nr(c)),ie=c=>ye(js(c)),he=c=>ye(ws(c)),de=c=>ye(s.a4(c));function ye(c){return c.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function ve(c,t){let r=!1;if(t&&t.length)for(const u of t)u instanceof s.J?s.w(u.message):(c.fire(new s.z(new Error(u.message))),r=!0);return r}let be;class De extends s.E{constructor(t,r="flat"){super(),this._transitionable=new s.a6(be||(be=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,u={}){this._validate(dl,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&ve(this,t.call(Ms,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Ge=class extends s.E{constructor(c,t,r,u){super(),this.scope=r,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),r,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new s.aa(c)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let r=-1,u=-1,p=1;for(const m of t.zoomStops)p=t.evaluate(new s.aa(m)),p>.01?(r=m,u=-1):u=m;return p<.01&&r>0&&u>r?[r,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof s.ab}};const ze=45,ft=65,bt=.05;function Lt(c,t,r,u){const p=s.af(ze,ft,r),[m,y]=Yt(c,u);let v=1-Math.min(1,Math.exp((t-m)/(y-m)*-6));return v*=v*v,v=Math.min(1,1.00747*v),v*p*c.alpha}function Yt(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function ii(c,t,r,u,p){const m=s.ad([],[t,r,u],p.mercatorFogMatrix);return Lt(c,s.ae(m),p.pitch,p._fov)}function li(c,t,r,u,p,m,y){const v=[[r,u,0],[p,u,0],[p,m,0],[r,m,0]];let T=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(const C of v){const R=s.ad([],C,t),P=s.ae(R);T=Math.min(T,P),A=Math.max(A,P)}return[Lt(c,T,y.pitch,y._fov),Lt(c,A,y.pitch,y._fov)]}class pi extends s.E{constructor(t,r,u,p){super();const m=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(m,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new s.ag(m),this.scope=u}get state(){const t=this._transform,r=t.projection.name==="globe",u=s.ah(t.zoom),p=this.properties.get("range"),m=[.5,3];return{range:r?[s.ai(m[0],p[0],u),s.ai(m[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,u={}){if(this._validate(ao,t,u))return;const p=s.l({},t);for(const m of Object.keys(s.a5.fog))p[m]===void 0&&(p[m]=s.a5.fog[m].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(ze,ft,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(u,p,m){const y=s.ac.fromLngLat(p),v=m.elevation?m.elevation.getAtPointOrZero(y):0;return ii(u,y.x,y.y,v,m)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return li(this.state,r,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(t,r,u,p,m){return this._transform.projection.supportsFog?li(this.state,t,r,u,p,m,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Yt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const u of r){const p=t.points[u];let m;if(p[2]>=0)m=p;else{const y=t.points[u-4];m=s.ak(y,p,y[2]/(y[2]-p[2]))}if(ii(this.state,m[0],m[1],0,this._transform)>=bt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&ve(this,t.call(Ms,s.l({value:r,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let Bn,vi,fn,Bi,pn=class extends s.E{constructor(c,t,r,u){super();const p=Bn||(Bn=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=s.al(r[0]),p=-Math.max(s.al(r[1]),.01),m=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],y=this.properties.get("vignette"),v=this.properties.get("vignette-color");return v.a=y,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*c),direction:m,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(fl,c,r))return;const u=s.l({},c);for(const p of Object.keys(s.a5.snow))u[p]===void 0&&(u[p]=s.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&ve(this,c.call(Ms,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},_n=class extends s.E{constructor(c,t,r,u){super();const p=vi||(vi=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=s.al(r[0]),p=-Math.max(s.al(r[1]),.01),m=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],y=this.properties.get("vignette-color");return y.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*c),direction:m,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:y}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(Ne,c,r))return;const u=s.l({},c);for(const p of Object.keys(s.a5.rain))u[p]===void 0&&(u[p]=s.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&ve(this,c.call(Ms,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class Yn extends s.E{constructor(t,r,u,p){super(),this.scope=u,this._options=t,this.properties=new s.ag(r),this._transitionable=new s.a6(r,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class pr{constructor(t,r,u,p){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,r){let u,p;if(t instanceof s.P||typeof t[0]=="number"){const m=s.P.convert(t);u=[m],p=r.isPointAboveHorizon(m)}else{const m=s.P.convert(t[0]),y=s.P.convert(t[1]),v=m.add(y)._div(2);u=[m,y],p=s.ao(m,y).every(T=>r.isPointAboveHorizon(T))&&r.isPointAboveHorizon(v)}return new pr(u,r.getCameraPoint(),p,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.ao(r,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(p[3]=this.cameraPoint)),s.ap(p,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],p=s.ao(r,u,t),m=this.cameraPoint.clone();switch(3*((m.y>r.y)+(m.y>u.y))+((m.x>r.x)+(m.x>u.x))){case 0:p[0]=m,p[4]=m.clone();break;case 1:p.splice(1,0,m);break;case 2:p[1]=m;break;case 3:p.splice(4,0,m);break;case 5:p.splice(2,0,m);break;case 6:p[3]=m;break;case 7:p.splice(3,0,m);break;case 8:p[2]=m}return p}containsTile(t,r,u,p=0){const m=t.queryPadding/r._pixelsPerMercatorPixel+1,y=u?this._bufferedCameraMercator(m,r):this._bufferedScreenMercator(m,r);let v=t.tileID.wrap+(y.unwrapped?p:0);const T=y.polygon.map(G=>s.aq(t.tileTransform,G,v));if(!s.ar(T,0,0,s.aj,s.aj))return;v=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const A=this.screenGeometryMercator.polygon.map(G=>s.as(t.tileTransform,G,v)),C=A.map(G=>new s.P(G[0],G[1])),R=r.getFreeCameraOptions().position||new s.ac(0,0,0),P=s.as(t.tileTransform,R,v),L=A.map(G=>{const U=s.at(G,G,P);return s.au(U,U),new s.av(P,U)}),j=s.aw(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:L,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(V=s.ax(T),V.min.x=s.aD(V.min.x,0,s.aj),V.min.y=s.aD(V.min.y,0,s.aj),V.max.x=s.aD(V.max.x,0,s.aj),V.max.y=s.aD(V.max.y,0,s.aj),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:j};var V}_bufferedScreenMercator(t,r){const u=Bo(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(m=>r.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,r){const u=Bo(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(m=>r.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,r){const u=function(m,y){const v=s.az([],y.pixelMatrix,y.globeMatrix),T=[0,-s.aE,0,1],A=[0,s.aE,0,1],C=[0,0,0,1];s.aA(T,T,v),s.aA(A,A,v),s.aA(C,C,v);const R=new s.P(T[0]/T[3],T[1]/T[3]),P=new s.P(A[0]/A[3],A[1]/A[3]),L=s.aB(m,R)&&T[3]<C[3],j=s.aB(m,P)&&A[3]<C[3];if(!L&&!j)return null;const V=function(ce,ae,me){for(let ge=1;ge<ce.length;ge++){const Me=Ur(ae.pointCoordinate3D(ce[ge-1]).x),Ee=Ur(ae.pointCoordinate3D(ce[ge]).x);if(me<0){if(Me<Ee)return{idx:ge,t:-Me/(Ee-1-Me)}}else if(Ee<Me)return{idx:ge,t:(1-Me)/(Ee+1-Me)}}return null}(m,y,L?-1:1);if(!V)return null;const{idx:G,t:U}=V;let J=G>1?Er(m.slice(0,G),y):[],ne=G<m.length?Er(m.slice(G),y):[];J=J.map(ce=>new s.P(Ur(ce.x),ce.y)),ne=ne.map(ce=>new s.P(Ur(ce.x),ce.y));const oe=[...J];oe.length===0&&oe.push(ne[ne.length-1]);const ue=s.ai(oe[oe.length-1].y,(ne.length===0?J[0]:ne[0]).y,U);let le;return le=L?[new s.P(0,ue),new s.P(0,0),new s.P(1,0),new s.P(1,ue)]:[new s.P(1,ue),new s.P(1,1),new s.P(0,1),new s.P(0,ue)],oe.push(...le),ne.length===0?oe.push(J[0]):oe.push(...ne),{polygon:oe.map(ce=>new s.ac(ce.x,ce.y)),unwrapped:!1}}(t,r);if(u)return u;const p=function(m,y){let v=!1,T=-1/0,A=0;for(let R=0;R<m.length-1;R++)m[R].x>T&&(T=m[R].x,A=R);for(let R=0;R<m.length-1;R++){const P=(A+R)%(m.length-1),L=m[P],j=m[P+1];Math.abs(L.x-j.x)>.5&&(L.x<j.x?(L.x+=1,P===0&&(m[m.length-1].x+=1)):(j.x+=1,P+1===m.length-1&&(m[0].x+=1)),v=!0)}const C=s.ay(y.center.lng);return v&&C<Math.abs(C-1)&&m.forEach(R=>{R.x-=1}),{polygon:m,unwrapped:v}}(Er(t,r).map(m=>new s.P(Ur(m.x),m.y)),r);return{polygon:p.polygon.map(m=>new s.ac(m.x,m.y)),unwrapped:p.unwrapped}}}function Er(c,t){return s.aC(c,r=>{const u=t.pointCoordinate3D(r);r.x=u.x,r.y=u.y},1/256)}function Ur(c){return c<0?1+c%1:c%1}function Bo(c){return 100*c|0}function ss(c,t,r,u,p){const m=function(v,T){if(v)return p(v);if(T){if(c.url&&T.tiles&&c.tiles&&delete c.tiles,T.variants){if(!Array.isArray(T.variants))return p(new Error("variants must be an array"));for(const C of T.variants){if(C==null||typeof C!="object"||C.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(C.capabilities))return p(new Error("capabilities must be an array"));if(C.capabilities.length===1&&C.capabilities[0]==="meshopt"){T=s.l(T,C);break}}}const A=s.aF(s.l({},T,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);A.tiles=t.canonicalizeTileset(A,c.url),p(null,A)}},y=function(v,T,A){if(!v)return null;if(!T&&!A)return v;A=A||v.worldview_default;const C=Object.values(v.language||{});if(C.length===0)return null;const R=Object.values(v.worldview||{});if(R.length===0)return null;const P=C.every(j=>j===T),L=R.every(j=>j===A);return P&&L?v:T in(v.language_options||{})||A in(v.worldview_options||{})?null:v.language_options&&v.worldview_options?v:null}(c.data,r,u);return y?s.q.frame(()=>m(null,y)):c.url?s.n(t.transformRequest(t.normalizeSourceURL(c.url,null,r,u),s.R.Source),m):s.q.frame(()=>{const{data:v,...T}=c;m(null,T)})}function os(c,t){const r=Math.pow(2,t.z),u=Math.floor(s.ay(c.getWest())*r),p=Math.floor(s.aH(c.getNorth())*r),m=Math.ceil(s.ay(c.getEast())*r),y=Math.ceil(s.aH(c.getSouth())*r);return t.x>=u&&t.x<m&&t.y>=p&&t.y<y}class zr{constructor(t,r,u){this.bounds=t?s.aG.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(s.aG.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!os(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(os(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new zr(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Yr extends s.E{constructor(t,r,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aF(r,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new s.aI}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=ss(this._options,this.map._requestManager,r,u,(p,m)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.z(p));else if(m){if(s.l(this,m),this.hasWorldviews=!!m.worldview_options,m.worldview_default&&(this.worldviewDefault=m.worldview_default),m.vector_layers){this.vectorLayers=m.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const y of m.vector_layers)this.vectorLayerIds.push(y.id),m.worldview&&m.worldview[y.source]&&this.localizableLayerIds.add(y.id)}this.tileBounds=zr.fromTileJSON(m),rr(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(t,r){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),m=this.map._requestManager.transformRequest(p,s.R.Tile),y=this.map.style?this.map.style.getLut(this.scope):null,v=y?{image:y.image.clone()}:null,T={request:m,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:v,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(u)&&(T.worldview=this.map.getWorldview()||this.worldviewDefault,T.localizableLayerIds=this.localizableLayerIds),T.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",T,A.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",T,A.bind(this),void 0,!0);else{const C=s.aJ.call({deduped:this._deduped},T,(R,P)=>{R||!P?A.call(this,R):(T.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},t.actor&&t.actor.send("loadTile",T,A.bind(this),void 0,!0))},!0);t.request={cancel:C}}function A(C,R){return delete t.request,t.aborted?r(null):C&&C.status!==404?r(C):(R&&R.resourceTiming&&(t.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&t.setExpiryData(R),t.loadVectorData(R,this.map.painter),s.aK(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class So extends s.E{constructor(t,r,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},r),s.l(this,s.aF(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=ss(this._options,this.map._requestManager,null,null,(r,u)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new s.z(r)):u&&(s.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(p=>p.id)),this.tileBounds=zr.fromTileJSON(u),rr(u.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const u=s.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(p,s.R.Tile),(m,y,v,T)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):m?(t.state="errored",r(m)):y?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:v,expires:T}),t.setTexture(y,this.map.painter),t.state="loaded",s.aK(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class za extends So{constructor(t,r,u,p){super(t,r,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.l({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);r&&r.enabled&&u&&r._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,s.R.Tile),m={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const y=(v,T,A,C)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(v)return v.name==="AbortError"?void 0:(t.state="errored",r(v));if(this.map._refreshExpiredTiles&&T&&t.setExpiryData({cacheControl:A,expires:C}),this.partial)t.state="empty";else{if(!T)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=T}r(null)};t.request=this.partial?t.fetchHeader(void 0,y.bind(this)):t.actor.send("loadTile",m,y.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const u=t.texture;u&&u instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,u,(p,m)=>{if(p)return t.state="errored",this.fire(new s.z(p)),void this.triggerRepaint(t);m&&(t._isHeaderLoaded=!0,t.setTexture(m,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:m})=>m===t),u=r&&r.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,r,u){if(!t)return;const p=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let m=null;r instanceof s.aN?m=r.paint.get("raster-array-band"):r instanceof s.aO&&(m=r.paint.get("raster-particle-array-band"));const y=m||this.getInitialBand(p);if(y!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,y)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,y)}getImages(t,r){const u=new Map;for(const p of t)for(const m of r){const[y,v]=m.split("/"),T=p.getLayer(y);if(!T||!T.hasBand(v)||!T.hasDataForBand(v))continue;const{bytes:A,tileSize:C,buffer:R}=T.getBandView(v),P=C+2*R,L={data:new s.r({width:P,height:P},A),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(m,L)}return u}}const dc={vector:Yr,raster:So,"raster-dem":class extends So{constructor(c,t,r,u){super(c,t,r,u),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,m){p&&(c.state="errored",t(p)),m&&(c.dem=m,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=s.o(this.map._requestManager.transformRequest(r,s.R.Tile),(function(p,m,y,v){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(m){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:y,expires:v});const T=ImageBitmap&&m instanceof ImageBitmap&&s.t(),A=1-(m.width-s.aL(m.width))/2;A<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const C=T?m:s.q.getImageData(m,A),R={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:C,encoding:this.encoding,padding:A};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",R,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),u=(t.x-1+r)%r,p=t.x===0?c.wrap-1:c.wrap,m=(t.x+1+r)%r,y=t.x+1===r?c.wrap+1:c.wrap,v={};return v[new s.aM(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},v[new s.aM(c.overscaledZ,y,t.z,m,t.y).key]={backfilled:!1},t.y>0&&(v[new s.aM(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},v[new s.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},v[new s.aM(c.overscaledZ,y,t.z,m,t.y-1).key]={backfilled:!1}),t.y+1<r&&(v[new s.aM(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},v[new s.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},v[new s.aM(c.overscaledZ,y,t.z,m,t.y+1).key]={backfilled:!1}),v}},"raster-array":za,geojson:class extends s.E{constructor(c,t,r,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(u),this._data=t.data,this._options=s.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=s.aj/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.l({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(r),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.z(u));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(m.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new s.A("data",m)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=s.C(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,m=this._partialReload,y={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:m};c.request=this.actor.send(r,y,(v,T)=>m&&!T?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):v?t(v):(c.loadVectorData(T,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(c,t,r,u){super(c,t,r,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aQ(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new s.z(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(c,t,r,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const r=this._options.models[t],u=s.aS(this.map._requestManager.transformRequest(r.uri,s.R.Model).url).then(p=>{if(!p)return;const m=s.aT(p),y=new s.aU(t,r.position,r.orientation,m);y.computeBoundsAndApplyParent(),this.models.push(y)}).catch(p=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${r.uri}: ${p.message}`)))});c.push(u)}Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(c,t,r,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=ss(this._options,this.map._requestManager,t,r,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new s.z(u))):p&&(s.l(this,p),p.bounds&&(this.tileBounds=new zr(p.bounds,this.minzoom,this.maxzoom)),rr(p.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(r,s.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const m=Object.values(c.buckets);for(const y of m)y.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(m,y){return c.aborted?t(null):m&&m.status!==404?t(m):(this.map._refreshExpiredTiles&&y&&c.setExpiryData(y),c.loadModelData(y,this.map.painter),c.state="loaded",void t(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aP{constructor(c,t,r,u){super(c,t,r,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(m=>typeof m!="number"))||this.fire(new s.z(new s.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends s.E{constructor(c,t,r,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:u,z:p}=c.tileID.canonical,m=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:u,z:p},{signal:m.signal})).then((function(y){return delete c.request,c.aborted?(c.state="unloaded",t(null)):y===void 0?(c.state="errored",t(null)):y===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(v){return v instanceof ImageData||v instanceof HTMLCanvasElement||v instanceof ImageBitmap||v instanceof HTMLImageElement}(y)?(this.loadTileData(c,y),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(y=>{y.name!=="AbortError"&&(c.state="errored",t(y))}),c.request.cancel=()=>m.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof s.T?(c.destroy(!0),c.texture&&c.texture instanceof s.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=s.C(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},pl=function(c,t,r,u){const p=new dc[t.type](c,t,r,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return s.aV(["load","abort","unload","serialize","prepare"],p),p};function Au(c,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:m}=u;return`featureset:${p}${m?`:import:${m}`:""}`}}(c.target)}`}function fc(c,t,r,u=""){if(c.uniqueFeatureID){const p=Au(c,t,u);if(r.has(p))return!0;r.add(p)}return!1}function La(c,t,r,u,p=!1){const m=t.sourceCache.transform,y=t.sourceCache.tilesIn(c,t.has3DLayers,p);y.sort(lo);const v=[];for(const T of y){const A=T.tile.queryRenderedFeatures(t,T,r,u,m,p);Object.keys(A).length&&v.push({wrappedTileID:T.tile.tileID.wrapped().key,queryResults:A})}return v.length===0?{}:function(T){const A={},C={};for(const R of T){const P=R.queryResults,L=R.wrappedTileID,j=C[L]=C[L]||{};for(const V in P){const G=P[V],U=j[V]=j[V]||{},J=A[V]=A[V]||[];for(const ne of G)U[ne.featureIndex]||(U[ne.featureIndex]=!0,J.push(ne))}}return A}(v)}function pc(c,t,r,u,p){const m={},y=u.queryRenderedSymbols(c),v=[];for(const T of Object.keys(y).map(Number))v.push(p[T]);v.sort(lo);for(const T of v){const A=T.featureIndex.lookupSymbolFeatures(y[T.bucketInstanceId],T.bucketIndex,T.sourceLayerIndex,t,r);for(const C in A){const R=m[C]=m[C]||[],P=A[C];P.sort((L,j)=>{const V=T.featureSortOrder;if(V){const G=V.indexOf(L.featureIndex);return V.indexOf(j.featureIndex)-G}return j.featureIndex-L.featureIndex});for(const L of P)R.push(L)}}return m}function fd(c,t){const r=c.getRenderableIds().map(m=>c.getTileByID(m)),u=[],p={};for(let m=0;m<r.length;m++){const y=r[m],v=y.tileID.canonical.key;p[v]||(p[v]=!0,y.querySourceFeatures(u,t))}return u}function lo(c,t){const r=c.tileID,u=t.tileID;return r.overscaledZ-u.overscaledZ||r.canonical.y-u.canonical.y||r.wrap-u.wrap||r.canonical.x-u.canonical.x}function pd(c,t){const r={};if(!t)return r;for(const u of c){const p=u.layerIds.map(m=>t.getLayer(m)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(m=>p.filter(y=>y.id===m)[0]));for(const m of p)r[m.fqid]=u}}return r}const Ps=32,co=33,No=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,u=0,p=0,m=0,y=0,v=0;for(1&t?p=m=y=Ps:r=u=v=Ps;(t>>=1)>1;){const A=r+p>>1,C=u+m>>1;1&t?(p=r,m=u,r=y,u=v):(r=p,u=m,p=y,m=v),y=A,v=C}const T=4*c;No[T+0]=r,No[T+1]=u,No[T+2]=p,No[T+3]=m}const uo=new Uint16Array(2178),Vo=new Uint8Array(1089),Xs=new Uint16Array(1089);function mc(c){return c===0?-.03125:c===32?.03125:0}const md={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class jo{constructor(t,r,u,p,m){this.tileID=t,this.uid=s.a$(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(t){const r=t+this.timeAdded;r<s.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=pd(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const m=this.buckets[p];if(m instanceof s.b1){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const m=this.buckets[p];if(m instanceof s.b1&&m.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const p in this.buckets){const m=this.buckets[p],y=r.style.getOwnLayer(p);if(!y)continue;const v=y.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,v)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,pd(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(t)}const r=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new s.T(t,u.image,r.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=r.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,r,u,p,m,y){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const v=function(T,A){const C=s.bn([],[.5*T.width,.5*-T.height,1]);return s.bo(C,C,[1,-1,0]),s.az(C,C,T.calculateProjMatrix(A.toUnwrapped())),Float32Array.from(C)}(m,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:v,transform:p,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),m=r?r.sourceLayer:"",y=p._geojsonTileLayer||p[m];if(!y)return;const v=s.b3(r&&r.filter),{z:T,x:A,y:C}=this.tileID.canonical,R={z:T,x:A,y:C};for(let P=0;P<y.length;P++){const L=y.feature(P);if(v.needGeometry){const G=s.b4(L,!0);if(!v.filter(new s.aa(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!v.filter(new s.aa(this.tileID.overscaledZ),L))continue;const j=u.getId(L,m),V=new s.b5(L,T,A,C,j);V.tile=R,t.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=s.b6(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const m=this.expirationTime-r;m?this.expirationTime=u+Math.max(m,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),m=t.style.getBrightness();for(const y in this.buckets){if(!t.style.hasLayer(y))continue;const v=this.buckets[y],T=v.layers[0],A=T.sourceLayer||"_geojsonTileLayer",C=u[A],R=t.style.getLayerSourceCache(T);let P={};R&&(P=R._state.getState(A,void 0));const L=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},j=Object.keys(P).length>0&&!r;j&&!v.stateDependentLayers.length&&!r||v.update(P,C,p,L,j?v.stateDependentLayers:v.layers,r,m),(v instanceof s.b7||v instanceof s.b8)&&t._terrain&&t._terrain.enabled&&R&&v.uploadPending()&&t._terrain._clearRenderCacheForTile(R.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const m of r)if(p[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=s.b9(md,this.tileID.canonical,this.tileTransform)[0],p=new s.ba,m=new s.bb;for(let y=0;y<u.length;y++){const{x:v,y:T}=u[y];p.emplaceBack(v,T),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(p,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,p.length,m.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=s.b9(md,this.tileID.canonical,this.tileTransform)[0];let p,m;if(this.isRaster){const y=function(v,T){const A=s.aW(v,T),C=Math.pow(2,v.z);for(let G=0;G<co;G++)for(let U=0;U<co;U++){const J=s.aX((v.x+(U+mc(U))/Ps)/C),ne=s.aY((v.y+(G+mc(G))/Ps)/C),oe=T.project(J,ne),ue=G*co+U;uo[2*ue+0]=Math.round((oe.x*A.scale-A.x)*s.aj),uo[2*ue+1]=Math.round((oe.y*A.scale-A.y)*s.aj)}Vo.fill(0),Xs.fill(0);for(let G=2045;G>=0;G--){const U=4*G,J=No[U+0],ne=No[U+1],oe=No[U+2],ue=No[U+3],le=J+oe>>1,ce=ne+ue>>1,ae=le+ce-ne,me=ce+J-le,ge=ne*co+J,Me=ue*co+oe,Ee=ce*co+le,qe=Math.hypot((uo[2*ge+0]+uo[2*Me+0])/2-uo[2*Ee+0],(uo[2*ge+1]+uo[2*Me+1])/2-uo[2*Ee+1])>=16;Vo[Ee]=Vo[Ee]||(qe?1:0),G<1022&&(Vo[Ee]=Vo[Ee]||Vo[(ne+me>>1)*co+(J+ae>>1)]||Vo[(ue+me>>1)*co+(oe+ae>>1)])}const R=new s.aZ,P=new s.a_;let L=0;function j(G,U){const J=U*co+G;return Xs[J]===0&&(R.emplaceBack(uo[2*J+0],uo[2*J+1],G*s.aj/Ps,U*s.aj/Ps),Xs[J]=++L),Xs[J]-1}function V(G,U,J,ne,oe,ue){const le=G+J>>1,ce=U+ne>>1;if(Math.abs(G-oe)+Math.abs(U-ue)>1&&Vo[ce*co+le])V(oe,ue,G,U,le,ce),V(J,ne,oe,ue,le,ce);else{const ae=j(G,U),me=j(J,ne),ge=j(oe,ue);P.emplaceBack(ae,me,ge)}}return V(0,0,Ps,Ps,Ps,0),V(Ps,Ps,0,0,0,Ps),{vertices:R,indices:P}}(this.tileID.canonical,r);p=y.vertices,m=y.indices}else{p=new s.aZ,m=new s.a_;for(const{x:v,y:T}of u)p.emplaceBack(v,T,0,0);const y=s.be(p.int16.subarray(0,4*p.length),void 0,4);for(let v=0;v<y.length;v+=3)m.emplaceBack(y[v],y[v+1],y[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,s.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=s.bd.simpleSegment(0,0,p.length,m.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,m=s.bg(p,r),y=s.bh(m),v=s.ah(r.zoom);let T;v>0&&(T=s.bi(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,y,T,v),this._makeGlobeTileDebugTextBuffer(t,p,r,y,T,v)}_globePoint(t,r,u,p,m,y,v){let T=s.bj(t,r,u);if(y){const A=1<<u.z,C=s.ay(p.center.lng),R=s.aH(p.center.lat),P=(u.x+.5)/A-C;let L=0;P>.5?L=-1:P<-.5&&(L=1);let j=(t/s.aj+u.x)/A+L,V=(r/s.aj+u.y)/A;j=(j-C)*p._pixelsPerMercatorPixel+C,V=(V-R)*p._pixelsPerMercatorPixel+R;const G=[j*p.worldSize,V*p.worldSize,0];s.ad(G,G,y),T=s.bk(T,G,v)}return s.ad(T,T,m)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,m,y){const v=new s.ba,T=new s.bb,A=new s.bl,C=(P,L,j,V,G)=>{const U=(j-P)/(G-1),J=(V-L)/(G-1),ne=v.length;for(let oe=0;oe<G;oe++){const ue=P+oe*U,le=L+oe*J;v.emplaceBack(ue,le);const ce=this._globePoint(ue,le,r,u,p,m,y);A.emplaceBack(ce[0],ce[1],ce[2]),T.emplaceBack(ne+oe)}},R=s.aj;C(0,0,R,0,16),C(R,0,R,R,16),C(R,R,0,R,16),C(0,R,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(T),this._tileDebugBuffer=t.createVertexBuffer(v,s.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(A,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,v.length,T.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,m,y){const v=s.aj/4,T=new s.ba,A=new s.a_,C=new s.bl,R=25;A.reserve(32),T.reserve(R),C.reserve(R);const P=(L,j)=>R*L+j;for(let L=0;L<R;L++){const j=L*v;for(let V=0;V<R;V++){const G=V*v;T.emplaceBack(G,j);const U=this._globePoint(G,j,r,u,p,m,y);C.emplaceBack(U[0],U[1],U[2])}}for(let L=0;L<4;L++)for(let j=0;j<4;j++){const V=P(L,j),G=P(L,j+1),U=P(L+1,j),J=P(L+1,j+1);A.emplaceBack(V,G,U),A.emplaceBack(U,G,J)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(A),this._tileDebugTextBuffer=t.createVertexBuffer(T,s.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(C,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,R,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class gc extends jo{constructor(t,r,u,p,m){super(t,r,u,p,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const u=this._mrt=new s.bp(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.br(p,(m,y,v,T)=>{if(m)r(m);else try{const A=u.getHeaderLength(y);if(A>t)return void(this.request=this.fetchHeader(A,r));u.parseHeader(y),this._isHeaderLoaded=!0;let C=0;for(const R of Object.values(u.layers))C=Math.max(C,R.dataIndex[R.dataIndex.length-1].lastByte);y.byteLength>=C&&(this.entireBuffer=y),r(null,this.entireBuffer||y,v,T)}catch(A){r(A)}}),this.request}fetchBand(t,r,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void u(new Error("Can't fetch tile band without an actor"));let y;const v=(R,P)=>{y.complete(R,P),R?u(R):(this.updateTextureDescriptor(t,r),u(null,this.textureDescriptor&&this.textureDescriptor.img))},T=(R,P)=>{if(R)return u(R);const L=m.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:P,task:y},v,void 0,!0);this._workQueue.push(()=>{L&&L.cancel(),y.cancel()})},A=p.getLayer(t);if(!A)return void u(new Error(`Unknown sourceLayer "${t}"`));if(A.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const C=A.getDataRange([r]);if(y=p.createDecodingTask(C),!y||y.tasks.length)if(this.flushQueues(),this.entireBuffer)T(null,this.entireBuffer.slice(C.firstByte,C.lastByte+1));else{const R=Object.assign({},this.requestParams,{headers:{Range:`bytes=${C.firstByte}-${C.lastByte}`}}),P=s.br(R,T);this._fetchQueue.push(()=>{P.cancel(),y.cancel()})}else u(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(r)||!u.hasDataForBand(r))return;const{bytes:p,tileSize:m,buffer:y,offset:v,scale:T}=u.getBandView(r),A=m+2*y,C=new s.r({width:A,height:A},p),R=this.texture;R&&R instanceof s.T&&R.update(C,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:C,buffer:y,offset:v,tileSize:m,format:u.pixelFormat,mix:[T,256*T,65536*T,16777216*T]}}}class gd{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const m={value:r,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},u)),this.data[p].push(m),this.order.push(p),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),m=this.data[u][p];return this.data[u].splice(p,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class _c{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},s.l(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==p&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const m in this.state[t][p])u[m]||(this.deletedStates[t][p][m]=null)}else for(const m in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][m]===null&&delete this.deletedStates[t][p][m]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=this.state[t]||{},p=this.stateChanges[t]||{},m=this.deletedStates[t];if(m===null)return{};if(r!==void 0){const v=String(r),T=s.l({},u[v],p[v]);if(m){const A=m[r];if(A===null)return{};for(const C in A)delete T[C]}return T}const y=s.l({},u,p);if(m)for(const v in m)delete y[v];return y}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const m={};for(const y in this.stateChanges[p])this.state[p][y]||(this.state[p][y]={}),s.l(this.state[p][y],this.stateChanges[p][y]),m[y]=this.state[p][y];u[p]=m}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const m={};if(this.deletedStates[p]===null)for(const y in this.state[p])m[y]={},this.state[p][y]={};else for(const y in this.deletedStates[p]){if(this.deletedStates[p][y]===null)this.state[p][y]={};else if(this.state[p][y])for(const v of Object.keys(this.deletedStates[p][y]))delete this.state[p][y][v];m[y]=this.state[p][y]}u[p]=u[p]||{},s.l(u[p],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(r)}}class hs extends s.E{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new gd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new _c,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Iu).map(t=>t.key)}getRenderableIds(t,r){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,r)&&u.push(this._tiles[p]);return t?u.sort((p,m)=>{const y=p.tileID,v=m.tileID,T=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),A=new s.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-v.overscaledZ||A.y-T.y||A.x-T.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Iu).map(p=>p.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new s.z(p,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const m=r[p];if(t.neighboringTiles&&t.neighboringTiles[m]){const y=this.getTileByID(m);u(t,y),u(y,t)}}function u(p,m){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-p.tileID.canonical.x;const v=m.tileID.canonical.y-p.tileID.canonical.y,T=Math.pow(2,p.tileID.canonical.z),A=m.tileID.key;y===0&&v===0||Math.abs(v)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),m.dem&&p.dem&&(p.dem.backfillBorder(m.dem,y,v),p.neighboringTiles&&p.neighboringTiles[A]&&(p.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const m in this._tiles){let y=this._tiles[m];if(p[m]||!y.hasData()||y.tileID.overscaledZ<=r||y.tileID.overscaledZ>u)continue;let v=y.tileID;for(;y&&y.tileID.overscaledZ>r+1;){const A=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[A.key],y&&y.hasData()&&(v=A)}let T=v;for(;T.overscaledZ>r;)if(T=T.scaledTo(T.overscaledZ-1),t[T.key]){p[v.key]=v;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),m=this._getLoadedTile(p);if(m)return m}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,m=Math.floor(u*p*5),y=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(v)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const m=this._tiles[p];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+r),u[m.tileID.key]=m}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u,p,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const y=this._source.type==="batched-model";let v,T=this._source.maxzoom;const A=this.map&&this.map.painter?this.map.painter._terrain:null;if(A&&A.sourceCache===this&&A.attenuationRange()){const P=A.attenuationRange()[0],L=Math.floor(P)-Math.log2(A.getDemUpscale());T>L&&(T=L)}if(this.used||this.usedForTerrain){if(this._source.tileID)v=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new s.aM(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y));else if(this.tileCoverLift!==0){const P=t.clone();P.tileCoverLift=this.tileCoverLift,v=P.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.minzoom<=1&&t.projection.name==="globe"&&(v.push(new s.aM(1,0,1,0,0)),v.push(new s.aM(1,0,1,1,0)),v.push(new s.aM(1,0,1,0,1)),v.push(new s.aM(1,0,1,1,1)))}else if(v=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:T,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:y}),this._source.hasTile){const P=this._source.hasTile.bind(this._source);v=v.filter(L=>P(L))}}else v=[];if(v.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Cu(this._source.type)){const P=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),L=Math.min(P,this._source.maxzoom);if(y){const j=t.extendTileCover(v,L);for(const V of j)v.push(V)}else if(m){const j=t.extendTileCover(v,L,this.transform._camera.forward());for(const V of j)v.push(V)}else if(this.castsShadows&&p){const j=t.extendTileCover(v,L,p);for(const V of j)this._shadowCasterTiles[V.key]=!0,v.push(V)}}const C=this._updateRetainedTiles(v);if(Cu(this._source.type)&&v.length!==0){const P={},L={},j=Object.keys(C);for(const G of j){const U=C[G],J=this._tiles[G];if(!J||J.fadeEndTime&&J.fadeEndTime<=s.q.now())continue;const ne=this.findLoadedParent(U,Math.max(U.overscaledZ-hs.maxOverzooming,this._source.minzoom));ne&&(this._addTile(ne.tileID),P[ne.tileID.key]=ne.tileID),L[G]=U}const V=v[v.length-1].overscaledZ;for(const G in this._tiles){const U=this._tiles[G];if(C[G]||!U.hasData())continue;let J=U.tileID;for(;J.overscaledZ>V;){J=J.scaledTo(J.overscaledZ-1);const ne=this._tiles[J.key];if(ne&&ne.hasData()&&L[J.key]){C[G]=U.tileID;break}}}for(const G in P)C[G]||(this._coveredTiles[G]=!0,C[G]=P[G])}for(const P in C)this._tiles[P].clearFadeHold();const R=s.bs(this._tiles,C);for(const P of R){const L=this._tiles[P];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+P)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce((A,C)=>Math.min(A,C.overscaledZ),1/0),m=t[0].overscaledZ,y=Math.max(m-hs.maxOverzooming,this._source.minzoom),v=Math.max(m+hs.maxUnderzooming,this._source.minzoom),T={};for(const A of t){const C=this._addTile(A);r[A.key]=A,C.hasData()||p<this._source.maxzoom&&(T[A.key]=A)}this._retainLoadedChildren(T,p,v,r);for(const A of t){let C=this._tiles[A.key];if(C.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const P=A.children(this._source.maxzoom)[0],L=this.getTile(P);if(L&&L.hasData()){r[P.key]=P;continue}}else{const P=A.children(this._source.maxzoom);if(r[P[0].key]&&r[P[1].key]&&r[P[2].key]&&r[P[3].key])continue}let R=C.wasRequested();for(let P=A.overscaledZ-1;P>=y;--P){const L=A.scaledTo(P);if(u[L.key]||(u[L.key]=!0,C=this.getTile(L),!C&&R&&(C=this._addTile(L)),C&&(r[L.key]=L,R=C.wasRequested(),C.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const m=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;p=m}for(const m of r)this._loadedParentTiles[m]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=!!r;if(!u){const p=this.map?this.map.painter:null,m=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new gc(t,m,this.transform.tileZoom,p,this._isRaster):new jo(t,m,this.transform.tileZoom,p,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,u||this._source.fire(new s.A("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],m=this.transform;if(!m)return p;const y=m.projection.name==="globe",v=s.ay(m.center.lng);for(const T in this._tiles){const A=this._tiles[T];if(u&&A.clearQueryDebugViz(),A.holdingForFade())continue;let C;if(y){const R=A.tileID.canonical;if(R.z===0){const P=[Math.abs(s.aD(v,...ml(R,-1))-v),Math.abs(s.aD(v,...ml(R,1))-v)];C=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(s.aD(v,...ml(R,-1))-v),Math.abs(s.aD(v,...ml(R,0))-v),Math.abs(s.aD(v,...ml(R,1))-v)];C=[P.indexOf(Math.min(...P))-1]}}else C=[0];for(const R of C){const P=t.containsTile(A,m,r,R);P&&p.push(P)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const u=this.getRenderableIds(t,r).map(m=>this._tiles[m].tileID),p=this.transform.projection.name==="globe";for(const m of u)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=p?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return u}sortCoordinatesByDistance(t){const r=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),m={};for(const y of r){const v=1/(1<<y.canonical.z);m[y.key]=((y.canonical.x+.5)*v+y.wrap-u[0])*p[0]+((y.canonical.y+.5)*v-u[1])*p[1]-u[2]*p[2]}return r.sort((y,v)=>m[y.key]-m[v.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Cu(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const T=()=>{this._sourceLoaded&&(this._source.off("data",T),this._preloadTiles(t,r))};return void this._source.on("data",T)}const u=new Map,p=Array.isArray(t)?t:[t],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const T of p){const A=T.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of A)u.set(C.key,C);this.usedForTerrain&&T.updateElevation(!1)}const v=Array.from(u.values());s.bt(v,(T,A)=>{const C=new jo(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,R=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),A(R,C)})},r)}}function Iu(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function Cu(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function ml(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}hs.maxOverzooming=10,hs.maxUnderzooming=3;class Bp{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:t,visibilityChanged:r});else if(p.type==="model"){const m=this.style.getLayerSource(p);m&&m.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const u=r.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&r.visible,r.visible=p}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const p of this.layers){const m=p.layer,y=this.style.getLayerSourceCache(m);let v=1;m.type==="fill-extrusion"&&(v=p.visible?m.paint.get("fill-extrusion-vertical-scale"):0);let T=y?y.getTile(r):null;if(!T&&y&&r.canonical.z>y.getSource().minzoom){let A=r.scaledTo(Math.min(y.getSource().maxzoom,r.overscaledZ-1));for(;A.overscaledZ>=y.getSource().minzoom&&(T=y.getTile(A),!T&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:T?T.getBucket(m):null,tileID:T?T.tileID:r,verticalScale:v})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const m=t.symbolInstances.get(p),y=m.zOffset,v=this._getHeightAtTileOffset(r,m.tileAnchorX,m.tileAnchorY);m.zOffset=v!==Number.NEGATIVE_INFINITY?v:y,u||y===m.zOffset||(u=!0),t.hasAnyZOffset||m.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,u,p){let m=r,y=u;if(t.canonical.z!==p.canonical.z){const v=p.canonical,T=1/(1<<t.canonical.z-v.z);m=(r+t.canonical.x*s.aj)*T-v.x*s.aj|0,y=(u+t.canonical.y*s.aj)*T-v.y*s.aj|0}return{tileX:m,tileY:y}}_getHeightAtTileOffset(t,r,u){let p,m;for(let y=0;y<this.layers.length;++y){if(this.layers[y].layer.type!=="fill-extrusion")continue;const{bucket:v,tileID:T,verticalScale:A}=this.currentBuildingBuckets[y];if(!v)continue;const{tileX:C,tileY:R}=this._mapCoordToOverlappingTile(t,r,u,T),P=v.getHeightAtTileCoord(C,R);P&&P.height!==void 0&&(P.hidden?p=P.height:m=Math.max(P.height*A,m||0))}if(m!==void 0)return m;for(let y=0;y<this.layers.length;++y){const v=this.layers[y];if(v.layer.type!=="model"||!v.visible)continue;const{bucket:T,tileID:A}=this.currentBuildingBuckets[y];if(!T)continue;const{tileX:C,tileY:R}=this._mapCoordToOverlappingTile(t,r,u,A),P=T.getHeightAtTileCoord(C,R);if(P&&!P.hidden)return P.height===void 0&&p!==void 0?Math.min(P.maxHeight,p)*P.verticalScale:P.height?P.height*P.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Mu(c,t){const r={};for(const u in c)u!=="ref"&&(r[u]=c[u]);return s.bu.forEach(u=>{u in t&&(r[u]=t[u])}),r}function Pu(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=Mu(c[r],t[c[r].ref]));return c}const ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function gl(c,t,r){r.push({command:ki.addSource,args:[c,t[c]]})}function _l(c,t,r){t.push({command:ki.removeSource,args:[c]}),r[c]=!0}function j_(c,t,r,u){_l(c,r,u),gl(c,t,r)}function Np(c,t,r){let u;for(u in c[r])if(c[r].hasOwnProperty(u)&&u!=="data"&&!s.bv(c[r][u],t[r][u]))return!1;for(u in t[r])if(t[r].hasOwnProperty(u)&&u!=="data"&&!s.bv(c[r][u],t[r][u]))return!1;return!0}function ka(c,t,r,u,p,m){let y;for(y in t=t||{},c=c||{})c.hasOwnProperty(y)&&(s.bv(c[y],t[y])||r.push({command:m,args:[u,y,t[y],p]}));for(y in t)t.hasOwnProperty(y)&&!c.hasOwnProperty(y)&&(s.bv(c[y],t[y])||r.push({command:m,args:[u,y,t[y],p]}))}function ia(c){return c.id}function yl(c,t){return c[t.id]=t,c}class Vp{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aD(t,0,1);let r=1,u=this._distances[r];const p=t*this.paddedLength+this.padding;for(;u<p&&r<this._distances.length;)u=this._distances[++r];const m=r-1,y=this._distances[m],v=u-y,T=v>0?(p-y)/v:0;return this.points[m].mult(1-T).add(this.points[r].mult(T))}}class _d{constructor(t,r,u){const p=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(r/u);for(let y=0;y<this.xCellCount*this.yCellCount;y++)p.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,u,p,m){this._forEachCell(r,u,p,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m)}insertCircle(t,r,u,p){this._forEachCell(r-p,u-p,r+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,r,u,p,m,y){this.boxCells[m].push(y)}_insertCircleCell(t,r,u,p,m,y){this.circleCells[m].push(y)}_query(t,r,u,p,m,y){if(u<0||t>this.width||p<0||r>this.height)return!m&&[];const v=[];if(t<=0&&r<=0&&this.width<=u&&this.height<=p){if(m)return!0;for(let T=0;T<this.boxKeys.length;T++)v.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const A=this.circles[3*T],C=this.circles[3*T+1],R=this.circles[3*T+2];v.push({key:this.circleKeys[T],x1:A-R,y1:C-R,x2:A+R,y2:C+R})}return y?v.filter(y):v}return this._forEachCell(t,r,u,p,this._queryCell,v,{hitTest:m,seenUids:{box:{},circle:{}}},y),m?v.length>0:v}_queryCircle(t,r,u,p,m){const y=t-u,v=t+u,T=r-u,A=r+u;if(v<0||y>this.width||A<0||T>this.height)return!p&&[];const C=[];return this._forEachCell(y,T,v,A,this._queryCellCircle,C,{hitTest:p,circle:{x:t,y:r,radius:u},seenUids:{box:{},circle:{}}},m),p?C.length>0:C}query(t,r,u,p,m){return this._query(t,r,u,p,!1,m)}hitTest(t,r,u,p,m){return this._query(t,r,u,p,!0,m)}hitTestCircle(t,r,u,p){return this._queryCircle(t,r,u,!0,p)}_queryCell(t,r,u,p,m,y,v,T){const A=v.seenUids,C=this.boxCells[m];if(C!==null){const P=this.bboxes;for(const L of C)if(!A.box[L]){A.box[L]=!0;const j=4*L;if(t<=P[j+2]&&r<=P[j+3]&&u>=P[j+0]&&p>=P[j+1]&&(!T||T(this.boxKeys[L]))){if(v.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[L],x1:P[j],y1:P[j+1],x2:P[j+2],y2:P[j+3]})}}}const R=this.circleCells[m];if(R!==null){const P=this.circles;for(const L of R)if(!A.circle[L]){A.circle[L]=!0;const j=3*L;if(this._circleAndRectCollide(P[j],P[j+1],P[j+2],t,r,u,p)&&(!T||T(this.circleKeys[L]))){if(v.hitTest)return y.push(!0),!0;{const V=P[j],G=P[j+1],U=P[j+2];y.push({key:this.circleKeys[L],x1:V-U,y1:G-U,x2:V+U,y2:G+U})}}}}}_queryCellCircle(t,r,u,p,m,y,v,T){const A=v.circle,C=v.seenUids,R=this.boxCells[m];if(R!==null){const L=this.bboxes;for(const j of R)if(!C.box[j]){C.box[j]=!0;const V=4*j;if(this._circleAndRectCollide(A.x,A.y,A.radius,L[V+0],L[V+1],L[V+2],L[V+3])&&(!T||T(this.boxKeys[j])))return y.push(!0),!0}}const P=this.circleCells[m];if(P!==null){const L=this.circles;for(const j of P)if(!C.circle[j]){C.circle[j]=!0;const V=3*j;if(this._circlesCollide(L[V],L[V+1],L[V+2],A.x,A.y,A.radius)&&(!T||T(this.circleKeys[j])))return y.push(!0),!0}}}_forEachCell(t,r,u,p,m,y,v,T){const A=this._convertToXCellCoord(t),C=this._convertToYCellCoord(r),R=this._convertToXCellCoord(u),P=this._convertToYCellCoord(p);for(let L=A;L<=R;L++)for(let j=C;j<=P;j++)if(m.call(this,t,r,u,p,this.xCellCount*j+L,y,v,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,u,p,m,y){const v=p-t,T=m-r,A=u+y;return A*A>v*v+T*T}_circleAndRectCollide(t,r,u,p,m,y,v){const T=(y-p)/2,A=Math.abs(t-(p+T));if(A>T+u)return!1;const C=(v-m)/2,R=Math.abs(r-(m+C));if(R>C+u)return!1;if(A<=T||R<=C)return!0;const P=A-T,L=R-C;return P*P+L*L<=u*u}}const Oa={unknown:0,flipRequired:1,flipNotRequired:2},yc=Math.tan(85*Math.PI/180);function xl(c,t,r,u,p,m,y){const v=s.bz();if(r)if(m.name==="globe"){const T=s.bA(p,t);s.az(v,v,T)}else{const T=s.bB([],y);v[0]=T[0],v[1]=T[1],v[4]=T[2],v[5]=T[3],u||s.by(v,v,p.angle)}else s.az(v,p.labelPlaneMatrix,c);return v}function Ru(c,t,r,u,p,m,y){const v=xl(c,t,r,u,p,m,y);return m.name==="globe"&&r||(v[2]=v[6]=v[10]=v[14]=0),v}function yd(c,t,r,u,p,m,y){if(r){if(m.name==="globe"){const v=xl(c,t,r,u,p,m,y);return s.bi(v,v),s.az(v,c,v),v}{const v=s.bw(c),T=s.bx([]);return T[0]=y[0],T[1]=y[1],T[4]=y[2],T[5]=y[3],s.az(v,v,T),u||s.by(v,v,-p.angle),v}}return p.glCoordMatrix}function Rs(c,t,r,u){const p=[c,t,r,1];r?s.aA(p,p,u):jp(p,p,u);const m=p[3];return p[0]/=m,p[1]/=m,p[2]/=m,p}function na(c,t){return Math.min(.5+c/t*.5,1.5)}function xd(c,t){const r=c[0]/c[3],u=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&u>=-t[1]&&u<=t[1]}function vd(c,t,r,u,p,m,y,v,T,A){const C=r.transform,R=u?c.textSizeData:c.iconSizeData,P=s.bH(R,r.transform.zoom),L=C.projection.name==="globe",j=[256/r.width*2+1,256/r.height*2+1],V=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;V.clear();let G=null;L&&(G=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const U=c.lineVertexArray,J=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,ne=r.transform.width/r.transform.height;let oe,ue=!1;for(let le=0;le<J.length;le++){const ce=J.get(le),{numGlyphs:ae,writingMode:me}=ce;if(me!==s.bI.vertical||ue||oe===s.bI.horizontal||(ue=!0),oe=me,(ce.hidden||me===s.bI.vertical)&&!ue){$i(ae,V);continue}ue=!1;const ge=new s.P(ce.tileAnchorX,ce.tileAnchorY);let{x:Me,y:Ee,z:qe}=C.projection.projectTilePoint(ge.x,ge.y,A.canonical);if(T){const[At,Ot,St]=T(ge);Me+=At,Ee+=Ot,qe+=St}const $e=[Me,Ee,qe,1];if(s.aA($e,$e,t),!xd($e,j)){$i(ae,V);continue}const ct=$e[3],Se=na(r.transform.getCameraToCenterDistance(C.projection),ct),Pe=s.bJ(R,P,ce),we=y?Pe/Se:Pe*Se,Xe=Rs(Me,Ee,qe,p);if(Xe[3]<=0){$i(ae,V);continue}let ke={};const Qe=s.al(c.layers[0].layout.get("text-max-angle")),We=Math.cos(Qe),tt=y?null:T,nt=Ds(ce,we,!1,v,t,p,m,c.glyphOffsetArray,U,V,G,Xe,ge,ke,ne,tt,C.projection,A,y,We);ue=nt.useVertical,tt&&nt.needsFlipping&&(ke={}),(nt.notEnoughRoom||ue||nt.needsFlipping&&Ds(ce,we,!0,v,t,p,m,c.glyphOffsetArray,U,V,G,Xe,ge,ke,ne,tt,C.projection,A,y,We).notEnoughRoom)&&$i(ae,V)}u?(c.text.dynamicLayoutVertexBuffer.updateData(V),G&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(G)):(c.icon.dynamicLayoutVertexBuffer.updateData(V),G&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(G))}function Du(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G){const{lineStartIndex:U,glyphStartIndex:J,segment:ne}=v,oe=J+v.numGlyphs,ue=U+v.lineLength,le=t.getoffsetX(J),ce=t.getoffsetX(oe-1),ae=xc(c*le,r,u,p,m,y,ne,U,ue,T,A,C,R,P,!0,L,j,V,G);if(!ae)return null;const me=xc(c*ce,r,u,p,m,y,ne,U,ue,T,A,C,R,P,!0,L,j,V,G);return me?{first:ae,last:me}:null}function Fa(c,t,r,u){return c===s.bI.horizontal&&Math.abs(u)>Math.abs(r)?{useVertical:!0}:c===s.bI.vertical?u>0?{needsFlipping:!0}:null:t!==Oa.unknown&&function(p,m){return p===0||Math.abs(m/p)>yc}(r,u)?t===Oa.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Ds(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J,ne){const oe=t/24,ue=c.lineOffsetX*oe,le=c.lineOffsetY*oe,{lineStartIndex:ce,glyphStartIndex:ae,numGlyphs:me,segment:ge,writingMode:Me,flipState:Ee}=c,qe=ce+c.lineLength,$e=ct=>{if(C){const[Xe,ke,Qe]=ct.up,We=A.length;s.bK(C,We+0,Xe,ke,Qe),s.bK(C,We+1,Xe,ke,Qe),s.bK(C,We+2,Xe,ke,Qe),s.bK(C,We+3,Xe,ke,Qe)}const[Se,Pe,we]=ct.point;s.bL(A,Se,Pe,we,ct.angle)};if(me>1){const ct=Du(oe,v,ue,le,r,R,P,c,T,m,L,V,!1,G,U,J,ne);if(!ct)return{notEnoughRoom:!0};if(u&&!r){let[Se,Pe,we]=ct.first.point,[Xe,ke,Qe]=ct.last.point;[Se,Pe]=Rs(Se,Pe,we,y),[Xe,ke]=Rs(Xe,ke,Qe,y);const We=Fa(Me,Ee,(Xe-Se)*j,ke-Pe);if(c.flipState=We&&We.needsFlipping?Oa.flipRequired:Oa.flipNotRequired,We)return We}$e(ct.first);for(let Se=ae+1;Se<ae+me-1;Se++){const Pe=xc(oe*v.getoffsetX(Se),ue,le,r,R,P,ge,ce,qe,T,m,L,V,!1,!1,G,U,J,ne);if(!Pe)return A.length-=4*(Se-ae),{notEnoughRoom:!0};$e(Pe)}$e(ct.last)}else{if(u&&!r){const Se=Rs(P.x,P.y,0,p),Pe=ce+ge+1,we=new s.P(T.getx(Pe),T.gety(Pe)),Xe=Rs(we.x,we.y,0,p),ke=Xe[3]>0?Xe:zu(P,we,Se,1,p,void 0,G,U.canonical),Qe=Fa(Me,Ee,(ke[0]-Se[0])*j,ke[1]-Se[1]);if(c.flipState=Qe&&Qe.needsFlipping?Oa.flipRequired:Oa.flipNotRequired,Qe)return Qe}const ct=xc(oe*v.getoffsetX(ae),ue,le,r,R,P,ge,ce,qe,T,m,L,V,!1,!1,G,U,J,ne);if(!ct)return{notEnoughRoom:!0};$e(ct)}return{}}function bd(c,t,r,u,p){const{x:m,y,z:v}=u.projectTilePoint(c.x,c.y,t);if(!p)return Rs(m,y,v,r);const[T,A,C]=p(c);return Rs(m+T,y+A,v+C,r)}function zu(c,t,r,u,p,m,y,v){const T=bd(c.sub(t)._unit()._add(c),v,p,y,m);return s.at(T,r,T),s.au(T,T),s.bF(T,r,T,u)}function xc(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J){const ne=u?c-t:c+t;let oe=ne>0?1:-1,ue=0;u&&(oe*=-1,ue=Math.PI),oe<0&&(ue+=Math.PI);let le=v+y+(oe>0?0:1)|0,ce=p,ae=p,me=0,ge=0;const Me=Math.abs(ne),Ee=[],qe=[];let $e=m,ct=$e,Se=s.bC([]);const Pe=()=>zu(ct,$e,ae,Me-me+1,C,P,V,G.canonical);for(;me+ge<=Me;){if(le+=oe,le<v||le>=T)return null;if(ae=ce,ct=$e,Ee.push(ae),L&&qe.push(ct),$e=new s.P(A.getx(le),A.gety(le)),ce=R[le],!ce){const St=bd($e,G.canonical,C,V,P);ce=St[3]>0?R[le]=St:Pe()}me+=ge;const At=s.at([],ce,ae),Ot=s.bD(ae,ce);if(r&&Ot>0&&ge>0&&s.bE(Se,At)/(ge*Ot)<J)return null;ge=Ot,Se=At}j&&P&&(R[le]&&(ce=Pe(),ge=s.bD(ae,ce),Se=s.at([],ce,ae)),R[le]=ce);const we=(Me-me)/ge,Xe=$e.sub(ct)._mult(we)._add(ct),ke=s.bF([],ae,Se,we);let Qe=[0,0,1],We=Se[0],tt=Se[1];if(U&&(Qe=V.upVector(G.canonical,Xe.x,Xe.y),Qe[0]!==0||Qe[1]!==0||Qe[2]!==1)){const At=[Qe[2],0,-Qe[0]],Ot=s.bG([],Qe,At);s.au(At,At),s.au(Ot,Ot),We=s.bE(Se,At),tt=s.bE(Se,Ot)}if(r){const At=s.bG([],Qe,Se);s.au(At,At),s.bF(ke,ke,At,r*oe)}const nt=ue+Math.atan2(tt,We);return Ee.push(ke),L&&qe.push(Xe),{point:ke,angle:nt,path:Ee,tilePath:qe,up:Qe}}function $i(c,t){const r=t.length,u=r+4*c;t.resize(u),t.float32.fill(-1/0,4*r,4*u)}function jp(c,t,r){const u=t[0],p=t[1];return c[0]=r[0]*u+r[4]*p+r[12],c[1]=r[1]*u+r[5]*p+r[13],c[3]=r[3]*u+r[7]*p+r[15],c}const Nt=100;class Up{constructor(t,r,u=new _d(t.width+200,t.height+200,25),p=new _d(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Nt,this.screenBottomBoundary=t.height+Nt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,u,p,m,y,v,T){let A=u.projectedAnchorX,C=u.projectedAnchorY,R=u.projectedAnchorZ;const P=u.elevation,L=u.tileID,j=t.getProjection();if(P&&L){const[le,ce,ae]=j.upVector(L.canonical,u.tileAnchorX,u.tileAnchorY),me=j.upVectorScale(L.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=le*P*me,C+=ce*P*me,R+=ae*P*me}const V=this.projectAndGetPerspectiveRatio(v,A,C,R,u.tileID,j.name==="globe"||!!P||this.transform.pitch>0,j),G=y*V.perspectiveRatio,U=(u.x1*r+p.x-u.padding)*G+V.point.x,J=(u.y1*r+p.y-u.padding)*G+V.point.y,ne=(u.x2*r+p.x+u.padding)*G+V.point.x,oe=(u.y2*r+p.y+u.padding)*G+V.point.y,ue=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(U,J,ne,oe)||!m&&this.grid.hitTest(U,J,ne,oe,T)||ue?{box:[],offscreen:!1,occluded:V.occluded}:{box:[U,J,ne,oe],offscreen:this.isOffscreen(U,J,ne,oe),occluded:!1}}placeCollisionCircles(t,r,u,p,m,y,v,T,A,C,R,P,L,j,V){const G=[],U=this.transform.elevation,J=t.getProjection(),ne=U?U.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,J):null,oe=new s.P(u.tileAnchorX,u.tileAnchorY);let{x:ue,y:le,z:ce}=J.projectTilePoint(oe.x,oe.y,V.canonical);if(ne){const[Qe,We,tt]=ne(oe);ue+=Qe,le+=We,ce+=tt}const ae=J.name==="globe",me=this.projectAndGetPerspectiveRatio(v,ue,le,ce,V,ae||!!U||this.transform.pitch>0,J),{perspectiveRatio:ge}=me,Me=(R?y/ge:y*ge)/s.bO,Ee=Rs(ue,le,ce,T),qe=u.lineOffsetX*Me,$e=u.lineOffsetY*Me,ct=s.al(t.layers[0].layout.get("text-max-angle")),Se=Math.cos(ct),Pe=me.signedDistanceFromCamera>0?Du(Me,m,qe,$e,!1,Ee,oe,u,p,T,{},U&&!R?ne:null,R&&!!U,J,V,R,Se):null;let we=!1,Xe=!1,ke=!0;if(Pe&&!me.occluded){const Qe=.5*L*ge+j,We=new s.P(-100,-100),tt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),nt=new Vp,{first:At,last:Ot}=Pe,St=At.path.length;let Ft=[];for(let Xt=St-1;Xt>=1;Xt--)Ft.push(At.path[Xt]);for(let Xt=1;Xt<Ot.path.length;Xt++)Ft.push(Ot.path[Xt]);const Mt=2.5*Qe;A&&(Ft=Ft.map(([Xt,mi,rn],Yi)=>(ne&&!ae&&(rn=ne(Yi<St-1?At.tilePath[St-1-Yi]:Ot.tilePath[Yi-St+2])[2]),Rs(Xt,mi,rn,A))),Ft.some(Xt=>Xt[3]<=0)&&(Ft=[]));let Ut=[];if(Ft.length>0){let Xt=1/0,mi=-1/0,rn=1/0,Yi=-1/0;for(const bi of Ft)Xt=Math.min(Xt,bi[0]),rn=Math.min(rn,bi[1]),mi=Math.max(mi,bi[0]),Yi=Math.max(Yi,bi[1]);mi>=We.x&&Xt<=tt.x&&Yi>=We.y&&rn<=tt.y&&(Ut=[Ft.map(bi=>new s.P(bi[0],bi[1]))],(Xt<We.x||mi>tt.x||rn<We.y||Yi>tt.y)&&(Ut=s.bM(Ut,We.x,We.y,tt.x,tt.y)))}for(const Xt of Ut){nt.reset(Xt,.25*Qe);let mi=0;mi=nt.length<=.5*Qe?1:Math.ceil(nt.paddedLength/Mt)+1;for(let rn=0;rn<mi;rn++){const Yi=rn/Math.max(mi-1,1),bi=nt.lerp(Yi),Vn=bi.x+Nt,Ln=bi.y+Nt;G.push(Vn,Ln,Qe,0);const Qt=Vn-Qe,Mi=Ln-Qe,Oi=Vn+Qe,sn=Ln+Qe;if(ke=ke&&this.isOffscreen(Qt,Mi,Oi,sn),Xe=Xe||this.isInsideGrid(Qt,Mi,Oi,sn),!r&&this.grid.hitTestCircle(Vn,Ln,Qe,P)&&(we=!0,!C))return{circles:[],offscreen:!1,collisionDetected:we,occluded:!1}}}}return{circles:!C&&we||!Xe?[]:G,offscreen:ke,collisionDetected:we,occluded:me.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let u=1/0,p=1/0,m=-1/0,y=-1/0;for(const C of t){const R=new s.P(C.x+Nt,C.y+Nt);u=Math.min(u,R.x),p=Math.min(p,R.y),m=Math.max(m,R.x),y=Math.max(y,R.y),r.push(R)}const v=this.grid.query(u,p,m,y).concat(this.ignoredGrid.query(u,p,m,y)),T={},A={};for(const C of v){const R=C.key;if(T[R.bucketInstanceId]===void 0&&(T[R.bucketInstanceId]={}),T[R.bucketInstanceId][R.featureIndex])continue;const P=[new s.P(C.x1,C.y1),new s.P(C.x2,C.y1),new s.P(C.x2,C.y2),new s.P(C.x1,C.y2)];s.bN(r,P)&&(T[R.bucketInstanceId][R.featureIndex]=!0,A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]=[]),A[R.bucketInstanceId].push(R.featureIndex))}return A}insertCollisionBox(t,r,u,p,m){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:m},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,u,p,m){const y=r?this.ignoredGrid:this.grid,v={bucketInstanceId:u,featureIndex:p,collisionGroupID:m};for(let T=0;T<t.length;T+=4)y.insertCircle(v,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,r,u,p,m,y,v){const T=[r,u,p,1];let A=!1;p||this.transform.pitch>0?(s.aA(T,T,t),this.fogState&&m&&v.name!=="globe"&&(A=function(P,L,j,V,G,U){const J=U.calculateFogTileMatrix(G),ne=[L,j,V];return s.ad(ne,ne,J),Lt(P,s.ae(ne),U.pitch,U._fov)}(this.fogState,r,u,p,m.toUnwrapped(),this.transform)>.9)):jp(T,T,t);const C=T[3];return{point:new s.P((T[0]/C+1)/2*this.transform.width+Nt,(-T[1]/C+1)/2*this.transform.height+Nt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/C*.5,1.5),signedDistanceFromCamera:C,occluded:y&&T[2]>C||A}}isOffscreen(t,r,u,p){return u<Nt||t>=this.screenRightBoundary||p<Nt||r>this.screenBottomBoundary}isInsideGrid(t,r,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=s.bx([]);return s.bo(t,t,[-100,-100,0]),t}}function Lu(c,t,r){const u=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return s.az(new Float32Array(16),c.projMatrix,u)}function ku(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const u=r.clone();return u.setProjection(t.projection),Lu(u,t.getProjection(),c)}function vc(c,t,r){return t.name===r.projection.name?c.projMatrix:Lu(r,t,c)}class Ks{constructor(t,r,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class Ba{constructor(t,r,u,p,m,y=!1){this.text=new Ks(t?t.text:null,r,u,m),this.icon=new Ks(t?t.icon:null,r,p,m),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ra{constructor(t,r,u,p=!1){this.text=t,this.icon=r,this.skipFade=u,this.clipped=p}}class Bt{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class ln{constructor(t,r,u,p,m){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=m}}class Ki{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:u=>u.collisionGroupID===r}}return this.collisionGroups[t]}}function Ts(c,t,r,u,p){const{horizontalAlign:m,verticalAlign:y}=s.bV(c),v=-(m-.5)*t,T=-(y-.5)*r,A=s.bU(c,u);return new s.P(v+A[0]*p,T+A[1]*p)}function sa(c,t,r,u,p){const m=new s.P(c,t);return r&&m._rotate(u?p:-p),m}class Wi{constructor(t,r,u,p,m,y){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Up(this.transform,m),this.buildingIndex=y,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Ki(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,u,p,m=1){const y=u.getBucket(r),v=u.latestFeatureIndex;if(!y||!v||r.fqid!==y.layerIds[0])return;const T=y.layers[0].layout,A=y.layers[0].paint,C=u.collisionBoxArray,R=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),P=u.tileSize/s.aj,L=u.tileID.toUnwrapped();this.transform.setProjection(y.projection);const j=(V=u.tileID,G=y.getProjection(),U=this.transform,G.name===this.projection?U.calculateProjMatrix(V.toUnwrapped()):Lu(U,G,V));var V,G,U;const J=T.get("text-pitch-alignment")==="map",ne=T.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const oe=r.dynamicFilter(),ue=r.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(u),ce=Ru(j,u.tileID.canonical,J,ne,this.transform,y.getProjection(),le);let ae=null;if(J){const Pe=yd(j,u.tileID.canonical,J,ne,this.transform,y.getProjection(),le);ae=s.az([],this.transform.labelPlaneMatrix,Pe)}let me=null;oe&&u.latestFeatureIndex&&(me={unwrappedTileID:L,dynamicFilter:oe,dynamicFilterNeedsFeature:ue}),this.retainedQueryData[y.bucketInstanceId]=new ln(y.bucketInstanceId,v,y.sourceLayerIndex,y.index,u.tileID);const[ge,Me]=y.layers[0].layout.get("text-size-scale-range"),Ee=s.aD(m,ge,Me),[qe,$e]=T.get("icon-size-scale-range"),ct=s.aD(m,qe,$e),Se={bucket:y,layout:T,paint:A,posMatrix:j,textLabelPlaneMatrix:ce,labelToScreenMatrix:ae,clippingData:me,scale:R,textPixelRatio:P,holdingForFade:u.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:s.bH(y.textSizeData,this.transform.zoom,Ee),partiallyEvaluatedIconSize:s.bH(y.iconSizeData,this.transform.zoom,ct),collisionGroup:this.collisionGroups.get(y.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const Pe of y.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Xe,symbolInstanceEnd:ke}=Pe;t.push({sortKey:we,symbolInstanceStart:Xe,symbolInstanceEnd:ke,parameters:Se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J){const{textOffset0:ne,textOffset1:oe,crossTileID:ue}=P,le=[ne,oe],ce=Ts(t,u,p,le,m),ae=this.collisionIndex.placeCollisionBox(j,m,r,sa(ce.x,ce.y,y,v,this.transform.angle),R,T,A,C.predicate);if(G){const me=j.getSymbolInstanceIconSize(J,this.transform.zoom,P.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,me,G,sa(ce.x,ce.y,y,v,this.transform.angle),R,T,A,C.predicate).box.length===0)return}if(ae.box.length>0){let me;return this.prevPlacement&&this.prevPlacement.variableOffsets[ue]&&this.prevPlacement.placements[ue]&&this.prevPlacement.placements[ue].text&&(me=this.prevPlacement.variableOffsets[ue].anchor),this.variableOffsets[ue]={textOffset:le,width:u,height:p,anchor:t,textScale:m,prevAnchor:me},this.markUsedJustification(j,t,P,V),j.allowVerticalPlacement&&(this.markUsedOrientation(j,V,P),this.placedOrientations[ue]=V),{shift:ce,placedGlyphBoxes:ae}}}placeLayerBucketPart(t,r,u,p,m=1){const{bucket:y,layout:v,paint:T,posMatrix:A,textLabelPlaneMatrix:C,labelToScreenMatrix:R,clippingData:P,textPixelRatio:L,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:U,collisionGroup:J,latestFeatureIndex:ne}=t.parameters,oe=v.get("text-optional"),ue=v.get("icon-optional"),le=v.get("text-allow-overlap"),ce=v.get("icon-allow-overlap"),ae=v.get("text-rotation-alignment")==="map",me=v.get("text-pitch-alignment")==="map",ge=T.get("symbol-z-offset"),Me=v.get("symbol-elevation-reference")==="sea",[Ee,qe]=v.get("text-size-scale-range"),[$e,ct]=v.get("icon-size-scale-range"),Se=s.aD(m,Ee,qe),Pe=s.aD(m,$e,ct);this.transform.setProjection(y.projection);let we=le&&(ce||!y.hasIconData()||ue),Xe=ce&&(le||!y.hasTextData()||oe);const ke=!ge.isConstant();!y.collisionArrays&&V&&y.deserializeCollisionBoxes(V),u&&p&&y.updateCollisionDebugBuffers(this.transform.zoom,V,Se,Pe);const Qe=(We,tt,nt)=>{const{crossTileID:At,numVerticalGlyphVertices:Ot}=We;let St=null;if(P&&P.dynamicFilterNeedsFeature||ke){const Li=this.retainedQueryData[y.bucketInstanceId];St=ne.loadFeature({featureIndex:We.featureIndex,bucketIndex:Li.bucketIndex,sourceLayerIndex:Li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(P&&!(0,P.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},St,this.retainedQueryData[y.bucketInstanceId].tileID.canonical,new s.P(We.tileAnchorX,We.tileAnchorY),this.transform.calculateDistanceTileData(P.unwrappedTileID)))return this.placements[At]=new ra(!1,!1,!1,!0),void r.add(At);const Ft=ge.evaluate(St,{});if(r.has(At))return;if(j)return void(this.placements[At]=new ra(!1,!1,!1));let Mt=!1,Ut=!1,Xt=!0,mi=!1,rn=!1,Yi=null,bi={box:null,offscreen:null,occluded:null},Vn={box:null},Ln=null,Qt=null,Mi=null,Oi=0,sn=0,ur=0;nt.textFeatureIndex?Oi=nt.textFeatureIndex:We.useRuntimeCollisionCircles&&(Oi=We.featureIndex),nt.verticalTextFeatureIndex&&(sn=nt.verticalTextFeatureIndex);const Gn=Li=>{Li.tileID=this.retainedQueryData[y.bucketInstanceId].tileID;const An=this.transform.elevation;Li.elevation=Me?Ft:Ft+(An?An.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0),Li.elevation+=We.zOffset},ar=nt.textBox;if(ar){Gn(ar);const Li=Gi=>{let Dn=s.bI.horizontal;if(y.allowVerticalPlacement&&!Gi&&this.prevPlacement){const Ir=this.prevPlacement.placedOrientations[At];Ir&&(this.placedOrientations[At]=Ir,Dn=Ir,this.markUsedOrientation(y,Dn,We))}return Dn},An=(Gi,Dn)=>{if(y.allowVerticalPlacement&&Ot>0&&nt.verticalTextBox){for(const Ir of y.writingModes)if(Ir===s.bI.vertical?(bi=Dn(),Vn=bi):bi=Gi(),bi&&bi.box&&bi.box.length)break}else bi=Gi()};if(v.get("text-variable-anchor")){let Gi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[At]){const yn=this.prevPlacement.variableOffsets[At];Gi.indexOf(yn.anchor)>0&&(Gi=Gi.filter(Lr=>Lr!==yn.anchor),Gi.unshift(yn.anchor))}const Dn=(yn,Lr,ir)=>{const $r=y.getSymbolInstanceTextSize(G,We,this.transform.zoom,tt),yo=(yn.x2-yn.x1)*$r+2*yn.padding,Zo=(yn.y2-yn.y1)*$r+2*yn.padding,Ls=We.hasIconTextFit&&!ce?Lr:null;Ls&&Gn(Ls);let to={box:[],offscreen:!1,occluded:!1};const Mo=le?2*Gi.length:Gi.length;for(let Po=0;Po<Mo;++Po){const xo=this.attemptAnchorPlacement(Gi[Po%Gi.length],yn,yo,Zo,$r,ae,me,L,A,J,Po>=Gi.length,We,tt,y,ir,Ls,G,U);if(xo&&(to=xo.placedGlyphBoxes,to&&to.box&&to.box.length)){Mt=!0,Yi=xo.shift;break}}return to};An(()=>Dn(ar,nt.iconBox,s.bI.horizontal),()=>{const yn=nt.verticalTextBox;return yn&&Gn(yn),y.allowVerticalPlacement&&!(bi&&bi.box&&bi.box.length)&&Ot>0&&yn?Dn(yn,nt.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),bi&&(Mt=bi.box,Xt=bi.offscreen,mi=bi.occluded);const Ir=Li(!(!bi||!bi.box));if(!Mt&&this.prevPlacement){const yn=this.prevPlacement.variableOffsets[At];yn&&(this.variableOffsets[At]=yn,this.markUsedJustification(y,yn.anchor,We,Ir))}}else{const Gi=(Dn,Ir)=>{const yn=y.getSymbolInstanceTextSize(G,We,this.transform.zoom,tt,m),Lr=this.collisionIndex.placeCollisionBox(y,yn,Dn,new s.P(0,0),le,L,A,J.predicate);return Lr&&Lr.box&&Lr.box.length&&(this.markUsedOrientation(y,Ir,We),this.placedOrientations[At]=Ir),Lr};An(()=>Gi(ar,s.bI.horizontal),()=>{const Dn=nt.verticalTextBox;return y.allowVerticalPlacement&&Ot>0&&Dn?(Gn(Dn),Gi(Dn,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Li(!!(bi&&bi.box&&bi.box.length))}}if(Ln=bi,Mt=Ln&&Ln.box&&Ln.box.length>0,Xt=Ln&&Ln.offscreen,mi=Ln&&Ln.occluded,We.useRuntimeCollisionCircles){const Li=y.text.placedSymbolArray.get(We.centerJustifiedTextSymbolIndex>=0?We.centerJustifiedTextSymbolIndex:We.verticalPlacedTextSymbolIndex),An=s.bJ(y.textSizeData,G,Li),Gi=v.get("text-padding");Qt=this.collisionIndex.placeCollisionCircles(y,le,Li,y.lineVertexArray,y.glyphOffsetArray,An,A,C,R,u,me,J.predicate,We.collisionCircleDiameter*An/s.bO,Gi,this.retainedQueryData[y.bucketInstanceId].tileID),Mt=le||Qt.circles.length>0&&!Qt.collisionDetected,Xt=Xt&&Qt.offscreen,mi=Qt.occluded}if(nt.iconFeatureIndex&&(ur=nt.iconFeatureIndex),nt.iconBox){const Li=An=>{Gn(An);const Gi=We.hasIconTextFit&&Yi?sa(Yi.x,Yi.y,ae,me,this.transform.angle):new s.P(0,0),Dn=y.getSymbolInstanceIconSize(U,this.transform.zoom,We.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(y,Dn,An,Gi,ce,L,A,J.predicate)};Vn&&Vn.box&&Vn.box.length&&nt.verticalIconBox?(Mi=Li(nt.verticalIconBox),Ut=Mi.box.length>0):(Mi=Li(nt.iconBox),Ut=Mi.box.length>0),Xt=Xt&&Mi.offscreen,rn=Mi.occluded}const Rn=oe||We.numHorizontalGlyphVertices===0&&Ot===0,ri=ue||We.numIconVertices===0;if(Rn||ri?ri?Rn||(Ut=Ut&&Mt):Mt=Ut&&Mt:Ut=Mt=Ut&&Mt,Mt&&Ln&&Ln.box&&this.collisionIndex.insertCollisionBox(Ln.box,v.get("text-ignore-placement"),y.bucketInstanceId,Vn&&Vn.box&&sn?sn:Oi,J.ID),Ut&&Mi&&this.collisionIndex.insertCollisionBox(Mi.box,v.get("icon-ignore-placement"),y.bucketInstanceId,ur,J.ID),Qt&&(Mt&&this.collisionIndex.insertCollisionCircles(Qt.circles,v.get("text-ignore-placement"),y.bucketInstanceId,Oi,J.ID),u)){const Li=y.bucketInstanceId;let An=this.collisionCircleArrays[Li];An===void 0&&(An=this.collisionCircleArrays[Li]=new Bt);for(let Gi=0;Gi<Qt.circles.length;Gi+=4)An.circles.push(Qt.circles[Gi+0]),An.circles.push(Qt.circles[Gi+1]),An.circles.push(Qt.circles[Gi+2]),An.circles.push(Qt.collisionDetected?1:0)}const En=y.projection.name!=="globe";we=we&&(En||!mi),Xe=Xe&&(En||!rn),this.placements[At]=new ra(Mt||we,Ut||Xe,Xt||y.justReloaded),r.add(At)};if(y.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(y,this.retainedQueryData[y.bucketInstanceId].tileID),y.elevationType==="road"&&y.updateRoadElevation(),y.updateZOffset(),y.sortFeaturesByY){const We=y.getSortedSymbolIndexes(this.transform.angle);for(let tt=We.length-1;tt>=0;--tt){const nt=We[tt];Qe(y.symbolInstances.get(nt),nt,y.collisionArrays[nt])}y.hasAnyZOffset&&s.w(`${y.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(y.hasAnyZOffset){const We=y.getSortedIndexesByZOffset();for(let tt=0;tt<We.length;++tt){const nt=We[tt];Qe(y.symbolInstances.get(nt),nt,y.collisionArrays[nt])}}else for(let We=t.symbolInstanceStart;We<t.symbolInstanceEnd;We++)Qe(y.symbolInstances.get(We),We,y.collisionArrays[We]);if(u&&y.bucketInstanceId in this.collisionCircleArrays){const We=this.collisionCircleArrays[y.bucketInstanceId];s.bi(We.invProjMatrix,A),We.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}markUsedJustification(t,r,u,p){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:T,crossTileID:A}=u,C=s.bT(r),R=p===s.bI.vertical?T:C==="left"?m:C==="center"?y:C==="right"?v:-1;m>=0&&(t.text.placedSymbolArray.get(m).crossTileID=R>=0&&m!==R?0:A),y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=R>=0&&y!==R?0:A),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=R>=0&&v!==R?0:A),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=R>=0&&T!==R?0:A)}markUsedOrientation(t,r,u){const p=r===s.bI.horizontal||r===s.bI.horizontalOnly?r:0,m=r===s.bI.vertical?r:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:A}=u,C=t.text.placedSymbolArray;y>=0&&(C.get(y).placedOrientation=p),v>=0&&(C.get(v).placedOrientation=p),T>=0&&(C.get(T).placedOrientation=p),A>=0&&(C.get(A).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let u=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(t):1,m=r?r.opacities:{},y=r?r.variableOffsets:{},v=r?r.placedOrientations:{};for(const T in this.placements){const A=this.placements[T],C=m[T];C?(this.opacities[T]=new Ba(C,p,A.text,A.icon,null,A.clipped),u=u||A.text!==C.text.placed||A.icon!==C.icon.placed):(this.opacities[T]=new Ba(null,p,A.text,A.icon,A.skipFade,A.clipped),u=u||A.text||A.icon)}for(const T in m){const A=m[T];if(!this.opacities[T]){const C=new Ba(A,p,!1,!1);C.isHidden()||(this.opacities[T]=C,u=u||A.text.placed||A.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in v)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=v[T]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,u,p){const m=new Set;for(const y of r){const v=y.getBucket(t);v&&y.latestFeatureIndex&&t.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,m,y,y.collisionBoxArray,u,p,y.tileID,t.scope),v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,y.tileID),v.elevationType==="road"&&v.updateRoadElevation(),v.updateZOffset())}}updateBucketOpacities(t,r,u,p,m,y,v,T){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const A=t.layers[0].layout,C=t.layers[0].paint,R=!!t.layers[0].dynamicFilter(),P=new Ba(null,0,!1,!1,!0),L=A.get("text-allow-overlap"),j=A.get("icon-allow-overlap"),V=A.get("text-variable-anchor"),G=A.get("text-rotation-alignment")==="map",U=A.get("text-pitch-alignment")==="map",J=C.get("symbol-z-offset"),ne=A.get("symbol-elevation-reference")==="sea",oe=!J.isConstant(),ue=new Ba(null,0,L&&(j||!t.hasIconData()||A.get("icon-optional")),j&&(L||!t.hasTextData()||A.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const le=(ae,me,ge)=>{for(let Me=0;Me<me/4;Me++)ae.opacityVertexArray.emplaceBack(ge)};let ce=0;y&&t.updateReplacement(v,y);for(let ae=0;ae<t.symbolInstances.length;ae++){const me=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:Me,crossTileID:Ee,numIconVertices:qe,tileAnchorX:$e,tileAnchorY:ct}=me;let Se=null;const Pe=this.retainedQueryData[t.bucketInstanceId];oe&&me&&Pe&&(Se=u.latestFeatureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:Pe.bucketIndex,sourceLayerIndex:Pe.sourceLayerIndex,layoutVertexArrayOffset:0}));const we=J.evaluate(Se,{}),Xe=r.has(Ee);let ke=this.opacities[Ee];Xe?ke=P:ke||(ke=ue,this.opacities[Ee]=ke),r.add(Ee);const Qe=ge>0||Me>0,We=qe>0,tt=this.placedOrientations[Ee],nt=tt===s.bI.vertical,At=tt===s.bI.horizontal||tt===s.bI.horizontalOnly;!Qe&&!We||ke.isHidden()||ce++;let Ot=!1;if((Qe||We)&&y)for(const St of t.activeReplacements){if(s.bP(St,m,s.bQ.Symbol,T)||St.min.x>$e||$e>St.max.x||St.min.y>ct||ct>St.max.y)continue;const Ft=s.bR($e,ct,v.canonical,St.footprintTileId.canonical);if(Ot=s.bS(Ft,St.footprint),Ot)break}if(Qe){const St=Ot?oa:vl(ke.text);le(t.text,ge,nt?oa:St),le(t.text,Me,At?oa:St);const Ft=ke.text.isHidden(),{leftJustifiedTextSymbolIndex:Mt,centerJustifiedTextSymbolIndex:Ut,rightJustifiedTextSymbolIndex:Xt,verticalPlacedTextSymbolIndex:mi}=me,rn=t.text.placedSymbolArray,Yi=Ft||nt?1:0;Mt>=0&&(rn.get(Mt).hidden=Yi),Ut>=0&&(rn.get(Ut).hidden=Yi),Xt>=0&&(rn.get(Xt).hidden=Yi),mi>=0&&(rn.get(mi).hidden=Ft||At?1:0);const bi=this.variableOffsets[Ee];bi&&this.markUsedJustification(t,bi.anchor,me,tt);const Vn=this.placedOrientations[Ee];Vn&&(this.markUsedJustification(t,"left",me,Vn),this.markUsedOrientation(t,Vn,me))}if(We){const St=Ot?oa:vl(ke.icon),{placedIconSymbolIndex:Ft,verticalPlacedIconSymbolIndex:Mt}=me,Ut=t.icon.placedSymbolArray,Xt=ke.icon.isHidden()?1:0;Ft>=0&&(le(t.icon,qe,nt?oa:St),Ut.get(Ft).hidden=Xt),Mt>=0&&(le(t.icon,me.numVerticalIconVertices,At?oa:St),Ut.get(Mt).hidden=Xt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const St=t.collisionArrays[ae];if(St){let Ft=new s.P(0,0),Mt=!0;if(St.textBox||St.verticalTextBox){if(V){const Xt=this.variableOffsets[Ee];Xt?(Ft=Ts(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textScale),G&&Ft._rotate(U?this.transform.angle:-this.transform.angle)):Mt=!1}R&&(Mt=!ke.clipped),St.textBox&&Na(t.textCollisionBox.collisionVertexArray,ke.text.placed,!Mt||nt,we,ne,Ft.x,Ft.y),St.verticalTextBox&&Na(t.textCollisionBox.collisionVertexArray,ke.text.placed,!Mt||At,we,ne,Ft.x,Ft.y)}const Ut=Mt&&!!(!At&&St.verticalIconBox);St.iconBox&&Na(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,Ut,we,ne,me.hasIconTextFit?Ft.x:0,me.hasIconTextFit?Ft.y:0),St.verticalIconBox&&Na(t.iconCollisionBox.collisionVertexArray,ke.icon.placed,!Ut,we,ne,me.hasIconTextFit?Ft.x:0,me.hasIconTextFit?Ft.y:0)}}}if(t.fullyClipped=ce===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ae.invProjMatrix,t.placementViewportMatrix=ae.viewportMatrix,t.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const u=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Na(c,t,r,u,p,m,y){c.emplaceBack(t?1:0,r?1:0,m||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,m||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,m||0,y||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,m||0,y||0,u,p?1:0)}const bc=Math.pow(2,25),wc=Math.pow(2,24),ds=Math.pow(2,17),mr=Math.pow(2,16),U_=Math.pow(2,9),Tc=Math.pow(2,8),wd=Math.pow(2,1);function vl(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*bc+t*wc+r*ds+t*mr+r*U_+t*Tc+r*wd+t}const oa=0;class Ou{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,u,p,m,y){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(v,p,t[this._currentTileIndex],this._sortAcrossTiles,y),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((T,A)=>T.sortKey-A.sortKey));this._currentPartIndex<v.length;){const T=v[this._currentPartIndex];if(r.placeLayerBucketPart(T,this._seenCrossTileIDs,u,T.symbolInstanceStart===0,y),this._currentPartIndex++,m())return!0}return!1}}class fs{constructor(t,r,u,p,m,y,v,T,A){this.placement=new Wi(t,m,y,v,T,A),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,u,p,m){const y=s.q.now(),v=()=>{const T=s.q.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=r[t[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=A)&&(!T.maxzoom||T.maxzoom>A)){const C=T,R=C.layout.get("symbol-z-elevate"),P=C.layout.get("symbol-sort-key").constantOr(1)!==void 0,L=C.layout.get("symbol-z-order"),j=L==="viewport-y"||L==="auto"&&!(L!=="viewport-y"&&P),V=C.layout.get("text-allow-overlap")||C.layout.get("icon-allow-overlap")||C.layout.get("text-ignore-placement")||C.layout.get("icon-ignore-placement"),G=j&&V,U=this._inProgressLayer=this._inProgressLayer||new Ou(C),J=s.C(T.source,T.scope);if(U.continuePlacement(R||G?p[J]:u[J],this.placement,this._showCollisionBoxes,T,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ho=512/s.aj/2;class Ss{constructor(t,r,u){this.tileID=t,this.bucketInstanceId=u,this.index=new s.bW(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*s.aj,m=t.canonical.y*s.aj;for(let y=0;y<r.length;y++){const{key:v,crossTileID:T,tileAnchorX:A,tileAnchorY:C}=r.get(y),R=Math.floor((p+A)*ho),P=Math.floor((m+C)*ho);this.index.add(R,P),this.keys.push(v),this.crossTileIDs.push(T)}this.index.finish()}findMatches(t,r,u){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),m=ho/Math.pow(2,r.canonical.z-this.tileID.canonical.z),y=r.canonical.x*s.aj,v=r.canonical.y*s.aj;for(let T=0;T<t.length;T++){const A=t.get(T);if(A.crossTileID)continue;const{key:C,tileAnchorX:R,tileAnchorY:P}=A,L=Math.floor((y+R)*m),j=Math.floor((v+P)*m),V=this.index.range(L-p,j-p,L+p,j+p).sort((G,U)=>G-U);for(const G of V){const U=this.crossTileIDs[G];if(this.keys[G]===C&&!u.has(U)){u.add(U),A.crossTileID=U;break}}}}}class $p{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const u in this.indexes){const p=this.indexes[u],m={};for(const y in p){const v=p[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+r),m[v.tileID.key]=v}this.indexes[u]=m}this.lng=t}addBucket(t,r,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<r.symbolInstances.length;m++)r.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>t.overscaledZ)for(const v in y){const T=y[v];T.tileID.isChildOf(t)&&T.findMatches(r.symbolInstances,t,p)}else{const v=y[t.scaledTo(Number(m)).key];v&&v.findMatches(r.symbolInstances,t,p)}}for(let m=0;m<r.symbolInstances.length;m++){const y=r.symbolInstances.get(m);y.crossTileID||(y.crossTileID=u.generate(),p.add(y.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ss(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const u of r.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let r=!1;for(const u in this.indexes){const p=this.indexes[u];for(const m in p)t[p[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[m]),delete p[m],r=!0)}return r}}class br{constructor(){this.layerIndexes={},this.crossTileIDs=new $p,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,u,p){let m=this.layerIndexes[t.fqid];m===void 0&&(m=this.layerIndexes[t.fqid]=new bl);let y=!1;const v={};p.name!=="globe"&&m.handleWrapJump(u);for(const T of r){const A=T.getBucket(t);A&&t.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(T.tileID,A,this.crossTileIDs)&&(y=!0),v[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(v)&&(y=!0),y}pruneUnusedLayers(t){const r={};t.forEach(u=>{r[u]=!0});for(const u in this.layerIndexes)r[u]||delete this.layerIndexes[u]}}const ps=771;class ci{constructor(t,r,u,p){this.blendFunction=t,this.blendColor=r,this.mask=u,this.blendEquation=p}}ci.Replace=[1,0,1,0],ci.disabled=new ci(ci.Replace,s.am.transparent,[!1,!1,!1,!1]),ci.unblended=new ci(ci.Replace,s.am.transparent,[!0,!0,!0,!0]),ci.alphaBlended=new ci([1,ps,1,ps],s.am.transparent,[!0,!0,!0,!0]),ci.alphaBlendedNonPremultiplied=new ci([770,ps,770,ps],s.am.transparent,[!0,!0,!0,!0]),ci.multiply=new ci([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class It{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);const Sc=7680;class qt{constructor(t,r,u,p,m,y){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=m,this.pass=y}}qt.disabled=new qt({func:519,mask:0},0,0,Sc,Sc,Sc);const Va=1029,wl=2305;class Wt{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}function Gp(c,t){const r=s.c1(c,3);s.c3(c,t),s.c7(c,3,r)}function fo(c,t){const r=s.bY([]);return s.bZ(r,r,-t),s.b_(r,r,-c),r}function Hp(c,t){const r=[c[0],c[1],0],u=[t[0],t[1],0];if(s.ae(r)>=1e-15){const y=s.au([],r);s.b$(u,y,s.bE(u,y)),t[0]=u[0],t[1]=u[1]}const p=s.bG([],t,c);if(s.c0(p)<1e-15)return null;const m=Math.atan2(-p[1],p[0]);return fo(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),m)}Wt.disabled=new Wt(!1,Va,wl),Wt.backCCW=new Wt(!0,Va,wl),Wt.backCW=new Wt(!0,Va,2304),Wt.frontCW=new Wt(!0,1028,2304),Wt.frontCCW=new Wt(!0,1028,wl);class Fu{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=s.bX(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,m=s.ac.fromLngLat(t,p),y=[m.x-u.x,m.y-u.y,m.z-u.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=Hp(y,r)}setPitchBearing(t,r){this.orientation=fo(s.al(t),s.al(-r))}}class as{constructor(t,r){this._transform=s.bx([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&s.c7(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.bY([]),t&&Gp(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=fo(t,r),Gp(this._transform,this._orientation)}forward(){const t=s.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const u=new Float64Array(16);return s.bi(u,this.getWorldToCamera(t,r)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,u){const p=this.position;s.b$(p,p,-t);const m=new Float64Array(16);return s.bn(m,[u,u,u]),s.bo(m,m,p),m[10]*=r,m}getWorldToCamera(t,r){const u=new Float64Array(16),p=new Float64Array(4),m=this.position;return s.c2(p,this._orientation),s.b$(m,m,-t),s.c3(u,p),s.bo(u,u,m),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=r,u[9]*=r,u[10]*=r,u[11]*=r,u}getCameraToClipPerspective(t,r,u,p){const m=new Float64Array(16);return s.c4(m,t,r,u,p),m}getCameraToClipOrthographic(t,r,u,p,m,y){const v=new Float64Array(16);return s.c5(v,t,r,u,p,m,y),v}getDistanceToElevation(t,r=!1){const u=t===0?0:s.c6(t,r?s.aY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new as([...this.position],[...this.orientation])}}const ms={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Tl{constructor(t=0,r=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=u,this.right=p}interpolate(t,r,u){return r.top!=null&&t.top!=null&&(this.top=s.ai(t.top,r.top,u)),r.bottom!=null&&t.bottom!=null&&(this.bottom=s.ai(t.bottom,r.bottom,u)),r.left!=null&&t.left!=null&&(this.left=s.ai(t.left,r.left,u)),r.right!=null&&t.right!=null&&(this.right=s.ai(t.right,r.right,u)),this}getCenter(t,r){const u=s.aD((this.left+t-this.right)/2,0,t),p=s.aD((this.top+r-this.bottom)/2,0,r);return new s.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Tl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const aa=15;class ja{constructor(t,r,u,p,m,y,v){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(y),this.setMaxBounds(v),this.width=0,this.height=0,this._center=new s.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Tl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new as,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new ja(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<aa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=s.ce(this.projectionOptions);const u=this.getProjection(),p=!s.bv(r,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.ce({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=s.cf(),s.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=s.aD(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,m=0;for(let y=0;y<r.length;y++){const v=new s.P(r[y][0]*this.width,u+r[y][1]*(this.height-u)),T=t.pointCoordinate(v);if(!T)continue;const A=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);p+=T[3]*A,m+=A}return m===0?NaN:p/m}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*r,p=this._mercatorZfromZoom(t),m=this._mercatorZfromZoom(this._maxZoom),y=Math.max(p-u,m);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const p=s.ae(s.at([],this._camera.position,u));return s.aD(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!s.ch(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];s.ci(u,this._camera.position)||(this._setCameraPosition(u),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Fu;return r.position=new s.ac(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!s.cj(t))return!1;s.ck(t,t);const r=s.cl([],[0,0,-1],t),u=s.cl([],[0,-1,0],t);if(u[2]<0)return!1;const p=Hp(r,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=s.aD(t[2],p/u,p/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,u){this._unmodified=!1,this._edgeInsets.interpolate(t,r,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new s.cm(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),p=this.pointCoordinate(new s.P(this.width,0)),m=this.pointCoordinate(new s.P(this.width,this.height)),y=this.pointCoordinate(new s.P(0,this.height)),v=Math.floor(Math.min(u.x,p.x,m.x,y.x)),T=Math.floor(Math.max(u.x,p.x,m.x,y.x)),A=1;for(let C=v-A;C<=T+A;C++)C!==0&&r.push(new s.cm(C,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,u){let p=[];const m=u!=null,y=!m;if(y&&this.zoom<r||m&&u[0]===0&&u[1]===0)return p;const v=new Set,T=(C,R,P,L,j)=>{const V=s.cK(R,C,P,L,j);v.has(V)||(p.push(new s.aM(C,R,P,L,j)),v.add(V))};for(let C=0;C<t.length;C++){const R=t[C];if(y&&R.canonical.z!==r)continue;const P=R.canonical,L=R.overscaledZ,j=R.wrap,V=1<<P.z,G=P.x+1<V,U=P.x>0,J=P.y+1<V,ne=P.y>0,oe=R.wrap-(U?0:1),ue=R.wrap+(G?0:1),le=U?P.x-1:V-1,ce=G?P.x+1:0;if(m)u[0]<0?(T(L,ue,P.z,ce,P.y),u[1]<0&&J&&(T(L,j,P.z,P.x,P.y+1),T(L,ue,P.z,ce,P.y+1)),u[1]>0&&ne&&(T(L,j,P.z,P.x,P.y-1),T(L,ue,P.z,ce,P.y-1))):u[0]>0?(T(L,oe,P.z,le,P.y),u[1]<0&&J&&(T(L,j,P.z,P.x,P.y+1),T(L,oe,P.z,le,P.y+1)),u[1]>0&&ne&&(T(L,j,P.z,P.x,P.y-1),T(L,oe,P.z,le,P.y-1))):u[1]<0&&J?T(L,j,P.z,P.x,P.y+1):ne&&T(L,j,P.z,P.x,P.y-1);else{const ae=R.visibleQuadrants;1&ae&&(T(L,oe,P.z,le,P.y),ne&&(T(L,j,P.z,P.x,P.y-1),T(L,oe,P.z,le,P.y-1))),2&ae&&(T(L,ue,P.z,ce,P.y),ne&&(T(L,j,P.z,P.x,P.y-1),T(L,ue,P.z,ce,P.y-1))),4&ae&&(T(L,oe,P.z,le,P.y),J&&(T(L,j,P.z,P.x,P.y+1),T(L,oe,P.z,le,P.y+1))),8&ae&&(T(L,ue,P.z,ce,P.y),J&&(T(L,j,P.z,P.x,P.y+1),T(L,ue,P.z,ce,P.y+1)))}}const A=[];for(const C of p)p.some(R=>C.isChildOf(R))||A.push(C);if(p=A.filter(C=>!t.some(R=>!!(C.overscaledZ<r&&R.isChildOf(C))||C.equals(R)||C.isChildOf(R))),y){const C=1<<r,R=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),P=[C*R.x,C*R.y],L=4,j=L*L;p=p.filter(V=>{const G=V.canonical.x+.5-P[0],U=V.canonical.y+.5-P[1];return G*G+U*U<j})}return p}coveringTiles(t){let r=this.coveringZoomLevel(t);const u=r,p=this.elevation&&this.elevation.exaggeration(),m=p&&!t.isTerrainDEM,y=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const v=this.locationCoordinate(this.center),T=this.center.lat,A=1<<r,C=[A*v.x,A*v.y,0],R=this.projection.name==="globe",P=!R,L=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,P),j=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=A*s.c6(1,this.center.lat),G=this._camera.position[2]/s.c6(1,this.center.lat),U=[A*j.x,A*j.y,G*(P?1:V)],J=R||p,ne=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),oe=this.isLODDisabled(!0)?r:0;let ue;if(this._elevation&&t.isTerrainDEM)ue=1e4*this._elevation.exaggeration();else if(this._elevation){const we=this._elevation.getMinMaxForVisibleTiles();ue=we?we.max:this._centerAltitude}else ue=this._centerAltitude;const le=t.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,ce=this.projection.isReprojectedInTileSpace?s.co(this):1,ae=we=>{const ke=new s.ac(we.x+25e-6,we.y,we.z),Qe=new s.ac(we.x,we.y+25e-6,we.z),We=we.toLngLat(),tt=ke.toLngLat(),nt=Qe.toLngLat(),At=this.locationCoordinate(We),Ot=this.locationCoordinate(tt),St=this.locationCoordinate(nt),Ft=Math.hypot(Ot.x-At.x,Ot.y-At.y),Mt=Math.hypot(St.x-At.x,St.y-At.y);return Math.sqrt(Ft*Mt)*ce/25e-6},me=we=>{const Xe=ue,ke=le;return{aabb:s.cr(this,A,0,0,0,we,ke,Xe,this.projection),zoom:0,x:0,y:0,minZ:ke,maxZ:Xe,wrap:we,fullyVisible:!1}},ge=[];let Me=[];const Ee=r,qe=t.reparseOverscaled?u:r,$e=(G-this._centerAltitude)*V,ct=we=>{if(!this._elevation||!we.tileID||!y)return;const Xe=this._elevation.getMinMaxForTile(we.tileID),ke=we.aabb;Xe?(ke.min[2]=Xe.min,ke.max[2]=Xe.max,ke.center[2]=(ke.min[2]+ke.max[2])/2):(we.shouldSplit=Pe(we),we.shouldSplit||(ke.min[2]=ke.max[2]=ke.center[2]=this._centerAltitude))},Se=(we,Xe)=>{if(.707*Xe<we)return 1;const ke=Xe/we;return ke/(1.4144271570014144+(Math.pow(1.1,ke-1.4144271570014144+1)-1)/(1.1-1)-1)},Pe=we=>{if(we.zoom<oe)return!0;if(we.zoom===Ee)return!1;if(we.shouldSplit!=null)return we.shouldSplit;const Xe=we.aabb.distanceX(U),ke=we.aabb.distanceY(U);let Qe=$e,We=1;if(R){Qe=we.aabb.distanceZ(U);const Mt=Math.pow(2,we.zoom),Ut=s.aY((we.y+1)/Mt),Xt=s.aY(we.y/Mt),mi=Math.min(Math.max(T,Ut),Xt),rn=s.cP(mi)/s.cP(T);if(We=mi===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,rn/this._mercatorScaleRatio),this.zoom<=s.cL&&we.zoom===Ee-1&&rn>=.9)return!0}else if(m&&(Qe=we.aabb.distanceZ(U)*V),this.projection.isReprojectedInTileSpace&&u<=5){const Mt=Math.pow(2,we.zoom),Ut=ae(new s.ac((we.x+.5)/Mt,(we.y+.5)/Mt));We=Ut>.85?1:Ut}if(!y){const Mt=Math.sqrt(Xe*Xe+ke*ke+Qe*Qe);let Ut=(1<<Ee-we.zoom)*ne*We;return Ut*=Se(Math.max(Qe,$e),Mt),Mt<Ut}let tt=Number.MAX_VALUE,nt=0;const At=we.aabb.getCorners(),Ot=[];for(const Mt of At){s.at(Ot,Mt,U),R||(m?Ot[2]*=V:Ot[2]=$e);const Ut=s.bE(Ot,this._camera.forward());Ut<tt&&(tt=Ut,nt=Math.abs(Ot[2]))}let St=(1<<Ee-we.zoom)*ne*We;if(St*=Se(Math.max(nt,$e),tt),tt<St)return!0;const Ft=we.aabb.closestPoint(C);return Ft[0]===C[0]&&Ft[1]===C[1]};if(this.renderWorldCopies)for(let we=1;we<=3;we++)ge.push(me(-we)),ge.push(me(we));for(ge.push(me(0));ge.length>0;){const we=ge.pop(),Xe=we.x,ke=we.y;let Qe=we.fullyVisible;const We=()=>this.projection.name==="globe"&&(we.y===0||we.y===(1<<we.zoom)-1);if(!Qe){let tt=J?we.aabb.intersects(L):we.aabb.intersectsFlat(L);if(tt===0&&We()){const nt=new s.cp(we.zoom,Xe,ke);tt=s.cq(this,A,nt,!0).intersects(L)}if(tt===0)continue;Qe=tt===2}if(we.zoom!==Ee&&Pe(we))for(let tt=0;tt<4;tt++){const nt=(Xe<<1)+tt%2,At=(ke<<1)+(tt>>1),Ot={aabb:y?we.aabb.quadrant(tt):s.cr(this,A,we.zoom+1,nt,At,we.wrap,we.minZ,we.maxZ,this.projection),zoom:we.zoom+1,x:nt,y:At,wrap:we.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:we.minZ,maxZ:we.maxZ};m&&!R&&(Ot.tileID=new s.aM(we.zoom+1===Ee?qe:we.zoom+1,we.wrap,we.zoom+1,nt,At),ct(Ot)),ge.push(Ot)}else{const tt=we.zoom===Ee?qe:we.zoom;if(t.minzoom&&t.minzoom>tt)continue;let nt=0;if(!Qe){let Ft=J?we.aabb.intersectsPrecise(L):we.aabb.intersectsPreciseFlat(L);if(Ft===0&&We()){const Mt=new s.cp(we.zoom,Xe,ke);Ft=s.cq(this,A,Mt,!0).intersectsPrecise(L)}if(Ft===0)continue;if(t.calculateQuadrantVisibility)if(L.containsPoint(we.aabb.center))nt=15;else for(let Mt=0;Mt<4;Mt++)we.aabb.quadrant(Mt).intersects(L)!==0&&(nt|=1<<Mt)}const At=C[0]-(.5+Xe+(we.wrap<<we.zoom))*(1<<r-we.zoom),Ot=C[1]-.5-ke,St=we.tileID?we.tileID:new s.aM(tt,we.wrap,we.zoom,Xe,ke);t.calculateQuadrantVisibility&&(St.visibleQuadrants=nt),Me.push({tileID:St,distanceSq:At*At+Ot*Ot})}}if(this.fogCullDistSq){const we=this.fogCullDistSq,Xe=this.horizonLineFromTop();Me=Me.filter(ke=>{const Qe=[0,0,0,1],We=[s.aj,s.aj,0,1],tt=this.calculateFogTileMatrix(ke.tileID.toUnwrapped());s.aA(Qe,Qe,tt),s.aA(We,We,tt);const nt=s.cs([],Qe,We),At=s.ct([],Qe,We),Ot=s.cM(nt,At);if(Ot===0)return!0;let St=!1;const Ft=this._elevation;if(Ft&&Ot>we&&Xe!==0){const Mt=this.calculateProjMatrix(ke.tileID.toUnwrapped());let Ut;t.isTerrainDEM||(Ut=Ft.getMinMaxForTile(ke.tileID)),Ut||(Ut={min:le,max:ue});const Xt=s.cu(this.rotation),mi=[Xt[0]*s.aj,Xt[1]*s.aj,Ut.max];s.ad(mi,mi,Mt),St=(1-mi[1])*this.height*.5<Xe}return Ot<we||St})}return Me.sort((we,Xe)=>we.distanceSq-Xe.distanceSq).map(we=>we.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=s.aD(t.lat,-s.cv,s.cv),u=this.projection.project(t.lng,r);return new s.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let u,p;const m=this.centerPoint;if(this.projection.name==="globe"){const v=this.worldSize;u=(r.x-m.x)/v,p=(r.y-m.y)/v}else{const v=this.pointCoordinate(r),T=this.pointCoordinate(m);u=v.x-T.x,p=v.y-T.y}const y=this.locationCoordinate(t);this.setLocation(new s.ac(y.x-u,y.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const u=r?s.c6(r,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new s.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const u=r??this._centerAltitude,p=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.aA(p,p,this.pixelMatrixInverse),s.aA(m,m,this.pixelMatrixInverse);const y=m[3];s.cw(p,p,1/p[3]),s.cw(m,m,1/y);const v=p[2],T=m[2];return{p0:p,p1:m,t:v===T?0:(u-v)/(T-v)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return s.aA(r,r,this.pixelMatrixInverse),s.aA(u,u,this.pixelMatrixInverse),s.cw(r,r,1/r[3]),s.cw(u,u,1/u[3]),r[2]=s.c6(r[2],this._center.lat)*this.worldSize,u[2]=s.c6(u[2],this._center.lat)*this.worldSize,s.cw(r,r,1/this.worldSize),s.cw(u,u,1/this.worldSize),new s.av([r[0],r[1],r[2]],s.au([],s.at([],u,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:u,t:p}=t,m=s.c6(r[2],this._center.lat),y=s.c6(u[2],this._center.lat);return new s.ac(s.ai(r[0],u[0],p)/this.worldSize,s.ai(r[1],u[1],p)/this.worldSize,s.ai(m,y,p))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new s.ac(u[0],u[1],u[2]);let p=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t,r);const y=.02*m,v=t.clone();for(let T=0;T<10&&m-p>y;T++){v.y=s.ai(p,m,.66);const A=this.projection.pointCoordinate3D(this,v.x,v.y);A?(m=v.y,u=A):p=v.y}return u?new s.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cx)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const u=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return s.aA(p,p,this.pixelMatrix),p[3]>0?new s.P(p[0]/p[3],p[1]/p[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,m=this.pointLocation3D(new s.P(r,t)),y=this.pointLocation3D(new s.P(p,t)),v=this.pointLocation3D(new s.P(p,u)),T=this.pointLocation3D(new s.P(r,u));let A=Math.min(m.lng,y.lng,v.lng,T.lng),C=Math.max(m.lng,y.lng,v.lng,T.lng),R=Math.min(m.lat,y.lat,v.lat,T.lat),P=Math.max(m.lat,y.lat,v.lat,T.lat);const L=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,V=(G,U,J,ne,oe)=>{const ue=(G+J)/2,le=(U+ne)/2,ce=new s.P(ue,le),{lng:ae,lat:me}=this.pointLocation3D(ce),ge=Math.max(0,A-ae,R-me,ae-C,me-P);A=Math.min(A,ae),C=Math.max(C,ae),R=Math.min(R,me),P=Math.max(P,me),(oe<j||ge>L)&&(V(G,U,ue,le,oe+1),V(ue,le,J,ne,oe+1))};if(V(r,t,p,t,1),V(p,t,p,u,1),V(p,u,r,u,1),V(r,u,r,t,1),this.projection.name==="globe"){const[G,U]=s.cy(this);G?(P=90,C=180,A=-180):U&&(R=-90,C=180,A=-180)}return new s.aG(new s.cd(A,R),new s.cd(C,P))}_getBoundsRectangular(t,r){const{top:u,left:p}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=new s.P(p,u),T=new s.P(y,u),A=new s.P(y,m),C=new s.P(p,m);let R=this.pointCoordinate(v,t),P=this.pointCoordinate(T,t);const L=this.pointCoordinate(A,r),j=this.pointCoordinate(C,r),V=(G,U)=>(U.y-G.y)/(U.x-G.x);return R.y>1&&P.y>=0?R=new s.ac((1-j.y)/V(j,R)+j.x,1):R.y<0&&P.y<=1&&(R=new s.ac(-j.y/V(j,R)+j.x,0)),P.y>1&&R.y>=0?P=new s.ac((1-L.y)/V(L,P)+L.x,1):P.y<0&&R.y<=1&&(P=new s.ac(-L.y/V(L,P)+L.x,0)),new s.aG().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(L))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const m=p.dem.tree;u.min=Math.min(u.min,m.minimums[0]),u.max=Math.max(u.max,m.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cv,this.maxLat=s.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.ay(this.minLng)*this.tileSize,this.worldMaxX=s.ay(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,u=this._distanceTileDataCache;if(u[r])return u[r];const p=t.canonical,m=1/this.height,y=this.cameraWorldSize,v=y/this.zoomScale(p.z),T=(p.x+Math.pow(2,p.z)*t.wrap)*v,A=p.y*v,C=this.point;C.x*=y/this.worldSize,C.y*=y/this.worldSize;const R=this.angle,P=Math.sin(-R),L=-Math.cos(-R);return u[r]={bearing:[P,L],center:[(C.x-T)*m,(C.y-A)*m],scale:v/s.aj*m},u[r]}calculateFogTileMatrix(t){const r=t.key,u=this._fogTileMatrixCache;if(u[r])return u[r];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.az(p,this.worldToFogMatrix,p),u[r]=new Float32Array(p),u[r]}calculateProjMatrix(t,r=!1,u=!1){const p=t.key;let m;if(m=u?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,m[p])return m[p];const y=this.calculatePosMatrix(t,this.worldSize);let v;return v=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,s.az(y,v,y),m[p]=new Float32Array(y),m[p]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[r])return u[r];const p=s.cz(t,this);return u[r]=p,u[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=s.bn([],[t,t,t]);return s.az(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=s.c6(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(r),p=this._camera.forward(),m=s.c6(1,this._center.lat);u[2]/=m,p[2]/=m,s.au(p,p);const y=t.raycast(u,p,t.exaggeration());if(y){const v=s.bF([],u,p,y),T=new s.ac(v[0],v[1],s.c6(v[2],s.aY(v[1]))),A=(T.z+s.ae([T.x-u[0],T.y-u[1],T.z-u[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,u=s.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),m=r.getAtPointOrZero(new s.ac(...p)),y=this.pixelsPerMeter/this.worldSize*m,v=this._minimumHeightOverTerrain(),T=p[2]-y;if(T<=v)if(T<0||t){const A=this.locationCoordinate(this._center,this._centerAltitude),C=[p[0],p[1],A.z-p[2]],R=s.ae(C);C[2]-=(v-T)/this._pixelsPerMercatorPixel;const P=s.ae(C);if(P===0)return;s.b$(C,C,R/P*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],A.z*this._pixelsPerMercatorPixel-C[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const P=this.center;return P.lat=s.aD(P.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(P.lng=s.aD(P.lng,this.minLng,this.maxLng)),this.center=P,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:p}=this.point;let m=0,y=u,v=p;const T=this.width/2,A=this.height/2,C=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(p-A<C&&(v=C+A),p+A>R&&(v=R-A),R-C<this.height&&(m=Math.max(m,this.height/(R-C)),v=(R+C)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const P=this.worldMinX*this.scale,L=this.worldMaxX*this.scale,j=this.worldSize/2-(P+L)/2;y=(u+j+this.worldSize)%this.worldSize-j,y-T<P&&(y=P+T),y+T>L&&(y=L-T),L-P<this.width&&(m=Math.max(m,this.width/(L-P)),y=(L+P)/2)}y===u&&v===p||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(y,v))),m&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.c6(1,this.center.lat)/s.c6(1,s.cN));const p=s.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?u:1,y=this._camera.getWorldToCamera(this.worldSize,m);let v;const T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(T[8]=2*-t.x/this.width,T[9]=2*t.y/this.height,this.isOrthographic){let me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ge=me*this.aspect,Me=-ge,Ee=-me;ge-=t.x,Me-=t.x,me+=t.y,Ee+=t.y,v=this._camera.getCameraToClipOrthographic(Me,ge,Ee,me,this._nearZ,this._farZ),((qe,$e,ct,Se)=>{for(let Pe=0;Pe<16;Pe++)qe[Pe]=s.ai($e[Pe],ct[Pe],Se)})(v,v,T,s.cO(this.pitch>=aa?1:this.pitch/aa))}else v=T;const A=s.cB([],T,y);let C=s.cB([],v,y);if(this.projection.isReprojectedInTileSpace){const me=this.locationCoordinate(this.center),ge=s.bx([]);s.bo(ge,ge,[me.x*this.worldSize,me.y*this.worldSize,0]),s.az(ge,ge,s.cC(this)),s.bo(ge,ge,[-me.x*this.worldSize,-me.y*this.worldSize,0]),s.az(C,C,ge),s.az(A,A,ge),this.inverseAdjustmentMatrix=s.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cE([],C,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=C,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),r){const me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);me[8]=2*-t.x/this.width,me[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cB([],me,y)}else this.expandedFarZProjMatrix=this.projMatrix;const R=s.bi([],v);this.frustumCorners=s.cF.fromInvProjectionMatrix(R,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const P=new Float32Array(16);s.bx(P),s.cE(P,P,[1,-1,1]),s.cG(P,P,this._pitch),s.by(P,P,this.angle);const L=s.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(L);const j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-t.x/this.width,L[9]=2*(t.y+j)/this.height,this.skyboxMatrix=s.az(P,L,P);const V=this.point,G=V.x,U=V.y,J=this.width%2/2,ne=this.height%2/2,oe=Math.cos(this.angle),ue=Math.sin(this.angle),le=G-Math.round(G)+oe*J+ue*ne,ce=U-Math.round(U)+oe*ne+ue*J,ae=new Float64Array(C);if(s.bo(ae,ae,[le>.5?le-1:le,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=ae,C=s.bz(),s.cE(C,C,[this.width/2,-this.height/2,1]),s.bo(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=s.bz(),s.cE(C,C,[1,-1,1]),s.bo(C,C,[-1,-1,0]),s.cE(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},C=s.bi(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cH(this);const me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(me,me,y),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,m=[t,t,r];s.b$(m,m,p),s.b$(u,u,-1),s.cI(u,u,m);const y=s.bz();s.bo(y,y,u),s.cE(y,y,m),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,p)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*m,p.y/this.worldSize-u[1]*m,t/this.worldSize*this._centerAltitude-u[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(m=Math.min((r-u)/p,1)),this._camera.position=s.bF([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),m=s.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),v=Math.max((t[2]-m)/Math.cos(u),y),T=this._zoomFromMercatorZ(v);s.bF(t,t,r,v),this._pitch=s.aD(u,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bX(p,-Math.PI,Math.PI),this._setZoom(s.aD(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,u=s.cx,p=0,m=1/0;for(;u-r>1e-6&&u>r;){const y=r+.5*(u-r),v=this.tileSize*Math.pow(2,y),T=this.getCameraToCenterDistance(this.projection,y,v),A=this.scaleZoom(T/(t*this.tileSize)),C=Math.abs(y-A);C<m&&(m=C,p=y),y<A?r=y:u=y}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const u=Math.min(t.x,r.x),p=Math.max(t.x,r.x),m=Math.min(t.y,r.y),y=Math.max(t.y,r.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const v=[new s.P(u,m),new s.P(p,y),new s.P(u,y),new s.P(p,m)],T=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const C of v){const R=this.pointRayIntersection(C);if(R.t<0)return!0;const P=this.rayIntersectionCoordinate(R);if(P.x<T||P.y<0||P.x>A||P.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,r){const u=s.ae(s.at([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+r;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,u,p],m){const y=[r,u,p,1];s.aA(y,y,m);const v=y[3]=Math.max(y[3],1e-6);return y[0]/=v,y[1]/=v,y[2]/=v,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,u=this.worldSize){const p=s.cA(t,r,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,u,p);let y=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(y=s.ai(1,y,s.cO(this.pitch>=aa?1:this.pitch/aa))),y}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(t,t,this.globeMatrix),t}getFrustum(t){return s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Ua=(c,t)=>{if(t>0&&c.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,u=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),p=r.isLODDisabled(!1)?s.af(60,45,r.pitch):s.af(30,15,r.pitch),m=r._farZ-r._nearZ,y=t*r.height,v=((1-(T=p))*r.cameraToCenterDistance+T*(r._farZ+y))*u;var T;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(v-r._nearZ)/m,(v-y-r._nearZ)/m]}}},gs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ec{constructor(t,r){this.aabb=t,this.lastCascade=r}}class Ac{add(t,r){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],r.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],r.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],r.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],r.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],r.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],r.max[2])):this.receivers[t.key]=new Ec(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,u){const p=s.cV.fromPoints(t.points);let m=0;for(const y in this.receivers){const v=this.receivers[y];if(!v||!p.intersectsAabb(v.aabb))continue;v.aabb.min=p.closestPoint(v.aabb.min),v.aabb.max=p.closestPoint(v.aabb.max);const T=v.aabb.getCorners();for(let A=0;A<u.length;A++){let C=!0;for(const R of T){const P=[R[0]*r,R[1]*r,R[2]];if(s.ad(P,P,u[A].matrix),P[0]<-1||P[0]>1||P[1]<-1||P[1]>1){C=!1;break}}if(v.lastCascade=A,m=Math.max(m,A),C)break}}return m+1}}class $_{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ac,this._depthMode=new It(t.context.gl.LEQUAL,It.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(gs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(gs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(gs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const p=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((j,V)=>{const G=u.style._mergedLayers[V];return j+(G.hasShadowPass()&&!G.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const m=u.context,y=gs.shadowMapResolution,v=gs.shadowMapResolution;if(this._cascades.length===0||gs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<gs.cascadeCount;++j){const V=u._shadowMapDebug,G=m.gl,U=m.createFramebuffer(y,v,V,"texture"),J=new s.T(m,{width:y,height:v,data:null},G.DEPTH_COMPONENT16);if(U.depthAttachment.set(J.texture),V){const ne=new s.T(m,{width:y,height:v,data:null},G.RGBA8);U.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:U,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cn,scale:0})}}this.shadowDirection=Td(r);let T=0;if(t.elevation){const j=t.elevation,V=[1e4,-1e4];j.visibleDemTiles.filter(G=>G.dem).forEach(G=>{const U=G.dem.tree;V[0]=Math.min(V[0],U.minimums[0]),V[1]=Math.max(V[1],U.maximums[0])}),V[0]!==1e4&&(T=(V[1]-V[0])*j.exaggeration())}const A=1.5*t.cameraToCenterDistance,C=3*A,R=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){const V=this._cascades[j];let G=t.height/50,U=1;gs.cascadeCount===1?U=C:j===0?U=A:(G=A,U=C);const[J,ne]=Sd(t,this.shadowDirection,G,U,gs.shadowMapResolution,T);V.scale=t.scale,V.matrix=J,V.boundingSphereRadius=ne,s.bi(R,V.matrix),V.frustum=s.cn.fromInvProjectionMatrix(R,1,0,!0),V.far=U}const P=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[P].far,this._cascades[P].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/gs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=gs.shadowMapResolution,this._uniformValues.u_shadowmap_0=ms.ShadowMap0,this._uniformValues.u_shadowmap_1=ms.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const L=u.transform.elevation;for(const j of this._groundShadowTiles){let V={min:0,max:0};if(L){const G=L.getMinMaxForTile(j);G&&(V=G)}this.addShadowReceiver(j.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,gs.shadowMapResolution,gs.shadowMapResolution]);for(let m=0;m<this._numCascadesToRender;++m){u.currentShadowCascade=m,p.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),p.clear({color:s.am.white,depth:1});for(const y of t.order){const v=t._mergedLayers[y];if(!v.hasShadowPass()||v.isHidden(u.transform.zoom))continue;const T=t.getLayerSourceCache(v),A=T?r[T.id]:void 0;(v.type==="model"||A&&A.length)&&u.renderLayer(u,T,v,A)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,u=t.context,p=r.directionalLight,m=r.ambientLight;if(!p||!m)return;const y=[],v=Ua(t,t.longestCutoffRange);v.shouldRenderCutoff&&y.push("RENDER_CUTOFF"),y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&y.push("NORMAL_OFFSET");const T=Eo(r,p,m),A=new It(u.gl.LEQUAL,It.ReadOnly,t.depthRangeFor3D);for(const C of this._groundShadowTiles){const R=C.toUnwrapped(),P=t.isTileAffectedByFog(C),L=t.getOrCreateProgram("groundShadow",{defines:y,overrideFog:P});this.setupShadows(R,L),t.uploadCommonUniforms(u,L,R,null,v);const j={u_matrix:t.transform.calculateProjMatrix(R),u_ground_shadow_factor:T};L.draw(t,u.gl.TRIANGLES,A,qt.disabled,ci.multiply,Wt.disabled,j,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ci.unblended:ci.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,u=r.calculatePosMatrix(t,r.worldSize);return s.az(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return s.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,u,p=0){if(!this.enabled)return;const m=this.painter.transform,y=this.painter.context,v=y.gl,T=this._uniformValues,A=new Float64Array(16),C=m.calculatePosMatrix(t,m.worldSize);for(let R=0;R<this._cascades.length;R++)s.az(A,this._cascades[R].matrix,C),T[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(v.TEXTURE0+ms.ShadowMap0+R),this._cascades[R].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const R=s.cT(t.canonical),P=2/m.tileSize*s.aj/gs.shadowMapResolution,L=P*this._cascades[0].boundingSphereRadius,j=P*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-m.zoom+Math.floor(m.zoom)));T.u_shadow_normal_offset=[R,L*V,j*V],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(y,T)}setupShadowsFromMatrix(t,r,u=!1){if(!this.enabled)return;const p=this.painter.context,m=p.gl,y=this._uniformValues,v=new Float64Array(16);for(let T=0;T<gs.cascadeCount;T++)s.az(v,this._cascades[T].matrix,t),y[T===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(v),p.activeTexture.set(m.TEXTURE0+ms.ShadowMap0+T),this._cascades[T].texture.bind(m.NEAREST,m.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const T=gs.normalOffset;y.u_shadow_normal_offset=[1,T,T],y.u_shadow_bias=[6e-5,.0012,.012]}else y.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,y)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,u,p){if(p[2]>=0)return{};const m=function(T,A,C){const R=C/(1<<T.canonical.z);return new s.cV([T.canonical.x*R+T.wrap*C,T.canonical.y*R+T.wrap*C,0],[(T.canonical.x+1)*R+T.wrap*C,(T.canonical.y+1)*R+T.wrap*C,A])}(t,r,u).getCorners(),y=r/-p[2];p[0]<0?(s.cU(m[0],m[0],[p[0]*y,0,0]),s.cU(m[3],m[3],[p[0]*y,0,0])):p[0]>0&&(s.cU(m[1],m[1],[p[0]*y,0,0]),s.cU(m[2],m[2],[p[0]*y,0,0])),p[1]<0?(s.cU(m[0],m[0],[0,p[1]*y,0]),s.cU(m[1],m[1],[0,p[1]*y,0])):p[1]>0&&(s.cU(m[2],m[2],[0,p[1]*y,0]),s.cU(m[3],m[3],[0,p[1]*y,0]));const v={};return v.vertices=m,v.planes=[Uo(m[1],m[0],m[4]),Uo(m[2],m[1],m[5]),Uo(m[3],m[2],m[6]),Uo(m[0],m[3],m[7])],v}addShadowReceiver(t,r,u){this._receivers.add(t,s.cV.fromTileIdAndHeight(t,r,u))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Uo(c,t,r){const u=s.at([],r,t),p=s.at([],c,t),m=s.bG([],u,p),y=s.ae(m);return y===0?[0,0,1,0]:(s.b$(m,m,1/y),[m[0],m[1],m[2],-s.bE(m,t)])}function Td(c){const t=c.properties.get("direction"),r=s.cR(t.x,t.y,t.z);r[2]=s.aD(r[2],0,75);const u=s.cW([r[0],r[1],r[2]]);return s.cS(u.x,u.y,u.z)}function Eo(c,t,r){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),m=t.properties.get("intensity"),y=t.properties.get("direction"),v=[y.x,y.y,y.z],T=r.properties.get("color-use-theme")==="none",A=r.properties.get("color"),C=r.properties.get("intensity"),R=Math.max(s.bE([0,0,1],v),0),P=[0,0,0];s.b$(P,A.toRenderColor(T?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),C);const L=[0,0,0];return s.b$(L,p.toRenderColor(u?null:c.getLut(r.scope)).toArray01Linear().slice(0,3),R*m),s.cX([P[0]>0?P[0]/(P[0]+L[0]):0,P[1]>0?P[1]/(P[1]+L[1]):0,P[2]>0?P[2]/(P[2]+L[2]):0])}function Sd(c,t,r,u,p,m){const y=c.zoom,v=c.scale,T=c.worldSize,A=1/T,C=c.aspect,R=Math.sqrt(1+C*C)*Math.tan(.5*c.fovX),P=R*R,L=u-r,j=u+r;let V,G;P>L/j?(V=u,G=u*R):(V=.5*j*(1+P),G=.5*Math.sqrt(L*L+2*(u*u+r*r)*P+j*j*P*P));const U=c.projection.pixelsPerMeter(c.center.lat,T),J=c._camera.getCameraToWorldMercator(),ne=[0,0,-V*A];s.ad(ne,ne,J);let oe=G*A;const ue=c._edgeInsets;if(!(ue.left===0&&ue.top===0&&ue.right===0&&ue.bottom===0||ue.left===ue.right&&ue.top===ue.bottom)){const Qe=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?U:1),We=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,u);We[8]=2*-c.centerOffset.x/c.width,We[9]=2*c.centerOffset.y/c.height;const tt=new Float64Array(16);s.cB(tt,We,Qe);const nt=new Float64Array(16);s.bi(nt,tt);const At=s.cn.fromInvProjectionMatrix(nt,T,y,!0);for(const Ot of At.points){const St=((le=Ot)[0]/=v,le[1]/=v,le[2]=s.c6(le[2],c._center.lat),le);oe=Math.max(oe,s.c0(s.cY([],ne,St)))}}var le;oe*=p/(p-1);const ce=Math.acos(t[2]),ae=Math.atan2(-t[0],-t[1]),me=new as;me.position=ne,me.setPitchBearing(ce,ae);const ge=me.getWorldToCamera(T,U),Me=oe*T,Ee=Math.min(c._mercatorZfromZoom(17)*T*-2,-2*Me),qe=me.getCameraToClipOrthographic(-Me,Me,-Me,Me,Ee,(Me+m*U)/t[2]),$e=new Float64Array(16);s.az($e,qe,ge);const ct=s.cS(Math.floor(1e6*ne[0])/1e6*T,Math.floor(1e6*ne[1])/1e6*T,0),Se=.5*p,Pe=[0,0,0];s.ad(Pe,ct,$e),s.b$(Pe,Pe,Se);const we=[Math.floor(Pe[0]),Math.floor(Pe[1]),Math.floor(Pe[2])],Xe=[0,0,0];s.at(Xe,Pe,we),s.b$(Xe,Xe,-1/Se);const ke=new Float64Array(16);return s.bx(ke),s.bo(ke,ke,Xe),s.az($e,ke,$e),[$e,Me]}class la extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return s.aS(this.requestManager.transformRequest(r,s.R.Model).url).then(u=>{if(!u)return;const p=s.aT(u),m=new s.aU(t,void 0,void 0,p);return m.computeBoundsAndApplyParent(),m}).catch(u=>{if(u&&u.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${r}: ${u.message}`)))})}load(t,r,u={forceReload:!1}){this.models[r]||(this.models[r]={});const p=Object.keys(t),m=[],y=[];for(const v of p){const T=t[v];this.hasURLBeenRequested(T)&&!u.forceReload||(this.modelByURL[T]={modelId:v,scope:r},m.push(this.loadModel(v,T)),y.push(v)),this.models[r][v]||(this.models[r][v]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+y.length,Promise.allSettled(m).then(v=>{for(let T=0;T<v.length;T++){const{status:A}=v[T];if(A==="rejected")continue;const{value:C}=v[T];this.models[r][y[T]]||(this.models[r][y[T]]={model:null,numReferences:1}),this.models[r][y[T]].model=C}this.numModelsLoading[r]-=y.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(v=>{this.fire(new s.z(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===p)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:m,modelId:y}=this.modelByURL[p];this.models[m][y].numReferences++}else this.modelUris[u][t]=p,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u=this.modelUris[r];for(const p in t)u[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u={};for(const p of t)this.hasModel(p,r,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[r][p].numReferences++:this.modelUris[r][p]&&!this.hasURLBeenRequested(p)?u[p]=this.modelUris[r][p]:!this.hasURLBeenRequested(p)&&s.cZ(p,!1)&&(this.modelUris[r][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[r][p]);this.load(u,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,u=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const p=this.modelUris[r][t];u||delete this.modelUris[r][t],delete this.modelByURL[p];const m=this.models[r][t].model;if(!m)return;delete this.models[r][t],m.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const u=this.models[t][r].model;delete this.models[t][r],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const u in this.models[r])this.models[r][u].model&&this.models[r][u].model.upload(t.context)}}const G_=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),H_={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function qp(c){return c=c||{},Object.assign(c,H_)}class Wp extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(y,v){const[T,A]=y,{center:C,radius:R}=v,[P,L]=C,j=Math.abs(T-P);return Math.sqrt((j>180?360-j:j)**2+(A-L)**2)<=R}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new s.P(this._map.transform.width/2,this._map.transform.height/2),p=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(t?p:u,r);m.length>0&&(this._selectedFloorplan&&m[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=m[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(m){const[[y,v],[T,A]]=m,C=(T-y+360)%360,R=C>180?360-C:C;return{center:[(y+R/2+360)%360,(v+A)/2],radius:Math.sqrt(R**2+(A-v)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const r=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let p;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const m of this._indoorData.levels)m.id===this._selectedLevel.id&&(p=m.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:p})),r){const m=this._indoorData.buildings.find(y=>y.id===r);this._buildingSelected(m,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const m=this._indoorData.levels.find(y=>y.id===u);this._updateLevels(m,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,r){r&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new s.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const r=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(r,!0)}this.fire(new s.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,r){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(r&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(A){const C=A.indexOf("/floor/");if(C===-1)return A;const R=C+7,P=A.indexOf("/",R);return P===-1?A.slice(R):A.slice(R,P)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const p=[],m={},y={},v={},T={};for(const A of this._indoorData.levels)if(p.push(A.id),m[A.id]=A.height,y[A.id]=A.base,t){if(this.mergeFloors){const C=u(t.id),R=u(A.id);v[A.id]=R===C?"true":"false"}else v[A.id]=A.id===t.id?"true":"false";T[A.id]=A.base<t.base?"true":"false"}else T[A.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",T]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),r&&t.extent)){const A=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),C=this._map.getZoom(),R=A.zoom?Math.abs(C-A.zoom):0;this._map.fitBounds(t.extent,R>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:C})}}selectFloorplan(t){const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,r);if(p.length>0){for(const m of p)if(JSON.parse(m.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=m,this._floorplanSelected(!0);break}}}selectBuilding(t){const r=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(r,!0)}selectLevel(t){this._levelSelected(t)}}function q_(c){if(!c.metadata||!c.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:r,top:u,width:p,height:m}=c.metadata.content_area,y=r*t,v=u*t;return[y,v,y+p*t,v+m*t]}function Bu(c){if(c)return c.map(([t,r])=>[t*s.q.devicePixelRatio,r*s.q.devicePixelRatio])}class Zp{constructor(t,r,u){this.id=t,this.scope=r,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof za))return t;const p=r.map(y=>this.sourceCache.getTile(y)),m=u.getImages(p,Array.from(this.pendingRequests));for(const[y,v]of m)t.set(s.I.from({name:y,iconsetId:this.id}),v),this.pendingRequests.delete(y);for(const y of this.pendingRequests)this.missingRequests.add(y);return this.pendingRequests.clear(),t}}const ca=(c,t)=>ve(c,t&&t.filter(r=>r.identifier!=="source.canvas")),Xp=s.aF(ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Kp=s.aF(ki,["setCenter","setZoom","setBearing","setPitch"]),$o=new Set(["background","sky","slot","custom"]),Ic={version:8,layers:[],sources:{}},Ed={duration:300,delay:0};class Ys extends s.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=s.l({},Ed),this._buildingIndex=new Bp(this),this.crossTileSymbolIndex=new br,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new Ui,this.dispatcher=r.dispatcher?r.dispatcher:new s.D(s.d0(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new lr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new s.d1(t._requestManager,r.localFontFamily?s.d2.all:r.localIdeographFontFamily?s.d2.ideographs:s.d2.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new la(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",s.d3());const u=this;this._rtlTextPluginCallback=Ys.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(m,y)=>{if(s.d4(m),y&&y.every(v=>v))for(const v in u._sourceCaches){const T=u._sourceCaches[v],A=T.getSource().type;A!=="vector"&&A!=="geojson"||T.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.getOwnSource(p.sourceId);if(m&&m.vectorLayerIds)for(const y in this._layers){const v=this._layers[y];v.source===m.id&&this._validateLayer(v)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.f(t))return t;const r=s.d5(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${s.d6(JSON.stringify(t))}`}_diffStyle(t,r,u){this.globalId=this._getGlobalId(t);const p=(m,y)=>{try{y(null,this.setState(m,u))}catch(v){y(v,!1)}};if(typeof t=="string"){const m=this.map._requestManager.normalizeStyleURL(t),y=this.map._requestManager.transformRequest(m,s.R.Style);s.n(y,(v,T)=>{v?this.fire(new s.z(v)):T&&p(T,r)})}else typeof t=="object"&&p(t,r)}loadURL(t,r={}){this.fire(new s.A("dataloading",{dataType:"style"}));const u=typeof r.validate=="boolean"?r.validate:!s.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const m=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(m,(y,v)=>{if(this._request=null,y)this.fire(new s.z(y));else if(v)return this.importsCache.set(t,v),this._load(v,u)})}loadJSON(t,r={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(Ic,!1)}_loadImports(t,r,u){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const m of t){const y=this._createFragmentStyle(m),v=new Promise(C=>{y.once("style.import.load",C),y.once("error",C)}).then(()=>this.mergeAll());if(p.push(v),this.resolvedImports.has(m.url)){y.loadEmpty();continue}const T=m.data||this.importsCache.get(m.url);T?(y.loadJSON(T,{validate:r}),this._isInternalStyle(T)&&(y.globalId=null)):m.url?y.loadURL(m.url,{validate:r}):y.loadEmpty();const A={style:y,id:m.id,config:m.config};if(u){const C=this.fragments.findIndex(({id:R})=>R===u);this.fragments=this.fragments.slice(0,C).concat(A).concat(this.fragments.slice(C))}else this.fragments.push(A)}return Promise.allSettled(p)}getImportGlobalIds(t=this,r=new Set){for(const u of t.fragments)u.style.globalId&&r.add(u.style.globalId),this.getImportGlobalIds(u.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?s.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[r];(t.config||p)&&(u=s.l({},t.config,p));const m=new Ys(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const u=t.indoor?qp(t.schema):t.schema;if(this._isInternalStyle(t)){const y=s.l({},Ic,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(y,r)}if(this.updateConfig(this._config,u),r&&ca(this,Ms(t)))return;this._loaded=!0,this.stylesheet=s.d7(t);const p=()=>{for(const A in t.sources)this.addSource(A,t.sources[A],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const A in t.iconsets)this.addIconset(A,t.iconsets[A]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const y=Pu(this.stylesheet.layers);if(this._order=y.map(A=>A.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new De(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new De(this.stylesheet.light)),this._layers={};for(const A of y){const C=s.dc(A,this.scope,this._styleColorTheme.lut,this.options);C.configDependencies.size!==0&&this._configDependentLayers.add(C.fqid),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C;const R=this.getOwnLayerSourceCache(C),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&C.canCastShadows()&&P&&(R.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const v=this.stylesheet.terrain;v&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const T=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new s.A(T?"style.load":"style.import.load"))}).catch(A=>{this.fire(new s.z(new Error("Failed to load imports",A))),this.fire(new s.A(T?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(T?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const y=this._evaluateColorThemeData(m);this._loadColorTheme(y).then(()=>{p()}).catch(v=>{s.w(`Couldn't load color theme from the stylesheet: ${v}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,u,p,m,y,v,T,A,C;const R={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(P=>{if(P.stylesheet){if(P.light!=null&&(t=P.light),P.stylesheet.lights)for(const L of P.stylesheet.lights)L.type==="ambient"&&P.ambientLight!=null&&(r=P.ambientLight),L.type==="directional"&&P.directionalLight!=null&&(u=P.directionalLight);p=this._prioritizeTerrain(p,P.terrain,P.stylesheet.terrain),P.stylesheet.fog&&P.fog!=null&&(m=P.fog),P.stylesheet.snow&&P.snow!=null&&(y=P.snow),P.stylesheet.rain&&P.rain!=null&&(v=P.rain),P.stylesheet.camera!=null&&(C=P.stylesheet.camera),P.stylesheet.projection!=null&&(T=P.stylesheet.projection),P.stylesheet.transition!=null&&(A=P.stylesheet.transition),R[P.scope]=P._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=u,this.fog=m,this.snow=y,this.rain=v,this._styleColorThemeForScope=R,p===null?delete this.terrain:this.terrain=p,this.camera=C||{"camera-projection":"perspective"},this.projection=T||{name:"mercator"},this.transition=s.l({},Ed,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=u=>{for(const p of u.fragments)r(p.style);t(u)};r(this)}_prioritizeTerrain(t,r,u){const p=t&&t.drapeRenderMode===0;return u===null?r&&r.drapeRenderMode===0?r:p?t:null:r!=null&&(!t||p||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},u={};this.forEachFragmentStyle(p=>{for(const m in p._sourceCaches){const y=s.C(m,p.scope);t[y]=p._sourceCaches[m]}for(const m in p._otherSourceCaches){const y=s.C(m,p.scope);r[y]=p._otherSourceCaches[m]}for(const m in p._symbolSourceCaches){const y=s.C(m,p.scope);u[y]=p._symbolSourceCaches[m]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},r=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(m=>{for(const y of m._order){const v=m._layers[y];if(v.type==="slot"){const T=s.d8(y);if(t[T])continue;t[T]=[]}v.slot&&t[v.slot]?t[v.slot].push(v):r.push(v)}}),this._mergedOrder=[];const p=(m=[])=>{for(const y of m)if(y.type==="slot"){const v=s.d8(y.id);t[v]&&p(t[v]),this._mergedSlots.push(v)}else{const v=s.C(y.id,y.scope);this._mergedOrder.push(v),u[v]=y,y.is3D(!!this.terrain)&&(this._has3DLayers=!0),y.type==="circle"&&(this._hasCircleLayers=!0),y.type==="symbol"&&(this._hasSymbolLayers=!0),y.type==="clip"&&(this._clipLayerPresent=!0)}};p(r),this._mergedOrder.sort((m,y)=>{const v=u[m],T=u[y];return v.hasInitialOcclusionOpacityProperties?T.is3D(!!this.terrain)?1:0:v.is3D(!!this.terrain)&&T.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,u,p){const m=s.l({},u);for(const v of Object.keys(s.a5.colorTheme))m[v]===void 0&&(m[v]=s.a5.colorTheme[v].default);const y=new s.a6(G_,r,new Map(p));return y.setTransitionOrValue(m,p),y.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const m="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let y=t;y.startsWith(m)||(y=m+y);const v=s.I.from("mapbox-reserved-lut"),T=new Image;T.src=y,T.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},T.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void u();this._styleColorTheme.lutLoading=!1;const{width:A,height:C,data:R}=s.q.getImageData(T);if(C>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(A!==C*C)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(v)&&this.removeImage(v),this.addImage(v,{data:new s.r({width:A,height:C},R),pixelRatio:1,sdf:!1,usvg:!1,version:0});const P=this.imageManager.getImage(v,this.scope);P?(this._styleColorTheme.lut={image:P.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,u,p){let m,y,v;const T=s.q.devicePixelRatio>1?"@2x":"";let A=s.n(u.transformRequest(u.normalizeSpriteURL(r,T,".json"),s.R.SpriteJSON),(P,L)=>{A=null,v||(v=P,m=L,R())}),C=s.o(u.transformRequest(u.normalizeSpriteURL(r,T,".png"),s.R.SpriteImage),(P,L)=>{C=null,v||(v=P,y=L,R())});function R(){if(v)p(v);else if(m&&y){const P=s.q.getImageData(y),L={};for(const j in m){const{width:V,height:G,x:U,y:J,sdf:ne,pixelRatio:oe,stretchX:ue,stretchY:le,content:ce}=m[j],ae=new s.r({width:V,height:G});s.r.copy(P,ae,{x:U,y:J},{x:0,y:0},{width:V,height:G},null),L[j]={data:ae,pixelRatio:oe,sdf:ne,stretchX:ue,stretchY:le,content:ce,usvg:!1}}p(null,L)}}return{cancel(){A&&(A.cancel(),A=null),C&&(C.cancel(),C=null)}}}(t,this.map._requestManager,(r,u)=>{if(this._spriteRequest=null,r)this.fire(new s.z(r));else if(u){const p=new Map;for(const m in u)p.set(s.I.from(m),u[m]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const u=this.getOwnSourceCache(r.source);if(!u)return void this.fire(new s.z(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const m=new Zp(t,this.scope,u);this.imageManager.addImageProvider(m,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(m,y)=>{if(this._spriteRequest=null,m)r?this._loadSprite(t):this.fire(new s.z(m));else if(y){const v=new Map;for(const T in y)v.set(s.I.from(T),y[T]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),s.R.Iconset),(m,y)=>{if(m)return void p(m);const v={},T=s.c_(new s.bq(y));for(const A of T.icons){const C={version:1,pixelRatio:s.q.devicePixelRatio,content:q_(A),stretchX:A.metadata?Bu(A.metadata.stretch_x_areas):void 0,stretchY:A.metadata?Bu(A.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:A};v[A.name]=C}p(null,v)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const u=t.sourceLayer;u&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.z(new Error(`Source layer "${u}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const u=this.fragments[r];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const u=this._sourceCaches[r].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const r=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&r.push(p.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const m=t.getProgramIds();if(m)for(const y of m){const v=t.getDefaultProgramParams(y,r.zoom,this._styleColorTheme.lut);v&&(u.style=this,this.fog&&(u._fogVisible=!0,v.overrideFog=!0,u.getOrCreateProgram(y,v)),u._fogVisible=!1,v.overrideFog=!1,u.getOrCreateProgram(y,v),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(v.overrideRtt=!0,u.getOrCreateProgram(y,v)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const v=this._changes.getLayerUpdatesByScope();for(const T in v){const{updatedIds:A,removedIds:C}=v[T];(A||C)&&(this._updateWorkerLayers(T,A,C),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const m={};for(const v in this._mergedSourceCaches){const T=this._mergedSourceCaches[v];m[v]=T.used,T.used=!1,T.tileCoverLift=0}for(const v of this._mergedOrder){const T=this._mergedLayers[v];if(T.recalculate(t,this._availableImages),!T.isHidden(t.zoom)){const A=this.getLayerSourceCache(T);A&&(A.used=!0,A.tileCoverLift=Math.max(A.tileCoverLift,T.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(T,t)}):this.precompilePrograms(T,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const y=this.imageManager.getPendingImageProviders();for(const v of y)v.sourceCache.used=!0;for(const v in m){const T=this._mergedSourceCaches[v];m[v]!==T.used&&T.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const u=r.resolvePendingRequests(),p=this.getFragmentStyle(r.scope);p&&p.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const u=this._mergedSourceCaches[r].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:r?p._serializeLayers(r):[],scope:t,removedIds:u||[],options:p.options})}setState(t,r){if(this._checkLoaded(),ca(this,Ms(t)))return!1;(t=s.d7(t)).layers=Pu(t.layers);const u=function(y,v){if(!y)return[{command:ki.setStyle,args:[v]}];let T=[];try{if(!s.bv(y.version,v.version))return[{command:ki.setStyle,args:[v]}];if(s.bv(y.center,v.center)||T.push({command:ki.setCenter,args:[v.center]}),s.bv(y.zoom,v.zoom)||T.push({command:ki.setZoom,args:[v.zoom]}),s.bv(y.bearing,v.bearing)||T.push({command:ki.setBearing,args:[v.bearing]}),s.bv(y.pitch,v.pitch)||T.push({command:ki.setPitch,args:[v.pitch]}),s.bv(y.sprite,v.sprite)||T.push({command:ki.setSprite,args:[v.sprite]}),s.bv(y.glyphs,v.glyphs)||T.push({command:ki.setGlyphs,args:[v.glyphs]}),s.bv(y.imports,v.imports)||function(L=[],j=[],V){j=j||[];const G=(L=L||[]).map(ia),U=j.map(ia),J=L.reduce(yl,{}),ne=j.reduce(yl,{}),oe=G.slice();let ue,le,ce,ae;for(ue=0,le=0;ue<G.length;ue++)ce=G[ue],ne.hasOwnProperty(ce)?le++:(V.push({command:ki.removeImport,args:[ce]}),oe.splice(oe.indexOf(ce,le),1));for(ue=0,le=0;ue<U.length;ue++)ce=U[U.length-1-ue],oe[oe.length-1-ue]!==ce&&(J.hasOwnProperty(ce)?(V.push({command:ki.removeImport,args:[ce]}),oe.splice(oe.lastIndexOf(ce,oe.length-le),1)):le++,ae=oe[oe.length-ue],V.push({command:ki.addImport,args:[ne[ce],ae]}),oe.splice(oe.length-ue,0,ce));for(const me of j){const ge=J[me.id];ge&&!s.bv(ge,me)&&V.push({command:ki.updateImport,args:[me.id,me]})}}(y.imports,v.imports,T),s.bv(y.transition,v.transition)||T.push({command:ki.setTransition,args:[v.transition]}),s.bv(y.light,v.light)||T.push({command:ki.setLight,args:[v.light]}),s.bv(y.fog,v.fog)||T.push({command:ki.setFog,args:[v.fog]}),s.bv(y.snow,v.snow)||T.push({command:ki.setSnow,args:[v.snow]}),s.bv(y.rain,v.rain)||T.push({command:ki.setRain,args:[v.rain]}),s.bv(y.projection,v.projection)||T.push({command:ki.setProjection,args:[v.projection]}),s.bv(y.lights,v.lights)||T.push({command:ki.setLights,args:[v.lights]}),s.bv(y.camera,v.camera)||T.push({command:ki.setCamera,args:[v.camera]}),s.bv(y.iconsets,v.iconsets)||function(L,j,V){let G;for(G in j=j||{},L=L||{})L.hasOwnProperty(G)&&(j.hasOwnProperty(G)||V.push({command:ki.removeIconset,args:[G]}));for(G in j){if(!j.hasOwnProperty(G))continue;const U=j[G];L.hasOwnProperty(G)?s.bv(L[G],U)||(V.push({command:ki.removeIconset,args:[G]}),V.push({command:ki.addIconset,args:[G,U]})):V.push({command:ki.addIconset,args:[G,U]})}}(y.iconsets,v.iconsets,T),!s.bv(y["color-theme"],v["color-theme"]))return[{command:ki.setStyle,args:[v]}];const A={},C=[];(function(L,j,V,G){let U;for(U in j=j||{},L=L||{})L.hasOwnProperty(U)&&(j.hasOwnProperty(U)||_l(U,V,G));for(U in j){if(!j.hasOwnProperty(U))continue;const J=j[U];L.hasOwnProperty(U)?s.bv(L[U],J)||(L[U].type==="geojson"&&J.type==="geojson"&&Np(L,j,U)?V.push({command:ki.setGeoJSONSourceData,args:[U,J.data]}):j_(U,j,V,G)):gl(U,j,V)}})(y.sources,v.sources,C,A);const R=[];y.layers&&y.layers.forEach(L=>{L.source&&A[L.source]?T.push({command:ki.removeLayer,args:[L.id]}):R.push(L)});let P=y.terrain;P&&A[P.source]&&(T.push({command:ki.setTerrain,args:[void 0]}),P=void 0),T=T.concat(C),s.bv(P,v.terrain)||T.push({command:ki.setTerrain,args:[v.terrain]}),function(L,j,V){j=j||[];const G=(L=L||[]).map(ia),U=j.map(ia),J=L.reduce(yl,{}),ne=j.reduce(yl,{}),oe=G.slice(),ue=Object.create(null);let le,ce,ae,me,ge,Me,Ee;for(le=0,ce=0;le<G.length;le++)ae=G[le],ne.hasOwnProperty(ae)?ce++:(V.push({command:ki.removeLayer,args:[ae]}),oe.splice(oe.indexOf(ae,ce),1));for(le=0,ce=0;le<U.length;le++)ae=U[U.length-1-le],oe[oe.length-1-le]!==ae&&(J.hasOwnProperty(ae)?(V.push({command:ki.removeLayer,args:[ae]}),oe.splice(oe.lastIndexOf(ae,oe.length-ce),1)):ce++,Me=oe[oe.length-le],V.push({command:ki.addLayer,args:[ne[ae],Me]}),oe.splice(oe.length-le,0,ae),ue[ae]=!0);for(le=0;le<U.length;le++)if(ae=U[le],me=J[ae],ge=ne[ae],!ue[ae]&&!s.bv(me,ge))if(s.bv(me.source,ge.source)&&s.bv(me["source-layer"],ge["source-layer"])&&s.bv(me.type,ge.type)){for(Ee in ka(me.layout,ge.layout,V,ae,null,ki.setLayoutProperty),ka(me.paint,ge.paint,V,ae,null,ki.setPaintProperty),s.bv(me.slot,ge.slot)||V.push({command:ki.setSlot,args:[ae,ge.slot]}),s.bv(me.filter,ge.filter)||V.push({command:ki.setFilter,args:[ae,ge.filter]}),s.bv(me.minzoom,ge.minzoom)&&s.bv(me.maxzoom,ge.maxzoom)||V.push({command:ki.setLayerZoomRange,args:[ae,ge.minzoom,ge.maxzoom]}),me)me.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?ka(me[Ee],ge[Ee],V,ae,Ee.slice(6),ki.setPaintProperty):s.bv(me[Ee],ge[Ee])||V.push({command:ki.setLayerProperty,args:[ae,Ee,ge[Ee]]}));for(Ee in ge)ge.hasOwnProperty(Ee)&&!me.hasOwnProperty(Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&Ee!=="slot"&&(Ee.indexOf("paint.")===0?ka(me[Ee],ge[Ee],V,ae,Ee.slice(6),ki.setPaintProperty):s.bv(me[Ee],ge[Ee])||V.push({command:ki.setLayerProperty,args:[ae,Ee,ge[Ee]]}))}else V.push({command:ki.removeLayer,args:[ae]}),Me=oe[oe.lastIndexOf(ae)+1],V.push({command:ki.addLayer,args:[ge,Me]})}(R,v.layers,T)}catch(A){console.warn("Unable to compute style diff:",A),T=[{command:ki.setStyle,args:[v]}]}return T}(this.serialize(),t).filter(y=>!(y.command in Kp));if(u.length===0)return!1;const p=u.filter(y=>!(y.command in Xp));if(p.length>0)throw new Error(`Unimplemented: ${p.map(y=>y.command).join(", ")}.`);const m=[];return u.forEach(y=>{m.push(this[y.command](...y.args))}),r&&Promise.all(m).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[r,u]of t.entries()){if(this.getImage(r))return this.fire(new s.z(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,u),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,r,u=!1){this.imageManager.updateImage(t,this.scope,r),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(t,r,u={}){return this._checkLoaded(),this._validate(de,`models.${t}`,r,null,u)||(this.modelManager.addModel(t,r,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Fo,`sources.${t}`,r,null,u))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=pl(t,r,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const m=y=>{const v=(y?"symbol:":"other:")+p.id,T=s.C(v,this.scope),A=this._sourceCaches[v]=new hs(T,p,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=A,A.onAdd(this.map)};m(!1),r.type!=="vector"&&r.type!=="geojson"||m(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([m,y])=>y.type==="source"&&y.source===t);if(p)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const m=s.d8(p.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(p.id),p.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const u=this.getOwnSourceCache(r);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const u=t[r]._tiles;for(const p in u){const m=u[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const p of t){if(this._validate(Da,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const m=this.ambientLight;m.set(p),m.updateTransitions(r)}else this.ambientLight=new Yn(p,fn||(fn=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const m=this.directionalLight;m.set(p),m.updateTransitions(r)}else this.directionalLight=new Yn(p,Bi||(Bi=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new s.aa(this.z||0,r);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const u=P=>.2126*(P[0]<=.03928?P[0]/12.92:Math.pow((P[0]+.055)/1.055,2.4))+.7152*(P[1]<=.03928?P[1]/12.92:Math.pow((P[1]+.055)/1.055,2.4))+.0722*(P[2]<=.03928?P[2]/12.92:Math.pow((P[2]+.055)/1.055,2.4)),p=t.properties.get("color").toRenderColor(null).toArray01(),m=t.properties.get("intensity"),y=t.properties.get("direction"),v=1-s.cR(y.x,y.y,y.z)[2]/90,T=u(p)*m*v,A=r.properties.get("color").toRenderColor(null).toArray01(),C=r.properties.get("intensity"),R=u(A)*C;return Number(((T+R)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.d9(t)){const r=s.da(t),u=this.fragments.find(({id:m})=>m===r);if(!u)return;const p=s.d8(t);return u.style.getFragmentStyle(p)}{const r=this.fragments.find(({id:u})=>u===t);return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},u=(p,m="")=>`${p}::${m}`;this._featuresetSelectors={};for(const p in t){const m=this._featuresetSelectors[p]=[];for(const y of t[p].selectors){if(y.featureNamespace){const T=this.getOwnLayer(y.layer);if(!T){s.w(`Layer is undefined for selector: ${y.layer}`);continue}const A=u(T.source,T.sourceLayer);if(A in r&&r[A]!==y.featureNamespace){s.w(`"featureNamespace ${y.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}r[A]=y.featureNamespace}let v;if(y.properties)for(const T in y.properties){const A=s.X(y.properties[T]);A.result==="success"&&(v=v||{},v[T]=A.value)}m.push({layerId:y.layer,namespace:y.featureNamespace,properties:v,uniqueFeatureID:y._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const u=[];for(const p in r.stylesheet.featuresets)u.push({featuresetId:p,importId:r.scope?r.scope:void 0});return u}getFeaturesetLayers(t,r){const u=this.getFragmentStyle(r),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const m=[];for(const y of p[t].selectors){const v=u.getOwnLayer(y.layer);v&&m.push(v)}return m}getConfigProperty(t,r){const u=this.getFragmentStyle(t);if(!u)return null;const p=s.C(r,u.scope),m=u.options.get(p),y=m?m.value||m.default:null;return y?y.serialize():null}setConfigProperty(t,r,u){const p=this.getFragmentStyle(t);if(!p)return;const m=p.stylesheet.indoor?qp(p.stylesheet.schema):p.stylesheet.schema;if(!m||!m[r])return;const y=s.X(u);if(y.result!=="success")return void ca(this,y.value);const v=y.value.expression,T=s.C(r,p.scope),A=p.options.get(T);if(!A)return;let C;const{minValue:R,maxValue:P,stepValue:L,type:j,values:V}=m[r],G=s.X(m[r].default);G.result==="success"&&(C=G.value.expression),C?(this.options.set(T,Object.assign({},A,{value:v,default:C,minValue:R,maxValue:P,stepValue:L,type:j,values:V})),this.updateConfigDependencies(r)):this.fire(new s.z(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const u=r.stylesheet.schema;if(!u)return null;const p={};for(const m in u){const y=s.C(m,r.scope),v=r.options.get(y),T=v?v.value||v.default:null;p[m]=T?T.serialize():null}return p}setConfig(t,r){const u=this.getFragmentStyle(t);u&&(u.updateConfig(r,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=r,u.updateConfig(u._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const u in r){let p,m;const y=s.X(r[u].default);if(y.result==="success"&&(p=y.value.expression),t&&t[u]!==void 0){const P=s.X(t[u]);P.result==="success"&&(m=P.value.expression)}const{minValue:v,maxValue:T,stepValue:A,type:C,values:R}=r[u];if(p){const P=s.C(u,this.scope);this.options.set(P,{default:p,value:m,minValue:v,maxValue:T,stepValue:A,type:C,values:R})}else this.fire(new s.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const u=this.getLayer(r);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(r=>{const u=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(u){const p=r._evaluateColorThemeData(u);(!r._styleColorTheme.lut&&p!==""||r._styleColorTheme.lut&&p!==r._styleColorTheme.lut.data)&&r.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,r,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new s.z(new Error(`Layer with id "${p}" already exists on this map`)));let m;if(t.type==="custom"){if(ca(this,s.db(t)))return;m=s.dc(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=s.d7(t),t=s.l(t,{source:p})),this._validate(B,`layers.${p}`,t,{arrayIndex:-1},u))return;m=s.dc(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:p}})}m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid);let y=this._order.length;if(r){const C=this._order.indexOf(r);if(C===-1)return void this.fire(new s.z(new Error(`Layer with id "${r}" does not exist on this map.`)));m.slot===this._layers[r].slot?y=C:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,p),this._layerOrderChanged=!0,this._layers[p]=m;const v=this.getOwnLayerSourceCache(m),T=!!this.directionalLight&&this.directionalLight.shadowsEnabled();v&&m.canCastShadows()&&T&&(v.castsShadows=!0);const A=this._changes.getRemovedLayer(m);if(A&&m.source&&v&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const C=s.C(m.source,m.scope);A.type!==m.type?this._changes.updateSourceCache(C,"clear"):(this._changes.updateSourceCache(C,"reload"),v.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===r)return;const p=this._order.indexOf(t);this._order.splice(p,1);let m=this._order.length;if(r){const y=this._order.indexOf(r);if(y===-1)return void this.fire(new s.z(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?m=y:s.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const p=this.getOwnLayerSourceCache(r);if(p&&p.castsShadows){let m=!1;for(const y in this._layers)if(this._layers[y].source===r.source&&this._layers[y].canCastShadows()){m=!0;break}p.castsShadows=m}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===r&&p.maxzoom===u||(r!=null&&(p.minzoom=r),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==r&&(u.slot=r,this._updateLayer(u))}setFilter(t,r,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!s.bv(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(q,`layers.${p.id}.filter`,r,{layerType:p.type},u)||(p.filter=s.d7(r),this._updateLayer(p)))}getFilter(t){const r=this._checkLayer(t);if(r)return s.d7(r.filter)}setLayoutProperty(t,r,u,p={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.bv(m.getLayoutProperty(r),u)){if(u!=null&&(!p||p.validate!==!1)&&ca(m,he.call(Ms,{key:`layers.${t}.layout.${r}`,layerType:m.type,objectKey:r,value:u,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(r,u),m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),this._updateLayer(m)}}getLayoutProperty(t,r){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(r)}setPaintProperty(t,r,u,p={}){this._checkLoaded();const m=this._checkLayer(t);if(!m||s.bv(m.getPaintProperty(r),u)||u!=null&&(!p||p.validate!==!1)&&ca(m,ie.call(Ms,{key:`layers.${t}.paint.${r}`,layerType:m.type,objectKey:r,value:u,styleSpec:s.a5})))return;const y=m.setPaintProperty(r,u);m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),y&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(t,r){const u=this._checkLayer(t);if(u)return u.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:T,importId:A}=t.target,C=this.getFragmentStyle(A),R=C.getFeaturesetLayers(T);for(const{source:P,sourceLayer:L}of R)C.setFeatureState({id:t.id,source:P,sourceLayer:L},r)}else if("layerId"in t.target){const{layerId:T}=t.target,A=this.getLayer(T);this.setFeatureState({id:t.id,source:A.source,sourceLayer:A.sourceLayer},r)}return}const u=t.source,p=t.sourceLayer,m=this._checkSource(u);if(!m)return;const y=m.type;if(y==="geojson"&&p)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(y==="vector"&&!p)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const v=this.getOwnSourceCaches(u);for(const T of v)T.setFeatureState(p,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:T,importId:A}=t.target,C=this.getFragmentStyle(A),R=C.getFeaturesetLayers(T);for(const{source:P,sourceLayer:L}of R)C.removeFeatureState({id:t.id,source:P,sourceLayer:L},r)}else if("layerId"in t.target){const{layerId:T}=t.target,A=this.getLayer(T);this.removeFeatureState({id:t.id,source:A.source,sourceLayer:A.sourceLayer},r)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const m=p.type,y=m==="vector"?t.sourceLayer:void 0;if(m==="vector"&&!y)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const v=this.getOwnSourceCaches(u);for(const T of v)T.removeFeatureState(y,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let m;if("featuresetId"in t.target){const{featuresetId:y,importId:v}=t.target,T=this.getFragmentStyle(v),A=T.getFeaturesetLayers(y);for(const{source:C,sourceLayer:R}of A){const P=T.getFeatureState({id:t.id,source:C,sourceLayer:R});if(P&&!m)m=P;else if(!s.bv(m,P))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:y}=t.target,v=this.getLayer(y);m=this.getFeatureState({id:t.id,source:v.source,sourceLayer:v.sourceLayer})}return m}const r=t.source,u=t.sourceLayer,p=this._checkSource(r);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(u,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),u=s.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=v=>this._mergedLayers[v].is3D(!!this.terrain),u=this.order,p={},m=[];for(let v=u.length-1;v>=0;v--){const T=u[v];if(r(T)){p[T]=v;for(const A of t){const C=A[T];if(C)for(const R of C)m.push(R)}}}m.sort((v,T)=>T.intersectionZ-v.intersectionZ);const y=[];for(let v=u.length-1;v>=0;v--){const T=u[v];if(r(T))for(let A=m.length-1;A>=0;A--){const C=m[A].feature;if(C.layer&&p[C.layer.id]<v)break;y.push(C),m.pop()}else for(const A of t){const C=A[T];if(C)for(const R of C)y.push(R.feature)}}return y}queryRenderedFeatures(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(q,"queryRenderedFeatures.filter",r.filter,null,r),p=s.b3(r.filter));const m={},y=C=>{if($o.has(C.type))return;const R=this.getOwnLayerSourceCache(C),P=m[R.id]=m[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};C.is3D(!!this.terrain)&&(P.has3DLayers=!0),P.layers[C.fqid]=P.layers[C.fqid]||{styleLayer:C,targets:[]},P.layers[C.fqid].targets.push({filter:p})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const C of r.layers){const R=this._layers[C];if(!R)return this.fire(new s.z(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];y(R)}}else for(const C in this._layers)y(this._layers[C]);const v=this._queryRenderedFeatures(t,m,u),T=this._flattenAndSortRenderedFeatures(v),A=[];for(const C of T)s.de(C.layer.id)===this.scope&&A.push(C);return A}queryRenderedFeatureset(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(q,"queryRenderedFeatures.filter",r.filter,null,r),p=s.b3(r.filter));const m="mock",y=[];if(r&&r.target)y.push(Object.assign({},r,{targetId:m,filter:p}));else{const C=this.getFeaturesetDescriptors();for(const R of C)y.push({targetId:m,filter:p,target:R});for(const{style:R}of this.fragments){const P=R.getFeaturesetDescriptors();for(const L of P)y.push({targetId:m,filter:p,target:L})}}const v=this.queryRenderedTargets(t,y,u),T=[],A=new Set;for(const C of v)for(const R of C.variants[m])fc(R,C,A)||T.push(new s.df(C,R));return T}queryRenderedTargets(t,r,u){const p={},m=(v,T,A,C)=>{const R=p[T.id]=p[T.id]||{sourceCache:T,layers:{},has3DLayers:!1};if(R.layers[v.fqid]=R.layers[v.fqid]||{styleLayer:v,targets:[]},v.is3D(!!this.terrain)&&(R.has3DLayers=!0),!C)return A.uniqueFeatureID=!1,void R.layers[v.fqid].targets.push(A);R.layers[v.fqid].targets.push(Object.assign({},A,{namespace:C.namespace,properties:C.properties,uniqueFeatureID:C.uniqueFeatureID}))};for(const v of r)if("featuresetId"in v.target){const{featuresetId:T,importId:A}=v.target,C=this.getFragmentStyle(A);if(!C||!C._featuresetSelectors)continue;const R=C._featuresetSelectors[T];if(!R){this.fire(new s.z(new Error(`The featureset '${T}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const P of R){const L=C.getOwnLayer(P.layerId);L&&!$o.has(L.type)&&m(L,C.getOwnLayerSourceCache(L),v,P)}}else if("layerId"in v.target){const{layerId:T}=v.target,A=this.getLayer(T);if(!A||$o.has(A.type))continue;m(A,this.getLayerSourceCache(A),v)}const y=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(y)}_queryRenderedFeatures(t,r,u){const p=[],m=!!this.map._showQueryGeometry,y=pr.createFromScreenPoints(t,u);for(const v in r){const T=La(y,r[v],this._availableImages,u,m);Object.keys(T).length&&p.push(T)}if(this.placement)for(const v in r){if(!r[v].sourceCache._onlySymbols)continue;const T=pc(y.screenGeometry,r[v],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(T).length&&p.push(T)}return p}querySourceFeatures(t,r){const u=r&&r.filter;u&&this._validate(q,"querySourceFeatures.filter",u,null,r);let p=[];const m=this.getOwnSourceCaches(t);for(const y of m)p=p.concat(fd(y,r));return p}addSourceType(t,r,u){return Ys.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Ys.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const v in t)if(!s.bv(t[v],p[v])){m=!0;break}if(!m)return;const y=this._getTransitionParameters();this.light.setLight(t,r,u),this.light.updateTransitions(y)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const v="terrain-dem-src";this.addSource(v,u.source),u=s.d7(u),u=s.l(u,{source:v})}const m=s.l({},u),y={};if(this.terrain&&p){m.source=this.terrain.get().source;const v=this.terrain?this.getFragmentStyle(this.terrain.scope):null;v&&(y.style=v.serialize())}if(this._validate(dt,"terrain",m,y))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&r!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,r),this.fire(new s.A("data",{dataType:"style"}))}else{const m=this.terrain,y=m.get();for(const v of Object.keys(s.a5.terrain))!u.hasOwnProperty(v)&&s.a5.terrain[v].default&&(u[v]=s.a5.terrain[v].default);for(const v in t)if(!s.bv(t[v],y[v])){m.set(t,this.options),this.stylesheet.terrain=t;const T=this._getTransitionParameters({duration:0});m.updateTransitions(T),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new pi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createSnow(t){const r=this.snow=new pn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createRain(t){const r=this.rain=new _n(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!s.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!s.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!s.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(r);this._loadColorTheme(u).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(p=>{s.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=r,u._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):r.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const u=this.terrain=new Ge(t,r,this.scope,this.options);r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,u,p,m={}){if(m&&m.validate===!1)return!1;const y=s.l({},this.serialize());return ca(this,t.call(Ms,s.l({key:r,style:y,value:u,styleSpec:s.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const u of r)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const u of r)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let r;this.directionalLight&&(r=Td(this.directionalLight));const u=new Set;for(const p in this._mergedLayers){const m=this._mergedLayers[p];m.hasElevation()&&!u.has(m.source)&&u.add(m.source)}for(const p in this._mergedSourceCaches){const m=this._mergedSourceCaches[p],y=u.has(m._source.id);m.update(t,void 0,void 0,r,y)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,u,p,m,y,v=!1){let T=!1,A=!1;const C={},R={};for(const P of this._mergedOrder){const L=this._mergedLayers[P];if(L.type!=="symbol")continue;const j=s.C(L.source,L.scope);let V=C[j];if(!V){const U=this.getLayerSourceCache(L);if(!U)continue;const J=U.getRenderableIds(!0).map(ne=>U.getTileByID(ne));R[j]=J.slice(),V=C[j]=J.sort((ne,oe)=>oe.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(oe.tileID)?-1:1))}const G=this.crossTileSymbolIndex.addLayer(L,V,r.center.lng,r.projection);T=T||G}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),r.zoom))&&(this.pauseablePlacement=new fs(r,this._mergedOrder,v,u,p,m,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,R,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),A=!0),T&&this.pauseablePlacement.placement.setStale()),A||T){this._buildingIndex.onNewFrame(r.zoom);for(let P=0;P<this._mergedOrder.length;P++){const L=this._mergedLayers[this._mergedOrder[P]];if(L.type!=="symbol")continue;const j=this.isLayerClipped(L);this.placement.updateLayerOpacities(L,C[s.C(L.source,L.scope)],P,j?y:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:m})=>m===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:m})=>m===r);return p===-1&&this.fire(new s.z(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==u[p].url&&this.setImportUrl(t,r.url),s.bv(r.config,u[p].config)||this.setImportConfig(t,r.config,r.data.schema),s.bv(r.data,u[p].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const m=this.getImportIndex(r);if(m===-1)return this;const y=u[p],v=this.fragments[p];return u=u.filter(({id:T})=>T!==t),this.fragments=this.fragments.filter(({id:T})=>T!==t),this.stylesheet.imports=u.slice(0,m).concat(y).concat(u.slice(m)),this.fragments=this.fragments.slice(0,m).concat(v).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=r;const m=this.fragments[p];return m.style=this._createFragmentStyle(u[p]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:r?(this.fragments[u].style.setState(r),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,r,u){this._checkLoaded();const p=this.getImportIndex(t),m=this.stylesheet.imports||[];if(p===-1)return this;r?m[p].config=r:delete m[p].config;const y=this.fragments[p];u&&y.style.stylesheet&&(y.style.stylesheet.schema=u);const v=y.style.stylesheet&&y.style.stylesheet.schema;return y.config=r,y.style.updateConfig(r,v),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(r.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return r===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[r];u&&t.push(u.getSource())}return t}getSource(t,r){const u=this.getSourceCache(t,r);return u&&u.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const u=s.C(t,r);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const r=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const u=t[r];u==="reload"?this.reloadSource(r):u==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const u of r){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,r,u){this.imageManager.getImages(r.images,r.scope,u),this._updateTilesForChangedImages();const p=y=>{if(y){const v=r.images.map(T=>s.I.toString(T));y.setDependencies(r.tileID.key,r.type,v)}},m=s.C(r.source,r.scope);p(this._mergedOtherSourceCaches[m]),p(this._mergedSymbolSourceCaches[m])}rasterizeImages(t,r,u){this.imageManager.rasterizeImages(r,u)}getGlyphs(t,r,u){this.glyphManager.getGlyphs(r.stacks,r.scope,u)}getResource(t,r,u){return s.dh(r,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):r.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(u||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ys.getSourceType=function(c){return dc[c]},Ys.setSourceType=function(c,t){dc[c]=t},Ys.registerForPluginStateChange=s.c$;var Sl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,El=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ad=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Nu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Us=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Vu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Id=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ju=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Uu=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Cd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const $a=[];Il(Sl,$a),Il(Ad,$a),Il(El,$a);const Js={"_prelude_fog.vertex.glsl":Vu,"_prelude_terrain.vertex.glsl":Us,"_prelude_shadow.vertex.glsl":Uu,"_prelude_fog.fragment.glsl":pt,"_prelude_shadow.fragment.glsl":Cd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Id,"_prelude_raster_particle.glsl":ju},Al={};Ri("",Us),Ri(pt,Vu),Ri(Cd,Uu),Ri(Id,""),Ri(ju,"");const ua=Ri(El,Ad),Cc=Sl;var Ga={background:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ri("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ri(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ri("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ri("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ri(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ri(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ri(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ri(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ri(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ri("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ri("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ri(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ri(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ri("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ri(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nu),skyboxGradient:Ri(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Nu),skyboxCapture:Ri(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ri(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ri(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ri(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ri(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ri("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ri("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ri("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ri("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Il(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of r)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const m of p)t.includes(m)||t.push(m)}}function Ri(c,t){const r=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(A=>{const C=A.split(" ");return C[C.length-1]}),p=[...new Set(p)]);const m={},y=[],v=[];if(c=c.replace(r,(A,C)=>(v.push(C),"")),(t=t.replace(r,(A,C)=>(y.push(C),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let T=[...$a];Il(c,T),Il(t,T);for(const A of[...y,...v])Js[A]||console.error(`Undefined include: ${A}`),Al[A]||(Al[A]=[],Il(Js[A],Al[A])),T=[...T,...Al[A]];return{fragmentSource:c=c.replace(u,(A,C,R,P,L)=>(m[L]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${R} ${P} ${L};
#else
uniform ${R} ${P} u_${L};
#endif
`:C==="initialize"?`
#ifdef HAS_UNIFORM_u_${L}
    ${R} ${P} ${L} = u_${L};
#endif
`:C==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${R} ${P} ${L};
#endif
`:C==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(A,C,R,P,L)=>{const j=P==="float"?"vec2":P,V=L.match(/color/)?"color":j;return C==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${L}
in ${R} ${P} a_${L};
#endif
`:m[L]?C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${R} ${j} a_${L};
out ${R} ${P} ${L};
#else
uniform ${R} ${P} u_${L};
#endif
`:C==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${R} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${R} ${P} ${L} = u_${L};
#endif
`:C==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    in ${R} ${P} a_${L};
    out ${R} ${P} ${L};
#endif
`:C==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${L} = a_${L};
#endif
`:void 0:C==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${R} ${j} a_${L};
#else
uniform ${R} ${P} u_${L};
#endif
`:C==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${L}0;
in vec4 a_${L}1;
in vec4 a_${L}2;
in vec4 a_${L}3;
#else
uniform ${R} ${P} u_${L};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${j} a_${L};
#else
uniform ${R} ${P} u_${L};
#endif
`:C==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${L}
    ${R} ${P} ${L} = a_${L};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${R} ${P} ${L} = a_${L};
#else
    ${R} ${P} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${R} ${P} ${L} = unpack_mix_${V}(a_${L}, u_${L}_t);
#else
    ${R} ${P} ${L} = u_${L};
#endif
`}),staticAttributes:p,usedDefines:T,vertexIncludes:y,fragmentIncludes:v}}class Md{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,u,p,m,y,v,T){this.context=t;let A=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!A&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(A=!0);let C=this.boundDynamicVertexBuffers.length!==v.length;for(let R=0;!C&&R<v.length;R++)this.boundDynamicVertexBuffers[R]!==v[R]&&(C=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==u||A||C||this.boundIndexBuffer!==m||this.boundVertexOffset!==y)this.freshBind(r,u,p,m,y,v,T);else{t.bindVertexArrayOES.set(this.vao);for(const R of v)R&&(R.bind(),T&&R.instanceCount&&R.setVertexAttribDivisor(t.gl,r,T));m&&m.dynamicDraw&&m.bind()}}freshBind(t,r,u,p,m,y,v){const T=t.numAttributes,A=this.context,C=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=y,r.enableAttributes(C,t),r.bind(),r.setVertexAttribPointers(C,t,m);for(const R of u)R.enableAttributes(C,t),R.bind(),R.setVertexAttribPointers(C,t,m);for(const R of y)R&&(R.enableAttributes(C,t),R.bind(),R.setVertexAttribPointers(C,t,m),v&&R.instanceCount&&R.setVertexAttribDivisor(C,t,v));p&&p.bind(),A.currentNumAttributes=T}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function W_(c,t){const r=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.ac(0,u/r).toLngLat().lat,new s.ac(0,(u+1)/r).toLngLat().lat]}function Yp(c,t,r,u,p,m,y){const v=c.context,T=v.gl,A=r.hillshadeFBO;if(!A)return;c.prepareDrawTile();const C=c.isTileAffectedByFog(t),R=c.getOrCreateProgram("hillshade",{overrideFog:C});v.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.colorAttachment.get());const P=((G,U,J,ne)=>{const oe=J.paint.get("hillshade-shadow-color"),ue=J.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",le=J.paint.get("hillshade-highlight-color"),ce=J.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ae=J.paint.get("hillshade-accent-color"),me=J.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ge=J.paint.get("hillshade-emissive-strength");let Me=s.al(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")Me-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){const qe=G.style.directionalLight.properties.get("direction"),$e=s.cR(qe.x,qe.y,qe.z);Me=s.al($e[1])}const Ee=!G.options.moving;return{u_matrix:ne||G.transform.calculateProjMatrix(U.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:W_(0,U.tileID),u_light:[J.paint.get("hillshade-exaggeration"),Me],u_shadow:oe.toRenderColor(ue?null:J.lut),u_highlight:le.toRenderColor(ce?null:J.lut),u_emissive_strength:ge,u_accent:ae.toRenderColor(me?null:J.lut)}})(c,r,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(v,R,t.toUnwrapped());const{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:V}=c.getTileBoundsBuffers(r);R.draw(c,T.TRIANGLES,p,m,y,Wt.disabled,P,u.id,L,j,V)}function Pd(c,t,r){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const m=r.getPixels();t.demTexture?t.demTexture.update(m,{premultiply:!1}):t.demTexture=new s.T(u,m,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Rd(c,t,r){const u=c.context,p=u.gl;if(!t.dem)return;const m=t.dem;if(u.activeTexture.set(p.TEXTURE1),Pd(c,t,m),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const y=m.dim;u.activeTexture.set(p.TEXTURE0);let v=t.hillshadeFBO;if(!v){const P=new s.T(u,{width:y,height:y,data:null},p.RGBA8);P.bind(p.LINEAR,p.CLAMP_TO_EDGE),v=t.hillshadeFBO=u.createFramebuffer(y,y,!0,"renderbuffer"),v.colorAttachment.set(P.texture)}u.bindFramebuffer.set(v.framebuffer),u.viewport.set([0,0,y,y]);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:A,tileBoundsSegments:C}=c.getMercatorTileBoundsBuffers(),R=[];c.linearFloatFilteringSupported()&&R.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:R}).draw(c,p.TRIANGLES,It.disabled,qt.disabled,ci.unblended,Wt.disabled,((P,L)=>{const j=L.stride,V=s.bz();return s.c5(V,0,s.aj,-s.aj,0,0,1),s.bo(V,V,[0,-s.aj,0]),{u_matrix:V,u_image:1,u_dimension:[j,j],u_zoom:P.overscaledZ}})(t.tileID,m),r.id,T,A,C),t.needsHillshadePrepare=!1}class Nn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Z_ extends Nn{getDefault(){return s.am.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class X_ extends Nn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class K_ extends Nn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Jp extends Nn{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Y_ extends Nn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class $u extends Nn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class J_ extends Nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Qp extends Nn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Dd extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gu extends Nn{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class zd extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ha extends Nn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ld extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class em extends Nn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cl extends Nn{getDefault(){return s.am.transparent}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mc extends Nn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Hu extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class qu extends Nn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ml extends Nn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Wu=class extends Nn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class kd extends Nn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class tm extends Nn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Od extends Nn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Zu extends Nn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Pc extends Nn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class im extends Nn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class nm extends Nn{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class rm extends Nn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Pl extends Nn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class sm extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Q_ extends Nn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Fd extends Nn{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class ey extends Fd{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Xu extends Fd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Bd extends Fd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nd extends Xu{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Vd=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),jd=(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:r,u_zoom_transition:p,u_merc_center:m,u_image0:0,u_frustum_tl:y,u_frustum_tr:v,u_frustum_br:T,u_frustum_bl:A,u_globe_pos:C,u_globe_radius:R,u_viewport:P,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:L,u_far_z_cutoff:j});function Ud(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const Rl=new class{constructor(){this.operations={}}newMorphing(c,t,r,u,p){if(c in this.operations){const m=this.operations[c];m.to.tileID.key!==r.tileID.key&&(m.queued=r)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Dl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function zl(c,t,r){if(t===0)return 0;const u=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function om(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const Es=c=>({u_matrix:c});function Rc(c,t,r,u,p){if(p>0){const m=s.q.now(),y=(m-c.timeAdded)/p,v=t?(m-t.timeAdded)/p:-1,T=r.getSource(),A=u.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),C=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(c.tileID.overscaledZ-A),R=C&&c.refreshedUponExpiration?1:s.aD(C?y:1-v,0,1);return c.refreshedUponExpiration&&y>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class Ku extends hs{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new s.D(s.d0(),null),p=pl("mock-dem",r,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class Yu extends hs{constructor(t){const r=pl("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.d0(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,y)=>{if(m[y.key]="",!this._tiles[y.key]){const v=new jo(y,this._source.tileSize*y.overscaleFactor(),t.tileZoom);v.state="loaded",this._tiles[y.key]=v}return m},{});for(const m in this._tiles)m in p||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const u=Object.values(r);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ju extends s.aM{constructor(t,r,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=u}}class Qu extends s.dt{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,m]=function(T){const A=new s.ba,C=new s.a_,R=131;A.reserve(17161),C.reserve(33800);const P=s.aj/128,L=s.aj+P/2,j=L+P;for(let G=-P;G<j;G+=P)for(let U=-P;U<j;U+=P){const J=U<0||U>L||G<0||G>L?24575:0,ne=s.aD(Math.round(U),0,s.aj),oe=s.aD(Math.round(G),0,s.aj);A.emplaceBack(ne+J,oe)}const V=(G,U)=>{const J=U*R+G;C.emplaceBack(J+1,J,J+R),C.emplaceBack(J+R,J+R+1,J+1)};for(let G=1;G<129;G++)for(let U=1;U<129;U++)V(U,G);return[0,129].forEach(G=>{for(let U=0;U<130;U++)V(U,G),V(G,U)}),[A,C,32768]}(),y=t.context;this.gridBuffer=y.createVertexBuffer(u,s.bc.members),this.gridIndexBuffer=y.createIndexBuffer(p),this.gridSegments=s.bd.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,u.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Yu(r.map),this.orthoMatrix=s.bz(),s.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const v=y.gl;this._overlapStencilMode=new qt({func:v.GEQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ku(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,m=t.terrain.drapeRenderMode===0,y=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const v=t.terrain&&t.terrain.scope,T=p.get("source"),A=m?this._mockSourceCache:t.getSourceCache(T,v);if(!A)return void s.w(`Couldn't find terrain source "${T}".`);if(this.sourceCache=A,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=y?this.calculateExaggeration(r):p.get("exaggeration"),!r.projection.requiresDraping&&y&&this._exaggeration===0)return void this._disable();this.enabled=!0;const C=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const R=this.getScaledDemTileSize();this.sourceCache.update(r,R,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),r.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=r!=null?u-r:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const m=t.zoom,y=this._style.terrain;if(!this._previousUpdateTimestamp)return y.getExaggeration(m);let v=m-this._previousZoom;const T=this._previousUpdateTimestamp;let A=m;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(m-A)>.5&&(v=.5*(m-A+v)),v*p<0&&(A+=v)),this._evaluationZoom=A;const C=y.getExaggeration(A),R=C===y.getExaggeration(Math.max(0,A-.1));if(R&&Math.abs(C-this._exaggeration)<.01)return C;let P=Math.min(.1,.00375*(this._updateTimestamp-T));return(R||C<.1||Math.abs(v)<1e-4)&&(P=Math.min(.2,4*P)),s.ai(this._exaggeration,C,P)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=r.getIds().map(T=>{const A=r.getTileByID(T).tileID;return A.projMatrix=u.calculateProjMatrix(A.toUnwrapped()),A});(function(T,A){const C=A.transform.pointCoordinate(A.transform.getCameraPoint()),R=new s.P(C.x,C.y);T.sort((P,L)=>{if(L.overscaledZ-P.overscaledZ)return L.overscaledZ-P.overscaledZ;const j=new s.P(P.canonical.x+(1<<P.canonical.z)*P.wrap,P.canonical.y),V=new s.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),G=R.mult(1<<P.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(j)-G.distSqr(V)})})(p,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},p.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};const y=this._style._mergedSourceCaches;for(const T in y){const A=y[T];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,t[T],m),A.usedForTerrain))continue;const C=t[T];A.getSource().reparseOverscaled&&this._assignTerrainTiles(C)}this.proxiedCoords[r.id]=p.map(T=>new Ju(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const v={};this._visibleDemTiles=[];for(const T of this.proxyCoords){const A=this.terrainTileForTile[T.key];if(!A)continue;const C=A.tileID.key;C in v||(this._visibleDemTiles.push(A),v[C]=C)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const u=this._findTileCoveringTileID(r,this.sourceCache);u&&(this.terrainTileForTile[r.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],m=p.dem;!m||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),Pd(this.painter,p,m))}}_prepareDemTileUniforms(t,r,u,p){if(!r||r.demTexture==null)return!1;const m=t.tileID.canonical,y=Math.pow(2,r.tileID.canonical.z-m.z),v=p||"";return u[`u_dem_tl${v}`]=[m.x*y%1,m.y*y%1],u[`u_dem_scale${v}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const m=p.dem.tree.minimums[0];return m>0&&t++,u+m},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new s.du({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(p,{premultiply:!1}):m=this._emptyDEMTexture=new s.T(t,p,r.R32F,{premultiply:!1}),m}setupElevationDraw(t,r,u){const p=this.painter.context,m=p.gl,y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};y.u_exaggeration=this.exaggeration();let v=null,T=null,A=1;if(u&&u.morphing&&this._useVertexMorphing){const L=u.morphing.srcDemTile,j=u.morphing.dstDemTile;A=u.morphing.phase,L&&j&&(this._prepareDemTileUniforms(t,L,y,"_prev")&&(T=L),this._prepareDemTileUniforms(t,j,y)&&(v=j))}const C=L=>L&&L.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST;let R=null;var P;if(this.enabled?T&&v?(R=v.demTexture,p.activeTexture.set(m.TEXTURE4),T.demTexture.bind(C(T),m.CLAMP_TO_EDGE),y.u_dem_lerp=A):(v=this.terrainTileForTile[t.tileID.key],R=this._prepareDemTileUniforms(t,v,y)?v.demTexture:this.emptyDEMTexture):R=this.emptyDEMTexture,p.activeTexture.set(m.TEXTURE2),R&&(y.u_dem_size=(P=R).size[0]===1?1:P.size[0]-2,R.bind(C(v),m.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,r,y),u&&u.useMeterToDem&&v){const L=(1<<v.tileID.canonical.z)*s.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=L}if(u&&u.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),r.setTerrainUniformValues(p,y),this.painter.transform.projection.name==="globe"){const L=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);r.setGlobeUniformValues(p,L)}}globeUniformValues(t,r,u){const p=t.projection;return{u_tile_tl_up:p.upVector(r,0,0),u_tile_tr_up:p.upVector(r,s.aj,0),u_tile_br_up:p.upVector(r,s.aj,s.aj),u_tile_bl_up:p.upVector(r,0,s.aj),u_tile_up_scale:u?s.dv(1):p.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,m,y,v,T){if(p.transform.projection.name==="globe")(function(A,C,R,P,L){const j=A.context,V=j.gl;let G,U;const J=A.transform,ne=s.dl(A,j,J),oe=(qe,$e)=>{if(U===$e)return;const ct=[Dl[$e],"PROJECTION_GLOBE_VIEW"];ne&&ct.push("CUSTOM_ANTIALIASING");const Se=A.isTileAffectedByFog(qe);G=A.getOrCreateProgram("globeRaster",{defines:ct,overrideFog:Se}),U=$e},ue=A.colorModeForRenderPass(),le=new It(V.LEQUAL,It.ReadWrite,A.depthRangeFor3D);Rl.update(L);const ce=s.dm(J),ae=[s.ay(J.center.lng),s.aH(J.center.lat)],me=A.globeSharedBuffers,ge=[J.width*s.q.devicePixelRatio,J.height*s.q.devicePixelRatio],Me=Float32Array.from(J.globeMatrix),Ee={useDenormalizedUpVectorScale:!0};{const qe=A.transform,$e=zl(qe.zoom,C.exaggeration(),C.sourceCache._source.tileSize);U=-1;const ct=V.TRIANGLES;for(const Se of P){const Pe=R.getTile(Se),we=qt.disabled,Xe=C.prevTerrainTileForTile[Se.key],ke=C.terrainTileForTile[Se.key];Ud(Xe,ke)&&Rl.newMorphing(Se.key,Xe,ke,L,250),j.activeTexture.set(V.TEXTURE0),Pe.texture&&Pe.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const Qe=Rl.getMorphValuesForProxy(Se.key),We=Qe?1:0;Qe&&s.L(Ee,{morphing:{srcDemTile:Qe.from,dstDemTile:Qe.to,phase:s.dk(Qe.phase)}});const tt=s.dn(Se.canonical),nt=s.dp(tt.getCenter().lat),At=s.dq(Se.canonical,tt,nt,qe.worldSize/qe._pixelsPerMercatorPixel),Ot=s.bh(s.dr(Se.canonical)),St=jd(qe.expandedFarZProjMatrix,Me,ce,Ot,s.ah(qe.zoom),ae,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,ge,$e,qe._farZ,At);if(oe(Se,We),G&&(C.setupElevationDraw(Pe,G,Ee),A.uploadCommonUniforms(j,G,Se.toUnwrapped()),me)){const[Ft,Mt,Ut]=me.getGridBuffers(nt,$e!==0);G.draw(A,ct,le,we,ue,Wt.backCCW,St,"globe_raster",Ft,Mt,Ut)}}}if(me&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&qe.push("CUSTOM_ANTIALIASING"),G=A.getOrCreateProgram("globeRaster",{defines:qe});for(const $e of P){const{x:ct,y:Se,z:Pe}=$e.canonical,we=Se===0,Xe=Se===(1<<Pe)-1,[ke,Qe,We,tt]=me.getPoleBuffers(Pe,!1);if(tt&&(we||Xe)){const nt=R.getTile($e);j.activeTexture.set(V.TEXTURE0),nt.texture&&nt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let At=s.ds(Pe,ct,J);const Ot=s.bh(s.dr($e.canonical)),St=(Ft,Mt)=>Ft.draw(A,V.TRIANGLES,le,qt.disabled,ue,Wt.disabled,jd(J.expandedFarZProjMatrix,At,At,Ot,0,ae,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,ge,0,J._farZ),"globe_pole_raster",Mt,We,tt);C.setupElevationDraw(nt,G,Ee),A.uploadCommonUniforms(j,G,$e.toUnwrapped()),we&&A.renderDefaultNorthPole&&St(G,ke),Xe&&A.renderDefaultSouthPole&&(At=s.cE(s.bz(),At,[1,-1,1]),St(G,Qe))}}}})(p,m,y,v,T);else{const A=p.context,C=A.gl;let R,P;const L=p.shadowRenderer,j=Ua(p,p.longestCutoffRange),V=ue=>{if(P===ue)return;const le=[];le.push(Dl[ue]),j.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),L&&(le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),L.useNormalOffset&&le.push("NORMAL_OFFSET")),R=p.getOrCreateProgram("terrainRaster",{defines:le}),P=ue},G=p.colorModeForRenderPass(),U=new It(C.LEQUAL,It.ReadWrite,p.depthRangeFor3D);Rl.update(T);const J=p.transform,ne=zl(J.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let oe=[0,0,0];if(L){const ue=p.style.directionalLight,le=p.style.ambientLight;ue&&le&&(oe=Eo(p.style,ue,le))}{P=-1;const ue=C.TRIANGLES,[le,ce]=[m.gridIndexBuffer,m.gridSegments];for(const ae of v){const me=y.getTile(ae),ge=qt.disabled,Me=m.prevTerrainTileForTile[ae.key],Ee=m.terrainTileForTile[ae.key];Ud(Me,Ee)&&Rl.newMorphing(ae.key,Me,Ee,T,250),A.activeTexture.set(C.TEXTURE0),me.texture&&me.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const qe=Rl.getMorphValuesForProxy(ae.key),$e=qe?1:0;let ct;qe&&(ct={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:s.dk(qe.phase)}});const Se=Vd(ae.projMatrix,om(ae.canonical,J.renderWorldCopies)?ne/10:ne,oe);if(V($e),!R)continue;m.setupElevationDraw(me,R,ct);const Pe=ae.toUnwrapped();L&&L.setupShadows(Pe,R),p.uploadCommonUniforms(A,R,Pe,null,j),R.draw(p,ue,U,ge,G,Wt.backCCW,Se,"terrain_raster",m.gridBuffer,le,ce)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,u=this.painter.context,p=this.proxySourceCache,m=this.proxiedCoords[p.id],y=this._drapedRenderBatches.shift(),v=r.style.order,T=[];let A=0;for(const C of m){const R=p.getTileByID(C.proxyTileKey),P=p.proxyCachedFBO[C.key]?p.proxyCachedFBO[C.key][t]:void 0,L=P!==void 0?p.renderCache[P]:this.pool[A++],j=P!==void 0;if(R.texture=L.tex,j&&!L.dirty){T.push(R.tileID);continue}let V;u.bindFramebuffer.set(L.fb.framebuffer),this.renderedToTile=!1,L.dirty&&(u.clear({color:s.am.transparent,stencil:0}),L.dirty=!1);for(let G=y.start;G<=y.end;++G){const U=r.style._mergedLayers[v[G]];if(U.isHidden(r.transform.zoom))continue;const J=r.style.getLayerSourceCache(U),ne=J?this.proxyToSource[C.key][J.id]:[C];if(!ne)continue;const oe=ne;u.viewport.set([0,0,L.fb.width,L.fb.height]),V!==(J?J.id:null)&&(this._setupStencil(L,ne,U,J),V=J?J.id:null),r.renderLayer(r,J,U,oe)}if(this._drapedRenderBatches.length===0)for(const G of this._pendingGroundEffectLayers){const U=r.style._mergedLayers[v[G]];if(U.isHidden(r.transform.zoom))continue;const J=r.style.getLayerSourceCache(U),ne=J?this.proxyToSource[C.key][J.id]:[C];if(!ne)continue;const oe=ne;u.viewport.set([0,0,L.fb.width,L.fb.height]),V!==(J?J.id:null)&&(this._setupStencil(L,ne,U,J),V=J?J.id:null),r.renderLayer(r,J,U,oe)}this.renderedToTile?(L.dirty=!0,T.push(R.tileID)):j||--A,A===5&&(A=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),y.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let u=-1,p=r;for(let m=0;m<r;++m)this._style.isLayerDraped(t._mergedLayers[t.order[m]])?u=Math.max(u,m):p=Math.min(p,m);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const y=m.tileID,v=1<<y.overscaledZ,{x:T,y:A}=y.canonical,C=T/v,R=(T+1)/v,P=A/v,L=(A+1)/v;return{minx:C,miny:P,maxx:R,maxy:L,t:m.dem.tree.raycastRoot(C,P,R,L,t,r,u),tile:m}});p.sort((m,y)=>(m.t!==null?m.t:Number.MAX_VALUE)-(y.t!==null?y.t:Number.MAX_VALUE));for(const m of p){if(m.t==null)return null;const y=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,t,r,u);if(y!=null)return y}return null}_createFBO(){const t=this.painter.context,r=t.gl,u=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const p=new s.T(t,{width:u[0],height:u[1],data:null},r.RGBA8);p.bind(r.LINEAR,r.CLAMP_TO_EDGE);const m=t.createFramebuffer(u[0],u[1],!0,null);return m.colorAttachment.set(p.texture),m.depthAttachment=new Nd(t,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:m,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],u=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!u&&r.shouldRedrape():!u&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Yr){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(p);if(m&&!r[m.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof s.ab){r[m.id]=!0;for(const y of this.proxyCoords){const v=this.proxyToSource[y.key][m.id];if(v)for(const T of v)this._clearRenderCacheForTile(m.id,T)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof So){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(p);if(!m||r[m.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const y=p.paint.get("raster-fade-duration");for(const v of this.proxyCoords){const T=this.proxyToSource[v.key][m.id];if(T)for(const A of T){const C=Rc(m.getTile(A),m.findLoadedParent(A,0),m,this.painter.transform,y);(C.opacity!==1||C.mix!==0)&&this._clearRenderCacheForTile(m.id,A)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,m=0,y=this._style._mergedLayers[t[m]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++m<r;)y=this._style._mergedLayers[t[m]];for(;m<r;++m){const v=this._style._mergedLayers[t[m]];v.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(v)?p===void 0&&(p=m):(v.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),p!==void 0&&(u.push({start:p,end:m-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:m-1}),u.length!==0){const v=u[u.length-1];this._pendingGroundEffectLayers.every(T=>T>v.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const y=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let v=0;v<y.length;++v){const T=Object.values(y[v]);r.renderCachePool.push(...T)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let y=u.length-1;y>=0;y--){const v=u[y];if(r.getTileByID(v.key),r.proxyCachedFBO[v.key]!==void 0){const T=t[v.key],A=this.proxyToSource[v.key];let C=0;for(const R in A){const P=A[R],L=T[R];if(!L||L.length!==P.length||P.some((j,V)=>j!==L[V]||p[R]&&p[R].hasOwnProperty(j.key))){C=-1;break}++C}for(const R in r.proxyCachedFBO[v.key])r.renderCache[r.proxyCachedFBO[v.key][R]].dirty=C<0||C!==Object.values(T).length}}const m=[...this._drapedRenderBatches];m.sort((y,v)=>v.end-v.start-(y.end-y.start));for(const y of m)for(const v of u){if(r.proxyCachedFBO[v.key])continue;let T=r.renderCachePool.pop();T===void 0&&r.renderCache.length<50&&(T=r.renderCache.length,r.renderCache.push(this._createFBO())),T!==void 0&&(r.proxyCachedFBO[v.key]={},r.proxyCachedFBO[v.key][y.start]=T,r.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,y=m.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let v;if(u.isTileClipped())v=r.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);v=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+v>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=v,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):qt.disabled}_renderTileClippingMasks(t,r){const u=this.painter,p=this.painter.context,m=p.gl;u._tileClippingMaskIDs={},p.setColorMode(ci.disabled),p.setDepthMode(It.disabled);const y=u.getOrCreateProgram("clippingMask");for(const v of t){const T=u._tileClippingMaskIDs[v.key]=--r;y.draw(u,m.TRIANGLES,It.disabled,new qt({func:m.ALWAYS,mask:0},T,255,m.KEEP,m.KEEP,m.REPLACE),ci.disabled,Wt.disabled,Es(v.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const u=[t.x,t.y,1,1];s.aA(u,u,r.pixelMatrixInverse),s.cw(u,u,1/u[3]),u[0]/=r.worldSize,u[1]/=r.worldSize;const p=r._camera.position,m=s.c6(1,r.center.lat),y=[p[0],p[1],p[2]/m,0],v=s.cY([],u.slice(0,3),y);s.au(v,v);const T=this.raycast(y,v,this._exaggeration);return T!==null&&T?(s.bF(y,y,v,T),y[3]=y[2],y[2]*=m,y):null}_setupProxiedCoordsForOrtho(t,r,u){if(t.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(t,r,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],m=this.proxyCoords;for(let T=0;T<m.length;T++){const A=m[T],C=this._findTileCoveringTileID(A,t);if(C){const R=this._createProxiedId(A,C,u[A.key]&&u[A.key][t.id]);p.push(R),this.proxyToSource[A.key][t.id]=[R]}}let y=!1;const v=new Set;for(let T=0;T<r.length;T++){const A=t.getTile(r[T]);if(!A||!A.hasData())continue;const C=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==A.tileID.canonical.z){const R=this.proxyToSource[C.tileID.key][t.id],P=this._createProxiedId(C.tileID,A,u[C.tileID.key]&&u[C.tileID.key][t.id]);R?R.splice(R.length-1,0,P):this.proxyToSource[C.tileID.key][t.id]=[P];const L=this.proxyToSource[C.tileID.key][t.id];v.has(L)||v.add(L),p.push(P),y=!0}}if(this._sourceTilesOverlap[t.id]=y,y&&this._debugParams.sortTilesHiZFirst)for(const T of v)T.sort((A,C)=>C.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],m=this.proxyCoords,y=t.getSource(),v=y.tileID;if(!v)return;const T=new s.P(v.x,v.y)._div(1<<v.z),A=y.coordinates.map(s.ac.fromLngLat).reduce((R,P)=>(R.min.x=Math.min(R.min.x,P.x-T.x),R.min.y=Math.min(R.min.y,P.y-T.y),R.max.x=Math.max(R.max.x,P.x-T.x),R.max.y=Math.max(R.max.y,P.y-T.y),R),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(R,P)=>{const L=R.wrap+R.canonical.x/(1<<R.canonical.z),j=R.canonical.y/(1<<R.canonical.z),V=s.aj/(1<<R.canonical.z),G=P.wrap+P.canonical.x/(1<<P.canonical.z),U=P.canonical.y/(1<<P.canonical.z);return L+V<G+A.min.x||L>G+A.max.x||j+V<U+A.min.y||j>U+A.max.y};for(let R=0;R<m.length;R++){const P=m[R];for(let L=0;L<r.length;L++){const j=t.getTile(r[L]);if(!j||!j.hasData()||C(P,j.tileID))continue;const V=this._createProxiedId(P,j,u[P.key]&&u[P.key][t.id]),G=this.proxyToSource[P.key][t.id];G?G.push(V):this.proxyToSource[P.key][t.id]=[V],p.push(V)}}}_createProxiedId(t,r,u){let p=this.orthoMatrix;if(u){const m=u.find(y=>y.key===r.tileID.key);if(m)return m}if(r.tileID.key!==t.key){const m=t.canonical.z-r.tileID.canonical.z;let y,v,T;p=s.bz();const A=r.tileID.wrap-t.wrap<<t.overscaledZ;m>0?(y=s.aj>>m,v=y*((r.tileID.canonical.x<<m)-t.canonical.x+A),T=y*((r.tileID.canonical.y<<m)-t.canonical.y)):(y=s.aj<<-m,v=s.aj*(r.tileID.canonical.x-(t.canonical.x+A<<-m)),T=s.aj*(r.tileID.canonical.y-(t.canonical.y<<-m))),s.c5(p,0,y,0,y,0,1),s.bo(p,p,[v,T,0])}return new Ju(r.tileID,t.key,p)}_findTileCoveringTileID(t,r){let u=r.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[r.id],m=p[t.key];if(u=m?r.getTileByID(m):null,u&&u.hasData()||m===null)return u;let y=u?u.tileID:t,v=y.overscaledZ;const T=r.getSource().minzoom,A=[];if(!m){const R=r.getSource().maxzoom;if(t.canonical.z>=R){const P=t.canonical.z-R;r.getSource().reparseOverscaled?(v=Math.max(t.canonical.z+2,r.transform.tileZoom),y=new s.aM(v,t.wrap,R,t.canonical.x>>P,t.canonical.y>>P)):P!==0&&(v=R,y=new s.aM(v,t.wrap,R,t.canonical.x>>P,t.canonical.y>>P))}y.key!==t.key&&(A.push(y.key),u=r.getTile(y))}const C=R=>{A.forEach(P=>{p[P]=R}),A.length=0};for(v-=1;v>=T&&(!u||!u.hasData());v--){u&&C(u.tileID.key);const R=y.calculateScaledKey(v);if(u=r.getTileByID(R),u&&u.hasData())break;const P=p[R];if(P===null)break;P===void 0?A.push(R):u=r.getTileByID(P)}return C(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[r.key]=!0}}function $d(c,t,r){const u=function(v,T,A){const C=s.bE(T,v),R=s.bE(A,[.2126,.7152,.0722]),P=(j,V,G)=>(1-G)*j+G*V,L=P(1-.3*Math.min(R,1),1,Math.min(C+1,1));return P(.92,1,Math.asin(s.aD(T[2],-1,1))/Math.PI+.5)*L}(c,[0,0,1],t),p=[0,0,0];s.b$(p,r.slice(0,3),u);const m=[0,0,0];s.b$(m,t.slice(0,3),c[2]);const y=[0,0,0];return s.cU(y,p,m),s.cX(y)}const eh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Gd=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class th{static cacheKey(t,r,u,p){let m=`${r}${p?p.cacheKey:""}`;for(const y of u)t.usedDefines.includes(y)&&(m+=`/${y}`);return m}constructor(t,r,u,p,m,y){const v=t.gl;this.program=v.createProgram(),this.configuration=p,this.name=r,this.fixedDefines=[...y];const T=p?p.getBinderAttributes():[],A=(u.staticAttributes||[]).concat(T);let C=p?p.defines():[];C=C.concat(y.map(G=>`#define ${G}`));const R=`#version 300 es
`;let P=R+C.concat("precision mediump float;",Cc,ua.fragmentSource).join(`
`);for(const G of u.fragmentIncludes)P+=`
${Js[G]}`;P+=`
${u.fragmentSource}`;let L=R+C.concat("precision highp float;",Cc,ua.vertexSource).join(`
`);for(const G of u.vertexIncludes)L+=`
${Js[G]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(L+=`
uniform int u_instanceID;
`),L+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(L=L.replaceAll("gl_InstanceID","u_instanceID"));const j=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(j,P),v.compileShader(j),v.attachShader(this.program,j);const V=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())this.failedToCreate=!0;else{v.shaderSource(V,L),v.compileShader(V),v.attachShader(this.program,V),this.attributes={},this.numAttributes=A.length;for(let G=0;G<this.numAttributes;G++)if(A[G]){const U=A[G].startsWith("a_")?A[G]:`a_${A[G]}`;v.bindAttribLocation(this.program,G,U),this.attributes[U]=G}v.linkProgram(this.program),v.deleteShader(V),v.deleteShader(j),this.fixedUniforms=m(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(G=>({u_instanceID:new s.cc(G)}))(t)),(y.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(G=>({u_dem:new s.cc(G),u_dem_prev:new s.cc(G),u_dem_tl:new s.c9(G),u_dem_scale:new s.cb(G),u_dem_tl_prev:new s.c9(G),u_dem_scale_prev:new s.cb(G),u_dem_size:new s.cb(G),u_dem_lerp:new s.cb(G),u_exaggeration:new s.cb(G),u_depth:new s.cc(G),u_depth_size_inv:new s.c9(G),u_depth_range_unpack:new s.c9(G),u_occluder_half_size:new s.cb(G),u_occlusion_depth_offset:new s.cb(G),u_meter_to_dem:new s.cb(G),u_label_plane_matrix_inv:new s.c8(G)}))(t)),y.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new s.ca(G),u_tile_tr_up:new s.ca(G),u_tile_br_up:new s.ca(G),u_tile_bl_up:new s.ca(G),u_tile_up_scale:new s.cb(G)}))(t)),y.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new s.c8(G),u_fog_range:new s.c9(G),u_fog_color:new s.cQ(G),u_fog_horizon_blend:new s.cb(G),u_fog_vertical_limit:new s.c9(G),u_fog_temporal_offset:new s.cb(G),u_frustum_tl:new s.ca(G),u_frustum_tr:new s.ca(G),u_frustum_br:new s.ca(G),u_frustum_bl:new s.ca(G),u_globe_pos:new s.ca(G),u_globe_radius:new s.cb(G),u_globe_transition:new s.cb(G),u_is_globe:new s.cc(G),u_viewport:new s.c9(G)}))(t)),y.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new s.cQ(G)}))(t)),y.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new s.ca(G),u_lighting_directional_dir:new s.ca(G),u_lighting_directional_color:new s.ca(G),u_ground_radiance:new s.ca(G)}))(t)),y.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new s.c8(G),u_light_matrix_1:new s.c8(G),u_fade_range:new s.c9(G),u_shadow_normal_offset:new s.ca(G),u_shadow_intensity:new s.cb(G),u_shadow_texel_size:new s.cb(G),u_shadow_map_resolution:new s.cb(G),u_shadow_direction:new s.ca(G),u_shadow_bias:new s.ca(G),u_shadowmap_0:new s.cc(G),u_shadowmap_1:new s.cc(G)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}_drawDebugWireframe(t,r,u,p,m,y,v,T,A,C){const R=t.options.wireframe;if(R.terrain===!1&&R.layers2D===!1&&R.layers3D===!1)return;const P=t.context;if(!(!(!R.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!R.layers2D||t._terrain&&t._terrain.renderingToTexture||!eh.includes(this.name))||!(!R.layers3D||!Gd.includes(this.name))))return;const L=P.gl,j=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,m,P);if(!j)return;const V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");const G=t.getOrCreateProgram(this.name,{config:this.configuration,defines:V});P.program.set(G.program);const U=(oe,ue,le)=>{if(ue[oe]&&le[oe])for(const ce in ue[oe])le[oe][ce]&&le[oe][ce].set(le.program,ce,ue[oe][ce].current)};A&&A.setUniforms(G.program,P,G.binderUniforms,v,{zoom:T}),U("fixedUniforms",this,G),U("terrainUniforms",this,G),U("globeUniforms",this,G),U("fogUniforms",this,G),U("lightsUniforms",this,G),U("shadowUniforms",this,G),j.bind(),P.setColorMode(new ci([L.ONE,L.ONE_MINUS_SRC_ALPHA,L.ZERO,L.ONE],s.am.transparent,[!0,!0,!0,!1])),P.setDepthMode(new It(r.func===L.LESS?L.LEQUAL:r.func,It.ReadOnly,r.range)),P.setStencilMode(qt.disabled);const J=3*y.primitiveLength*2,ne=3*y.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const oe=C||1;for(let ue=0;ue<oe;++ue)G.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ue),L.drawElements(L.LINES,J,L.UNSIGNED_SHORT,ne)}else C&&C>1?L.drawElementsInstanced(L.LINES,J,L.UNSIGNED_SHORT,ne,C):L.drawElements(L.LINES,J,L.UNSIGNED_SHORT,ne);m.bind(),P.program.set(this.program),P.setDepthMode(r),P.setStencilMode(u),P.setColorMode(p)}checkUniforms(t,r,u){if(this.fixedDefines.includes(r)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${r} being defined`)}}draw(t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G){const U=t.context,J=U.gl;if(this.failedToCreate)return;U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(p),U.setColorMode(m),U.setCullFace(y);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,v[ue]);j&&j.setUniforms(this.program,U,this.binderUniforms,P,{zoom:L});const ne={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[r];this.checkUniforms(T,"RENDER_SHADOWS",this.shadowUniforms);const oe=G&&G>0?1:void 0;for(const ue of R.get()){const le=ue.vaos||(ue.vaos={});if((le[T]||(le[T]=new Md)).bind(U,this,A,j?j.getPaintVertexBuffers():[],C,ue.vertexOffset,V||[],oe),this.forceManualRenderingForInstanceIDShaders){const ce=G||1;for(let ae=0;ae<ce;++ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ae),C?J.drawElements(r,ue.primitiveLength*ne,J.UNSIGNED_SHORT,ue.primitiveOffset*ne*2):J.drawArrays(r,ue.vertexOffset,ue.vertexLength)}else G&&G>1?J.drawElementsInstanced(r,ue.primitiveLength*ne,J.UNSIGNED_SHORT,ue.primitiveOffset*ne*2,G):C?J.drawElements(r,ue.primitiveLength*ne,J.UNSIGNED_SHORT,ue.primitiveOffset*ne*2):J.drawArrays(r,ue.vertexOffset,ue.vertexLength);r===J.TRIANGLES&&C&&this._drawDebugWireframe(t,u,p,m,C,ue,P,L,j,G)}}}function Dc(c,t,r=0){const u=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,c.transform.tileZoom)/u,m=p*(t.tileID.canonical.x+t.tileID.wrap*u),y=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(t,1,c.transform.tileZoom),u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y],u_pattern_transition:r}}const zc={terrain:0,flat:1},am=s.bz(),qa=(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U)=>{const J=t.style.light,ne=J.properties.get("position"),oe=[ne.x,ne.y,ne.z],ue=s.dx();J.properties.get("anchor")==="viewport"&&(s.dy(ue,-t.transform.angle),s.dz(oe,oe,ue));const le=J.properties.get("color"),ce=t.transform,ae={u_matrix:c,u_lightpos:oe,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_vertical_gradient:+r,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:am,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:zc[A],u_base_type:zc[C],u_ao:p,u_edge_radius:m,u_width_scale:y,u_flood_light_color:j,u_vertical_scale:V,u_flood_light_intensity:G,u_ground_shadow_factor:U};return ce.projection.name==="globe"&&(ae.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],ae.u_zoom_transition=R,ae.u_inv_rot_matrix=L,ae.u_merc_center=P,ae.u_up_dir=ce.projection.upVector(new s.cp(0,0,0),P[0]*s.aj,P[1]*s.aj),ae.u_height_lift=T),ae},ty=(c,t,r,u,p,m)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:u,u_height_type:zc[p],u_base_type:zc[m]}),iy=(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U)=>{const J=qa(c,t,r,u,p,m,y,v,A,C,R,P,L,j,V,G,1,[0,0,0]),ne={u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8};return s.l(J,Dc(t,T,U),ne)},lm=(c,t,r)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:r}),cm=(c,t,r,u,p,m=0)=>s.l(lm(c,t,p),Dc(r,u,m)),ny=(c,t,r,u)=>({u_matrix:c,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:u}),ry=(c,t,r,u,p,m,y=0)=>s.l(cm(c,t,r,u,m,y),{u_world:p}),Hd=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),Lc=(c,t,r,u,p)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:u,u_reset_depth:p}),um=(c,t,r,u)=>{const p=s.aj/r.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},Wa=(c,t,r=1)=>({u_matrix:c,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:r}),hm=s.bz(),dm=(c,t,r,u,p,m,y)=>{const v=c.transform,T=v.projection.name==="globe",A=T?s.dA(v.zoom,t.canonical)*v._pixelsPerMercatorPixel:s.aw(r,1,m),C={u_matrix:t.projMatrix,u_extrude_scale:A,u_intensity:y,u_inv_rot_matrix:hm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){C.u_inv_rot_matrix=u,C.u_merc_center=p,C.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],C.u_zoom_transition=s.ah(v.zoom);const R=p[0]*s.aj,P=p[1]*s.aj;C.u_up_dir=v.projection.upVector(new s.cp(0,0,0),R,P)}return C};function qd(c,[t,r,u,p],[m,y]){if(m===y)return[0,0,0,0];const v=255*(c-1)/(c*(y-m));return[t*v,r*v,u*v,p*v]}function ih(c,t,[r,u]){return r===u?0:.5/c+(t-r)*(c-1)/(c*(u-r))}const ha=(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J,ne,oe)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:m,u_scale_parent:A,u_fade_t:C.mix,u_opacity:C.opacity*R.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:R.paint.get("raster-brightness-min"),u_brightness_high:R.paint.get("raster-brightness-max"),u_saturation_factor:s.dB(R.paint.get("raster-saturation")),u_contrast_factor:s.dC(R.paint.get("raster-contrast")),u_spin_weights:fm(R.paint.get("raster-hue-rotate")),u_perspective_transform:P,u_raster_elevation:L,u_zoom_transition:y,u_merc_center:v,u_cutoff_params:T,u_colorization_mix:qd(s.dD,V,U),u_colorization_offset:ih(s.dD,G,U),u_color_ramp:j,u_texture_offset:[ne/(J+2*ne),J/(J+2*ne)],u_texture_res:[J+2*ne,J+2*ne],u_emissive_strength:oe});function fm(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const $s=.05,Wd=(c,t,r,u,p,m,y,v,T,A,C,R)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:m,u_scale_parent:A,u_fade_t:C.mix,u_opacity:C.opacity,u_image0:0,u_image1:1,u_raster_elevation:R,u_zoom_transition:y,u_merc_center:v,u_cutoff_params:T}),nh=(c,t,r,u,p,m,y,v,T,A)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:u,u_color_ramp:m,u_velocity_res:p,u_max_speed:y,u_uv_offset:v,u_data_scale:[255*T[0],255*T[1]],u_data_offset:A,u_particle_pos_scale:1.1,u_particle_pos_offset:[$s,$s]}),pm=(c,t,r,u,p,m,y,v,T,A)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:u,u_max_speed:p,u_speed_factor:m,u_reset_rate:y,u_rand_seed:Math.random(),u_uv_offset:v,u_data_scale:[255*T[0],255*T[1]],u_data_offset:A,u_particle_pos_scale:1.1,u_particle_pos_offset:[$s,$s]}),Zd=s.bz(),rh=(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J,ne,oe,ue,le)=>{const ce=p.transform,ae={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ce.getCameraToCenterDistance(J),u_rotate_symbol:+r,u_aspect_ratio:ce.width/ce.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:y,u_coord_matrix:v,u_is_text:+A,u_elevation_from_sea:T?1:0,u_pitch_with_map:+u,u_texsize:C,u_texsize_icon:R,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zd,u_up_vector:[0,-1,0],u_color_adj_mat:oe,u_icon_transition:ue||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(J)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:le||1,u_ground_shadow_factor:ne,u_inv_matrix:s.bi(s.bz(),y)};return J.name==="globe"&&(ae.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],ae.u_zoom_transition=j,ae.u_inv_rot_matrix=G,ae.u_merc_center=V,ae.u_camera_forward=ce._camera.forward(),ae.u_ecef_origin=s.dE(ce.globeMatrix,L.toUnwrapped()),ae.u_tile_matrix=Float32Array.from(ce.globeMatrix),ae.u_up_vector=U),ae},sh=(c,t,r,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:u}),mm=(c,t,r,u,p,m,y,v,T)=>s.l(function(A,C,R,P,L,j){const{width:V,height:G}=P.imageManager.getPixelSize(C),U=Math.pow(2,j.tileID.overscaledZ),J=j.tileSize*Math.pow(2,P.transform.tileZoom)/U,ne=J*(j.tileID.canonical.x+j.tileID.wrap*U),oe=J*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:R.tl,u_pattern_br:R.br,u_texsize:[V,G],u_pattern_size:R.displaySize,u_pattern_units_to_pixels:L?[P.transform.width,-1*P.transform.height]:[1/s.aw(j,1,P.transform.tileZoom),1/s.aw(j,1,P.transform.tileZoom)],u_pixel_coord_upper:[ne>>16,oe>>16],u_pixel_coord_lower:[65535&ne,65535&oe]}}(0,m,y,u,v,T),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),oh=new Float32Array(s.bx([])),Za=(c,t,r,u,p,m,y,v,T,A,C,R,P,L=[0,0,0],j)=>{const V=p.style.light,G=V.properties.get("position"),U=[-G.x,-G.y,G.z],J=s.dx();V.properties.get("anchor")==="viewport"&&(s.dy(J,-p.transform.angle),s.dz(U,U,J));const ne=C.alphaMode==="MASK",oe=V.properties.get("color").toRenderColor(null),ue=P.paint.get("model-ambient-occlusion-intensity"),le=P.paint.get("model-color").constantOr(s.am.white).toRenderColor(null),ce=P.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:u||oh,u_lightpos:U,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:L,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+ne,u_alphaCutoff:C.alphaCutoff,u_baseColorFactor:[y.r,y.g,y.b,y.a],u_emissiveFactor:[v[0],v[1],v[2],1],u_metallicFactor:T,u_roughnessFactor:A,u_baseColorTexture:ms.BaseColor,u_metallicRoughnessTexture:ms.MetallicRoughness,u_normalTexture:ms.Normal,u_occlusionTexture:ms.Occlusion,u_emissionTexture:ms.Emission,u_lutTexture:ms.LUT,u_color_mix:[le.r,le.g,le.b,ce],u_aoIntensity:ue,u_emissive_strength:R,u_occlusionTextureTransform:j||[0,0,0,0]}},gm=(c,t=oh,r=oh)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),sy={fillExtrusion:c=>({u_matrix:new s.c8(c),u_lightpos:new s.ca(c),u_lightintensity:new s.cb(c),u_lightcolor:new s.ca(c),u_vertical_gradient:new s.cb(c),u_opacity:new s.cb(c),u_edge_radius:new s.cb(c),u_width_scale:new s.cb(c),u_ao:new s.c9(c),u_height_type:new s.cc(c),u_base_type:new s.cc(c),u_tile_id:new s.ca(c),u_zoom_transition:new s.cb(c),u_inv_rot_matrix:new s.c8(c),u_merc_center:new s.c9(c),u_up_dir:new s.ca(c),u_height_lift:new s.cb(c),u_flood_light_color:new s.ca(c),u_vertical_scale:new s.cb(c),u_flood_light_intensity:new s.cb(c),u_ground_shadow_factor:new s.ca(c)}),fillExtrusionDepth:c=>({u_matrix:new s.c8(c),u_edge_radius:new s.cb(c),u_width_scale:new s.cb(c),u_vertical_scale:new s.cb(c),u_height_type:new s.cc(c),u_base_type:new s.cc(c)}),fillExtrusionPattern:c=>({u_matrix:new s.c8(c),u_lightpos:new s.ca(c),u_lightintensity:new s.cb(c),u_lightcolor:new s.ca(c),u_vertical_gradient:new s.cb(c),u_height_factor:new s.cb(c),u_edge_radius:new s.cb(c),u_width_scale:new s.cb(c),u_ao:new s.c9(c),u_height_type:new s.cc(c),u_base_type:new s.cc(c),u_tile_id:new s.ca(c),u_zoom_transition:new s.cb(c),u_inv_rot_matrix:new s.c8(c),u_merc_center:new s.c9(c),u_up_dir:new s.ca(c),u_height_lift:new s.cb(c),u_image:new s.cc(c),u_texsize:new s.c9(c),u_pixel_coord_upper:new s.c9(c),u_pixel_coord_lower:new s.c9(c),u_tile_units_to_pixels:new s.cb(c),u_opacity:new s.cb(c),u_pattern_transition:new s.cb(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new s.c8(c),u_opacity:new s.cb(c),u_ao_pass:new s.cb(c),u_meter_to_tile:new s.cb(c),u_ao:new s.c9(c),u_flood_light_intensity:new s.cb(c),u_flood_light_color:new s.ca(c),u_attenuation:new s.cb(c),u_edge_radius:new s.cb(c),u_fb:new s.cc(c),u_fb_size:new s.cb(c),u_dynamic_offset:new s.cb(c)}),fill:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_ground_shadow_factor:new s.ca(c)}),fillPattern:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_image:new s.cc(c),u_texsize:new s.c9(c),u_pixel_coord_upper:new s.c9(c),u_pixel_coord_lower:new s.c9(c),u_tile_units_to_pixels:new s.cb(c),u_ground_shadow_factor:new s.ca(c),u_pattern_transition:new s.cb(c)}),fillOutline:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_world:new s.c9(c),u_ground_shadow_factor:new s.ca(c)}),fillOutlinePattern:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_world:new s.c9(c),u_image:new s.cc(c),u_texsize:new s.c9(c),u_pixel_coord_upper:new s.c9(c),u_pixel_coord_lower:new s.c9(c),u_tile_units_to_pixels:new s.cb(c),u_ground_shadow_factor:new s.ca(c),u_pattern_transition:new s.cb(c)}),building:c=>({u_matrix:new s.c8(c),u_normal_matrix:new s.c8(c),u_opacity:new s.cb(c)}),buildingDepth:c=>({u_matrix:new s.c8(c)}),elevatedStructuresDepth:c=>({u_matrix:new s.c8(c),u_depth_bias:new s.cb(c)}),elevatedStructures:c=>({u_matrix:new s.c8(c),u_ground_shadow_factor:new s.ca(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new s.c8(c),u_camera_pos:new s.ca(c),u_depth_bias:new s.cb(c),u_height_scale:new s.cb(c),u_reset_depth:new s.cb(c)}),circle:s.dF,collisionBox:c=>({u_matrix:new s.c8(c),u_camera_to_center_distance:new s.cb(c),u_extrude_scale:new s.c9(c)}),collisionCircle:c=>({u_matrix:new s.c8(c),u_inv_matrix:new s.c8(c),u_camera_to_center_distance:new s.cb(c),u_viewport_size:new s.c9(c)}),debug:c=>({u_color:new s.di(c),u_matrix:new s.c8(c),u_overlay:new s.cc(c),u_overlay_scale:new s.cb(c)}),clippingMask:c=>({u_matrix:new s.c8(c)}),heatmap:c=>({u_extrude_scale:new s.cb(c),u_intensity:new s.cb(c),u_matrix:new s.c8(c),u_inv_rot_matrix:new s.c8(c),u_merc_center:new s.c9(c),u_tile_id:new s.ca(c),u_zoom_transition:new s.cb(c),u_up_dir:new s.ca(c)}),heatmapTexture:c=>({u_image:new s.cc(c),u_color_ramp:new s.cc(c),u_opacity:new s.cb(c)}),hillshade:c=>({u_matrix:new s.c8(c),u_image:new s.cc(c),u_latrange:new s.c9(c),u_light:new s.c9(c),u_shadow:new s.di(c),u_highlight:new s.di(c),u_emissive_strength:new s.cb(c),u_accent:new s.di(c)}),hillshadePrepare:c=>({u_matrix:new s.c8(c),u_image:new s.cc(c),u_dimension:new s.c9(c),u_zoom:new s.cb(c)}),line:s.dG,linePattern:s.dH,raster:c=>({u_matrix:new s.c8(c),u_normalize_matrix:new s.c8(c),u_globe_matrix:new s.c8(c),u_merc_matrix:new s.c8(c),u_grid_matrix:new s.dj(c),u_tl_parent:new s.c9(c),u_scale_parent:new s.cb(c),u_fade_t:new s.cb(c),u_opacity:new s.cb(c),u_image0:new s.cc(c),u_image1:new s.cc(c),u_brightness_low:new s.cb(c),u_brightness_high:new s.cb(c),u_saturation_factor:new s.cb(c),u_contrast_factor:new s.cb(c),u_spin_weights:new s.ca(c),u_perspective_transform:new s.c9(c),u_raster_elevation:new s.cb(c),u_zoom_transition:new s.cb(c),u_merc_center:new s.c9(c),u_cutoff_params:new s.cQ(c),u_colorization_mix:new s.cQ(c),u_colorization_offset:new s.cb(c),u_color_ramp:new s.cc(c),u_texture_offset:new s.c9(c),u_texture_res:new s.c9(c),u_emissive_strength:new s.cb(c)}),rasterParticle:c=>({u_matrix:new s.c8(c),u_normalize_matrix:new s.c8(c),u_globe_matrix:new s.c8(c),u_merc_matrix:new s.c8(c),u_grid_matrix:new s.dj(c),u_tl_parent:new s.c9(c),u_scale_parent:new s.cb(c),u_fade_t:new s.cb(c),u_opacity:new s.cb(c),u_image0:new s.cc(c),u_image1:new s.cc(c),u_raster_elevation:new s.cb(c),u_zoom_transition:new s.cb(c),u_merc_center:new s.c9(c),u_cutoff_params:new s.cQ(c)}),rasterParticleTexture:c=>({u_texture:new s.cc(c),u_opacity:new s.cb(c)}),rasterParticleDraw:c=>({u_particle_texture:new s.cc(c),u_particle_texture_side_len:new s.cb(c),u_tile_offset:new s.c9(c),u_velocity:new s.cc(c),u_color_ramp:new s.cc(c),u_velocity_res:new s.c9(c),u_max_speed:new s.cb(c),u_uv_offset:new s.c9(c),u_data_scale:new s.c9(c),u_data_offset:new s.cb(c),u_particle_pos_scale:new s.cb(c),u_particle_pos_offset:new s.c9(c)}),rasterParticleUpdate:c=>({u_particle_texture:new s.cc(c),u_particle_texture_side_len:new s.cb(c),u_velocity:new s.cc(c),u_velocity_res:new s.c9(c),u_max_speed:new s.cb(c),u_speed_factor:new s.cb(c),u_reset_rate:new s.cb(c),u_rand_seed:new s.cb(c),u_uv_offset:new s.c9(c),u_data_scale:new s.c9(c),u_data_offset:new s.cb(c),u_particle_pos_scale:new s.cb(c),u_particle_pos_offset:new s.c9(c)}),symbol:c=>({u_is_size_zoom_constant:new s.cc(c),u_is_size_feature_constant:new s.cc(c),u_size_t:new s.cb(c),u_size:new s.cb(c),u_camera_to_center_distance:new s.cb(c),u_rotate_symbol:new s.cc(c),u_aspect_ratio:new s.cb(c),u_fade_change:new s.cb(c),u_matrix:new s.c8(c),u_label_plane_matrix:new s.c8(c),u_coord_matrix:new s.c8(c),u_is_text:new s.cc(c),u_elevation_from_sea:new s.cc(c),u_pitch_with_map:new s.cc(c),u_texsize:new s.c9(c),u_texsize_icon:new s.c9(c),u_texture:new s.cc(c),u_texture_icon:new s.cc(c),u_gamma_scale:new s.cb(c),u_device_pixel_ratio:new s.cb(c),u_tile_id:new s.ca(c),u_zoom_transition:new s.cb(c),u_inv_rot_matrix:new s.c8(c),u_merc_center:new s.c9(c),u_camera_forward:new s.ca(c),u_tile_matrix:new s.c8(c),u_up_vector:new s.ca(c),u_ecef_origin:new s.ca(c),u_is_halo:new s.cc(c),u_icon_transition:new s.cb(c),u_color_adj_mat:new s.c8(c),u_scale_factor:new s.cb(c),u_ground_shadow_factor:new s.ca(c),u_inv_matrix:new s.c8(c)}),background:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_opacity:new s.cb(c),u_color:new s.di(c)}),backgroundPattern:c=>({u_matrix:new s.c8(c),u_emissive_strength:new s.cb(c),u_opacity:new s.cb(c),u_image:new s.cc(c),u_pattern_tl:new s.c9(c),u_pattern_br:new s.c9(c),u_texsize:new s.c9(c),u_pattern_size:new s.c9(c),u_pixel_coord_upper:new s.c9(c),u_pixel_coord_lower:new s.c9(c),u_pattern_units_to_pixels:new s.c9(c)}),terrainRaster:c=>({u_matrix:new s.c8(c),u_image0:new s.cc(c),u_skirt_height:new s.cb(c),u_ground_shadow_factor:new s.ca(c)}),skybox:c=>({u_matrix:new s.c8(c),u_sun_direction:new s.ca(c),u_cubemap:new s.cc(c),u_opacity:new s.cb(c),u_temporal_offset:new s.cb(c)}),skyboxGradient:c=>({u_matrix:new s.c8(c),u_color_ramp:new s.cc(c),u_center_direction:new s.ca(c),u_radius:new s.cb(c),u_opacity:new s.cb(c),u_temporal_offset:new s.cb(c)}),skyboxCapture:c=>({u_matrix_3f:new s.dj(c),u_sun_direction:new s.ca(c),u_sun_intensity:new s.cb(c),u_color_tint_r:new s.cQ(c),u_color_tint_m:new s.cQ(c),u_luminance:new s.cb(c)}),globeRaster:c=>({u_proj_matrix:new s.c8(c),u_globe_matrix:new s.c8(c),u_normalize_matrix:new s.c8(c),u_merc_matrix:new s.c8(c),u_zoom_transition:new s.cb(c),u_merc_center:new s.c9(c),u_image0:new s.cc(c),u_grid_matrix:new s.dj(c),u_skirt_height:new s.cb(c),u_far_z_cutoff:new s.cb(c),u_frustum_tl:new s.ca(c),u_frustum_tr:new s.ca(c),u_frustum_br:new s.ca(c),u_frustum_bl:new s.ca(c),u_globe_pos:new s.ca(c),u_globe_radius:new s.cb(c),u_viewport:new s.c9(c)}),globeAtmosphere:c=>({u_frustum_tl:new s.ca(c),u_frustum_tr:new s.ca(c),u_frustum_br:new s.ca(c),u_frustum_bl:new s.ca(c),u_horizon:new s.cb(c),u_transition:new s.cb(c),u_fadeout_range:new s.cb(c),u_color:new s.cQ(c),u_high_color:new s.cQ(c),u_space_color:new s.cQ(c),u_temporal_offset:new s.cb(c),u_horizon_angle:new s.cb(c)}),model:c=>({u_matrix:new s.c8(c),u_lighting_matrix:new s.c8(c),u_normal_matrix:new s.c8(c),u_node_matrix:new s.c8(c),u_lightpos:new s.ca(c),u_lightintensity:new s.cb(c),u_lightcolor:new s.ca(c),u_camera_pos:new s.ca(c),u_opacity:new s.cb(c),u_baseColorFactor:new s.cQ(c),u_emissiveFactor:new s.cQ(c),u_metallicFactor:new s.cb(c),u_roughnessFactor:new s.cb(c),u_baseTextureIsAlpha:new s.cc(c),u_alphaMask:new s.cc(c),u_alphaCutoff:new s.cb(c),u_baseColorTexture:new s.cc(c),u_metallicRoughnessTexture:new s.cc(c),u_normalTexture:new s.cc(c),u_occlusionTexture:new s.cc(c),u_emissionTexture:new s.cc(c),u_lutTexture:new s.cc(c),u_color_mix:new s.cQ(c),u_aoIntensity:new s.cb(c),u_emissive_strength:new s.cb(c),u_occlusionTextureTransform:new s.cQ(c)}),modelDepth:c=>({u_matrix:new s.c8(c),u_instance:new s.c8(c),u_node_matrix:new s.c8(c)}),groundShadow:c=>({u_matrix:new s.c8(c),u_ground_shadow_factor:new s.ca(c)}),stars:c=>({u_matrix:new s.c8(c),u_up:new s.ca(c),u_right:new s.ca(c),u_intensity_multiplier:new s.cb(c)}),snowParticle:c=>({u_modelview:new s.c8(c),u_projection:new s.c8(c),u_time:new s.cb(c),u_cam_pos:new s.ca(c),u_velocityConeAperture:new s.cb(c),u_velocity:new s.cb(c),u_horizontalOscillationRadius:new s.cb(c),u_horizontalOscillationRate:new s.cb(c),u_boxSize:new s.cb(c),u_billboardSize:new s.cb(c),u_simpleShapeParameters:new s.c9(c),u_screenSize:new s.c9(c),u_thinningCenterPos:new s.c9(c),u_thinningShape:new s.ca(c),u_thinningAffectedRatio:new s.cb(c),u_thinningParticleOffset:new s.cb(c),u_particleColor:new s.cQ(c),u_direction:new s.ca(c)}),rainParticle:c=>({u_modelview:new s.c8(c),u_projection:new s.c8(c),u_time:new s.cb(c),u_cam_pos:new s.ca(c),u_texScreen:new s.cc(c),u_velocityConeAperture:new s.cb(c),u_velocity:new s.cb(c),u_boxSize:new s.cb(c),u_rainDropletSize:new s.c9(c),u_distortionStrength:new s.cb(c),u_rainDirection:new s.ca(c),u_color:new s.cQ(c),u_screenSize:new s.c9(c),u_thinningCenterPos:new s.c9(c),u_thinningShape:new s.ca(c),u_thinningAffectedRatio:new s.cb(c),u_thinningParticleOffset:new s.cb(c),u_shapeDirectionalPower:new s.cb(c),u_shapeNormalPower:new s.cb(c),u_mode:new s.cb(c)}),vignette:c=>({u_vignetteShape:new s.ca(c),u_vignetteColor:new s.cQ(c)}),occlusion:c=>({u_matrix:new s.c8(c),u_anchorPos:new s.ca(c),u_screenSizePx:new s.c9(c),u_occluderSizePx:new s.c9(c),u_color:new s.cQ(c)})};class Go{constructor(t,r,u,p){this.id=Go.uniqueIdxCounter,Go.uniqueIdxCounter++,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Go.uniqueIdxCounter,Go.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Go.uniqueIdxCounter=0;const oy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xd{constructor(t,r,u,p,m,y){this.length=r.length,this.attributes=u,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.instanceCount=y,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||m||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let u=0;u<this.attributes.length;u++){const p=r.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,r,u){for(let p=0;p<this.attributes.length;p++){const m=this.attributes[p],y=r.attributes[m.name];y!==void 0&&t.vertexAttribPointer(y,m.components,t[oy[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,r,u){for(let p=0;p<this.attributes.length;p++){const m=r.attributes[this.attributes[p].name];m!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(m,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ah{constructor(t,r,u,p,m){this.context=t,this.width=r,this.height=u;const y=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new ey(t,y)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new Xu(t,y):new Bd(t,y))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class Ll{constructor(t,r){this.gl=t,this.clearColor=new Z_(this),this.clearDepth=new X_(this),this.clearStencil=new K_(this),this.colorMask=new Jp(this),this.depthMask=new Y_(this),this.stencilMask=new $u(this),this.stencilFunc=new J_(this),this.stencilOp=new Qp(this),this.stencilTest=new Dd(this),this.depthRange=new Gu(this),this.depthTest=new zd(this),this.depthFunc=new Ha(this),this.blend=new Ld(this),this.blendFunc=new em(this),this.blendColor=new Cl(this),this.blendEquation=new Mc(this),this.cullFace=new Hu(this),this.cullFaceSide=new qu(this),this.frontFace=new Ml(this),this.program=new Wu(this),this.activeTexture=new kd(this),this.viewport=new tm(this),this.bindFramebuffer=new Od(this),this.bindRenderbuffer=new Zu(this),this.bindTexture=new Pc(this),this.bindVertexBuffer=new im(this),this.bindElementBuffer=new nm(this),this.bindVertexArrayOES=new rm(this),this.pixelStoreUnpack=new Pl(this),this.pixelStoreUnpackPremultiplyAlpha=new sm(this),this.pixelStoreUnpackFlipY=new Q_(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,u){return new Go(this,t,r,u)}createVertexBuffer(t,r,u,p,m){return new Xd(this,t,r,u,p,m)}createRenderbuffer(t,r,u){const p=this.gl,m=p.createRenderbuffer();return this.bindRenderbuffer.set(m),p.renderbufferStorage(p.RENDERBUFFER,t,r,u),this.bindRenderbuffer.set(null),m}createFramebuffer(t,r,u,p){return new ah(this,t,r,u,p)}clear({color:t,depth:r,stencil:u,colorMask:p}){const m=this.gl;let y=0;t&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(p||[!0,!0,!0,!0])),r!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),u!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),m.clear(y)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bv(t.blendFunction,ci.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Xa;function kl(c,t,r,u,p,m,y){const v=c.context,T=v.gl,A=c.transform,C=c.getOrCreateProgram("collisionBox"),R=[];let P=0,L=0;for(let oe=0;oe<u.length;oe++){const ue=u[oe],le=t.getTile(ue),ce=le.getBucket(r);if(!ce)continue;const ae=ku(ue,ce,A);let me=ae;p[0]===0&&p[1]===0||(me=c.translatePosMatrix(ae,le,p,m));const ge=y?ce.textCollisionBox:ce.iconCollisionBox,Me=ce.collisionCircleArray;if(Me.length>0){const Ee=s.bz(),qe=me;s.cB(Ee,ce.placementInvProjMatrix,A.glCoordMatrix),s.cB(Ee,Ee,ce.placementViewportMatrix),R.push({circleArray:Me,circleOffset:L,transform:qe,invTransform:Ee,projection:ce.getProjection()}),P+=Me.length/4,L=P}ge&&(c.terrain&&c.terrain.setupElevationDraw(le,C),C.draw(c,T.LINES,It.disabled,qt.disabled,c.colorModeForRenderPass(),Wt.disabled,um(me,A,le,ce.getProjection()),r.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,A.zoom,null,[ge.collisionVertexBuffer,ge.collisionVertexBufferExt]))}if(!y||!R.length)return;const j=c.getOrCreateProgram("collisionCircle"),V=new s.dI;V.resize(4*P),V._trim();let G=0;for(const oe of R)for(let ue=0;ue<oe.circleArray.length/4;ue++){const le=4*ue,ce=oe.circleArray[le+0],ae=oe.circleArray[le+1],me=oe.circleArray[le+2],ge=oe.circleArray[le+3];V.emplace(G++,ce,ae,me,ge,0),V.emplace(G++,ce,ae,me,ge,1),V.emplace(G++,ce,ae,me,ge,2),V.emplace(G++,ce,ae,me,ge,3)}(!Xa||Xa.length<2*P)&&(Xa=function(oe){const ue=2*oe,le=new s.a_;le.resize(ue),le._trim();for(let ce=0;ce<ue;ce++){const ae=6*ce;le.uint16[ae+0]=4*ce+0,le.uint16[ae+1]=4*ce+1,le.uint16[ae+2]=4*ce+2,le.uint16[ae+3]=4*ce+2,le.uint16[ae+4]=4*ce+3,le.uint16[ae+5]=4*ce+0}return le}(P));const U=v.createIndexBuffer(Xa,!0),J=v.createVertexBuffer(V,s.dJ.members,!0);for(const oe of R){const ue={u_matrix:oe.transform,u_inv_matrix:oe.invTransform,u_camera_to_center_distance:(ne=A).getCameraToCenterDistance(oe.projection),u_viewport_size:[ne.width,ne.height]};j.draw(c,T.TRIANGLES,It.disabled,qt.disabled,c.colorModeForRenderPass(),Wt.disabled,ue,r.id,J,U,s.bd.simpleSegment(0,2*oe.circleOffset,oe.circleArray.length,oe.circleArray.length/2),null,A.zoom)}var ne;J.destroy(),U.destroy()}const kc=s.bz();function Oc(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=s.az([],t,c.globeMatrix);s.bi(r,r);const u=[0,0,0],p=[0,1,0,0];return s.aA(p,p,r),u[0]=p[0],u[1]=p[1],u[2]=p[2],s.au(u,u),u}function lh({width:c,height:t,anchor:r,textOffset:u,textScale:p},m){const{horizontalAlign:y,verticalAlign:v}=s.bV(r),T=-(y-.5)*c,A=-(v-.5)*t,C=s.bU(r,u);return new s.P((T/p+C[0])*m,(A/p+C[1])*m)}function Kd(c,t,r,u,p,m,y,v,T,A){const C=c.text.placedSymbolArray,R=c.text.dynamicLayoutVertexArray,P=c.icon.dynamicLayoutVertexArray,L={},j=c.getProjection(),V=vc(y,j,p),G=p.elevation,U=j.upVectorScale(y.canonical,p.center.lat,p.worldSize).metersToTile;R.clear();for(let J=0;J<C.length;J++){const ne=C.get(J),{tileAnchorX:oe,tileAnchorY:ue,numGlyphs:le}=ne,ce=ne.hidden||!ne.crossTileID||c.allowVerticalPlacement&&!ne.placedOrientation?null:u[ne.crossTileID];if(ce){let ae=0,me=0,ge=0;if(G){const Xe=G?G.getAtTileOffset(y,oe,ue):0,[ke,Qe,We]=j.upVector(y.canonical,oe,ue);ae=Xe*ke*U,me=Xe*Qe*U,ge=Xe*We*U}let[Me,Ee,qe,$e]=Rs(ne.projectedAnchorX+ae,ne.projectedAnchorY+me,ne.projectedAnchorZ+ge,r?V:m);const ct=na(p.getCameraToCenterDistance(j),$e);let Se=s.bJ(c.textSizeData,T,ne)*ct/s.bO;r&&(Se*=c.tilePixelRatio/v);const Pe=lh(ce,Se);r?({x:Me,y:Ee,z:qe}=j.projectTilePoint(oe+Pe.x,ue+Pe.y,y.canonical),[Me,Ee,qe]=Rs(Me+ae,Ee+me,qe+ge,m)):(t&&Pe._rotate(-p.angle),Me+=Pe.x,Ee+=Pe.y,qe=0);const we=c.allowVerticalPlacement&&ne.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let Xe=0;Xe<le;Xe++)s.bL(R,Me,Ee,qe,we);A&&ne.associatedIconIndex>=0&&(L[ne.associatedIconIndex]={x:Me,y:Ee,z:qe,angle:we})}else $i(le,R)}if(A){P.clear();const J=c.icon.placedSymbolArray;for(let ne=0;ne<J.length;ne++){const oe=J.get(ne),{numGlyphs:ue}=oe,le=L[ne];if(oe.hidden||!le)$i(ue,P);else{const{x:ce,y:ae,z:me,angle:ge}=le;for(let Me=0;Me<ue;Me++)s.bL(P,ce,ae,me,ge)}}c.icon.dynamicLayoutVertexBuffer.updateData(P)}c.text.dynamicLayoutVertexBuffer.updateData(R)}function ch(c,t,r,u,p,m,y={}){const v=r.paint.get("icon-translate"),T=r.paint.get("text-translate"),A=r.paint.get("icon-translate-anchor"),C=r.paint.get("text-translate-anchor"),R=r.layout.get("icon-rotation-alignment"),P=r.layout.get("text-rotation-alignment"),L=r.layout.get("icon-pitch-alignment"),j=r.layout.get("text-pitch-alignment"),V=r.layout.get("icon-keep-upright"),G=r.layout.get("text-keep-upright"),U=r.paint.get("icon-color-saturation"),J=r.paint.get("icon-color-contrast"),ne=r.paint.get("icon-color-brightness-min"),oe=r.paint.get("icon-color-brightness-max"),ue=r.layout.get("symbol-elevation-reference")==="sea",le=c.context,ce=le.gl,ae=c.transform,me=R==="map",ge=P==="map",Me=L==="map",Ee=j==="map",qe=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let $e=!1;const ct=c.depthModeForSublayer(0,It.ReadOnly),Se=new It(c.context.gl.LEQUAL,It.ReadOnly,c.depthRangeFor3D),Pe=[s.ay(ae.center.lng),s.aH(ae.center.lat)],we=r.layout.get("text-variable-anchor"),Xe=ae.projection.name==="globe",ke=[],Qe=[0,-1,0];for(const We of u){const tt=t.getTile(We),nt=tt.getBucket(r);if(!nt||nt.projection.name==="mercator"&&Xe||nt.fullyClipped)continue;const At=nt.projection.name==="globe",Ot=At?s.ah(ae.zoom):0,St=vc(We,nt.getProjection(),ae),Ft=ae.calculatePixelsToTileUnitsMatrix(tt),Mt=we&&nt.hasTextData(),Ut=nt.hasIconTextFit()&&Mt&&nt.hasIconData(),Xt=nt.elevationType==="road"?Se:ct,mi=nt.getProjection().createInversionMatrix(ae,We.canonical),rn=c.shadowRenderer,Yi=nt.elevationType==="road"&&!!rn&&rn.enabled;let bi=[0,0,0];if(Yi){const Rn=c.style.directionalLight,ri=c.style.ambientLight;Rn&&ri&&(bi=Eo(c.style,Rn,ri))}const Vn=Rn=>{ae.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||c.terrain)&&(Rn.push("DEPTH_D24"),Rn.push("DEPTH_OCCLUSION"))},Ln=()=>{const Rn=me&&r.layout.get("symbol-placement")!=="point",ri=[];Vn(ri);const En=Rn||Ut,Li=r.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&Me&&ri.push("PITCH_WITH_MAP_TERRAIN"),At&&(ri.push("PROJECTION_GLOBE_VIEW"),En&&ri.push("PROJECTED_POS_ON_VIEWPORT")),Li>0&&ri.push("ICON_TRANSITION"),nt.icon.zOffsetVertexBuffer&&ri.push("Z_OFFSET"),U===0&&J===0&&ne===0&&oe===1||ri.push("COLOR_ADJUSTMENT"),nt.sdfIcons&&ri.push("RENDER_SDF"),Yi&&ri.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const An=nt.icon.programConfigurations.get(r.id),Gi=c.getOrCreateProgram("symbol",{config:An,defines:ri}),Dn=tt.imageAtlasTexture?tt.imageAtlasTexture.size:[0,0],Ir=nt.iconSizeData,yn=s.bH(Ir,ae.zoom),Lr=Me||ae.pitch!==0,ir=xl(St,tt.tileID.canonical,Me,me,ae,nt.getProjection(),Ft),$r=yd(St,tt.tileID.canonical,Me,me,ae,nt.getProjection(),Ft),yo=c.translatePosMatrix($r,tt,v,A,!0),Zo=c.translatePosMatrix(St,tt,v,A),Ls=En?kc:ir,to=me&&!Me&&!Rn;let Mo=Qe;!Xe&&!ae.mercatorFromTransition||me||(Mo=Oc(ae));const Po=At?Mo:Qe,xo=r.getColorAdjustmentMatrix(U,J,ne,oe),Wl=rh(Ir.kind,yn,to,Me,c,Zo,Ls,yo,ue,!1,Dn,[0,0],!0,We,Ot,Pe,mi,Po,nt.getProjection(),bi,xo,Li),sl=tt.imageAtlasTexture?tt.imageAtlasTexture:null,Ah=r.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear,Ih=nt.sdfIcons||c.options.rotating||c.options.zooming||Ah||Lr?ce.LINEAR:ce.NEAREST,Ch=nt.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,Jc=c.terrain&&Me&&Rn?s.bi(s.bz(),ir):kc;if(Rn&&nt.icon){const In=ae.elevation,Zl=In?In.getAtTileOffsetFunc(We,ae.center.lat,ae.worldSize,nt.getProjection()):null,bf=Ru(St,tt.tileID.canonical,Me,me,ae,nt.getProjection(),Ft);vd(nt,St,c,!1,bf,$r,Me,V,Zl,We)}return{program:Gi,buffers:nt.icon,uniformValues:Wl,atlasTexture:sl,atlasTextureIcon:null,atlasInterpolation:Ih,atlasInterpolationIcon:null,isSDF:nt.sdfIcons,hasHalo:Ch,depthMode:Xt,tile:tt,renderWithShadows:Yi,labelPlaneMatrixInv:Jc}},Qt=()=>{const Rn=ge&&r.layout.get("symbol-placement")!=="point",ri=[],En=Rn||we||Ut;c.terrainRenderModeElevated()&&Ee&&ri.push("PITCH_WITH_MAP_TERRAIN"),At&&(ri.push("PROJECTION_GLOBE_VIEW"),En&&ri.push("PROJECTED_POS_ON_VIEWPORT")),nt.text.zOffsetVertexBuffer&&ri.push("Z_OFFSET"),nt.iconsInText&&ri.push("RENDER_TEXT_AND_SYMBOL"),ri.push("RENDER_SDF"),Yi&&ri.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Vn(ri);const Li=nt.text.programConfigurations.get(r.id),An=c.getOrCreateProgram("symbol",{config:Li,defines:ri});let Gi,Dn=[0,0],Ir=null;const yn=nt.textSizeData;nt.iconsInText&&(Dn=tt.imageAtlasTexture?tt.imageAtlasTexture.size:[0,0],Ir=tt.imageAtlasTexture?tt.imageAtlasTexture:null,Gi=Ee||ae.pitch!==0||c.options.rotating||c.options.zooming||yn.kind==="composite"||yn.kind==="camera"?ce.LINEAR:ce.NEAREST);const Lr=tt.glyphAtlasTexture?tt.glyphAtlasTexture.size:[0,0],ir=r.layout.get("text-size-scale-range"),$r=s.aD(c.scaleFactor,ir[0],ir[1]),yo=s.bH(yn,ae.zoom,$r),Zo=xl(St,tt.tileID.canonical,Ee,ge,ae,nt.getProjection(),Ft),Ls=yd(St,tt.tileID.canonical,Ee,ge,ae,nt.getProjection(),Ft),to=c.translatePosMatrix(Ls,tt,T,C,!0),Mo=c.translatePosMatrix(St,tt,T,C),Po=En?kc:Zo,xo=ge&&!Ee&&!Rn;let Wl=Qe;!Xe&&!ae.mercatorFromTransition||ge||(Wl=Oc(ae));const sl=rh(yn.kind,yo,xo,Ee,c,Mo,Po,to,ue,!0,Lr,Dn,!0,We,Ot,Pe,mi,At?Wl:Qe,nt.getProjection(),bi,null,null,$r),Ah=tt.glyphAtlasTexture?tt.glyphAtlasTexture:null,Ih=ce.LINEAR,Ch=r.paint.get("text-halo-width").constantOr(1)!==0,Jc=c.terrain&&Ee&&Rn?s.bi(s.bz(),Zo):kc;if(Rn&&nt.text){const In=ae.elevation,Zl=In?In.getAtTileOffsetFunc(We,ae.center.lat,ae.worldSize,nt.getProjection()):null,bf=Ru(St,tt.tileID.canonical,Ee,ge,ae,nt.getProjection(),Ft);vd(nt,St,c,!0,bf,Ls,Ee,G,Zl,We)}return{program:An,buffers:nt.text,uniformValues:sl,atlasTexture:Ah,atlasTextureIcon:Ir,atlasInterpolation:Ih,atlasInterpolationIcon:Gi,isSDF:!0,hasHalo:Ch,depthMode:Xt,tile:tt,renderWithShadows:Yi,labelPlaneMatrixInv:Jc}},Mi=nt.icon.segments.get().length,Oi=nt.text.segments.get().length,sn=Mi&&!y.onlyText?Ln():null,ur=Oi&&!y.onlyIcons?Qt():null,Gn=r.paint.get("icon-opacity").constantOr(1),ar=r.paint.get("text-opacity").constantOr(1);if(qe&&nt.canOverlap){$e=!0;const Rn=Gn&&!y.onlyText?nt.icon.segments.get():[],ri=ar&&!y.onlyIcons?nt.text.segments.get():[];for(const En of Rn)ke.push({segments:new s.bd([En]),sortKey:En.sortKey,state:sn});for(const En of ri)ke.push({segments:new s.bd([En]),sortKey:En.sortKey,state:ur})}else y.onlyText||ke.push({segments:Gn?nt.icon.segments:new s.bd([]),sortKey:0,state:sn}),y.onlyIcons||ke.push({segments:ar?nt.text.segments:new s.bd([]),sortKey:0,state:ur})}$e&&ke.sort((We,tt)=>We.sortKey-tt.sortKey);for(const We of ke){const tt=We.state;if(tt)if(c.terrain?c.terrain.setupElevationDraw(tt.tile,tt.program,{useDepthForOcclusion:ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:tt.labelPlaneMatrixInv}):c.setupDepthForOcclusion(ae.depthOcclusionForSymbolsAndCircles,tt.program),le.activeTexture.set(ce.TEXTURE0),tt.atlasTexture&&tt.atlasTexture.bind(tt.atlasInterpolation,ce.CLAMP_TO_EDGE,!0),tt.atlasTextureIcon&&(le.activeTexture.set(ce.TEXTURE1),tt.atlasTextureIcon&&tt.atlasTextureIcon.bind(tt.atlasInterpolationIcon,ce.CLAMP_TO_EDGE,!0)),tt.renderWithShadows&&c.shadowRenderer.setupShadows(tt.tile.tileID.toUnwrapped(),tt.program,"vector-tile",tt.tile.tileID.overscaledZ),c.uploadCommonLightUniforms(c.context,tt.program),tt.hasHalo){const nt=tt.uniformValues;nt.u_is_halo=1,Yd(tt.buffers,We.segments,r,c,tt.program,tt.depthMode,p,m,nt,2),nt.u_is_halo=0}else{if(tt.isSDF){const nt=tt.uniformValues;tt.hasHalo&&(nt.u_is_halo=1,Yd(tt.buffers,We.segments,r,c,tt.program,tt.depthMode,p,m,nt,1)),nt.u_is_halo=0}Yd(tt.buffers,We.segments,r,c,tt.program,tt.depthMode,p,m,tt.uniformValues,1)}}}function Yd(c,t,r,u,p,m,y,v,T,A){const C=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,m,y,v,Wt.disabled,T,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,u.transform.zoom,c.programConfigurations.get(r.id),C,A)}function Ol(c,t){const r=1<<c.canonical.z,u=(t.x*r-c.canonical.x-c.wrap*r)*s.aj,p=(t.y*r-c.canonical.y)*s.aj,m=s.dS(t.z,t.y);return s.cS(u,p,m)}function Fc(c,t,r,u,p){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const m=c.context.gl,y=new It(c.context.gl.LEQUAL,It.ReadWrite,c.depthRangeFor3D),v=new It(c.context.gl.GREATER,It.ReadWrite,c.depthRangeFor3D),T=function(L){const j=s.cJ(L.pitch);let V=.01;return L.isOrthographic&&(V=s.ai(1e-4,V,s.cO(j>=aa?1:j/aa))),2*V}(c.transform),A=c.transform.getFreeCameraOptions().position,C="elevatedStructuresDepthReconstruct",R=c.getOrCreateProgram(C,{defines:["DEPTH_RECONSTRUCTION"]}),P=c.getOrCreateProgram(C);for(const L of u){const j=t.getTile(L),V=j.getBucket(r);if(!V)continue;const G=V.elevatedStructures;if(!G)continue;const U=V.elevationBufferData.heightRange,J=Ol(L.toUnwrapped(),A),ne=c.translatePosMatrix(L.projMatrix,j,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let oe,ue,le,ce;if(p==="initialize"){if(!U||U.min>=1||G.depthSegments.segments[0].primitiveLength===0)continue;oe=Lc(ne,J,T,1,0),ue=y,le=G.depthSegments,ce=R}else if(p==="reset"){if(!U||U.min>=0||G.maskSegments.segments[0].primitiveLength===0)continue;oe=Lc(ne,J,0,0,1),ue=v,le=G.maskSegments,ce=R}else if(p==="geometry"){if(G.depthSegments.segments[0].primitiveLength===0)continue;oe=Lc(ne,J,T,1,0),ue=y,le=G.depthSegments,ce=P}ce.draw(c,m.TRIANGLES,ue,qt.disabled,ci.disabled,Wt.disabled,oe,r.id,G.vertexBuffer,G.indexBuffer,le,r.paint,c.transform.zoom)}}function Tt(c,t,r){const{painter:u,sourceCache:p,layer:m,coords:y,colorMode:v,elevationType:T,terrainEnabled:A,pass:C}=c,R=u.context.gl,P=m.paint.get("fill-pattern"),L=m.paint.get("fill-pattern-cross-fade"),j=P.constantOr(null);let V=T;T!=="road"||t&&!A||(V="none");const G=V==="road",U=c.painter.shadowRenderer,J=G&&!!U&&U.enabled,ne=new It(u.context.gl.LEQUAL,It.ReadOnly,u.depthRangeFor3D);let oe=[0,0,0];if(J){const ce=u.style.directionalLight,ae=u.style.ambientLight;ce&&ae&&(oe=Eo(u.style,ce,ae))}const ue=P&&P.constantOr(1),le=(ce,ae)=>{let me,ge,Me,Ee,qe;ae?(me=ue&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Me=R.LINES):(me=ue?"fillPattern":"fill",Me=R.TRIANGLES);for(const $e of y){const ct=p.getTile($e);if(ue&&!ct.patternsLoaded())continue;const Se=ct.getBucket(m);if(!Se)continue;const Pe=t?Se.elevationBufferData:Se.bufferData;if(Pe.isEmpty())continue;u.prepareDrawTile();const we=Pe.programConfigurations.get(m.id),Xe=u.isTileAffectedByFog($e),ke=[],Qe=[];G&&(ke.push("ELEVATED_ROADS"),Qe.push(Pe.elevatedLayoutVertexBuffer)),J&&ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ue&&(u.context.activeTexture.set(R.TEXTURE0),ct.imageAtlasTexture&&ct.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),we.updatePaintBuffers());let We=!1;if(j&&ct.imageAtlas){const St=ct.imageAtlas,Ft=s.dN.from(j),Mt=Ft.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Ut=Ft.getSecondary(),Xt=St.patternPositions.get(Mt),mi=Ut?St.patternPositions.get(Ut.scaleSelf(s.q.devicePixelRatio).toString()):null;We=!!Xt&&!!mi,Xt&&we.setConstantPatternPositions(Xt,mi)}L>0&&(We||we.getPatternTransitionVertexBuffer("fill-pattern"))&&ke.push("FILL_PATTERN_TRANSITION");const tt=u.getOrCreateProgram(me,{config:we,overrideFog:Xe,defines:ke}),nt=u.translatePosMatrix($e.projMatrix,ct,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));J&&U.setupShadows(ct.tileID.toUnwrapped(),tt,"vector-tile",ct.tileID.overscaledZ);const At=m.paint.get("fill-emissive-strength");if(ae){Ee=Pe.lineIndexBuffer,qe=Pe.lineSegments;const St=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];ge=me==="fillOutlinePattern"&&ue?ry(nt,At,u,ct,St,oe,L):ny(nt,At,St,oe)}else Ee=Pe.indexBuffer,qe=Pe.triangleSegments,ge=ue?cm(nt,At,u,ct,oe,L):lm(nt,At,oe);u.uploadCommonUniforms(u.context,tt,$e.toUnwrapped());let Ot=ce;(T==="road"&&!A||T==="offset")&&(Ot=ne),tt.draw(u,Me,Ot,r||u.stencilModeForClipping($e),v,Wt.disabled,ge,m.id,Pe.layoutVertexBuffer,Ee,qe,m.paint,u.transform.zoom,we,Qe)}};u.renderPass===C&&le(u.depthModeForSublayer(1,u.renderPass==="opaque"?It.ReadWrite:It.ReadOnly),!1),V==="none"&&u.renderPass==="translucent"&&m.paint.get("fill-antialias")&&le(u.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly),!0)}function Bc(c,t,r,u,p,m,y,v){r.resetLayerRenderingStats(c);const T=c.context,A=T.gl,C=c.transform,R=r.paint.get("fill-extrusion-pattern"),P=r.paint.get("fill-extrusion-pattern-cross-fade"),L=R.constantOr(null),j=R.constantOr(1),V=r.paint.get("fill-extrusion-opacity"),G=c.style.enable3dLights(),U=r.paint.get(G&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],ne=r.layout.get("fill-extrusion-edge-radius"),oe=ne>0&&!r.paint.get("fill-extrusion-rounded-roof"),ue=oe?0:ne,le=C.projection.name==="globe"?s.dT():0,ce=C.projection.name==="globe",ae=ce?s.ah(C.zoom):0,me=[s.ay(C.center.lng),s.aH(C.center.lat)],ge=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(ge?null:r.lut).toArray01().slice(0,3),Ee=r.paint.get("fill-extrusion-flood-light-intensity"),qe=r.paint.get("fill-extrusion-vertical-scale"),$e=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ct=r.paint.get("fill-extrusion-height-alignment"),Se=r.paint.get("fill-extrusion-base-alignment"),Pe=Ua(c,r.paint.get("fill-extrusion-cutoff-fade-range")),we=[];let Xe;ce&&we.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&we.push("FAUX_AO"),oe&&we.push("ZERO_ROOF_RADIUS"),v&&we.push("HAS_CENTROID"),Ee>0&&we.push("FLOOD_LIGHT"),Pe.shouldRenderCutoff&&we.push("RENDER_CUTOFF"),$e&&we.push("RENDER_WALL_MODE");const ke=c.renderPass==="shadow",Qe=c.shadowRenderer,We=ke&&!!Qe,tt=ke?Wt.disabled:Wt.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let nt=[0,0,0];if(Qe){const St=c.style.directionalLight,Ft=c.style.ambientLight;St&&Ft&&(nt=Eo(c.style,St,Ft)),ke||(we.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Qe.useNormalOffset&&we.push("NORMAL_OFFSET")),Xe=we.concat(["SHADOWS_SINGLE_CASCADE"])}const At=We?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",Ot=r.getLayerRenderingStats();for(const St of u){const Ft=t.getTile(St),Mt=Ft.getBucket(r);if(!Mt||Mt.projection.name!==C.projection.name)continue;let Ut=!1;Qe&&(Ut=Qe.getMaxCascadeForTile(St.toUnwrapped())===0);const Xt=c.isTileAffectedByFog(St),mi=Mt.programConfigurations.get(r.id);let rn=!1;if(L&&Ft.imageAtlas){const Oi=Ft.imageAtlas,sn=s.dN.from(L),ur=sn.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Gn=sn.getSecondary(),ar=Oi.patternPositions.get(ur),Rn=Gn?Oi.patternPositions.get(Gn.scaleSelf(s.q.devicePixelRatio).toString()):null;rn=!!ar&&!!Rn,ar&&mi.setConstantPatternPositions(ar,Rn)}P>0&&(rn||mi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&we.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yi=c.getOrCreateProgram(At,{config:mi,defines:Ut?Xe:we,overrideFog:Xt});if(c.terrain&&c.terrain.setupElevationDraw(Ft,Yi,{useMeterToDem:!0}),!Mt.centroidVertexBuffer){const Oi=Yi.attributes.a_centroid_pos;Oi!==void 0&&A.vertexAttrib2f(Oi,0,0)}!ke&&Qe&&Qe.setupShadows(Ft.tileID.toUnwrapped(),Yi,"vector-tile",Ft.tileID.overscaledZ),j&&(c.context.activeTexture.set(A.TEXTURE0),Ft.imageAtlasTexture&&Ft.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),mi.updatePaintBuffers());const bi=r.paint.get("fill-extrusion-vertical-gradient"),Vn=1/Mt.tileToMeter;let Ln;if(ke&&Qe){if(ay(Ft.tileID,Mt,c))continue;const Oi=Qe.calculateShadowPassMatrixFromTile(Ft.tileID.toUnwrapped());Ln=ty(Oi,ue,Vn,qe,ct,Se)}else{const Oi=c.translatePosMatrix(St.expandedProjMatrix,Ft,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),sn=C.projection.createInversionMatrix(C,St.canonical);Ln=j?iy(Oi,c,bi,V,J,ue,Vn,St,Ft,le,ct,Se,ae,me,sn,Me,qe,P):qa(Oi,c,bi,V,J,ue,Vn,St,le,ct,Se,ae,me,sn,Me,qe,Ee,nt)}c.uploadCommonUniforms(T,Yi,St.toUnwrapped(),null,Pe);let Qt=Mt.segments;if(C.projection.name==="mercator"&&!ke&&(Qt=Mt.getVisibleSegments(Ft.tileID,c.terrain,c.transform.getFrustum(0)),!Qt.get().length))continue;if(Ot)if(ke)for(const Oi of Qt.get())Ot.numRenderedVerticesInShadowPass+=Oi.primitiveLength;else for(const Oi of Qt.get())Ot.numRenderedVerticesInTransparentPass+=Oi.primitiveLength;const Mi=[];(c.terrain||v)&&Mi.push(Mt.centroidVertexBuffer),ce&&Mi.push(Mt.layoutVertexExtBuffer),$e&&Mi.push(Mt.wallVertexBuffer),Yi.draw(c,T.gl.TRIANGLES,p,m,y,tt,Ln,r.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Qt,r.paint,c.transform.zoom,mi,Mi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function Ka(c,t,r,u,p,m,y,v,T,A,C,R,P,L,j,V,G,U,J){const ne=c.context,oe=ne.gl,ue=c.transform,le=c.transform.zoom,ce=[],ae=Ua(c,r.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ce.push("CLEAR_SUBPASS"),J&&(ce.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(oe.TEXTURE0),J.bind(oe.LINEAR,oe.CLAMP_TO_EDGE))):A==="sdf"&&ce.push("SDF_SUBPASS"),G&&ce.push("HAS_CENTROID"),ae.shouldRenderCutoff&&ce.push("RENDER_CUTOFF");const me=r.layout.get("fill-extrusion-edge-radius"),ge=(Me,Ee,qe,$e,ct)=>{const Se=Ee.programConfigurations.get(r.id),Pe=c.isTileAffectedByFog(Me),we=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Se,defines:ce,overrideFog:Pe}),Xe=((Qe,We,tt,nt,At,Ot,St,Ft,Mt,Ut,Xt)=>({u_matrix:We,u_opacity:tt,u_ao_pass:nt?1:0,u_meter_to_tile:At,u_ao:Ot,u_flood_light_intensity:St,u_flood_light_color:Ft,u_attenuation:Mt,u_edge_radius:Ut,u_fb:0,u_fb_size:Xt,u_dynamic_offset:1}))(0,$e,C,T,ct,[R,P*ct],L,j,V,le>=17?0:me*ct,J?J.size[0]:0),ke=[];G&&ke.push(Ee.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(ne,we,Me.toUnwrapped(),null,ae),we.draw(c,ne.gl.TRIANGLES,p,m,y,v,Xe,r.id,Ee.vertexBuffer,Ee.indexBuffer,qe,r.paint,le,Se,ke)};for(const Me of u){const Ee=t.getTile(Me),qe=Ee.getBucket(r);if(!qe||qe.projection.name!==ue.projection.name||!qe.groundEffect||qe.groundEffect&&!qe.groundEffect.hasData())continue;const $e=qe.groundEffect,ct=1/qe.tileToMeter;{const Se=c.translatePosMatrix(Me.projMatrix,Ee,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Pe=$e.getDefaultSegment();ge(Me,$e,Pe,Se,ct)}if(U)for(let Se=0;Se<4;Se++){const Pe=s.dU[Se](Me),we=t.getTile(Pe);if(!we)continue;const Xe=we.getBucket(r);if(!Xe||Xe.projection.name!==ue.projection.name||!Xe.groundEffect||Xe.groundEffect&&!Xe.groundEffect.hasData())continue;const ke=Xe.groundEffect;let Qe,We;Se===0?(Qe=[-s.aj,0,0],We=1):Se===1?(Qe=[s.aj,0,0],We=0):Se===2?(Qe=[0,-s.aj,0],We=3):(Qe=[0,s.aj,0],We=2);const tt=ke.regionSegments[We];if(!tt)continue;const nt=new Float32Array(16);s.bo(nt,Me.projMatrix,Qe),ge(Me,ke,tt,c.translatePosMatrix(nt,Ee,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),ct)}}}function da(c,t,r,u,p,m,y){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const v=m?m.findDEMTileFor(r):null;if(!(v&&v.dem||y))return;m&&v&&v.dem&&u.selfDEMTileTimestamp!==v.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=v.dem._timestamp);const T=U=>new s.P(Math.ceil((U+s.dX)*s.dY),0),A=U=>{const J=t.getSource().minzoom,ne=ue=>{const le=t.getTileByID(ue);if(le&&le.hasData())return le.getBucket(p)},oe=[0,-1,1];for(const ue of oe){if(U.overscaledZ+ue<J)continue;const le=ne(U.calculateScaledKey(U.overscaledZ+ue));if(le)return le}},C=[0,0,0],R=(U,J)=>(C[0]=Math.min(U.min.y,J.min.y),C[1]=Math.max(U.max.y,J.max.y),C[2]=s.aj-J.min.x>U.max.x?J.min.x-s.aj:U.max.x,C),P=(U,J)=>(C[0]=Math.min(U.min.x,J.min.x),C[1]=Math.max(U.max.x,J.max.x),C[2]=s.aj-J.min.y>U.max.y?J.min.y-s.aj:U.max.y,C),L=[(U,J)=>R(U,J),(U,J)=>R(J,U),(U,J)=>P(U,J),(U,J)=>P(J,U)],j=(U,J,ne,oe,ue,le,ce)=>{if(!m)return 0;const ae=[[le?ne:U,le?U:ne,0],[le?ne:J,le?J:ne,0]],me=ce<0?s.aj+ce:ce,ge=[le?me:(U+J)/2,le?(U+J)/2:me,0];return ne===0&&ce<0||ne!==0&&ce>0?m.getForTilePoints(ue,[ge],!0,oe):ae.push(ge),m.getForTilePoints(r,ae,!0,v),Math.max(ae[0][2],ae[1][2],ge[2])/m.exaggeration()};for(let U=0;U<4;U++){const J=u.borderFeatureIndices[U];if(J.length===0)continue;const ne=s.dU[U](r),oe=A(ne);if(!(oe&&oe instanceof s.dV))continue;const ue=m?m.findDEMTileFor(ne):null;if(!(ue&&ue.dem||y)||(m&&ue&&ue.dem&&u.borderDEMTileTimestamp[U]!==ue.dem._timestamp&&(u.borderDoneWithNeighborZ[U]=-1,u.borderDEMTileTimestamp[U]=ue.dem._timestamp),u.borderDoneWithNeighborZ[U]===oe.canonical.z))continue;oe.centroidVertexArray.length===0&&oe.createCentroidsBuffer();const le=(U<2?1:5)-U,ce=oe.borderDoneWithNeighborZ[le]!==u.canonical.z,ae=oe.borderFeatureIndices[le];let me=0;if(u.canonical.z!==oe.canonical.z){for(const ge of J)u.showCentroid(u.featuresOnBorder[ge]);if(ce)for(const ge of ae)oe.showCentroid(oe.featuresOnBorder[ge]);u.borderDoneWithNeighborZ[U]=oe.canonical.z,oe.borderDoneWithNeighborZ[le]=u.canonical.z}for(const ge of J){const Me=u.featuresOnBorder[ge],Ee=u.centroidData[Me.centroidDataIndex],qe=Me.borders[U];let $e;for(;me<ae.length;){$e=oe.featuresOnBorder[ae[me]];const ct=$e.borders[le];if(ct[1]>qe[0]+3||ct[0]>qe[0]-3)break;oe.showCentroid($e),me++}if($e&&me<ae.length){const ct=me;let Se=0;for(;!($e.borders[le][0]>qe[1]-3)&&(Se++,++me!==ae.length);)$e=oe.featuresOnBorder[ae[me]];$e=oe.featuresOnBorder[ae[ct]];let Pe=!1;if(Se>=1){const ke=$e.borders[le];Math.abs(qe[0]-ke[0])<3&&Math.abs(qe[1]-ke[1])<3&&(Se=1,Pe=!0,me=ct+1)}else if(Se===0){u.showCentroid(Me);continue}const we=oe.centroidData[$e.centroidDataIndex];y&&Pe&&(((V=Ee).flags|(G=we).flags)&s.dW?(V.flags|=s.dW,G.flags|=s.dW):(V.flags&=~s.dW,G.flags&=~s.dW));const Xe=Me.intersectsCount()>1||$e.intersectsCount()>1;if(Se>1)me=ct,Ee.centroidXY=we.centroidXY=new s.P(0,0);else if(ue&&ue.dem&&!Xe){const ke=L[U](Ee,we),Qe=U%2?s.aj-1:0,We=j(ke[0],Math.min(s.aj-1,ke[1]),Qe,ue,ne,U<2,ke[2]);Ee.centroidXY=we.centroidXY=T(We)}else Xe?Ee.centroidXY=we.centroidXY=new s.P(0,0):(Ee.centroidXY=u.encodeBorderCentroid(Me),we.centroidXY=oe.encodeBorderCentroid($e));u.writeCentroidToBuffer(Ee),oe.writeCentroidToBuffer(we)}else u.showCentroid(Me)}u.borderDoneWithNeighborZ[U]=oe.canonical.z,oe.borderDoneWithNeighborZ[le]=u.canonical.z}var V,G;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const fa=[1,0,0],jt=[0,1,0],Jd=[0,0,1];function ay(c,t,r){const u=r.transform,p=r.shadowRenderer;if(!p)return!0;const m=c.toUnwrapped(),y=u.tileSize*p._cascades[r.currentShadowCascade].scale;let v=t.maxHeight;if(u.elevation){const V=u.elevation.getMinMaxForTile(c);V&&(v+=V.max)}const T=[...p.shadowDirection];T[2]=-T[2];const A=p.computeSimplifiedTileShadowVolume(m,v,y,T);if(!A)return!1;const C=[fa,jt,Jd,T,[T[0],0,T[2]],[0,T[1],T[2]]],R=u.projection.name==="globe",P=u.scaleZoom(y),L=s.cn.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,P,!R),j=p.getCurrentCascadeFrustum();return L.intersectsPrecise(A.vertices,A.planes,C)===0||j.intersectsPrecise(A.vertices,A.planes,C)===0}function _m(c){return[c[0]*s.dZ,c[1]*s.dZ,c[2]*s.dZ,0]}function Nc(c,t,r,u,p,m,y,v,T){const A=u.getSource(),C=r.globeSharedBuffers;if(!C)return;let R,P,L;if(t&&(R=u.getTile(t)),A instanceof s.aP?(P=A.texture,L=s.ds(0,0,r.transform)):R&&t&&(P=R.texture,L=s.ds(t.canonical.z,t.canonical.x,r.transform)),!P||!L)return;c||(L=s.cE(s.bz(),L,[1,-1,1]));const j=r.context,V=j.gl,G=p.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,U=r.colorModeForDrapableLayerRenderPass(m),J=y.defines;J.push("GLOBE_POLES");const ne=new It(V.LEQUAL,It.ReadWrite,r.depthRangeFor3D),oe=Float32Array.from(r.transform.expandedFarZProjMatrix),ue=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),j.activeTexture.set(V.TEXTURE0),P.bind(G,V.CLAMP_TO_EDGE),j.activeTexture.set(V.TEXTURE1),P.bind(G,V.CLAMP_TO_EDGE),"useMipmap"in P&&j.extTextureFilterAnisotropic&&r.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const[le,ce,ae,me]=t?C.getPoleBuffers(t.canonical.z,!1):C.getPoleBuffers(0,!0),ge=p.paint.get("raster-elevation");let Me;c?(Me=le,r.renderDefaultNorthPole=ge!==0):(Me=ce,r.renderDefaultSouthPole=ge!==0);const Ee=_m(y.mix),qe=((ct,Se,Pe,we,Xe,ke,Qe,We,tt,nt,At,Ot,St)=>ha(ct,Se,Pe,new Float32Array(16),new Float32Array(9),[0,0],we,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ke,[0,0],We,2,nt,At,Ot,1,0,St))(oe,ue,L,s.ah(r.transform.zoom),0,p,0,ge,0,Ee,y.offset,y.range,m),$e=r.getOrCreateProgram("raster",{defines:J});r.uploadCommonUniforms(j,$e,null),$e.draw(r,V.TRIANGLES,ne,T,U,v,qe,p.id,Me,ae,me)}function ym(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,m=t+p;return[t,r,(m-p-t)/u,(m-t)/u]}function ly(c,t,r,u){if(c)return t instanceof za&&c instanceof gc?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:_m(u.mix),offset:u.offset,buffer:0,tileSize:1}}var xm=s.d_([{name:"a_index",type:"Int16",components:1}]);class cy{constructor(t,r,u,p){const m={width:u[0],height:u[1],data:null},y=t.gl;this.targetColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,m,y.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,p),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=r.width*r.height;this.particleTexture0=new s.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1});const m=new s.d$;m.reserve(p);for(let y=0;y<p;y++)m.emplaceBack(y);this.particleIndexBuffer=this.context.createVertexBuffer(m,xm.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function uy(c,t,r){if(!c)return null;const u=t.getTextureDescriptor(c,r,!0);if(!u)return null;let{texture:p,mix:m,offset:y,tileSize:v,buffer:T,format:A}=u;if(!p||!A)return null;let C=!1;return A==="uint32"&&(C=!0,m[3]=0,m=qd(s.e0,m,[0,r.paint.get("raster-particle-max-speed")]),y=ih(s.e0,y,[0,r.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[T/(v+2*T),v/(v+2*T)],tileSize:v,scalarData:C,scale:m,offset:y,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function Qd(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,m=t+p;return[t,r,(m-p-t)/u,(m-t)/u]}const ef=new s.am(1,0,0,1),tf=new s.am(0,1,0,1),nf=new s.am(0,0,1,1),zs=new s.am(1,0,1,1),pa=new s.am(0,1,1,1);function Ya(c,t,r,u,p,m,y){const v=c.context,T=c.transform,A=v.gl,C=T.projection.name==="globe",R=C?["PROJECTION_GLOBE_VIEW"]:[];let P=s.bw(r.projMatrix);if(C&&s.ah(T.zoom)>0){const Ee=s.bg(r.canonical,T),qe=s.e1(Ee);P=s.az(new Float32Array(16),T.globeMatrix,qe),s.az(P,T.projMatrix,P)}const L=s.bz();L[12]+=2*p/(s.q.devicePixelRatio*T.width),L[13]+=2*m/(s.q.devicePixelRatio*T.height),s.az(P,L,P);const j=c.getOrCreateProgram("debug",{defines:R}),V=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw(V,j);const G=It.disabled,U=qt.disabled,J=c.colorModeForRenderPass(),ne="$debug";v.activeTexture.set(A.TEXTURE0),c.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),C?V._makeGlobeTileDebugBuffers(c.context,T):V._makeDebugTileBoundsBuffers(c.context,T.projection);const oe=V._tileDebugBuffer||c.debugBuffer,ue=V._tileDebugIndexBuffer||c.debugIndexBuffer,le=V._tileDebugSegments||c.debugSegments;if(j.draw(c,A.LINE_STRIP,G,U,J,Wt.disabled,Wa(P,u),ne,oe,ue,le,null,null,null,[V._globeTileDebugBorderBuffer]),y){const Ee=V.latestRawTileData,qe=Math.floor((Ee&&Ee.byteLength||0)/1024);let $e=r.canonical.toString();r.overscaledZ!==r.canonical.z&&($e+=` => ${r.overscaledZ}`),$e+=` ${V.state}`,$e+=` ${qe}kb`,function(ct,Se){ct.initDebugOverlayCanvas();const Pe=ct.debugOverlayCanvas,we=ct.context.gl,Xe=ct.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Pe.width,Pe.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Se,5,5),Xe.strokeText(Se,5,5),ct.debugOverlayTexture.update(Pe),ct.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)}(c,$e)}const ce=t.getTile(r).tileSize,ae=512/Math.min(ce,512)*(r.overscaledZ/T.zoom)*.5,me=V._tileDebugTextBuffer||c.debugBuffer,ge=V._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Me=V._tileDebugTextSegments||c.debugSegments;j.draw(c,A.TRIANGLES,G,U,ci.alphaBlended,Wt.disabled,Wa(P,s.am.transparent,ae),ne,me,ge,Me,null,null,null,[V._globeTileDebugTextBuffer])}function uh(c,t,r,u){Fl(c,0,t+r/2,c.transform.width,r,u)}function hh(c,t,r,u){Fl(c,t-r/2,0,r,c.transform.height,u)}function Fl(c,t,r,u,p,m){const y=c.context,v=y.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*s.q.devicePixelRatio,r*s.q.devicePixelRatio,u*s.q.devicePixelRatio,p*s.q.devicePixelRatio),y.clear({color:m}),v.disable(v.SCISSOR_TEST)}const vm=s.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Qs}=vm;function nn(c,t,r,u){c.emplaceBack(t,r,u)}class Vc{constructor(t){this.vertexArray=new s.e2,this.indices=new s.a_,nn(this.vertexArray,-1,-1,1),nn(this.vertexArray,1,-1,1),nn(this.vertexArray,-1,1,1),nn(this.vertexArray,1,1,1),nn(this.vertexArray,-1,-1,-1),nn(this.vertexArray,1,-1,-1),nn(this.vertexArray,-1,1,-1),nn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Qs),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function ma(c,t,r,u,p,m){const y=c.context.gl,v=t.paint.get("sky-atmosphere-color"),T=t.paint.get("sky-atmosphere-halo-color"),A=t.paint.get("sky-atmosphere-sun-intensity"),C=((R,P,L,j,V)=>({u_matrix_3f:R,u_sun_direction:P,u_sun_intensity:L,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(s.e4(s.dx(),u),p,A,v,T);y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+m,t.skyboxTexture,0),r.draw(c,y.TRIANGLES,It.disabled,qt.disabled,ci.unblended,Wt.frontCW,C,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const bm=s.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class wm{constructor(t){const r=new s.e5;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const u=new s.a_;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,bm.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Tm=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class hy{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Bl{constructor(t){this.colorModeAlphaBlendedWriteRGB=new ci([1,ps,1,ps],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ci([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new hy,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new wm(r);const u=this.params.sizeRange,p=this.params.intensityRange,m=function(C){const R=s.ea(30),P=[];for(let L=0;L<C;++L){const j=2*Math.PI*R(),V=Math.acos(1-2*R())-.5*Math.PI;P.push(s.cS(Math.cos(V)*Math.cos(j),Math.cos(V)*Math.sin(j),Math.sin(V)))}return P}(this.params.starsCount),y=s.ea(300),v=new s.e6,T=new s.a_;let A=0;for(let C=0;C<m.length;++C){const R=s.b$([],m[C],200),P=Math.max(0,1+.01*u*(1*y()-.5)),L=Math.max(0,1+.01*p*(1*y()-.5));v.emplaceBack(R[0],R[1],R[2],-1,-1,P,L),v.emplaceBack(R[0],R[1],R[2],1,-1,P,L),v.emplaceBack(R[0],R[1],R[2],1,1,P,L),v.emplaceBack(R[0],R[1],R[2],-1,1,P,L),T.emplaceBack(A+0,A+1,A+2),T.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=r.createVertexBuffer(v,Tm.members),this.starsIdx=r.createIndexBuffer(T),this.starsSegments=s.bd.simpleSegment(0,0,v.length,T.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const u=t.context,p=u.gl,m=t.transform,y=new It(p.LEQUAL,It.ReadOnly,[0,1]),v=s.ah(m.zoom),T=t.style.getLut(r.scope),A=r.properties.get("color-use-theme")==="none",C=r.properties.get("color").toRenderColor(A?null:T).toArray01(),R=r.properties.get("high-color-use-theme")==="none",P=r.properties.get("high-color").toRenderColor(R?null:T).toArray01(),L=r.properties.get("space-color-use-theme")==="none",j=r.properties.get("space-color").toRenderColor(L?null:T).toArray01PremultipliedAlpha(),V=5e-4,G=s.e7(r.properties.get("horizon-blend"),0,1,V,.25),U=s.dl(t,u,m)&&G===V?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,J=t.frameCounter/1e3%1,ne=s.ae(m.globeCenterInViewSpace),oe=Math.sqrt(Math.pow(ne,2)-Math.pow(U,2)),ue=Math.acos(oe/ne),le=ce=>{const ae=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ce&&ae.push("ALPHA_PASS");const me=t.getOrCreateProgram("globeAtmosphere",{defines:ae}),ge=((Ee,qe,$e,ct,Se,Pe,we,Xe,ke,Qe,We,tt)=>({u_frustum_tl:Ee,u_frustum_tr:qe,u_frustum_br:$e,u_frustum_bl:ct,u_horizon:Se,u_transition:Pe,u_fadeout_range:we,u_color:Xe,u_high_color:ke,u_space_color:Qe,u_temporal_offset:We,u_horizon_angle:tt}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,v,G,C,P,j,J,ue);t.uploadCommonUniforms(u,me);const Me=this.atmosphereBuffer;Me&&me.draw(t,p.TRIANGLES,y,qt.disabled,ce?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Wt.backCW,ge,ce?"atmosphere_glow_alpha":"atmosphere_glow",Me.vertexBuffer,Me.indexBuffer,Me.segments)};le(!1),le(!0)}drawStars(t,r){const u=s.aD(r.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,m=p.gl,y=t.transform,v=t.getOrCreateProgram("stars"),T=s.bY([]);s.b_(T,T,-y._pitch),s.bZ(T,T,-y.angle),s.b_(T,T,s.al(y._center.lat)),s.e8(T,T,-s.al(y._center.lng));const A=s.c3(new Float32Array(16),T),C=s.az([],y.starsProjMatrix,A),R=s.e4([],A),P=s.e9([],R),L=[0,1,0];s.dz(L,L,P),s.b$(L,L,this.params.sizeMultiplier);const j=[1,0,0];s.dz(j,j,P),s.b$(j,j,this.params.sizeMultiplier);const V=(G=L,U=j,J=u,{u_matrix:Float32Array.from(C),u_up:G,u_right:U,u_intensity_multiplier:J});var G,U,J;t.uploadCommonUniforms(p,v),this.starsVx&&this.starsIdx&&v.draw(t,m.TRIANGLES,It.disabled,qt.disabled,this.colorModeAlphaBlendedWriteRGB,Wt.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Ja(c,t){const r=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=s.bx([]);return s.cE(p,p,[u,u,1]),s.az(r,p,r),s.az(r,t.worldToFogMatrix,r),r}function ut(c,t,r,u,p){const m=r.material,y=u.context,{baseColorTexture:v,metallicRoughnessTexture:T}=m.pbrMetallicRoughness,{normalTexture:A,occlusionTexture:C,emissionTexture:R}=m;function P(j,V,G){if(j&&(c.push(V),y.activeTexture.set(y.gl.TEXTURE0+G),j.gfxTexture)){const{minFilter:U,magFilter:J,wrapS:ne,wrapT:oe}=j.sampler;j.gfxTexture.bindExtraParam(U,J,ne,oe)}}P(v,"HAS_TEXTURE_u_baseColorTexture",ms.BaseColor),P(T,"HAS_TEXTURE_u_metallicRoughnessTexture",ms.MetallicRoughness),P(A,"HAS_TEXTURE_u_normalTexture",ms.Normal),P(C,"HAS_TEXTURE_u_occlusionTexture",ms.Occlusion),P(R,"HAS_TEXTURE_u_emissionTexture",ms.Emission),p&&(p.texture||(p.texture=new s.ed(u.context,p.image,[p.image.height,p.image.height,p.image.height],y.gl.RGBA8)),y.activeTexture.set(y.gl.TEXTURE0+ms.LUT),p.texture&&p.texture.bind(y.gl.LINEAR,y.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||c.push("DIFFUSE_SHADED");const L=u.shadowRenderer;L&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),L.useNormalOffset&&c.push("NORMAL_OFFSET"))}function wt(c,t,r,u,p,m){const y=r.paint.get("model-opacity").constantOr(1),v=t.context,T=new It(t.context.gl.LEQUAL,It.ReadWrite,t.depthRangeFor3D),A=t.transform,C=c.mesh,R=C.material,P=R.pbrMetallicRoughness,L=t.style.fog;let j;j=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:s.az([],u.zScaleMatrix,c.nodeModelMatrix),s.az(j,u.negCameraPosMatrix,j);const V=s.bi([],j);s.ee(V,V);const G=r.paint.get("model-color-use-theme").constantOr("default")==="none",U=r.paint.get("model-emissive-strength").constantOr(0),J=Za(new Float32Array(c.worldViewProjection),new Float32Array(j),new Float32Array(V),null,t,y,P.baseColorFactor.toRenderColor(null),R.emissiveFactor,P.metallicFactor,P.roughnessFactor,R,U,r),ne={defines:[]},oe=[],ue=t.shadowRenderer;ue&&(ue.useNormalOffset=!1),ut(ne.defines,oe,C,t,G?null:r.lut);let le=null;if(L){const me=Ja(c.nodeModelMatrix,t.transform);if(le=new Float32Array(me),A.projection.name!=="globe"){const ge=C.aabb.min,Me=C.aabb.max,[Ee,qe]=L.getOpacityForBounds(me,ge[0],ge[1],Me[0],Me[1]);ne.overrideFog=Ee>=bt||qe>=bt}}const ce=Ua(t,r.paint.get("model-cutoff-fade-range"));ce.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");const ae=t.getOrCreateProgram("model",ne);t.uploadCommonUniforms(v,ae,null,le,ce),t.renderPass!=="shadow"&&ue&&ue.setupShadowsFromMatrix(c.nodeModelMatrix,ae),ae.draw(t,v.gl.TRIANGLES,T,p,m,C.material.doubleSided?Wt.disabled:Wt.backCCW,J,r.id,C.vertexBuffer,C.indexBuffer,C.segments,r.paint,t.transform.zoom,void 0,oe)}function Qa(c,t,r,u,p,m,y){let v;v=c.projection.name==="globe"?s.ef(r,c):[...r],s.az(v,v,t.matrix);const T=s.az([],u,v);if(t.meshes)for(const A of t.meshes){if(A.material.alphaMode!=="BLEND"){y.push({mesh:A,depth:0,modelIndex:p,worldViewProjection:T,nodeModelMatrix:v});continue}const C=s.ad([],A.centroid,T);!c.isOrthographic&&C[2]<=0||m.push({mesh:A,depth:C[2],modelIndex:p,worldViewProjection:T,nodeModelMatrix:v})}if(t.children)for(const A of t.children)Qa(c,A,r,u,p,m,y)}function $n(c,t,r,u){const p=r.shadowRenderer;if(!p)return;const m=p.getShadowPassDepthMode(),y=p.getShadowPassColorMode(),v=p.calculateShadowPassMatrixFromMatrix(t),T=gm(v);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,m,qt.disabled,y,Wt.backCCW,T,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,r.transform.zoom,void 0,void 0)}function Ce(c,t,r){const u=t.updateZoomBasedPaintProperties(),p=function(m,y,v){let T,A,C,R=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&R>0){const P=m.terrain,L=P.findDEMTileFor(v);L&&L.dem?T=s.el.create(P,v,L):R=0}if(R===0&&(y.terrainElevationMin=0,y.terrainElevationMax=0),R===y.validForExaggeration&&(R===0||T&&T._demTile&&T._demTile.tileID===y.validForDEMTile.id&&T._dem._timestamp===y.validForDEMTile.timestamp))return!1;for(const P in y.instancesPerModel){const L=y.instancesPerModel[P];for(let j=0;j<L.instancedDataArray.length;++j){const V=(T?R*T.getElevationAt(0|L.instancedDataArray.float32[16*j],0|L.instancedDataArray.float32[16*j+1],!0,!0):0)+L.instancesEvaluatedElevation[j];L.instancedDataArray.float32[16*j+6]=V,A=A?Math.min(y.terrainElevationMin,V):V,C=C?Math.max(y.terrainElevationMax,V):V}}return y.terrainElevationMin=A||0,y.terrainElevationMax=C||0,y.validForExaggeration=R,y.validForDEMTile=T&&T._demTile?{id:T._demTile.tileID,timestamp:T._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,r);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const po={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cV([0,0,0],[s.aj,s.aj,0])};function dh(c,t){const r=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,m=c.canonical.x/r,y=(c.canonical.x+1)/r,v=c.canonical.y/r,T=(c.canonical.y+1)/r;let A=t._centerAltitude;if(p){const L=p.getMinMaxForTile(c);L&&L.max>A&&(A=L.max)}const C=s.aD(u.x,m,y)-u.x,R=s.aD(u.y,v,T)-u.y,P=s.c6(A,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(C*C+R*R+P*P))}function fh(c,t,r,u,p,m,y){const v=c.context,T=c.renderPass==="shadow",A=c.shadowRenderer,C=T&&A?A.getShadowPassDepthMode():new It(v.gl.LEQUAL,It.ReadWrite,c.depthRangeFor3D),R=c.isTileAffectedByFog(m);if(r.meshes)for(const P of r.meshes){const L=["MODEL_POSITION_ON_GPU"],j=[];let V,G,U;u.instancedDataArray.length>20&&L.push("INSTANCED_ARRAYS");const J=Ua(c,t.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),T&&A)V=c.getOrCreateProgram("modelDepth",{defines:L}),G=gm(y.shadowTileMatrix,y.shadowTileMatrix,Float32Array.from(r.matrix)),U=A.getShadowPassColorMode();else{ut(L,j,P,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),V=c.getOrCreateProgram("model",{defines:L,overrideFog:R});const oe=P.material,ue=oe.pbrMetallicRoughness,le=t.paint.get("model-opacity").constantOr(1),ce=t.paint.get("model-emissive-strength").constantOr(0);G=Za(m.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,c,le,ue.baseColorFactor.toRenderColor(null),oe.emissiveFactor,ue.metallicFactor,ue.roughnessFactor,oe,ce,t,p),A&&(y.shadowUniformsInitialized?V.setShadowUniformValues(v,A.getShadowUniformValues()):(A.setupShadows(m.toUnwrapped(),V,"model-tile",m.overscaledZ),y.shadowUniformsInitialized=!0)),U=J.shouldRenderCutoff||le<1||oe.alphaMode!=="OPAQUE"?ci.alphaBlended:ci.unblended}c.uploadCommonUniforms(v,V,m.toUnwrapped(),null,J);const ne=P.material.doubleSided?Wt.disabled:Wt.backCCW;if(u.instancedDataArray.length>20)j.push(u.instancedDataBuffer),V.draw(c,v.gl.TRIANGLES,C,qt.disabled,U,ne,G,t.id,P.vertexBuffer,P.indexBuffer,P.segments,t.paint,c.transform.zoom,void 0,j,u.instancedDataArray.length);else{const oe=T?"u_instance":"u_normal_matrix";for(let ue=0;ue<u.instancedDataArray.length;++ue)G[oe]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ue,16),V.draw(c,v.gl.TRIANGLES,C,qt.disabled,U,ne,G,t.id,P.vertexBuffer,P.indexBuffer,P.segments,t.paint,c.transform.zoom,void 0,j)}}if(r.children)for(const P of r.children)fh(c,t,P,u,p,m,y)}const rf=[1,-1,1];function Sm(c,t,r,u){if(!r.modelManager)return!0;const p=r.modelManager;if(!r.shadowRenderer)return!0;const m=r.shadowRenderer,y=t.aabb;let v=!0,T=c.maxHeight;if(T===0){let C=0;for(const R in c.instancesPerModel){const P=p.getModel(R,u);P?C=Math.max(C,Math.max(Math.max(P.aabb.max[0],P.aabb.max[1]),P.aabb.max[2])):v=!1}T=c.maxScale*C*1.41+c.maxVerticalOffset,v&&(c.maxHeight=T)}y.max[2]=T,y.min[2]+=c.terrainElevationMin,y.max[2]+=c.terrainElevationMax,s.ad(y.min,y.min,t.tileMatrix),s.ad(y.max,y.max,t.tileMatrix);const A=y.intersects(m.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=A===2),A===0}function Em(c,t){const r=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],m=c.uniformValues.u_cutoff_params[3];return u===r||m===p?1:s.aD(((t-r)/(u-r)-p)/(m-p),0,1)}function Nl(c,t,r,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();s.az(p,p,c);const m=s.ei(r.min[0],r.min[1],r.min[2],1);let y=s.aA(s.ej(),m,p),v=y,T=y;m[1]=r.max[1],y=s.aA(s.ej(),m,p),v=y[1]<v[1]?y:v,T=y[1]>T[1]?y:T,m[0]=r.max[0],y=s.aA(s.ej(),m,p),v=y[1]<v[1]?y:v,T=y[1]>T[1]?y:T,m[1]=r.min[1],y=s.aA(s.ej(),m,p),v=y[1]<v[1]?y:v,T=y[1]>T[1]?y:T;const A=s.aD(u[0],0,1),C=100*t.pixelsPerMeter*s.aD(u[1],0,1),R=s.aD(u[2],0,1),P=s.ek(s.ej(),v,T,A),L=Math.tan(.5*t.fovX),j=-P[2]*L;if(C===0)return P[1]<-Math.abs(j)?R:1;const V=(-Math.abs(j)-P[1])/C,G=(J,ne,oe)=>(1-oe)*J+oe*ne,U=s.aD(G(1,R,V),R,1);return G(1,U,s.aD((t.pitch-20)/20,0,1))}class dy{}class fy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,u){{const R=this._storage.get(r.id);if(R)return R.lastUsedFrameIdx=t,R.buf}const p=u.gl,m=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),y=new ArrayBuffer(m),v=new Int16Array(y);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(y));const T=new s.en;for(let R=0;R<m/2;R+=3){const P=v[R],L=v[R+1],j=v[R+2];T.emplaceBack(P,L),T.emplaceBack(L,j),T.emplaceBack(j,P)}const A=u.bindVertexArrayOES.current,C=new dy;return C.buf=new Go(u,T),C.lastUsedFrameIdx=t,this._storage.set(r.id,C),u.bindVertexArrayOES.set(A),C.buf}update(t){for(const[r,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class Am{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ph=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class sf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class of{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Im=s.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class mh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const y=new s.eo,v=new s.a_;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(1,1),y.emplaceBack(-1,1),v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(y,Im.members),this.vignetteIdx=t.context.createIndexBuffer(v)}const p=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const y={u_vignetteShape:(m={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:m.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,It.disabled,qt.disabled,ci.alphaBlended,Wt.disabled,y,"vignette",this.vignetteVx,this.vignetteIdx,p)}var m}}class jc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),m=u.toLngLat(),y=s.al(m.lng),v=s.al(m.lat),T=t.pixelsPerMeter/r,A=y*s.eq,C=s.eq*Math.log(Math.tan(Math.PI/4+v/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const R=-this._offsetYPrev+C,P=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+A)*T,this._accumulatedOffsetY+=R*T,this._accumulatedElevation+=P*T,this._offsetXPrev=A,this._offsetYPrev=C,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function el(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function af(c){const t=s.ea(1323123451230),r=[];for(let u=0;u<c;++u){const p=2*t()-1,m=2*t()-1,y=2*t()-1;r.push(s.cS(p,m,y))}return r}function ga(c,t,r,u,p){const m=s.aD((p-r)/(u-r),0,1);return(1-m)*c+m*t}class _s{constructor(t){this._movement=new jc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new mh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,m=s.bY([]);s.b_(m,m,s.al(90)-u._pitch),s.bZ(m,m,-u.angle);const y=s.c3(new Float32Array(16),m),v=s.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),T=s.ee([],v),A=s.az([],T,y),C=Date.now()/1e3;return this._accumulatedTimeFromStart+=(C-this._prevTime)*r,this._prevTime=C,{projectionMatrix:p,modelviewMatrix:A}}}class py extends _s{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new of(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=af(this.particlesCount),p=new s.er,m=new s.a_;let y=0;const v=s.ea(1323123451230);for(let T=0;T<u.length;++T){const A=u[T],C=[2*v()-1,v(),v(),v()];p.emplaceBack(A[0],A[1],A[2],-1,-1,...C),p.emplaceBack(A[0],A[1],A[2],1,-1,...C),p.emplaceBack(A[0],A[1],A[2],1,1,...C),p.emplaceBack(A[0],A[1],A[2],-1,1,...C),m.emplaceBack(y+0,y+1,y+2),m.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=r.createVertexBuffer(p,ph.members),this.particlesIdx=r.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(r.revealStart>u)return;const p=ga(0,1,r.revealStart,r.revealStart+r.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const m=structuredClone(this._params);let y=[-m.direction.x,m.direction.y,-100];s.au(y,y);const v=structuredClone(this._vignetteParams);v.strength*=p,m.overrideStyleParameters||(m.intensity=t.style.rain.state.density,m.timeFactor=t.style.rain.state.intensity,m.color=structuredClone(t.style.rain.state.color),y=structuredClone(t.style.rain.state.direction),m.screenThinning.intensity=t.style.rain.state.centerThinning,m.dropletSizeX=t.style.rain.state.dropletSize[0],m.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],m.distortionStrength=100*t.style.rain.state.distortionStrength,v.strength=1,v.color=structuredClone(t.style.rain.state.vignetteColor));const T=this.updateOnRender(t,m.timeFactor),A=t.context,C=A.gl,R=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(A,{width:t.width,height:t.height,data:null},C.RGBA8)),m.distortionStrength>0&&(A.activeTexture.set(C.TEXTURE0),this.screenTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.copyTexSubImage2D(C.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const P=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(A,P),A.activeTexture.set(C.TEXTURE0),this.screenTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const L=[m.color.r,m.color.g,m.color.b,m.color.a],j=(V,G)=>{const U=el(this._movement.getPosition(),V),J=m.dropletSizeX,ne=m.dropletSizeX*m.dropletSizeYScale,oe=t.width/2,ue=t.height/2,le=ga(0,m.screenThinning.start,0,1,m.screenThinning.intensity),ce=ga(.001,m.screenThinning.range,0,1,m.screenThinning.intensity),ae=ga(0,m.screenThinning.particleOffset,0,1,m.screenThinning.intensity),me=(ge={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:U,velocityConeAperture:m.velocityConeAperture,velocity:m.velocity,boxSize:V,rainDropletSize:[J,ne],distortionStrength:m.distortionStrength,rainDirection:y,color:L,screenSize:[R.width,R.height],thinningCenterPos:[oe,ue],thinningShape:[le,ce,Math.pow(10,m.screenThinning.fadePower)],thinningAffectedRatio:m.screenThinning.affectedRatio,thinningParticleOffset:ae,shapeDirectionalPower:m.shapeDirPower,shapeNormalPower:m.shapeNormalPower,mode:G?0:1},{u_modelview:Float32Array.from(ge.modelview),u_projection:Float32Array.from(ge.projection),u_time:ge.time,u_cam_pos:ge.camPos,u_texScreen:0,u_velocityConeAperture:ge.velocityConeAperture,u_velocity:ge.velocity,u_boxSize:ge.boxSize,u_rainDropletSize:ge.rainDropletSize,u_distortionStrength:ge.distortionStrength,u_rainDirection:ge.rainDirection,u_color:ge.color,u_screenSize:ge.screenSize,u_thinningCenterPos:ge.thinningCenterPos,u_thinningShape:ge.thinningShape,u_thinningAffectedRatio:ge.thinningAffectedRatio,u_thinningParticleOffset:ge.thinningParticleOffset,u_shapeDirectionalPower:ge.shapeDirectionalPower,u_shapeNormalPower:ge.shapeNormalPower,u_mode:ge.mode});var ge;const Me=Math.round(m.intensity*this.particlesCount),Ee=s.bd.simpleSegment(0,0,4*Me,2*Me);P.draw(t,C.TRIANGLES,It.disabled,qt.disabled,ci.alphaBlended,Wt.disabled,me,"rain_particles",this.particlesVx,this.particlesIdx,Ee)};m.distortionStrength>0&&j(m.boxSize,!0),j(m.boxSize,!1),this._vignette.draw(t,v)}}const Uc=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Pn extends _s{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new of(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=af(this.particlesCount),p=new s.es,m=new s.a_;let y=0;const v=s.ea(1323123451230);for(let T=0;T<u.length;++T){const A=u[T],C=v(),R=v(),P=v(),L=[T/u.length,C,R,P],j=[v(),v()];p.emplaceBack(A[0],A[1],A[2],-1,-1,...L,...j),p.emplaceBack(A[0],A[1],A[2],1,-1,...L,...j),p.emplaceBack(A[0],A[1],A[2],1,1,...L,...j),p.emplaceBack(A[0],A[1],A[2],-1,1,...L,...j),m.emplaceBack(y+0,y+1,y+2),m.emplaceBack(y+0,y+2,y+3),y+=4}this.particlesVx=r.createVertexBuffer(p,Uc.members),this.particlesIdx=r.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let u=[-r.direction.x,r.direction.y,-100];s.au(u,u);const p=structuredClone(this._vignetteParams),m=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=t.transform.zoom;if(m.revealStart>y)return;const v=ga(0,1,m.revealStart,m.revealStart+m.revealRange,y);p.strength*=v,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const T=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const A=t.context,C=A.gl,R=t.transform,P=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(A,P),((L,j,V)=>{const G=el(this._movement.getPosition(),L),U=R.width/2,J=R.height/2,ne=ga(0,V.screenThinning.start,0,1,V.screenThinning.intensity),oe=ga(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),ue=ga(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),le=(ce={modelview:T.modelviewMatrix,projection:T.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:G,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:L,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[R.width,R.height],thinningCenterPos:[U,J],thinningShape:[ne,oe,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:ue,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:u},{u_modelview:Float32Array.from(ce.modelview),u_projection:Float32Array.from(ce.projection),u_time:ce.time,u_cam_pos:ce.camPos,u_velocityConeAperture:ce.velocityConeAperture,u_velocity:ce.velocity,u_horizontalOscillationRadius:ce.horizontalOscillationRadius,u_horizontalOscillationRate:ce.horizontalOscillationRate,u_boxSize:ce.boxSize,u_billboardSize:ce.billboardSize,u_simpleShapeParameters:ce.simpleShapeParameters,u_screenSize:ce.screenSize,u_thinningCenterPos:ce.thinningCenterPos,u_thinningShape:ce.thinningShape,u_thinningAffectedRatio:ce.thinningAffectedRatio,u_thinningParticleOffset:ce.thinningParticleOffset,u_particleColor:ce.color,u_direction:ce.direction});var ce;const ae=Math.round(V.intensity*this.particlesCount),me=s.bd.simpleSegment(0,0,4*ae,2*ae);this.particlesVx&&this.particlesIdx&&P.draw(t,C.TRIANGLES,It.disabled,qt.disabled,ci.alphaBlended,Wt.disabled,le,"snow_particles",this.particlesVx,this.particlesIdx,me)})(r.boxSize,0,r),this._vignette.draw(t,p)}}const Ni={symbol:function(c,t,r,u,p){if(c.renderPass!=="translucent")return;const m=qt.disabled,y=c.colorModeForRenderPass(),v=r.layout.get("text-variable-anchor"),T=r.layout.get("text-size-scale-range"),A=s.aD(c.scaleFactor,T[0],T[1]);v&&function(P,L,j,V,G,U,J,ne){const oe=L.transform,ue=G==="map",le=U==="map";for(const ce of P){const ae=V.getTile(ce),me=ae.getBucket(j);if(!me||!me.text||!me.text.segments.get().length)continue;const ge=s.bH(me.textSizeData,oe.zoom,ne),Me=vc(ce,me.getProjection(),oe),Ee=oe.calculatePixelsToTileUnitsMatrix(ae),qe=xl(Me,ae.tileID.canonical,le,ue,oe,me.getProjection(),Ee),$e=me.hasIconTextFit()&&me.hasIconData();ge&&Kd(me,ue,le,J,oe,qe,ce,Math.pow(2,oe.zoom-ae.tileID.overscaledZ),ge,$e)}}(u,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),p,A);const C=r.paint.get("icon-opacity").constantOr(1)!==0,R=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||R)?ch(c,t,r,u,m,y):(C&&ch(c,t,r,u,m,y,{onlyIcons:!0}),R&&ch(c,t,r,u,m,y,{onlyText:!0})),t.map.showCollisionBoxes&&(kl(c,t,r,u,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),kl(c,t,r,u,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("circle-opacity"),m=r.paint.get("circle-stroke-width"),y=r.paint.get("circle-stroke-opacity"),v=r.layout.get("circle-sort-key").constantOr(1)!==void 0,T=r.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(m.constantOr(1)===0||y.constantOr(1)===0))return;const A=c.context,C=A.gl,R=c.transform,P=c.depthModeForSublayer(0,It.ReadOnly),L=qt.disabled,j=c.colorModeForDrapableLayerRenderPass(T),V=R.projection.name==="globe",G=[s.ay(R.center.lng),s.aH(R.center.lat)],U=[];for(let ne=0;ne<u.length;ne++){const oe=u[ne],ue=t.getTile(oe),le=ue.getBucket(r);if(!le||le.projection.name!==R.projection.name)continue;const ce=le.programConfigurations.get(r.id),ae=s.dK(r),me=c.isTileAffectedByFog(oe);V&&ae.push("PROJECTION_GLOBE_VIEW"),ae.push("DEPTH_D24"),c.terrain&&R.depthOcclusionForSymbolsAndCircles&&ae.push("DEPTH_OCCLUSION");const ge=c.getOrCreateProgram("circle",{config:ce,defines:ae,overrideFog:me}),Me=le.layoutVertexBuffer,Ee=le.globeExtVertexBuffer,qe=le.indexBuffer,$e=R.projection.createInversionMatrix(R,oe.canonical),ct={programConfiguration:ce,program:ge,layoutVertexBuffer:Me,globeExtVertexBuffer:Ee,indexBuffer:qe,uniformValues:s.dL(c,oe,ue,$e,G,r),tile:ue};if(v){const Se=le.segments.get();for(const Pe of Se)U.push({segments:new s.bd([Pe]),sortKey:Pe.sortKey,state:ct})}else U.push({segments:le.segments,sortKey:0,state:ct})}v&&U.sort((ne,oe)=>ne.sortKey-oe.sortKey);const J={useDepthForOcclusion:R.depthOcclusionForSymbolsAndCircles};for(const ne of U){const{programConfiguration:oe,program:ue,layoutVertexBuffer:le,globeExtVertexBuffer:ce,indexBuffer:ae,uniformValues:me,tile:ge}=ne.state,Me=ne.segments;c.terrain&&c.terrain.setupElevationDraw(ge,ue,J),c.uploadCommonUniforms(A,ue,ge.tileID.toUnwrapped()),ue.draw(c,C.TRIANGLES,P,L,j,Wt.disabled,me,r.id,le,ae,Me,r.paint,R.zoom,oe,[ce])}},heatmap:function(c,t,r,u){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,m=p.gl,y=qt.disabled,v=new ci([m.ONE,m.ONE,m.ONE,m.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(L,j,V,G){const U=L.gl,J=j.width*G,ne=j.height*G;L.activeTexture.set(U.TEXTURE1),L.viewport.set([0,0,J,ne]);let oe=V.heatmapFbo;if(!oe||oe&&(oe.width!==J||oe.height!==ne)){oe&&oe.destroy();const ue=U.createTexture();U.bindTexture(U.TEXTURE_2D,ue),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),oe=V.heatmapFbo=L.createFramebuffer(J,ne,!0,null),function(le,ce,ae,me,ge,Me){const Ee=le.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,le.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,ge,Me,0,Ee.RGBA,le.extRenderToTextureHalfFloat?Ee.HALF_FLOAT:Ee.UNSIGNED_BYTE,null),me.colorAttachment.set(ae)}(L,0,ue,oe,J,ne)}else U.bindTexture(U.TEXTURE_2D,oe.colorAttachment.get()),L.bindFramebuffer.set(oe.framebuffer)})(p,c,r,c.transform.projection.name==="globe"?.5:.25),p.clear({color:s.am.transparent});const T=c.transform,A=T.projection.name==="globe",C=A?["PROJECTION_GLOBE_VIEW"]:[],R=A?Wt.frontCCW:Wt.disabled,P=[s.ay(T.center.lng),s.aH(T.center.lat)];for(let L=0;L<u.length;L++){const j=u[L];if(t.hasRenderableParent(j))continue;const V=t.getTile(j),G=V.getBucket(r);if(!G||G.projection.name!==T.projection.name)continue;const U=c.isTileAffectedByFog(j),J=G.programConfigurations.get(r.id),ne=c.getOrCreateProgram("heatmap",{config:J,defines:C,overrideFog:U}),{zoom:oe}=c.transform;c.terrain&&c.terrain.setupElevationDraw(V,ne),c.uploadCommonUniforms(p,ne,j.toUnwrapped());const ue=T.projection.createInversionMatrix(T,j.canonical);ne.draw(c,m.TRIANGLES,It.disabled,y,v,R,dm(c,j,V,ue,P,oe,r.paint.get("heatmap-intensity")),r.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,r.paint,c.transform.zoom,J,A?[G.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,m){const y=p.context,v=y.gl,T=m.heatmapFbo;if(!T)return;y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,T.colorAttachment.get()),y.activeTexture.set(v.TEXTURE1);let A=m.colorRampTexture;A||(A=m.colorRampTexture=new s.T(y,m.colorRamp,v.RGBA8)),A.bind(v.LINEAR,v.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,v.TRIANGLES,It.disabled,qt.disabled,p.colorModeForRenderPass(),Wt.disabled,((C,R,P,L)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,m),m.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,m.paint,p.transform.zoom)}(c,r))},line:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("line-opacity"),m=r.paint.get("line-width");if(p.constantOr(1)===0||m.constantOr(1)===0)return;const y=r.paint.get("line-emissive-strength"),v=r.paint.get("line-occlusion-opacity"),T=r.layout.get("line-elevation-reference"),A=r.layout.get("line-width-unit")==="meters",C=T==="sea",R=!(!c.terrain||!c.terrain.enabled),P=c.context,L=P.gl;if(r.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const j=r.layout.get("line-cross-slope"),V=j!==void 0,G=j<1,U=c.colorModeForDrapableLayerRenderPass(y),J=c.terrain&&c.terrain.renderingToTexture,ne=J?1:s.q.devicePixelRatio,oe=r.paint.get("line-dasharray"),ue=oe.constantOr(1),le=r.layout.get("line-cap"),ce=oe.constantOr(null),ae=le.constantOr(null),me=r.paint.get("line-pattern"),ge=me.constantOr(1),Me=r.paint.get("line-pattern-cross-fade"),Ee=me.constantOr(null),qe=r.paint.get("line-opacity").constantOr(1);let $e=!ge&&qe!==1||c.depthOcclusion&&v>0&&v<1;const ct=r.paint.get("line-gradient"),Se=ge?"linePattern":"line",Pe=s.dM(r);let we;if(J&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&($e=!1),v!==0&&c.depthOcclusion){const We=r.paint._values["line-opacity"];We&&We.value&&We.value.kind==="constant"?we=We.value:s.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}m.value.kind!=="constant"&&m.value.isLineProgressConstant===!1&&Pe.push("VARIABLE_LINE_WIDTH");const Xe=(We,tt,nt,At,Ot,St)=>{for(const Ft of We){const Mt=t.getTile(Ft);if(ge&&!Mt.patternsLoaded())continue;const Ut=Mt.getBucket(r);if(!Ut||Ut.elevationType!=="none"&&!Ot||Ut.elevationType==="none"&&Ot)continue;c.prepareDrawTile();const Xt=[...tt],mi=c.shadowRenderer,rn=Ut.elevationType==="road"&&!!mi&&mi.enabled;let Yi=[0,0,0];if(rn){const ri=c.style.directionalLight,En=c.style.ambientLight;ri&&En&&(Yi=Eo(c.style,ri,En)),Xt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const bi=Ut.programConfigurations.get(r.id);let Vn=!1;if(Ee&&Mt.imageAtlas){const ri=s.dN.from(Ee),En=ri.getPrimary().scaleSelf(ne).toString(),Li=Mt.imageAtlas.patternPositions.get(En),An=ri.getSecondary(),Gi=An?Mt.imageAtlas.patternPositions.get(An.scaleSelf(ne).toString()):null;Vn=!!Li&&!!Gi,Li&&bi.setConstantPatternPositions(Li,Gi)}Me>0&&(Vn||bi.getPatternTransitionVertexBuffer("line-pattern"))&&Xt.push("LINE_PATTERN_TRANSITION");const Ln=c.isTileAffectedByFog(Ft),Qt=c.getOrCreateProgram(Se,{config:bi,defines:Xt,overrideFog:Ln,overrideRtt:!Ot&&void 0});if(!ge&&ce&&ae&&Mt.lineAtlas){const ri=Mt.lineAtlas.getDash(ce,ae);ri&&bi.setConstantPatternPositions(ri)}rn&&mi.setupShadows(Mt.tileID.toUnwrapped(),Qt,"vector-tile",Mt.tileID.overscaledZ);let[Mi,Oi]=r.paint.get("line-trim-offset");(ae==="round"||ae==="square")&&Mi!==Oi&&(Mi===0&&(Mi-=1),Oi===1&&(Oi+=1));const sn=J?Ft.projMatrix:null,ur=A?1/Ut.tileToMeter/s.aw(Mt,1,c.transform.zoom):1,Gn=A?1/Ut.tileToMeter/s.aw(Mt,1,Math.floor(c.transform.zoom)):1,ar=ge?s.dO(c,Mt,r,sn,ne,ur,Gn,[Mi,Oi],Yi,Me):s.dP(c,Mt,r,sn,Ut.lineClipsArray.length,ne,ur,Gn,[Mi,Oi],Yi);if(ct){const ri=Ut.gradients[r.id];let En=ri.texture;if(r.gradientVersion!==ri.version){let Li=256;if(r.stepInterpolant){const An=t.getSource().maxzoom,Gi=Ft.canonical.z===An?Math.ceil(1<<c.transform.maxZoom-Ft.canonical.z):1;Li=s.aD(s.dQ(Ut.maxLineLength/s.aj*1024*Gi),256,P.maxTextureSize)}ri.gradient=s.dR({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Li,image:ri.gradient||void 0,clips:Ut.lineClipsArray}),ri.texture?ri.texture.update(ri.gradient):ri.texture=new s.T(P,ri.gradient,L.RGBA8),ri.version=r.gradientVersion,En=ri.texture}P.activeTexture.set(L.TEXTURE1),En.bind(r.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}ue&&(P.activeTexture.set(L.TEXTURE0),Mt.lineAtlasTexture&&Mt.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),bi.updatePaintBuffers()),ge&&(P.activeTexture.set(L.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),bi.updatePaintBuffers()),Ot&&!C&&c.terrain.setupElevationDraw(Mt,Qt),c.uploadCommonUniforms(P,Qt,Ft.toUnwrapped());const Rn=ri=>{we!=null&&(we.value=qe*v),Qt.draw(c,L.TRIANGLES,nt,ri,U,Wt.disabled,ar,r.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,r.paint,c.transform.zoom,bi,[Ut.layoutVertexBuffer2,Ut.patternVertexBuffer,Ut.zOffsetVertexBuffer]),we!=null&&(we.value=qe)};if($e&&!Ot){const ri=c.stencilModeForClipping(Ft).ref;ri===0&&J&&P.clear({stencil:0});const En={func:L.EQUAL,mask:255};ar.u_alpha_discard_threshold=.8,Rn(new qt(En,ri,255,L.KEEP,L.KEEP,L.INVERT)),ar.u_alpha_discard_threshold=0,Rn(new qt(En,ri,255,L.KEEP,L.KEEP,L.KEEP))}else ar.u_alpha_discard_threshold=$e&&Ot&&St?.8:0,Rn(Ot?At:c.stencilModeForClipping(Ft))}};let ke=c.depthModeForSublayer(0,It.ReadOnly);const Qe=new It(c.depthOcclusion?L.GREATER:L.LEQUAL,It.ReadOnly,c.depthRangeFor3D);if(r.hasNonElevatedBuckets){const We=!J&&c.terrain;v!==0&&We?s.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):We?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):Xe(u,Pe,ke,qt.disabled,!1,!0)}if(r.hasElevatedBuckets){T==="hd-road-markup"?R||(ke=Qe,Pe.push("ELEVATED_ROADS")):(Pe.push("ELEVATED"),ke=Qe,V&&Pe.push(G?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),C&&Pe.push("ELEVATION_REFERENCE_SEA"));const We=$e?c.stencilModeFor3D():qt.disabled;c.forceTerrainMode=!0,Xe(u,Pe,ke,We,!0,!0),$e&&Xe(u,Pe,ke,We,!0,!1),c.forceTerrainMode=!1}$e&&(c.resetStencilClippingMasks(),J&&P.clear({stencil:0})),v===0||c.depthOcclusion||J||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,r,u){const p=r.paint.get("fill-color"),m=r.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const y=r.paint.get("fill-emissive-strength"),v=c.colorModeForDrapableLayerRenderPass(y),T=r.paint.get("fill-pattern"),A=c.opaquePassEnabledForLayer()&&!T.constantOr(1)&&p.constantOr(s.am.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";let C="none";r.layout.get("fill-elevation-reference")!=="none"?C="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(C="offset");const R=!(!c.terrain||!c.terrain.enabled),P={painter:c,sourceCache:t,layer:r,coords:u,colorMode:v,elevationType:C,terrainEnabled:R,pass:A};if(c.renderPass!=="shadow")if(C!=="offset"){if(Tt(P,!1),C==="road"){const L=!R&&c.renderPass==="translucent";L&&Fc(c,t,r,u,"geometry"),Tt(P,!0,qt.disabled),L&&function(j){const{painter:V,sourceCache:G,layer:U,coords:J,colorMode:ne}=j,oe=V.context.gl,ue=j.painter.shadowRenderer,le=!!ue&&ue.enabled,ce=new It(V.context.gl.LEQUAL,It.ReadOnly,V.depthRangeFor3D);let ae=[0,0,0];if(le){const me=V.style.directionalLight,ge=V.style.ambientLight;me&&ge&&(ae=Eo(V.style,me,ge))}for(const me of J){const ge=G.getTile(me),Me=ge.getBucket(U);if(!Me)continue;const Ee=Me.elevatedStructures;if(!Ee||!Ee.renderableSegments||Ee.renderableSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const qe=Me.bufferData.programConfigurations.get(U.id),$e=V.isTileAffectedByFog(me),ct=[];le&&ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Se=V.getOrCreateProgram("elevatedStructures",{config:qe,overrideFog:$e,defines:ct}),Pe=V.translatePosMatrix(me.projMatrix,ge,U.paint.get("fill-translate"),U.paint.get("fill-translate-anchor"));le&&ue.setupShadows(ge.tileID.toUnwrapped(),Se,"vector-tile",ge.tileID.overscaledZ);const we=Hd(Pe,ae);V.uploadCommonUniforms(V.context,Se,me.toUnwrapped()),Se.draw(V,oe.TRIANGLES,ce,qt.disabled,ne,Wt.backCCW,we,U.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.renderableSegments,U.paint,V.transform.zoom,qe,[Ee.vertexBufferNormal])}}(P)}}else Tt(P,!1,c.stencilModeFor3D());else c.shadowRenderer&&C==="road"&&!R&&function(L){const{painter:j,sourceCache:V,layer:G,coords:U}=L,J=j.context.gl,ne=L.painter.shadowRenderer;for(const oe of U){const ue=V.getTile(oe),le=ue.getBucket(G);if(!le)continue;const ce=le.elevatedStructures;if(!ce||!ce.shadowCasterSegments||ce.shadowCasterSegments.segments[0].primitiveLength===0)continue;j.prepareDrawTile();const ae=le.bufferData.programConfigurations.get(G.id),me=j.isTileAffectedByFog(oe),ge=j.getOrCreateProgram("elevatedStructuresDepth",{config:ae,overrideFog:me}),Me=ne.calculateShadowPassMatrixFromTile(ue.tileID.toUnwrapped());j.uploadCommonUniforms(j.context,ge,oe.toUnwrapped());const Ee={u_matrix:Me,u_depth_bias:.001};ge.draw(j,J.TRIANGLES,ne.getShadowPassDepthMode(),qt.disabled,ne.getShadowPassColorMode(),Wt.disabled,Ee,G.id,ce.vertexBuffer,ce.indexBuffer,ce.shadowCasterSegments,G.paint,j.transform.zoom,ae)}}(P)},"fill-extrusion":function(c,t,r,u){const p=r.paint.get("fill-extrusion-opacity"),m=c.context,y=m.gl,v=c.terrain,T=v&&v.renderingToTexture;if(p===0)return;const A=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),C=c.style.order.indexOf(r.fqid);if(A&&function(R,P,L,j,V){for(const G of j){const U=P.getTile(G).getBucket(L);U&&(U.updateReplacement(G,R.replacementSource,V),U.uploadCentroid(R.context))}}(c,t,r,u,C),v||A)for(const R of u){const P=t.getTile(R).getBucket(r);P&&da(c.context,t,R,P,r,v,A)}if(c.renderPass==="shadow"&&c.shadowRenderer){const R=c.shadowRenderer;if(v&&p<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const P=R.getShadowPassDepthMode(),L=R.getShadowPassColorMode();Bc(c,t,r,u,P,qt.disabled,L,A)}else if(c.renderPass==="translucent"){const R=!r.paint.get("fill-extrusion-pattern").constantOr(1),P=r.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!T&&P.a!==0){const L=new It(c.context.gl.LEQUAL,It.ReadWrite,c.depthRangeFor3D);p===1&&R?Bc(c,t,r,u,L,qt.disabled,ci.unblended,A):(Bc(c,t,r,u,L,qt.disabled,ci.disabled,A),Bc(c,t,r,u,L,c.stencilModeFor3D(),c.colorModeForRenderPass(),A),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&R&&(!v&&c.transform.projection.name!=="globe"||T)){const L=r.paint.get("fill-extrusion-opacity"),j=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),V=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=r.paint.get("fill-extrusion-flood-light-intensity"),U=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",J=r.paint.get("fill-extrusion-flood-light-color").toRenderColor(U?null:r.lut).toArray01().slice(0,3),ne=j>0&&V>0,oe=G>0,ue=(ce,ae,me)=>(1-me)*ce+me*ae,le=ce=>{const ae=c.depthModeForSublayer(1,It.ReadOnly,y.LEQUAL,!0),me=r.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ge=ue(.1,3,me),Me=c._showOverdrawInspector;if(!Me){const Ee=new qt({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),qe=new ci([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0],y.MIN);Ka(c,t,r,u,ae,Ee,qe,Wt.disabled,ce,"sdf",L,j,V,G,J,ge,A,!1)}{const Ee=Me?qt.disabled:new qt({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),qe=Me?c.colorModeForRenderPass():new ci([y.ONE_MINUS_DST_ALPHA,y.DST_ALPHA,y.ONE,y.ONE],s.am.transparent,[!0,!0,!0,!0]);Ka(c,t,r,u,ae,Ee,qe,Wt.disabled,ce,"color",L,j,V,G,J,ge,A,!1)}};if(T){const ce=(ae,me,ge)=>{const Me=c.depthModeForSublayer(1,It.ReadOnly,y.LEQUAL,!1),Ee=r.paint.get(ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=ue(.1,3,Ee);{const $e=new ci([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0]);Ka(c,t,r,u,Me,qt.disabled,$e,Wt.disabled,ae,"clear",L,j,V,G,J,qe,A,me)}{const $e=new qt({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),ct=new ci([y.ONE,y.ONE,y.ONE,y.ONE],s.am.transparent,[!1,!1,!1,!0],y.MIN);Ka(c,t,r,u,Me,$e,ct,Wt.disabled,ae,"sdf",L,j,V,G,J,qe,A,me)}{const $e=ae?y.ZERO:y.ONE_MINUS_DST_ALPHA,ct=new qt({func:y.EQUAL,mask:255},255,255,y.KEEP,y.DECR,y.DECR),Se=new ci([$e,y.DST_ALPHA,y.ONE_MINUS_DST_ALPHA,y.ZERO],s.am.transparent,[!0,!0,!0,!0]);Ka(c,t,r,u,Me,ct,Se,Wt.disabled,ae,"color",L,j,V,G,J,qe,A,me)}{const $e=new ci([y.ONE,y.ONE,y.ONE,ae?y.ZERO:y.ONE],s.am.transparent,[!1,!1,!1,!0],ae?y.FUNC_ADD:y.MAX);Ka(c,t,r,u,Me,qt.disabled,$e,Wt.disabled,ae,"clear",L,j,V,G,J,qe,A,me,ge)}};if(ne||oe){let ae;if(c.prepareDrawTile(),v){const me=v.drapeBufferSize[0],ge=v.drapeBufferSize[1];ae=v.framebufferCopyTexture,ae&&(!ae||ae.size[0]===me&&ae.size[1]===ge)||(ae&&ae.destroy(),ae=v.framebufferCopyTexture=new s.T(m,new s.r({width:me,height:ge}),y.RGBA8)),ae.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.copyTexSubImage2D(y.TEXTURE_2D,0,0,0,0,0,me,ge)}ne&&ce(!0,!1,ae),oe&&ce(!1,!0,ae)}}else ne&&le(!0),oe&&le(!1),(ne||oe)&&c.resetStencilClippingMasks()}}},hillshade:function(c,t,r,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,m=c.terrain&&c.terrain.renderingToTexture,[y,v]=c.renderPass!=="translucent"||m?[{},u]:c.stencilConfigForOverlap(u);for(const T of v){const A=t.getTile(T);if(A.needsHillshadePrepare&&c.renderPass==="offscreen")Rd(c,A,r);else if(c.renderPass==="translucent"){const C=c.depthModeForSublayer(0,It.ReadOnly),R=r.paint.get("hillshade-emissive-strength"),P=c.colorModeForDrapableLayerRenderPass(R),L=m&&c.terrain?c.terrain.stencilModeForRTTOverlap(T):y[T.overscaledZ];Yp(c,T,A,r,C,L,P)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,u,p,m){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const y=c.transform.projection.name==="globe",v=r.paint.get("raster-elevation")!==0,T=v&&y;if(c.renderElevatedRasterBackface&&!T)return;const A=c.context,C=A.gl,R=t.getSource(),P=function(le,ce,ae,me){const ge=ce.paint.get("raster-color"),Me=le.type==="raster-array",Ee=[],qe=ce.paint.get("raster-resampling"),$e=ce.paint.get("raster-color-mix");let ct=ce.paint.get("raster-color-range");const Se=[$e[0],$e[1],$e[2],0],Pe=$e[3];let we=qe==="nearest"?me.NEAREST:me.LINEAR;if(Me&&(Ee.push("RASTER_ARRAY"),ge||Ee.push("RASTER_COLOR"),qe==="linear"&&Ee.push("RASTER_ARRAY_LINEAR"),we=me.NEAREST,!ct&&le.rasterLayers)){const Xe=le.rasterLayers.find(({id:ke})=>ke===ce.sourceLayer);Xe&&Xe.fields&&Xe.fields.range&&(ct=Xe.fields.range)}if(ct=ct||[0,1],ge){Ee.push("RASTER_COLOR"),ae.activeTexture.set(me.TEXTURE2),ce.updateColorRamp(ct);let Xe=ce.colorRampTexture;Xe||(Xe=ce.colorRampTexture=new s.T(ae,ce.colorRamp,me.RGBA8)),Xe.bind(me.LINEAR,me.CLAMP_TO_EDGE)}return{mix:Se,range:ct,offset:Pe,defines:Ee,resampling:we}}(R,r,A,C);if(R instanceof s.aP&&!u.length&&!y)return;const L=r.paint.get("raster-emissive-strength"),j=c.colorModeForDrapableLayerRenderPass(L),V=c.terrain&&c.terrain.renderingToTexture,G=!c.options.moving,U=r.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;if(R instanceof s.aP&&!u.length&&(R.onNorthPole||R.onSouthPole)){const le=v?c.stencilModeFor3D():qt.disabled;return void Nc(!!R.onNorthPole,null,c,t,r,L,P,Wt.disabled,le)}if(!u.length)return;const[J,ne]=R instanceof s.aP||V?[{},u]:c.stencilConfigForOverlap(u),oe=ne[ne.length-1].overscaledZ;T&&P.defines.push("PROJECTION_GLOBE_VIEW"),v&&P.defines.push("RENDER_CUTOFF");const ue=(le,ce,ae)=>{for(const me of le){const ge=me.toUnwrapped(),Me=t.getTile(me);if(V&&(!Me||!Me.hasData()))continue;A.activeTexture.set(C.TEXTURE0);const Ee=ly(Me,R,r,P);if(!Ee||!Ee.texture)continue;const{texture:qe,mix:$e,offset:ct,tileSize:Se,buffer:Pe}=Ee;let we,Xe;V?(we=It.disabled,Xe=me.projMatrix):v?(we=new It(C.LEQUAL,It.ReadWrite,c.depthRangeFor3D),Xe=y?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(ge,G)):(we=c.depthModeForSublayer(me.overscaledZ-oe,r.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,C.LESS),Xe=c.transform.calculateProjMatrix(ge,G));const ke=c.terrain&&V?c.terrain.stencilModeForRTTOverlap(me):J[me.overscaledZ],Qe=m?0:r.paint.get("raster-fade-duration");Me.registerFadeDuration(Qe);const We=t.findLoadedParent(me,0),tt=Rc(Me,We,t,c.transform,Qe);let nt,At;c.terrain&&c.terrain.prepareDrawTile(),A.activeTexture.set(C.TEXTURE0),qe.bind(U,C.CLAMP_TO_EDGE),A.activeTexture.set(C.TEXTURE1),We?(We.texture&&We.texture.bind(U,C.CLAMP_TO_EDGE),nt=Math.pow(2,We.tileID.overscaledZ-Me.tileID.overscaledZ),At=[Me.tileID.canonical.x*nt%1,Me.tileID.canonical.y*nt%1]):qe.bind(U,C.CLAMP_TO_EDGE),"useMipmap"in qe&&A.extTextureFilterAnisotropic&&c.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);const Ot=c.transform;let St;const Ft=v?ym(Ot):[0,0,0,0];let Mt,Ut,Xt,mi,rn,Yi=0;if(T&&R instanceof s.aP&&R.coordinates.length>3)Mt=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0)))),Ut=Float32Array.from(Ot.globeMatrix),Xt=Float32Array.from(s.dm(Ot)),mi=[s.ay(Ot.center.lng),s.aH(Ot.center.lat)],St=R.elevatedGlobePerspectiveTransform,rn=R.elevatedGlobeGridMatrix||new Float32Array(9);else if(T){const Qt=s.dn(me.canonical);Yi=s.dp(Qt.getCenter().lat),Mt=Float32Array.from(s.bh(s.dr(me.canonical))),Ut=Float32Array.from(Ot.globeMatrix),Xt=Float32Array.from(s.dm(Ot)),mi=[s.ay(Ot.center.lng),s.aH(Ot.center.lat)],St=[0,0],rn=Float32Array.from(s.dq(me.canonical,Qt,Yi,Ot.worldSize/Ot._pixelsPerMercatorPixel))}else St=R instanceof s.aP?R.perspectiveTransform:[0,0],Mt=new Float32Array(16),Ut=new Float32Array(9),Xt=new Float32Array(16),mi=[0,0],rn=new Float32Array(9);const bi=ha(Xe,Mt,Ut,Xt,rn,At||[0,0],s.ah(c.transform.zoom),mi,Ft,nt||1,tt,r,St,v?r.paint.get("raster-elevation"):0,2,$e,ct,P.range,Se,Pe,L),Vn=c.isTileAffectedByFog(me),Ln=c.getOrCreateProgram("raster",{defines:P.defines,overrideFog:Vn});if(c.uploadCommonUniforms(A,Ln,ge),R instanceof s.aP){const Qt=R.elevatedGlobeVertexBuffer,Mi=R.elevatedGlobeIndexBuffer;if(V||!y)R.boundsBuffer&&R.boundsSegments&&Ln.draw(c,C.TRIANGLES,we,qt.disabled,j,Wt.disabled,bi,r.id,R.boundsBuffer,c.quadTriangleIndexBuffer,R.boundsSegments);else if(Qt&&Mi){const Oi=Ot.zoom<=s.cL?R.elevatedGlobeSegments:R.getSegmentsForLongitude(Ot.center.lng);Oi&&Ln.draw(c,C.TRIANGLES,we,qt.disabled,j,ce,bi,r.id,Qt,Mi,Oi)}}else if(T){we=new It(C.LEQUAL,It.ReadOnly,c.depthRangeFor3D);const Qt=c.globeSharedBuffers;if(Qt){const[Mi,Oi,sn]=Qt.getGridBuffers(Yi,!1);Ln.draw(c,C.TRIANGLES,we,ae||ke,c.colorModeForRenderPass(),ce,bi,r.id,Mi,Oi,sn)}}else{const{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:Mi,tileBoundsSegments:Oi}=c.getTileBoundsBuffers(Me);Ln.draw(c,C.TRIANGLES,we,ke,j,Wt.disabled,bi,r.id,Qt,Mi,Oi)}}if(!(R instanceof s.aP)&&T)for(const me of le){const ge=me.canonical.y===(1<<me.canonical.z)-1;me.canonical.y===0&&Nc(!0,me,c,t,r,L,P,ce,ae||qt.disabled),ge&&Nc(!1,me,c,t,r,L,P,ce===Wt.frontCW?Wt.backCW:Wt.frontCW,ae||qt.disabled)}};T?ue(ne,c.renderElevatedRasterBackface?Wt.backCW:Wt.frontCW,c.stencilModeFor3D()):ue(ne,Wt.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,u,p,m){c.renderPass==="offscreen"&&function(y,v,T,A){if(!A.length)return;const C=y.context,R=C.gl,P=v.getSource();if(!(P instanceof za))return;const L=Math.ceil(Math.sqrt(T.paint.get("raster-particle-count")));let j=T.particlePositionRGBAImage;if(!j||j.width!==L){const ne=function(oe){const ue=oe*oe,le=new Uint8Array(4*ue),ce=function(me){return me|=0,me=Math.imul(2747636419^me,2654435769),me=Math.imul(me^me>>>16,2654435769),((me=Math.imul(me^me>>>16,2654435769))>>>0)/4294967296},ae=1/1.1;for(let me=0;me<ue;me++){const ge=ae*(ce(2*me+0)+$s),Me=ae*(ce(2*me+1)+$s),Ee=255*ge%1,qe=255*Me%1,$e=Ee,ct=Me-qe/255,Se=qe;le[4*me+0]=255*(ge-Ee/255),le[4*me+1]=255*$e,le[4*me+2]=255*ct,le[4*me+3]=255*Se}return le}(L);j=T.particlePositionRGBAImage=new s.r({width:L,height:L},ne)}let V=T.particleFramebuffer;V?V.width!==L&&(V.destroy(),V=T.particleFramebuffer=C.createFramebuffer(L,L,!0,null)):V=T.particleFramebuffer=C.createFramebuffer(L,L,!0,null);const G=[];for(const ne of A){const oe=v.getTile(ne);if(!(oe instanceof gc))continue;const ue=uy(oe,P,T);if(!ue)continue;const le=[oe.tileSize,oe.tileSize];let ce=T.tileFramebuffer;ce||(ce=T.tileFramebuffer=C.createFramebuffer(le[0],le[1],!0,null));let ae=oe.rasterParticleState;ae||(ae=oe.rasterParticleState=new cy(C,ne,le,j));const me=ae.update(T.lastInvalidatedAt);ae.particleTextureDimension!==L&&ae.updateParticleTexture(ne,j);const ge=ae.targetColorTexture;ae.targetColorTexture=ae.backgroundColorTexture,ae.backgroundColorTexture=ge;const Me=ae.particleTexture0;ae.particleTexture0=ae.particleTexture1,ae.particleTexture1=Me,G.push([ne,ue,ae,me])}if(G.length===0)return;const U=s.q.now(),J=T.previousDrawTimestamp?.001*(U-T.previousDrawTimestamp):.0167;if(T.previousDrawTimestamp=U,T.hasColorMap()){C.activeTexture.set(R.TEXTURE0+2);let ne=T.colorRampTexture;ne||(ne=T.colorRampTexture=new s.T(C,T.colorRamp,R.RGBA8)),ne.bind(R.LINEAR,R.CLAMP_TO_EDGE)}C.bindFramebuffer.set(T.tileFramebuffer.framebuffer),function(ne,oe,ue){const le=ne.context,ce=le.gl,ae=oe.tileFramebuffer;le.activeTexture.set(ce.TEXTURE0);const me={u_texture:0,u_opacity:1.05*(Me=oe.paint.get("raster-particle-fade-opacity-factor"))/(Me+.05)},ge=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Me;for(const Ee of ue){const[,,qe,$e]=Ee;ae.colorAttachment.set(qe.targetColorTexture.texture),le.viewport.set([0,0,ae.width,ae.height]),le.clear({color:s.am.transparent}),$e&&(qe.backgroundColorTexture.bind(ce.NEAREST,ce.CLAMP_TO_EDGE),ge.draw(ne,ce.TRIANGLES,It.disabled,qt.disabled,ci.alphaBlended,Wt.disabled,me,oe.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(y,T,G),function(ne,oe,ue,le){const ce=ne.context,ae=ce.gl,me=ue.tileFramebuffer,ge=ne.transform.projection.name==="globe",Me=ue.paint.get("raster-particle-max-speed");for(const Ee of le){const[qe,$e,ct]=Ee;ce.activeTexture.set(ae.TEXTURE0+0),$e.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),me.colorAttachment.set(ct.targetColorTexture.texture);const Se=ne.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1});ce.activeTexture.set(ae.TEXTURE0+1);const Pe=$e.scalarData?[]:[0,1,2,3].map(ke=>s.dU[ke](qe));Pe.push(qe);const we=qe.canonical.x,Xe=qe.canonical.y;for(const ke of Pe){const Qe=oe.getTile(ge?ke.wrapped():ke);if(!Qe)continue;const We=Qe.rasterParticleState;if(!We)continue;const tt=ke.canonical.x+(1<<ke.canonical.z)*(ke.wrap-qe.wrap),nt=ke.canonical.y;We.particleTexture0.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const At=nh(1,We.particleTexture0.size[0],[tt-we,nt-Xe],0,$e.texture.size,2,Me,$e.textureOffset,$e.scale,$e.offset);Se.draw(ne,ae.POINTS,It.disabled,qt.disabled,ci.alphaBlended,Wt.disabled,At,ue.id,We.particleIndexBuffer,void 0,We.particleSegment)}}}(y,v,T,G),C.bindFramebuffer.set(T.particleFramebuffer.framebuffer),function(ne,oe,ue,le){const ce=ne.context,ae=ce.gl,me=oe.paint.get("raster-particle-max-speed"),ge=le*oe.paint.get("raster-particle-speed-factor")*.15,Me=function(qe){return Math.pow(qe,6)}(.01+1*oe.paint.get("raster-particle-reset-rate-factor")),Ee=oe.particleFramebuffer;ce.viewport.set([0,0,Ee.width,Ee.height]);for(const qe of ue){const[,$e,ct]=qe;ce.activeTexture.set(ae.TEXTURE0+0),$e.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),ce.activeTexture.set(ae.TEXTURE0+1);const Se=ct.particleTexture0;Se.bind(ae.NEAREST,ae.CLAMP_TO_EDGE);const Pe=pm(1,Se.size[0],0,$e.texture.size,me,ge,Me,$e.textureOffset,$e.scale,$e.offset);Ee.colorAttachment.set(ct.particleTexture1.texture),ce.clear({color:s.am.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:$e.defines}).draw(ne,ae.TRIANGLES,It.disabled,qt.disabled,ci.unblended,Wt.disabled,Pe,oe.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(y,T,G,J)}(c,t,r,u),c.renderPass==="translucent"&&(function(y,v,T,A,C){const R=y.context,P=R.gl,L=v.getSource().tileSize,j=5*(1-s.af(s.cx,s.cx+1,y.transform.zoom))*L+T.paint.get("raster-particle-elevation"),V=!y.options.moving,G=y.transform.projection.name==="globe";if(!A.length)return;const[U,J]=y.stencilConfigForOverlap(A),ne=[];G&&ne.push("PROJECTION_GLOBE_VIEW");const oe=y.stencilModeFor3D();for(const ue of J){const le=ue.toUnwrapped(),ce=v.getTile(ue);if(!ce.rasterParticleState)continue;const ae=ce.rasterParticleState,me=100;ce.registerFadeDuration(me);const ge=v.findLoadedParent(ue,0),Me=Rc(ce,ge,v,y.transform,me);let Ee,qe;y.terrain&&y.terrain.prepareDrawTile(),R.activeTexture.set(P.TEXTURE0),ae.targetColorTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),R.activeTexture.set(P.TEXTURE1),ge&&ge.rasterParticleState?(ge.rasterParticleState.targetColorTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ee=Math.pow(2,ge.tileID.overscaledZ-ce.tileID.overscaledZ),qe=[ce.tileID.canonical.x*Ee%1,ce.tileID.canonical.y*Ee%1]):ae.targetColorTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const $e=G?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(le,V),ct=y.transform,Se=Qd(ct),Pe=s.dn(ue.canonical),we=s.dp(Pe.getCenter().lat);let Xe,ke,Qe,We,tt;G?(Xe=Float32Array.from(s.bh(s.dr(ue.canonical))),ke=Float32Array.from(ct.globeMatrix),Qe=Float32Array.from(s.dm(ct)),We=[s.ay(ct.center.lng),s.aH(ct.center.lat)],tt=Float32Array.from(s.dq(ue.canonical,Pe,we,ct.worldSize/ct._pixelsPerMercatorPixel))):(Xe=new Float32Array(16),ke=new Float32Array(9),Qe=new Float32Array(16),We=[0,0],tt=new Float32Array(9));const nt=Wd($e,Xe,ke,Qe,tt,qe||[0,0],s.ah(y.transform.zoom),We,Se,Ee||1,Me,j),At=y.isTileAffectedByFog(ue),Ot=y.getOrCreateProgram("rasterParticle",{defines:ne,overrideFog:At});if(y.uploadCommonUniforms(R,Ot,le),G){const St=new It(P.LEQUAL,It.ReadOnly,y.depthRangeFor3D),Ft=0,Mt=y.globeSharedBuffers;if(Mt){const[Ut,Xt,mi]=Mt.getGridBuffers(we,Ft!==0);Ot.draw(y,P.TRIANGLES,St,oe,ci.alphaBlended,y.renderElevatedRasterBackface?Wt.frontCCW:Wt.backCCW,nt,T.id,Ut,Xt,mi)}}else{const St=y.depthModeForSublayer(0,It.ReadOnly),Ft=U[ue.overscaledZ],{tileBoundsBuffer:Mt,tileBoundsIndexBuffer:Ut,tileBoundsSegments:Xt}=y.getTileBoundsBuffers(ce);Ot.draw(y,P.TRIANGLES,St,Ft,ci.alphaBlended,Wt.disabled,nt,T.id,Mt,Ut,Xt)}}y.resetStencilClippingMasks()}(c,t,r,u),c.style.map.triggerRepaint())},background:function(c,t,r,u){const p=r.paint.get("background-color"),m=r.paint.get("background-color-use-theme").constantOr("default")==="none",y=r.paint.get("background-opacity"),v=r.paint.get("background-emissive-strength"),T=r.paint.get("background-pitch-alignment")==="viewport";if(y===0)return;const A=c.context,C=A.gl,R=c.transform,P=R.tileSize,L=r.paint.get("background-pattern");let j;if(L!==void 0&&(L===null||(j=c.imageManager.getPattern(s.I.from(L.toString()),r.scope,c.style.getLut(r.scope)),!j)))return;const V=!L&&p.a===1&&y===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==V)return;const G=qt.disabled,U=c.depthModeForSublayer(0,V==="opaque"?It.ReadWrite:It.ReadOnly),J=c.colorModeForDrapableLayerRenderPass(v),ne=L?"backgroundPattern":"background";let oe,ue=u;if(ue||(oe=c.getBackgroundTiles(),ue=Object.values(oe).map(le=>le.tileID)),L&&(A.activeTexture.set(C.TEXTURE0),c.imageManager.bind(c.context,r.scope)),T){const le=c.getOrCreateProgram(ne,{overrideFog:!1,overrideRtt:!0}),ce=new Float32Array(s.bx([])),ae=new s.aM(0,0,0,0,0),me=L?mm(ce,v,y,c,0,r.scope,j,T,{tileID:ae,tileSize:P}):sh(ce,v,y,p.toRenderColor(m?null:r.lut));le.draw(c,C.TRIANGLES,U,G,J,Wt.disabled,me,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const le of ue){const ce=c.isTileAffectedByFog(le),ae=c.getOrCreateProgram(ne,{overrideFog:ce}),me=le.toUnwrapped(),ge=u?le.projMatrix:c.transform.calculateProjMatrix(me);c.prepareDrawTile();const Me=t?t.getTile(le):oe?oe[le.key]:new jo(le,P,R.zoom,c),Ee=L?mm(ge,v,y,c,0,r.scope,j,T,{tileID:le,tileSize:P}):sh(ge,v,y,p.toRenderColor(m?null:r.lut));c.uploadCommonUniforms(A,ae,me);const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:$e,tileBoundsSegments:ct}=c.getTileBoundsBuffers(Me);ae.draw(c,C.TRIANGLES,U,G,J,Wt.disabled,Ee,r.id,qe,$e,ct)}},sky:function(c,t,r){const u=c._atmosphere?s.ah(c.transform.zoom):1,p=r.paint.get("sky-opacity")*u;if(p===0)return;const m=c.context,y=r.paint.get("sky-type"),v=new It(m.gl.LEQUAL,It.ReadOnly,[0,1]),T=c.frameCounter/1e3%1;y==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&(function(A,C,R,P){const L=A.context,j=L.gl;let V=C.skyboxFbo;if(!V){V=C.skyboxFbo=L.createFramebuffer(32,32,!0,null),C.skyboxGeometry=new Vc(L),C.skyboxTexture=L.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,C.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ne=0;ne<6;++ne)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}L.bindFramebuffer.set(V.framebuffer),L.viewport.set([0,0,32,32]);const G=C.getCenter(A,!0),U=A.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);s.bx(J),s.e3(J,J,.5*-Math.PI),ma(A,C,U,J,G,0),s.bx(J),s.e3(J,J,.5*Math.PI),ma(A,C,U,J,G,1),s.bx(J),s.cG(J,J,.5*-Math.PI),ma(A,C,U,J,G,2),s.bx(J),s.cG(J,J,.5*Math.PI),ma(A,C,U,J,G,3),s.bx(J),ma(A,C,U,J,G,4),s.bx(J),s.e3(J,J,Math.PI),ma(A,C,U,J,G,5),L.viewport.set([0,0,A.width,A.height])}(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&function(A,C,R,P,L){const j=A.context,V=j.gl,G=A.transform,U=A.getOrCreateProgram("skybox");j.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,C.skyboxTexture);const J=((ne,oe,ue,le,ce)=>({u_matrix:ne,u_sun_direction:oe,u_cubemap:0,u_opacity:le,u_temporal_offset:ce}))(G.skyboxMatrix,C.getCenter(A,!1),0,P,L);A.uploadCommonUniforms(j,U),U.draw(A,V.TRIANGLES,R,qt.disabled,A.colorModeForRenderPass(),Wt.backCW,J,"skybox",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)}(c,r,v,p,T):y==="gradient"&&c.renderPass==="sky"&&function(A,C,R,P,L){const j=A.context,V=j.gl,G=A.transform,U=A.getOrCreateProgram("skyboxGradient");C.skyboxGeometry||(C.skyboxGeometry=new Vc(j)),j.activeTexture.set(V.TEXTURE0);let J=C.colorRampTexture;J||(J=C.colorRampTexture=new s.T(j,C.colorRamp,V.RGBA8)),J.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ne=((oe,ue,le,ce,ae)=>({u_matrix:oe,u_color_ramp:0,u_center_direction:ue,u_radius:s.al(le),u_opacity:ce,u_temporal_offset:ae}))(G.skyboxMatrix,C.getCenter(A,!1),C.paint.get("sky-gradient-radius"),P,L);A.uploadCommonUniforms(j,U),U.draw(A,V.TRIANGLES,R,qt.disabled,A.colorModeForRenderPass(),Wt.backCW,ne,"skyboxGradient",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)}(c,r,v,p,T)},debug:function(c,t,r,u,p,m){for(let y=0;y<r.length;y++)if(p){const A=new s.am(u.r*.8,u.g*.8,u.b*.8,1);Ya(c,t,r[y],u,-1,-1,m),Ya(c,t,r[y],u,-1,1,m),Ya(c,t,r[y],u,1,1,m),Ya(c,t,r[y],u,1,-1,m),Ya(c,t,r[y],A,0,0,m)}else Ya(c,t,r[y],u,0,0,m)},custom:function(c,t,r,u){const p=c.context,m=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const y=m.prerender;if(y){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const v=c.transform.pointMerc;y.call(m,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),s.ah(c.transform.zoom),[v.x,v.y],c.transform.pixelsPerMeterRatio)}else y.call(m,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const v=m.renderToTile;if(v){const T=u[0].canonical,A={x:T.x+u[0].wrap*(m.wrapTileId?0:1<<T.z),y:T.y,z:T.z};p.setDepthMode(It.disabled),p.setStencilMode(qt.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),v.call(m,p.gl,A),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(qt.disabled);const y=m.renderingMode==="3d"?new It(c.context.gl.LEQUAL,It.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,It.ReadOnly);if(p.setDepthMode(y),c.transform.projection.name==="globe"){const v=c.transform.pointMerc;m.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),s.ah(c.transform.zoom),[v.x,v.y],c.transform.pixelsPerMeterRatio)}else m.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,u){if(c.renderPass==="opaque")return;const p=r.paint.get("model-opacity").constantOr(1);if(p===0)return;const m=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!m||c.terrain&&p<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const y=c.shadowRenderer,v=r.paint.get("model-receive-shadows");y&&(y.useNormalOffset=!0,v||(y.enabled=!1));const T=()=>{y&&(y.useNormalOffset=!0,v||(y.enabled=!0))},A=t.getSource();if(c.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(U,J,ne,oe,ue){const le=U.transform;if(le.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${le.projection.name} projection is not yet implemented`);const ce=le.getFreeCameraOptions().position;if(!U.modelManager)return;const ae=U.modelManager;ne.modelManager=ae;const me=U.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ge=ne._unevaluatedLayout._values["model-id"],Me=Object.assign({},ne.layout.get("model-id").parameters),Ee=U.style.order.indexOf(ne.fqid);for(const qe of oe){const $e=J.getTile(qe).getBucket(ne);if(!$e||$e.projection.name!==le.projection.name)continue;const ct=$e.getModelUris();ct&&!$e.modelsRequested&&(ae.addModelsFromBucket(ct,ue),$e.modelsRequested=!0);const Se=dh(qe,le);Me.zoom=Se;const Pe=ge.possiblyEvaluate(Me);if(Ce(U,$e,qe),po.shadowUniformsInitialized=!1,po.useSingleShadowCascade=!!me&&me.getMaxCascadeForTile(qe.toUnwrapped())===0,U.renderPass==="shadow"&&me){if(U.currentShadowCascade===1&&$e.isInsideFirstShadowMapFrustum)continue;const ke=le.calculatePosMatrix(qe.toUnwrapped(),le.worldSize);if(po.tileMatrix.set(ke),po.shadowTileMatrix=Float32Array.from(me.calculateShadowPassMatrixFromMatrix(ke)),po.aabb.min.fill(0),po.aabb.max[0]=po.aabb.max[1]=s.aj,po.aabb.max[2]=0,Sm($e,po,U,ne.scope))continue}const we=1<<qe.canonical.z,Xe=[((ce.x-qe.wrap)*we-qe.canonical.x)*s.aj,(ce.y*we-qe.canonical.y)*s.aj,ce.z*we*s.aj];U.conflationActive&&Object.keys($e.instancesPerModel).length>0&&U.style.isLayerClipped(ne,J.getSource())&&$e.updateReplacement(qe,U.replacementSource,Ee,ue)&&($e.uploaded=!1,$e.upload(U.context));for(let ke in $e.instancesPerModel){const Qe=$e.instancesPerModel[ke];Qe.features.length>0&&(ke=Pe.evaluate(Qe.features[0].feature,{}));const We=ae.getModel(ke,ue);if(We||ae.hasURLBeenRequested(ke)||$e.modelUris.includes(ke)||($e.modelUris.push(ke),$e.modelsRequested=!1),We&&We.uploaded)for(const tt of We.nodes)fh(U,ne,tt,Qe,Xe,qe,po)}}}(c,t,r,u,A.type==="vector"?r.scope:""),void T();if(!A.loaded())return;if(A.type==="batched-model")return function(U,J,ne,oe){ne.resetLayerRenderingStats(U);const ue=U.context,le=U.transform,ce=U.style.fog,ae=U.shadowRenderer;if(le.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);const me=U.transform.getFreeCameraOptions().position,ge=s.b$([],[me.x,me.y,me.z],U.transform.worldSize),Me=s.eb([],ge),Ee=s.bx([]),qe=s.ec(le.center.lat,le.zoom),$e=s.bn([],[1,1,1/qe]);s.bo(Ee,Ee,Me);const ct=ne.paint.get("model-opacity").constantOr(1),Se=new It(ue.gl.LEQUAL,It.ReadWrite,U.depthRangeFor3D),Pe=new It(ue.gl.LEQUAL,It.ReadOnly,U.depthRangeFor3D),we=new s.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Xe=U.renderPass==="shadow",ke=Xe&&ae?ae.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),Qe=ne.paint.get("model-front-cutoff"),We=Qe[2]<1,tt=Ua(U,ne.paint.get("model-cutoff-fade-range")),nt=ne.getLayerRenderingStats();(function(At,Ot,St,Ft){const Mt=At.terrain?At.terrain.exaggeration():0,Ut=At.transform.zoom;for(const Xt of Ft){const mi=Ot.getTile(Xt).getBucket(St);mi&&(mi.setFilter(St.filter),At.conflationActive&&mi.updateReplacement(Xt,At.replacementSource),mi.evaluateScale(At,St),At.terrain&&Mt>0&&mi.elevationUpdate(At.terrain,Mt,Xt,St.source),mi.needsReEvaluation(At,Ut,St)&&mi.evaluate(St))}})(U,J,ne,oe),function(){let At,Ot,St;We?(At=oe.length-1,Ot=-1,St=-1):(At=0,Ot=oe.length,St=1);const Ft=new Float64Array(16),Mt=s.eg(),Ut=new s.P(0,0);for(let Xt=At;Xt!==Ot;Xt+=St){const mi=oe[Xt],rn=J.getTile(mi).getBucket(ne);if(!rn||!rn.uploaded)continue;let Yi=!1;ae&&(Yi=ae.getMaxCascadeForTile(mi.toUnwrapped())===0);const bi=le.calculatePosMatrix(mi.toUnwrapped(),le.worldSize),Vn=rn.modelTraits;!Xe&&We&&(s.bi(Ft,bi),s.ad(Mt,ge,Ft),Ut.x=Mt[0],Ut.y=Mt[1]);const Ln=[];rn.setFilter(ne.filter);for(const Qt of rn.getNodesInfo()){if(Qt.hiddenByReplacement||!Qt.node.meshes)continue;const Mi=Qt.node;let Oi=0;U.terrain&&Mi.elevation&&(Oi=Mi.elevation*U.terrain.exaggeration());const sn=(()=>{const Dn=Qt.aabb;return we.min=[...Dn.min],we.max=[...Dn.max],we.min[2]+=Oi,we.max[2]+=Oi,s.ad(we.min,we.min,bi),s.ad(we.max,we.max,bi),we})(),ur=Qt.evaluatedScale;if(ur[0]<=1&&ur[1]<=1&&ur[2]<=1&&sn.intersects(ke)===0)continue;if(!Xe&&We){const Dn=.16666666666666666;Qt.cameraCollisionOpacity=ge[0]>sn.min[0]&&ge[0]<sn.max[0]&&ge[1]>sn.min[1]&&ge[1]<sn.max[1]&&ge[2]*qe<sn.max[2]&&Mi.footprint&&s.bS(Ut,Mi.footprint)?Math.max(Qt.cameraCollisionOpacity-Dn,0):Math.min(1,Qt.cameraCollisionOpacity+Dn)}const Gn=[...bi],ar=Mi.anchor?Mi.anchor[0]:0,Rn=Mi.anchor?Mi.anchor[1]:0;s.bo(Gn,Gn,[ar*(ur[0]-1),Rn*(ur[1]-1),Oi]),s.ci(ur,s.eh)||s.cE(Gn,Gn,ur);const ri=s.az([],Gn,Mi.matrix),En=s.az([],le.expandedFarZProjMatrix,ri),Li=s.az([],le.expandedFarZProjMatrix,Gn),An=s.aA([],[ar,Rn,Oi,1],En)[2];Mi.hidden=!1;let Gi=ct;Xe||(We&&(Gi*=Qt.cameraCollisionOpacity,Gi*=Nl(Gn,le,Qt.aabb,Qe)),Gi*=Em(tt,An)),Gi!==0?Ln.push({nodeInfo:Qt,depth:An,opacity:Gi,wvpForNode:En,wvpForTile:Li,nodeModelMatrix:ri,tileModelMatrix:Gn}):Mi.hidden=!0}Xe||Ln.sort((Qt,Mi)=>!We||Qt.opacity===1&&Mi.opacity===1?Qt.depth<Mi.depth?-1:1:Qt.opacity===1?-1:Mi.opacity===1?1:Qt.depth>Mi.depth?-1:1);for(const Qt of Ln){const Mi=Qt.nodeInfo,Oi=Mi.node;let sn=s.az([],$e,Qt.tileModelMatrix);s.az(sn,Ee,sn);const ur=s.bi([],sn);s.ee(ur,ur),s.cE(ur,ur,rf),sn=s.az(sn,sn,Oi.matrix);const Gn=U.renderPass==="light-beam",ar=ne.paint.get("model-color-use-theme").constantOr("default")==="none",Rn=Vn&s.em.HasMapboxMeshFeatures,ri=Rn?0:Mi.evaluatedRMEA[0][2];for(let En=0;En<Oi.meshes.length;++En){const Li=Oi.meshes[En],An=En===Oi.lightMeshIndex;let Gi=Qt.wvpForNode;if(An){if(!Gn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}Gi=Qt.wvpForTile}else if(Gn)continue;const Dn={defines:[]},Ir=[];if(!Xe&&ae&&(ae.useNormalOffset=!!Li.normalBuffer),ut(Dn.defines,Ir,Li,U,ar?null:ne.lut),Rn||Dn.defines.push("DIFFUSE_SHADED"),Yi&&Dn.defines.push("SHADOWS_SINGLE_CASCADE"),nt&&(Xe?nt.numRenderedVerticesInShadowPass+=Li.vertexArray.length:nt.numRenderedVerticesInTransparentPass+=Li.vertexArray.length),Xe){$n(Li,Qt.nodeModelMatrix,U,ne);continue}let yn=null;if(ce){const Ls=Ja(Qt.nodeModelMatrix,U.transform);if(yn=new Float32Array(Ls),le.projection.name!=="globe"){const to=Li.aabb.min,Mo=Li.aabb.max,[Po,xo]=ce.getOpacityForBounds(Ls,to[0],to[1],Mo[0],Mo[1]);Dn.overrideFog=Po>=bt||xo>=bt}}const Lr=Li.material;let ir;Lr.occlusionTexture&&Lr.occlusionTexture.offsetScale&&(ir=Lr.occlusionTexture.offsetScale,Dn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const $r=U.getOrCreateProgram("model",Dn);!Xe&&ae&&ae.setupShadowsFromMatrix(Qt.tileModelMatrix,$r,ae.useNormalOffset),U.uploadCommonUniforms(ue,$r,null,yn);const yo=Lr.pbrMetallicRoughness;yo.metallicFactor=.9,yo.roughnessFactor=.5;const Zo=Za(new Float32Array(Gi),new Float32Array(sn),new Float32Array(ur),new Float32Array(Oi.matrix),U,Qt.opacity,yo.baseColorFactor.toRenderColor(null),Lr.emissiveFactor,yo.metallicFactor,yo.roughnessFactor,Lr,ri,ne,[0,0,0],ir);!An&&(Mi.hasTranslucentParts||Qt.opacity<1)&&$r.draw(U,ue.gl.TRIANGLES,Se,qt.disabled,ci.disabled,Wt.backCCW,Zo,ne.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,ne.paint,U.transform.zoom,void 0,Ir),$r.draw(U,ue.gl.TRIANGLES,An?Pe:Se,qt.disabled,An||Qt.opacity<1||Mi.hasTranslucentParts?ci.alphaBlended:ci.unblended,Wt.backCCW,Zo,ne.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,ne.paint,U.transform.zoom,void 0,Ir)}}}}()}(c,t,r,u),void T();if(A.type!=="model")return;const C=A.getModels(),R=[],P=c.transform.getFreeCameraOptions().position,L=s.b$([],[P.x,P.y,P.z],c.transform.worldSize);s.eb(L,L);const j=[],V=[];let G=0;for(const U of C){const J=r.paint.get("model-rotation").constantOr(null),ne=r.paint.get("model-scale").constantOr(null),oe=r.paint.get("model-translation").constantOr(null);U.computeModelMatrix(c,J,ne,oe,!0,!0,!1);const ue=s.bx([]),le=s.ec(U.position.lat,c.transform.zoom),ce=s.bn([],[1,1,1/le]);s.bo(ue,ue,L),R.push({zScaleMatrix:ce,negCameraPosMatrix:ue});for(const ae of U.nodes)Qa(c.transform,ae,U.matrix,c.transform.expandedFarZProjMatrix,G,j,V);G++}if(j.sort((U,J)=>J.depth-U.depth),c.renderPass!=="shadow"){if(p===1)for(const U of V)wt(U,c,r,R[U.modelIndex],qt.disabled,c.colorModeForRenderPass());else{for(const U of V)wt(U,c,r,R[U.modelIndex],qt.disabled,ci.disabled);for(const U of V)wt(U,c,r,R[U.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const U of j)wt(U,c,r,R[U.modelIndex],qt.disabled,c.colorModeForRenderPass());T()}else{for(const U of V)$n(U.mesh,U.nodeModelMatrix,c,r);for(const U of j)$n(U.mesh,U.nodeModelMatrix,c,r);T()}}},lf={line:function(c,t,r){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const m=t.getTile(p).getBucket(c);if(m&&(m.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,r){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const m of p)m.upload(r.context)},raster:function(c,t,r){const u=t.getSource();if(!(u instanceof za&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const m=c.paint.get("raster-array-band")||u.getInitialBand(p);if(m==null)return;const y=t.getIds().map(v=>t.getTileByID(v));for(const v of y)v.updateNeeded(p,m)&&u.prepareTile(v,p,m)},"raster-particle":function(c,t,r){const u=t.getSource();if(!(u instanceof za&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const m=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(m==null)return;const y=t.getIds().map(v=>t.getTileByID(v));for(const v of y)v.updateNeeded(p,m)&&u.prepareTile(v,p,m)}},Ho={fill:Fc};class gh{constructor(t,r,u,p,m){this.context=new Ll(t,r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const y=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const T of y)this._debugParams.enabledLayers[T]=!0;m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),m.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),m.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),m.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const T of y)m.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],T);this.occlusionParams=new Am(m),this.setup(),this.numSublayers=hs.maxUnderzooming+hs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new $_(this),this._wireframeDebugCache=new fy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const v=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,v,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p}updateTerrain(t,r){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qu(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,r),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=r.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const m=u+.78*(p-u);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Qu(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*s.q.devicePixelRatio,this.height=r*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,r=new s.ba;r.emplaceBack(0,0),r.emplaceBack(s.aj,0),r.emplaceBack(0,s.aj),r.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=t.createVertexBuffer(r,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const u=new s.ba;u.emplaceBack(0,0),u.emplaceBack(s.aj,0),u.emplaceBack(0,s.aj),u.emplaceBack(s.aj,s.aj),this.debugBuffer=t.createVertexBuffer(u,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const p=new s.ba;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const m=new s.aZ;m.emplaceBack(0,0,0,0),m.emplaceBack(s.aj,0,s.aj,0),m.emplaceBack(0,s.aj,0,s.aj),m.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(m,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const y=new s.a_;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(y);const v=new s.bb;for(const A of[0,1,3,2,0])v.emplaceBack(A);this.debugIndexBuffer=t.createIndexBuffer(v),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bz();const T=this.context.gl;this.stencilClearMode=new qt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,It.disabled,this.stencilClearMode,ci.disabled,Wt.disabled,Es(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,u){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let v=!1;for(const T of u)if(this._tileClippingMaskIDs[T.key]===void 0){v=!0;break}if(!v)return}this.currentStencilSource=r.id;const p=this.context,m=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(ci.disabled),p.setDepthMode(It.disabled);const y=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of u){const T=r.getTile(v),A=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:P}=this.getTileBoundsBuffers(T);y.draw(this,m.TRIANGLES,It.disabled,new qt({func:m.ALWAYS,mask:0},A,255,m.KEEP,m.KEEP,m.REPLACE),ci.disabled,Wt.disabled,Es(v.projMatrix),"$clipping",C,R,P)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new qt({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new qt({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,u=t.sort((y,v)=>v.overscaledZ-y.overscaledZ),p=u[u.length-1].overscaledZ,m=u[0].overscaledZ-p+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let v=0;v<m;v++)y[v+p]=new qt({func:r.GEQUAL,mask:255},v+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=m,[y,u]}return[{[p]:qt.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ci([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ci.unblended:ci.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ci([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,u,p=!1){if(this.depthOcclusion)return new It(this.context.gl.GREATER,It.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return It.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new It(u||this.context.gl.LEQUAL,r,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),m=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&u!==0&&(this.depthFBO=new ah(this.context,r,u,!1,"texture"),this.depthTexture=new s.T(this.context,{width:r,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,m),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,u,0,0,r,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const u=s.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const p=this.style._mergedLayers,m=!(!this.terrain||!this.terrain.enabled),y=()=>this.style._getOrder(m).filter(Se=>{const Pe=p[Se];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]});let v=y(),T=!1,A=!1;for(const Se of v){const Pe=p[Se];Pe.type==="circle"&&(T=!0),Pe.type==="symbol"&&(Pe.hasInitialOcclusionOpacityProperties?A=!0:T=!0)}let C=v.map(Se=>p[Se]);const R=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let P=0,L=!1;for(const Se in R){const Pe=R[Se];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++P)}let j=!1;for(const Se of C)Se.isHidden(this.transform.zoom)||(Se.type==="clip"&&(j=!0),this.prepareLayer(Se));const V={},G={},U={},J={},ne={};for(const Se in R){const Pe=R[Se];V[Se]=Pe.getVisibleCoordinates(),G[Se]=V[Se].slice().reverse(),U[Se]=Pe.getVisibleCoordinates(!0).reverse(),J[Se]=Pe.getShadowCasterCoordinates(),ne[Se]=Pe.sortCoordinatesByDistance(V[Se])}const oe=Se=>{const Pe=this.style.getLayerSourceCache(Se);return Pe&&Pe.used?Pe.getSource():null};if(P||j||this._clippingActiveLastFrame){const Se=[],Pe=[];let we=0;for(const Xe of C)this.isSourceForClippingOrConflation(Xe,oe(Xe))&&(Se.push(Xe),Pe.push(we)),we++;if(Se&&(j||Se.length>1)||this._clippingActiveLastFrame){j=!1;const Xe=[];for(let ke=0;ke<Se.length;ke++){const Qe=Se[ke],We=Pe[ke],tt=this.style.getLayerSourceCache(Qe);if(!tt||!tt.used||!tt.getSource().usedInConflation&&Qe.type!=="clip")continue;let nt=s.ev,At=s.bQ.None;const Ot=[];let St=!0;if(Qe.type==="clip"){nt=We;for(const Ft of Qe.layout.get("clip-layer-types"))At|=Ft==="model"?s.bQ.Model:Ft==="symbol"?s.bQ.Symbol:s.bQ.FillExtrusion;for(const Ft of Qe.layout.get("clip-layer-scope"))Ot.push(Ft);Qe.isHidden(this.transform.zoom)?St=!1:j=!0}St&&Xe.push({layer:Qe.fqid,cache:tt,order:nt,clipMask:At,clipScope:Ot})}this.replacementSource.setSources(Xe),L=!0}}this._clippingActiveLastFrame=j,L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Se=0;Se<C.length;Se++){const Pe=C[Se],we=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(we,this.longestCutoffRange),we>0){const Xe=oe(Pe);Xe&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D(m)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Se),this._lastOcclusionLayer=Se)}const ue=this.style&&this.style.fog;ue?(this._fogVisible=ue.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ue.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0,v=y(),C=v.map(Se=>p[Se]));const le=this._shadowRenderer;if(le){le.updateShadowParameters(this.transform,this.style.directionalLight);for(const Se in R)for(const Pe of V[Se]){let we={min:0,max:0};this.terrain&&(we=this.terrain.getMinMaxForTile(Pe)||we),le.addShadowReceiver(Pe.toUnwrapped(),we.min,we.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Bl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ce&&!this._snow&&(this._snow=new Pn(this)),!ce&&this._snow&&(this._snow.destroy(),delete this._snow),ae&&!this._rain&&(this._rain=new py(this)),!ae&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Rr.has(this.context.gl))return;this.renderPass="offscreen";for(const Se of C){const Pe=t.getLayerSourceCache(Se);if(!Se.hasOffscreenPass()||Se.isHidden(this.transform.zoom))continue;const we=Pe?G[Pe.id]:void 0;(Se.type==="custom"||Se.type==="raster"||Se.type==="raster-particle"||Se.isSky()||we&&we.length)&&this.renderLayer(this,Pe,Se,we)}this.depthRangeFor3D=[0,1-(C.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,J)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ge=(()=>{if(r.showOverdrawInspector)return s.am.black;const Se=this.style.fog;if(Se&&this.transform.projection.supportsFog){const Pe=this.style.getLut(Se.scope);if(!me){const we=Se.properties.get("color-use-theme")==="none",Xe=Se.properties.get("color").toRenderColor(we?null:Pe).toArray01();return new s.am(...Xe)}if(me){const we=Se.properties.get("space-color-use-theme")==="none",Xe=Se.properties.get("space-color").toRenderColor(we?null:Pe).toArray01();return new s.am(...Xe)}}return s.am.transparent})();if(this.context.clear({color:ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const Se=C[this.currentLayer],Pe=t.getLayerSourceCache(Se);if(Se.isSky())continue;const we=Pe?(Se.is3D(m)?ne:G)[Pe.id]:void 0;this._renderTileClippingMasks(Se,Pe,we),this.renderLayer(this,Pe,Se,we)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const Se=C[this.currentLayer],Pe=t.getLayerSourceCache(Se);Se.isSky()&&this.renderLayer(this,Pe,Se,Pe?G[Pe.id]:void 0)}function Me(Se,Pe){let we;return Pe&&(we=(Se.type==="symbol"?U:Se.is3D(m)?ne:G)[Pe.id]),we}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const Se=C[this.currentLayer];if(Se.type==="raster"||Se.type==="raster-particle"){const Pe=t.getLayerSourceCache(Se);this.renderLayer(this,Pe,Se,Me(Se,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ee=0;le&&(Ee=le.getShadowCastingLayerCount());let qe=!1,$e=-1;for(let Se=0;Se<v.length;++Se){const Pe=C[Se];Pe.isHidden(this.transform.zoom)||Pe.is3D(m)&&($e=Se)}A&&$e===-1&&(T=!0);let ct=!1;for(;this.currentLayer<v.length;){const Se=C[this.currentLayer],Pe=t.getLayerSourceCache(Se);if(Se.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Se)){if(Se.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ct&&Se.is3D(m)&&!m){const we=this.currentLayer,Xe=ke=>{for(this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){const Qe=C[this.currentLayer];if(Ho[Qe.type]){const We=this.style.getLayerSourceCache(Qe);Ho[Qe.type](this,We,Qe,Me(Qe,We),ke)}}};Xe("initialize"),Xe("reset"),this.currentLayer=we,ct=!0}if(T&&!qe&&this.terrain&&!this.transform.isOrthographic&&(qe=!0,this.blitDepth()),A&&$e!==-1&&this.currentLayer===$e+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Se,Pe,Pe?V[Pe.id]:void 0),this.renderLayer(this,Pe,Se,Me(Se,Pe)),!this.terrain&&le&&Ee>0&&Se.hasShadowPass()&&--Ee==0&&(le.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const we=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=we;this.currentLayer++){const Xe=C[this.currentLayer];if(!Xe.hasLightBeamPass())continue;const ke=t.getLayerSourceCache(Xe);this.renderLayer(this,ke,Xe,ke?G[ke.id]:void 0)}this.currentLayer=we,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const we=this.currentLayer;this.depthOcclusion=!0;for(const Xe of this.layersWithOcclusionOpacity){this.currentLayer=Xe;const ke=C[this.currentLayer],Qe=t.getLayerSourceCache(ke),We=Qe?G[Qe.id]:void 0;this.terrain||this._renderTileClippingMasks(ke,Qe,Qe?V[Qe.id]:void 0),this.renderLayer(this,Qe,ke,We)}this.depthOcclusion=!1,this.currentLayer=we,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Se=null;C.forEach(Pe=>{const we=t.getLayerSourceCache(Pe);we&&!Pe.isHidden(this.transform.zoom)&&we.getVisibleCoordinates().length&&(!Se||Se.getSource().maxzoom<we.getSource().maxzoom)&&(Se=we)}),Se&&this.options.showTileBoundaries&&Ni.debug(this,Se,Se.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ni.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Se){const Pe=Se.transform.padding;uh(Se,Se.transform.height-(Pe.top||0),3,ef),uh(Se,Pe.bottom||0,3,tf),hh(Se,Pe.left||0,3,nf),hh(Se,Se.transform.width-(Pe.right||0),3,zs);const we=Se.transform.centerPoint;(function(Xe,ke,Qe,We){Fl(Xe,ke-1,Qe-10,2,20,We),Fl(Xe,ke-10,Qe-1,20,2,We)})(Se,we.x,Se.transform.height-we.y,pa)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,u=!r||!r.includes(t.type);if(lf[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);lf[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,r,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Ni[u.type](t,r,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(r.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,u=r.createQuery();this.deferredRenderGpuTimeQueries.push(u),r.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const u in t){const p=t[u],m=this.context.extTimerQuery,y=m.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(p.query),r[u]=y}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let u=0;for(const p of t)u+=r.getQueryParameter(p,r.QUERY_RESULT)/1e6,r.deleteQuery(p);return u}translatePosMatrix(t,r,u,p,m){if(!u[0]&&!u[1])return t;const y=m?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(y){const A=Math.sin(y),C=Math.cos(y);u=[u[0]*C-u[1]*A,u[0]*A+u[1]*C]}const v=[m?u[0]:s.aw(r,u[0],this.transform.zoom),m?u[1]:s.aw(r,u[1],this.transform.zoom),0],T=new Float32Array(16);return s.bo(T,t,v),T}saveTileTexture(t){const r=t.size[0],u=this._tileTextures[r];u?u.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,m=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(m.push("LIGHTING_3D_MODE"),m.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||m.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||m.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(m.push("TERRAIN"),this.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&m.push("GLOBE"),!this._fogVisible||p||r!==void 0&&!r||m.push("FOG","FOG_DITHERING"),p&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}getOrCreateProgram(t,r){this.cache=this.cache||{};const u=r&&r.defines||[],p=r&&r.config,m=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(u),y=th.cacheKey(Ga[t],t,m,p);return this.cache[y]||(this.cache[y]=new th(this.context,t,Ga[t],p,sy[t],m)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const m=((y,v,T)=>{const A=y.properties.get("direction"),C=y.properties.get("color-use-theme")==="none",R=y.properties.get("color").toRenderColor(C?null:T.getLut(y.scope)).toArray01(),P=y.properties.get("intensity"),L=v.properties.get("color-use-theme")==="none",j=v.properties.get("color").toRenderColor(L?null:T.getLut(v.scope)).toArray01(),V=v.properties.get("intensity"),G=[A.x,A.y,A.z],U=s.dw(j,V),J=s.dw(R,P);return{u_lighting_ambient_color:U,u_lighting_directional_dir:G,u_lighting_directional_color:J,u_ground_radiance:$d(G,J,U)}})(u,p,this.style);r.setLightsUniformValues(t,m)}}}uploadCommonUniforms(t,r,u,p,m){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch),T=((A,C,R,P,L,j,V,G,U,J,ne,oe)=>{const ue=A.transform,le=C.properties.get("color-use-theme")==="none",ce=C.properties.get("color").toRenderColor(le?null:A.style.getLut(C.scope)).toArray01();ce[3]=P;const ae=A.frameCounter/1e3%1,[me,ge]=C.properties.get("vertical-range");return{u_fog_matrix:R?ue.calculateFogTileMatrix(R):oe||A.identityMat,u_fog_range:C.getFovAdjustedRange(ue._fov),u_fog_color:ce,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(me,ge),ge],u_fog_temporal_offset:ae,u_frustum_tl:L,u_frustum_tr:j,u_frustum_br:V,u_frustum_bl:G,u_globe_pos:U,u_globe_radius:J,u_viewport:ne,u_globe_transition:s.ah(ue.zoom),u_is_globe:+(ue.projection.name==="globe")}})(this,y,u,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],p);r.setFogUniformValues(t,T)}m&&r.setCutoffUniformValues(t,m.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)r[p.key]=t[p.key]||new jo(p,512,this.transform.tileZoom,this);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=bt||r[1]>=bt}setupDepthForOcclusion(t,r,u){const p=this.context,m=p.gl,y=!!u;var v;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(m.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((v=this.depthRangeFor3D)[1]-v[0]),-1-2*v[0]/(v[1]-v[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),p.activeTexture.set(m.TEXTURE0),y||r.setTerrainUniformValues(p,u)}}function tl(c,t){let r=!1,u=null;const p=()=>{u=null,r&&(c(),u=setTimeout(p,t),r=!1)};return()=>(r=!0,u||p(),u)}class Vl{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=tl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=_h(t);if(this._hashName){const u=this._hashName;let p=!1;const m=location.hash.slice(1).split("&").map(y=>{const v=y.split("=")[0];return v===u?(p=!0,`${v}=${r}`):y}).filter(y=>y);return p||m.push(`${u}=${r}`),`#${m.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(r=u)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function _h(c,t){const r=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,p),y=Math.round(r.lng*m)/m,v=Math.round(r.lat*m)/m,T=c.getBearing(),A=c.getPitch();let C=t?`/${y}/${v}/${u}`:`${u}/${v}/${y}`;return(T||A)&&(C+="/"+Math.round(10*T)/10),A&&(C+=`/${Math.round(A)}`),C}const jl={linearity:.3,easing:s.ew(0,0,.3,1)},cf=s.l({deceleration:2500,maxSpeed:1400},jl),uf=s.l({deceleration:20,maxSpeed:1400},jl),Ao=s.l({deceleration:1e3,maxSpeed:360},jl),qo=s.l({deceleration:1e3,maxSpeed:90},jl);class yh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=s.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)r.zoom+=m.zoomDelta||0,r.bearing+=m.bearingDelta||0,r.pitch+=m.pitchDelta||0,m.panDelta&&r.pan._add(m.panDelta),m.around&&(r.around=m.around),m.pinchAround&&(r.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const m=Ul(r.pan.mag(),u,s.l({},cf,t||{}));p.offset=r.pan.mult(m.amount/r.pan.mag()),p.center=this._map.transform.center,il(p,m)}if(r.zoom){const m=Ul(r.zoom,u,uf);p.zoom=this._map.transform.zoom+m.amount,il(p,m)}if(r.bearing){const m=Ul(r.bearing,u,Ao);p.bearing=this._map.transform.bearing+s.aD(m.amount,-179,179),il(p,m)}if(r.pitch){const m=Ul(r.pitch,u,qo);p.pitch=this._map.transform.pitch+m.amount,il(p,m)}if(p.zoom||p.bearing){const m=r.pinchAround===void 0?r.around:r.pinchAround;p.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function il(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function Ul(c,t,r){const{maxSpeed:u,linearity:p,deceleration:m}=r,y=s.aD(c*p/(t/1e3),-u,u),v=Math.abs(y)/(m*p);return{easing:r.easing,duration:1e3*v,amount:y*(v/2)}}class As extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u,p={}){const m=Kt(r.getCanvasContainer(),u),y=r.unproject(m);super(t,s.l({point:m,lngLat:y,originalEvent:u},p)),this._defaultPrevented=!1,this.target=r}}class Io extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u){const p=t==="touchend"?u.changedTouches:u.touches,m=Ei(r.getCanvasContainer(),p),y=m.map(T=>r.unproject(T)),v=m.reduce((T,A,C,R)=>T.add(A.div(R.length)),new s.P(0,0));super(t,{points:m,point:v,lngLats:y,lngLat:r.unproject(v),originalEvent:u}),this._defaultPrevented=!1}}class hf extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class _a{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new hf(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new As(t.type,this._map,t))}mouseup(t){this._map.fire(new As(t.type,this._map,t))}preclick(t){const r=s.l({},t);r.type="preclick",this._map.fire(new As(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new As(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new As(t.type,this._map,t))}mouseover(t){this._map.fire(new As(t.type,this._map,t))}mouseout(t){this._map.fire(new As(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Io(t.type,this._map,t))}touchmove(t){this._map.fire(new Io(t.type,this._map,t))}touchend(t){this._map.fire(new Io(t.type,this._map,t))}touchcancel(t){this._map.fire(new Io(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class df{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new As(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new As("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new As(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xh{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ct(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const u=r,p=this._startPos,m=this._lastPos;if(!p||!m||m.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Re("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const y=Math.min(p.x,u.x),v=Math.max(p.x,u.x),T=Math.min(p.y,u.y),A=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${T}px)`,this._box.style.width=v-y+"px",this._box.style.height=A-T+"px")})}mouseupWindow(t,r){if(!this._active)return;const u=this._startPos,p=r;if(u&&t.button===0){if(this.reset(),hi(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Dt(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new s.A(t,{originalEvent:r}))}}function $c(c,t){const r={};for(let u=0;u<c.length;u++)r[c[u].identifier]=t[u];return r}class ff{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const m=new s.P(0,0);for(const y of p)m._add(y);return m.div(p.length)}(r),this.touches=$c(u,r)))}touchmove(t,r,u){if(this.aborted||!this.centroid)return;const p=$c(u,r);for(const m in this.touches){const y=p[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,r,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Ar{constructor(t){this.singleTap=new ff(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,u){this.singleTap.touchstart(t,r,u)}touchmove(t,r,u){this.singleTap.touchmove(t,r,u)}touchend(t,r,u){const p=this.singleTap.touchend(t,r,u);if(p){const m=t.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(p)<30;if(m&&y||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class pf{constructor(){this._zoomIn=new Ar({numTouches:1,numTaps:2}),this._zoomOut=new Ar({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,u){this._zoomIn.touchstart(t,r,u),this._zoomOut.touchstart(t,r,u)}touchmove(t,r,u){this._zoomIn.touchmove(t,r,u),this._zoomOut.touchmove(t,r,u)}touchend(t,r,u){const p=this._zoomIn.touchend(t,r,u),m=this._zoomOut.touchend(t,r,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(p)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const mf={0:1,2:2},ya={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Gc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const u=gi(t);this._correctButton(t,u)&&(this._lastPoint=r,this._eventButton=u)}mousemoveWindow(t,r){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,m){const y=mf[m];return p.buttons===void 0||(p.buttons&y)!==y}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(u,r)}}mouseupWindow(t){this._lastPoint&&gi(t)===this._eventButton&&(this._moved&&hi(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf extends Gc{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class vh extends Gc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?ya[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=.8*(r.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class nl extends Gc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?ya[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=-.5*(r.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class _f{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,r,u){return this._calculateTransform(t,r,u)}touchmove(t,r,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!s.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,u)}}touchend(t,r,u){this._calculateTransform(t,r,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,u){u.length>0&&(this._active=!0);const p=$c(u,r),m=new s.P(0,0),y=new s.P(0,0);let v=0;for(const A in p){const C=p[A],R=this._touches[A];R&&(m._add(C),y._add(C.sub(R)),v++,p[A]=C)}if(this._touches=p,v<this._minTouches||!y.mag())return;const T=y.div(v);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(v),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,u){return{}}touchstart(t,r,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[m,y]=p,v=$l(u,r,m),T=$l(u,r,y);if(!v||!T)return;const A=this._aroundCenter?null:v.add(T).div(2);return this._move([v,T],A,t)}touchend(t,r,u){if(!this._firstTwoTouches)return;const[p,m]=this._firstTwoTouches,y=$l(u,r,p),v=$l(u,r,m);y&&v||(this._active&&hi(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function $l(c,t,r){for(let u=0;u<c.length;u++)if(c[u].identifier===r)return t[u]}function qc(c,t){return Math.log(c/t)/Math.LN2}class yf extends Hc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qc(this._distance,u),pinchAround:r}}}function bh(c,t){return 180*c.angleWith(t)/Math.PI}class Cm extends Hc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:bh(this._vector,u),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=bh(t,u);return Math.abs(p)<r}}function wh(c){return Math.abs(c.y)>Math.abs(c.x)}class Mm extends Hc{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,wh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,u){const p=this._lastPoints;if(!p)return;const m=t[0].sub(p[0]),y=t[1].sub(p[1]);return this._map._cooperativeGestures&&!s.ex()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(m,y,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5})}gestureBeginsVertically(t,r,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,m=r.mag()>=2;if(!p&&!m)return;if(!p||!m)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const y=t.y>0==r.y>0;return wh(t)&&wh(r)&&y}}const Pm={panStep:100,bearingStep:15,pitchStep:10};class Rm{constructor(){const t=Pm;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,u=0,p=0,m=0,y=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),y=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:v=>{const T=v.getZoom();v.easeTo({duration:300,easeId:"keyboardHandler",easing:Dm,zoom:r?Math.round(T)+r*(t.shiftKey?2:1):T,bearing:v.getBearing()+u*this._bearingStep,pitch:v.getPitch()+p*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:v.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Dm(c){return c*(2-c)}const xf=4.000244140625,zm=1/450;class Lm{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=zm,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,r!==0&&r%xf==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Kt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>xf?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&C!==0&&(C=1/C);const R=r(),P=Math.pow(2,R),L=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):P;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(L*C))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r(),p=this._startZoom,m=this._easing;let y,v=!1;if(this._type==="wheel"&&p&&m){const A=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),C=m(A);y=s.ai(p,u,C),A<1?this._frameId||(this._frameId=!0):v=!0}else y=u,v=!0;this._active=!0,v&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let T=y-r();return T*this._lastDelta<0&&(T=0),{noInertia:!0,needsRenderFrame:!v,zoomDelta:T,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=s.ey;if(this._prevEase){const u=this._prevEase,p=(s.q.now()-u.start)/u.duration,m=u.easing(p+.01)-u.easing(p),y=.27/Math.sqrt(m*m+1e-4)*.01,v=Math.sqrt(.0729-y*y);r=s.ew(y,v,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class km{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Om{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fm{constructor(){this._tap=new Ar({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=r[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,r,u))}touchmove(t,r,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=r[0],m=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,r,u)}touchend(t,r,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,r,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bm{constructor(t,r,u){this._el=t,this._mousePan=r,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class my{constructor(t,r,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gy{constructor(t,r,u,p){this._el=t,this._touchZoom=r,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kn=c=>c.zoom||c.drag||c.pitch||c.rotate;class Nm extends s.A{}class _y{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const u=s.at([],r,t);this.radius=s.ae(u[2]<0?s.eA([],u,this.constants):[u[0],u[1],0])}projectRay(t){s.eA(t,t,this.constants),s.au(t,t),s.eB(t,t,this.constants);const r=s.b$([],t,this.radius);if(r[2]>0){const u=s.b$([],[0,0,1],s.bE(r,[0,0,1])),p=s.b$([],s.au([],[r[0],r[1],0]),this.radius),m=s.cU([],r,s.b$([],s.at([],s.cU([],p,u),r),2));r[0]=m[0],r[1]=m[1]}return r}}function Gl(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class yy{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yh(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new _y,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),s.aV(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,m,y]of this._listeners){const v=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(m,v,y)}}destroy(){for(const[t,r,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,p,u)}}_addDefaultHandlers(t){const r=this._map,u=r.getCanvasContainer();this._add("mapEvent",new _a(r,t));const p=r.boxZoom=new xh(r,t);this._add("boxZoom",p);const m=new pf,y=new Om;r.doubleClickZoom=new km(y,m),this._add("tapZoom",m),this._add("clickZoom",y);const v=new Fm;this._add("tapDragZoom",v);const T=r.touchPitch=new Mm(r);this._add("touchPitch",T);const A=new vh(t),C=new nl(t);r.dragRotate=new my(t,A,C),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]);const R=new gf(t),P=new _f(r,t);r.dragPan=new Bm(u,R,P),this._add("mousePan",R),this._add("touchPan",P,["touchZoom","touchRotate"]);const L=new Cm,j=new yf;r.touchZoomRotate=new gy(u,j,L,v),this._add("touchRotate",L,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new df(r));const V=r.scrollZoom=new Lm(r,this);this._add("scrollZoom",V,["mousePan"]);const G=r.keyboard=new Rm;this._add("keyboard",G);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[U]&&r[U].enable(t[U])}_add(t,r,u){this._handlers.push({handlerName:t,handler:r,allowed:u}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,u){for(const p in t)if(p!==u&&(!r||r.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const u of t)this._el.contains(u.target)&&r.push(u);return r}handleEvent(t,r){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,m={needsRenderFrame:!1},y={},v={},T=t.touches?this._getMapTouches(t.touches):void 0,A=T?Ei(this._el,T):u?void 0:Kt(this._el,t);for(const{handlerName:P,handler:L,allowed:j}of this._handlers){if(!L.isEnabled())continue;let V;this._blockedByActive(v,j,P)?L.reset():L[r||t.type]&&(V=L[r||t.type](t,A,T),this.mergeHandlerResult(m,y,V,P,p),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||L.isActive())&&(v[P]=L)}const C={};for(const P in this._previousActiveHandlers)v[P]||(C[P]=p);this._previousActiveHandlers=v,(Object.keys(C).length||Gl(m))&&(this._changes.push([m,y,C]),this._triggerRenderFrame()),(Object.keys(v).length||Gl(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=m;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(t,r,u,p,m){if(!u)return;s.l(t,u);const y={handlerName:p,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(r.zoom=y),u.panDelta!==void 0&&(r.drag=y),u.pitchDelta!==void 0&&(r.pitch=y),u.bearingDelta!==void 0&&(r.rotate=y)}_applyChanges(){const t={},r={},u={};for(const[p,m,y]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.l(r,m),s.l(u,y);this._updateMapTransform(t,r,u),this._changes=[]}_updateMapTransform(t,r,u){const p=this._map,m=p.transform,y=J=>[J.x,J.y,J.z];if((J=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Gl(t)){const J=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),J!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&p._stop(!0),!Gl(t))return void this._fireEvents(r,u,!0);let{panDelta:v,zoomDelta:T,bearingDelta:A,pitchDelta:C,around:R,aroundCoord:P,pinchAround:L}=t;m._isCameraConstrained&&(T>0&&(T=0),m._isCameraConstrained=!1),L!==void 0&&(R=L),(T||(J=>r[J]&&!this._eventsInProgress[J])("drag"))&&R&&(this._dragOrigin=y(m.pointCoordinate3D(R)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",p._stop(!0),R=R||p.transform.centerPoint,A&&(m.bearing+=A),C&&(m.pitch+=C),m._updateCameraState();const j=[0,0,0];if(v)if(m.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(R).dir),ne=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(R.sub(v)).dir);j[0]=ne[0]-J[0],j[1]=ne[1]-J[1]}else{const J=m.pointCoordinate(R);if(m.projection.name==="globe"){v=v.rotate(-m.angle);const ne=m._pixelsPerMercatorPixel/m.worldSize;j[0]=-v.x*s.ez(s.aY(J.y))*ne,j[1]=-v.y*s.ez(m.center.lat)*ne}else{const ne=m.pointCoordinate(R.sub(v));J&&ne&&(j[0]=ne.x-J.x,j[1]=ne.y-J.y)}}const V=m.zoom,G=[0,0,0];if(T){const J=y(P||m.pointCoordinate3D(R)),ne={dir:s.au([],s.at([],J,m._camera.position))};if(ne.dir[2]<0){const oe=m.zoomDeltaToMovement(J,T);s.b$(G,ne.dir,oe)}}const U=s.cU(j,j,G);m._translateCameraConstrained(U),T&&Math.abs(m.zoom-V)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,u,!0)}_fireEvents(t,r,u){const p=kn(this._eventsInProgress),m=kn(t),y={};for(const C in t){const{originalEvent:R}=t[C];this._eventsInProgress[C]||(y[`${C}start`]=R),this._eventsInProgress[C]=t[C]}!p&&m&&this._fireEvent("movestart",m.originalEvent);for(const C in y)this._fireEvent(C,y[C]);m&&this._fireEvent("move",m.originalEvent);for(const C in t){const{originalEvent:R}=t[C];this._fireEvent(C,R)}const v={};let T;for(const C in this._eventsInProgress){const{handlerName:R,originalEvent:P}=this._eventsInProgress[C];this._handlersById[R].isActive()||(delete this._eventsInProgress[C],T=r[R]||P,v[`${C}end`]=T)}for(const C in v)this._fireEvent(C,v[C]);const A=kn(this._eventsInProgress);if(u&&(p||m)&&!A){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=P=>P!==0&&-this._bearingSnap<P&&P<this._bearingSnap;C?(R(C.bearing||this._map.getBearing())&&(C.bearing=0),this._map.easeTo(C,{originalEvent:T})):(this._map.fire(new s.A("moveend",{originalEvent:T})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new s.A(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Nm("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Hl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Vm extends s.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.l({offset:t},r),u)}panTo(t,r,u){return this.easeTo(s.l({center:t},r),u)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,u){return this.easeTo(s.l({zoom:t},r),u)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,u){return this.easeTo(s.l({bearing:t},r),u)}resetNorth(t,r){return this.rotateTo(0,s.l({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=s.aG.convert(t);const u=r&&r.bearing||0,p=r&&r.pitch||0,m=t.getNorthWest(),y=t.getSouthEast();return this._cameraForBounds(this.transform,m,y,u,p,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?s.l({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.l({},r,t)}_extendCameraOptions(t){return(t=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const u=r.max[0]-r.min[0],p=r.max[1]-r.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,u,p,m,y){const v=t.clone(),T=this._extendCameraOptions(y);v.bearing=p,v.pitch=m;const A=s.cd.convert(r),C=s.cd.convert(u),R=.5*(A.lat+C.lat),P=.5*(A.lng+C.lng),L=s.eC(R,P),j=s.au([],L),V=s.au([],s.bG([],j,[0,1,0])),G=s.bG([],V,j),U=[V[0],V[1],V[2],0,G[0],G[1],G[2],0,j[0],j[1],j[2],0,0,0,0,1],J=[L,s.eC(A.lat,A.lng),s.eC(C.lat,A.lng),s.eC(C.lat,C.lng),s.eC(A.lat,C.lng),s.eC(R,A.lng),s.eC(R,C.lng),s.eC(A.lat,P),s.eC(C.lat,P)];let ne=s.cV.fromPoints(J.map(ke=>[s.bE(V,ke),s.bE(G,ke),s.bE(j,ke)]));const oe=s.ad([],ne.center,U);s.eD(oe)===0&&s.eE(oe,0,0,1),s.au(oe,oe),s.b$(oe,oe,s.aE),v.center=s.eF(oe);const ue=v.getWorldToCameraMatrix(),le=s.bi(new Float64Array(16),ue);ne=s.cV.applyTransform(ne,s.az([],ue,U));const ce=this._extendAABB(ne,v,T,p);if(!ce)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=ce,s.ad(oe,oe,ue);const ae=.5*(ne.max[2]-ne.min[2]),me=this._minimumAABBFrustumDistance(v,ne),ge=s.b$([],[0,0,1],ae),Me=s.cU(ge,oe,ge),Ee=me+(v.pitch===0?0:s.bD(oe,Me)),qe=v.globeCenterInViewSpace,$e=s.at([],oe,[qe[0],qe[1],qe[2]]);s.au($e,$e),s.b$($e,$e,Ee);const ct=s.cU([],oe,$e);s.ad(ct,ct,le);const Se=s.eq/s.aE,Pe=s.ae(ct),we=s.c6(Math.max(Pe*Se-s.eq,Number.EPSILON),0),Xe=Math.min(v.zoomFromMercatorZAdjusted(we),T.maxZoom);return Xe>.5*(s.cL+s.cx)?(v.setProjection({name:"mercator"}),v.zoom=Xe,this._cameraForBounds(v,r,u,p,m,y)):{center:v.center,zoom:Xe,bearing:p,pitch:m}}_extendAABB(t,r,u,p){const m=.5*((u.padding.left||0)+(u.padding.right||0)),y=.5*((u.padding.top||0)+(u.padding.bottom||0)),v=y,T=m,A=m,C=y,R=r.width-(T+A),P=r.height-(v+C),L=s.at([],t.max,t.min),j=Math.min(R/L[0],P/L[1]),V=Math.min(r.scaleZoom(r.scale*j),u.maxZoom);if(isNaN(V))return null;const G=r.scale/r.zoomScale(V),U=new s.cV([t.min[0]-T*G,t.min[1]-C*G,t.min[2]],[t.max[0]+A*G,t.max[1]+v*G,t.max[2]]),J=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new s.P(u.offset.x,u.offset.y):s.P.convert(u.offset)).rotate(-s.al(p));return U.center[0]-=J.x*G,U.center[1]+=J.y*G,U}queryTerrainElevation(t,r){const u=this.transform.elevation;return u?(r=s.l({},{exaggerated:!0},r),u.getAtPoint(s.ac.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,u,p,m,y){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,u,p,m,y);const v=t.clone(),T=this._extendCameraOptions(y);v.bearing=p,v.pitch=m;const A=s.cd.convert(r),C=s.cd.convert(u),R=new s.cd(A.lng,C.lat),P=new s.cd(C.lng,A.lat),L=v.project(A),j=v.project(C),V=this.queryTerrainElevation(A),G=this.queryTerrainElevation(C),U=this.queryTerrainElevation(R),J=this.queryTerrainElevation(P),ne=[[L.x,L.y,Math.min(V||0,G||0,U||0,J||0)],[j.x,j.y,Math.max(V||0,G||0,U||0,J||0)]];let oe=s.cV.fromPoints(ne);const ue=v.getWorldToCameraMatrix(),le=s.bi(new Float64Array(16),ue);oe=s.cV.applyTransform(oe,ue);const ce=this._extendAABB(oe,v,T,p);if(!ce)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=ce;const ae=.5*s.at([],oe.max,oe.min)[2],me=this._minimumAABBFrustumDistance(v,oe),ge=[0,0,1,0];s.aA(ge,ge,ue),s.eG(ge,ge);const Me=s.b$([],ge,me+ae),Ee=s.cU([],oe.center,Me);s.ad(oe.center,oe.center,le),s.ad(Ee,Ee,le);const qe=v.unproject(new s.P(oe.center[0],oe.center[1])),$e=s.eH(v.projection,qe),ct=Math.pow(2,$e),Se=Math.min(v._zoomFromMercatorZ(Ee[2]*v.pixelsPerMeter*ct/v.worldSize),T.maxZoom);return v.mercatorFromTransition&&Se<.5*(s.cL+s.cx)?(v.setProjection({name:"globe"}),v.zoom=Se,this._cameraForBounds(v,r,u,p,m,y)):{center:qe,zoom:Se,bearing:p,pitch:m}}fitBounds(t,r,u){const p=this.cameraForBounds(t,r);return this._fitInternal(p,r,u)}fitScreenCoordinates(t,r,u,p,m){const y=s.P.convert(t),v=s.P.convert(r),T=new s.P(Math.min(y.x,v.x),Math.min(y.y,v.y)),A=new s.P(Math.max(y.x,v.x),Math.max(y.y,v.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(y,v))return this;const C=this.transform.pointLocation3D(T),R=this.transform.pointLocation3D(A),P=this.transform.pointLocation3D(new s.P(T.x,A.y)),L=this.transform.pointLocation3D(new s.P(A.x,T.y)),j=[Math.min(C.lng,R.lng,P.lng,L.lng),Math.min(C.lat,R.lat,P.lat,L.lat)],V=[Math.max(C.lng,R.lng,P.lng,L.lng),Math.max(C.lat,R.lat,P.lat,L.lat)],G=p&&p.pitch?p.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,j,V,u,G,p);return this._fitInternal(U,p,m)}_fitInternal(t,r,u){return t?(r=s.l(t,r)).linear?this.easeTo(r,u):this.flyTo(r,u):this}jumpTo(t,r){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,m=!1,y=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.cd.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(m=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(y=!0,u.pitch=+t.pitch);const v=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(v))if(t.retainPadding===!1){const T=u.clone();T.padding=v,u.setLocationAtPoint(u.center,T.centerPoint)}else u.padding=v;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.A("movestart",r)).fire(new s.A("move",r)),p&&this.fire(new s.A("zoomstart",r)).fire(new s.A("zoom",r)).fire(new s.A("zoomend",r)),m&&this.fire(new s.A("rotatestart",r)).fire(new s.A("rotate",r)).fire(new s.A("rotateend",r)),y&&this.fire(new s.A("pitchstart",r)).fire(new s.A("pitch",r)).fire(new s.A("pitchend",r)),this.fire(new s.A("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(Hl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const u=this.transform;if(!u.projection.supportsFreeCamera)return s.w(Hl),this;this.stop();const p=u.zoom,m=u.pitch,y=u.bearing;u.setFreeCameraOptions(t);const v=p!==u.zoom,T=m!==u.pitch,A=y!==u.bearing;return this.fire(new s.A("movestart",r)).fire(new s.A("move",r)),v&&this.fire(new s.A("zoomstart",r)).fire(new s.A("zoom",r)).fire(new s.A("zoomend",r)),A&&this.fire(new s.A("rotatestart",r)).fire(new s.A("rotate",r)).fire(new s.A("rotateend",r)),T&&this.fire(new s.A("pitchstart",r)).fire(new s.A("pitch",r)).fire(new s.A("pitchend",r)),this.fire(new s.A("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=s.l({offset:[0,0],duration:500,easing:s.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),m=this.getBearing(),y=this.getPitch(),v=this.getPadding(),T="zoom"in t?+t.zoom:p,A="bearing"in t?this._normalizeBearing(t.bearing,m):m,C="pitch"in t?+t.pitch:y,R=this._extendPadding(t.padding),P=s.P.convert(t.offset);let L,j,V;if(u.projection.name==="globe"){const ge=s.ac.fromLngLat(u.center),Me=P.rotate(-u.angle);ge.x+=Me.x/u.worldSize,ge.y+=Me.y/u.worldSize;const Ee=ge.toLngLat(),qe=s.cd.convert(t.center||Ee);this._normalizeCenter(qe),L=u.centerPoint.add(Me),j=new s.P(ge.x,ge.y).mult(u.worldSize),V=new s.P(s.ay(qe.lng),s.aH(qe.lat)).mult(u.worldSize).sub(j)}else{L=u.centerPoint.add(P);const ge=u.pointLocation(L),Me=s.cd.convert(t.center||ge);this._normalizeCenter(Me),j=u.project(ge),V=u.project(Me).sub(j)}const G=u.zoomScale(T-p);let U,J;t.around&&(U=s.cd.convert(t.around),J=u.locationPoint(U));const ne=this._zooming||T!==p,oe=this._rotating||m!==A,ue=this._pitching||C!==y,le=!u.isPaddingEqual(R),ce=t.retainPadding===!1?u.clone():u,ae=ge=>Me=>{if(ne&&(ge.zoom=s.ai(p,T,Me)),oe&&(ge.bearing=s.ai(m,A,Me)),ue&&(ge.pitch=s.ai(y,C,Me)),le&&(ce.interpolatePadding(v,R,Me),L=ce.centerPoint.add(P)),U)ge.setLocationAtPoint(U,J);else{const Ee=ge.zoomScale(ge.zoom-p),qe=T>p?Math.min(2,G):Math.max(.5,G),$e=Math.pow(qe,1-Me),ct=ge.unproject(j.add(V.mult(Me*$e)).mult(Ee));ge.setLocationAtPoint(ge.renderWorldCopies?ct.wrap():ct,L)}return t.preloadOnly||this._fireMoveEvents(r),ge};if(t.preloadOnly){const ge=this._emulate(ae,t.duration,u);return this._preloadTiles(ge),this}const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=oe,this._pitching=ue,this._padding=le,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,me),this._ease(ae(u),ge=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(r,ge)},t),this}_prepareEase(t,r,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||u.moving||this.fire(new s.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.A("zoomend",t)),p&&this.fire(new s.A("rotateend",t)),m&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const ke=s.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ke,r)}this.stop(),t=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.ey},t);const u=this.transform,p=this.getZoom(),m=this.getBearing(),y=this.getPitch(),v=this.getPadding(),T="zoom"in t?s.aD(+t.zoom,u.minZoom,u.maxZoom):p,A="bearing"in t?this._normalizeBearing(t.bearing,m):m,C="pitch"in t?+t.pitch:y,R=this._extendPadding(t.padding),P=u.zoomScale(T-p),L=s.P.convert(t.offset);let j=u.centerPoint.add(L);const V=u.pointLocation(j),G=s.cd.convert(t.center||V);this._normalizeCenter(G);const U=u.project(V),J=u.project(G).sub(U);let ne=t.curve;const oe=Math.max(u.width,u.height),ue=oe/P,le=J.mag();if("minZoom"in t){const ke=s.aD(Math.min(t.minZoom,p,T),u.minZoom,u.maxZoom),Qe=oe/u.zoomScale(ke-p);ne=Math.sqrt(Qe/le*2)}const ce=ne*ne;function ae(ke){const Qe=(ue*ue-oe*oe+(ke?-1:1)*ce*ce*le*le)/(2*(ke?ue:oe)*ce*le);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function me(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function ge(ke){return(Math.exp(ke)+Math.exp(-ke))/2}const Me=ae(0);let Ee=function(ke){return ge(Me)/ge(Me+ne*ke)},qe=function(ke){return oe*((ge(Me)*(me(Qe=Me+ne*ke)/ge(Qe))-me(Me))/ce)/le;var Qe},$e=(ae(1)-Me)/ne;if(Math.abs(le)<1e-6||!isFinite($e)){if(Math.abs(oe-ue)<1e-6)return this.easeTo(t,r);const ke=ue<oe?-1:1;$e=Math.abs(Math.log(ue/oe))/ne,qe=function(){return 0},Ee=function(Qe){return Math.exp(ke*ne*Qe)}}t.duration="duration"in t?+t.duration:1e3*$e/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ct=m!==A,Se=C!==y,Pe=!u.isPaddingEqual(R),we=t.retainPadding===!1?u.clone():u,Xe=ke=>Qe=>{const We=Qe*$e,tt=1/Ee(We);ke.zoom=Qe===1?T:p+ke.scaleZoom(tt),ct&&(ke.bearing=s.ai(m,A,Qe)),Se&&(ke.pitch=s.ai(y,C,Qe)),Pe&&(we.interpolatePadding(v,R,Qe),j=we.centerPoint.add(L));const nt=Qe===1?G:ke.unproject(U.add(J.mult(qe(We))).mult(tt));return ke.setLocationAtPoint(ke.renderWorldCopies?nt.wrap():nt,j),ke._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),ke};if(t.preloadOnly){const ke=this._emulate(Xe,t.duration,u);return this._preloadTiles(ke),this}return this._zooming=!0,this._rotating=ct,this._pitching=Se,this._padding=Pe,this._prepareEase(r,!1),this._ease(Xe(u),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,r)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,r,u){u.animate===!1||u.duration===0?(t(1),r()):(this._easeStart=s.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=s.bX(t,-180,180);const u=Math.abs(t-r);return Math.abs(t-360-r)<u&&(t-=360),Math.abs(t+360-r)<u&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const u=t.lng-r.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,u){const p=Math.ceil(15*r/1e3),m=[],y=t(u.clone());for(let v=0;v<=p;v++){const T=y(v/p);m.push(T.clone())}return m}_preloadTiles(t,r){}}class Th{constructor(t={}){this.options=t,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Re("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Re("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Re("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const u=r.reduce((p,m,y)=>(m.value&&(p+=`${m.key}=${m.value}${y<r.length-1?"&":""}`),p),"?");t.href=`${s.e.FEEDBACK_URL}/${u}#${_h(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style._mergedSourceCaches;for(const p in r){const m=r[p];if(m.used){const y=m.getSource();y.attribution&&t.indexOf(y.attribution)<0&&t.push(y.attribution)}}t.sort((p,m)=>p.length-m.length),t=t.filter((p,m)=>{for(let y=m+1;y<t.length;y++)if(t[y].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Wc{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Re("div","mapboxgl-ctrl");const r=Re("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const u=t[r].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class Co{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,u=r?this._queue.concat(r):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const u of r)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Sh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=s.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,u){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+u}}const or={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class mo extends s.A{constructor(t,r,u,p){const{point:m,lngLat:y,originalEvent:v,target:T}=t;super(t.type,{point:m,lngLat:y,originalEvent:v,target:T}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=u,this.feature=p}}class Zc{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=r.filter;let p=r.type;u&&this.filters.set(t,s.b3(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const m=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):m.size===0&&this.map.on(p,this.handleType),m.size===0&&this.interactionsByType.set(p,m),m.set(t,r),this.typeById.set(t,p)}get(t){const r=this.typeById.get(t);if(!r)return;const u=this.interactionsByType.get(r);return u?u.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(r);u&&(u.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const u=[];for(const[p,m]of r)m.target&&u.push({targetId:p,target:m.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const u=new Map;for(const[p,{feature:m}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(m.id,m);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),p=!!r;r=r||this.queryTargets(t.point,u);const m=t.type==="mouseenter";let y=!1;const v=new Set;for(const T of r){for(const[A,C]of u){if(!C.target)continue;const R=T.variants?T.variants[A]:null;if(R){for(const P of R){if(fc(P,T,v,A))continue;const L=new s.df(T,P),j=Au(P,T,A);p&&(L.state=this.map.getFeatureState(L));const V=m?this.prevHoveredFeatures.get(j):null,G=new mo(t,A,C,L),U=V?V.stop:C.handler(G);if(m&&this.hoveredFeatures.set(j,{feature:T,stop:U}),U!==!1){y=!0;break}}if(y)break}}if(y)break}if(!y)for(const[T,A]of u){const{handler:C,target:R}=A;if(!R&&C(new mo(t,T,A,null))!==!1)break}}}function Eh(c,t){if(Array.isArray(c)&&Array.isArray(t)){const r=new Set(c),u=new Set(t);return r.size===u.size&&c.every(p=>u.has(p))}return s.bv(c,t)}const jm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},xy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xc{constructor(t,r,u=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new vh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new nl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Ct()}move(t,r){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,r),m=p&&p.bearingDelta;if(m&&u.setBearing(u.getBearing()+m),this.mousePitch){const y=this.mousePitch.mousemoveWindow(t,r),v=y&&y.pitchDelta;v&&u.setPitch(u.getPitch()+v)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Dt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Kt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Kt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ei(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Ei(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Um(c,t,r){if(c=new s.cd(c.lng,c.lat),t){const u=new s.cd(c.lng-360,c.lat),p=new s.cd(c.lng+360,c.lat),m=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),y=r.locationPoint3D(c).distSqr(t),v=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(u).distSqr(t)<y&&(v||Math.abs(u.lng-r.center.lng)<m)?c=u:r.locationPoint3D(p).distSqr(t)<y&&(v||Math.abs(p.lng-r.center.lng)<m)&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const u=r.locationPoint3D(c);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const vf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},eo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Kc extends s.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=s.l({element:t},r)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:m=1,draggable:y=!1,clickTolerance:v=0,rotation:T=eo.rotation,rotationAlignment:A=eo.rotationAlignment,pitchAlignment:C=eo.pitchAlignment,occludedOpacity:R=eo.occludedOpacity,altitude:P=eo.altitude}=t||{};this._anchor=u,this._color=p,this._scale=m,this._draggable=y,this._clickTolerance=v,this._rotation=T,this._rotationAlignment=A,this._pitchAlignment=C,this._occludedOpacity=R,this._altitude=P,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});const L=this._element.classList;for(const V in vf)L.remove(`mapboxgl-marker-anchor-${V}`);L.add(`mapboxgl-marker-anchor-${this._anchor}`);const j=t&&t.className?t.className.trim().split(/\s+/):[];L.add(...j),this._popup=null}_createDefaultMarker(){const t=Re("div"),r=Ue("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=Ue("radialGradient",{id:"shadowGradient"},Ue("defs",{},r));Ue("stop",{offset:"10%","stop-opacity":.4},u),Ue("stop",{offset:"100%","stop-opacity":.05},u),Ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return Ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),Ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),Ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||eo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,u=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,u=this._element;this._popup&&(r===u||u.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const u=t.unproject(r,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const m=p.position.toLngLat();return m.distanceTo(u)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(r,this._altitude);let p;t._showingGlobe()&&s.eK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${vf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,u=this.getPitchAlignment();if(!r||!t||u!=="map")return"";if(!r._showingGlobe()){const T=r.getPitch();return T?`rotateX(${T}deg)`:""}const p=s.cJ(s.eL(r.transform,this._lngLat)),m=t.sub(s.eM(r.transform)),y=Math.abs(m.x)+Math.abs(m.y);if(y===0)return"";const v=p/y;return`rotateX(${-m.y*v}deg) rotateY(${m.x*v}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(r._showingGlobe()){const m=r.project(new s.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),y=r.project(new s.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(m);u=s.cJ(Math.atan2(y.y,y.x))-90}else u=-r.getBearing();else if(p==="horizon"){const m=s.af(4,6,r.getZoom()),y=s.eM(r.transform);y.y+=m*r.transform.height;const v=t.sub(y),T=s.cJ(Math.atan2(v.y,v.x));u=(T>90?T-270:T+90)*(1-m)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=Um(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const m=this._clickTolerance||r._clickTolerance;if(t.point.dist(u)<m)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,u=this._pos;r&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||eo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||eo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||eo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||eo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ql={maxWidth:100,unit:"metric"},Wo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},go={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},_o=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xa(c=new s.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new s.P(0,c);case"top-left":return new s.P(r,r);case"top-right":return new s.P(-r,r);case"bottom":return new s.P(0,-c);case"bottom-left":return new s.P(r,-r);case"bottom-right":return new s.P(-r,-r);case"left":return new s.P(c,0);case"right":return new s.P(-c,0)}return new s.P(0,0)}return c instanceof s.P||Array.isArray(c)?s.P.convert(c):s.P.convert(c[t]||[0,0])}return{version:W,supported:He.supported,setRTLTextPlugin:s.eN,getRTLTextPluginStatus:s.eO,Map:class extends Vm{constructor(c){Y.mark(X.create);const t=c;if((c=s.l({},jm,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&s.eI(window)&&(c.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ja(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new Co,this._domRenderTaskQueue=new Co,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.l({},or,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Sh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new Jt(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new sf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new yy(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||s.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new Wp(this),c.hash&&(this._hash=new Vl(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,s.l({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new Th({customAttribution:c.customAttribution})),this._logoControl=new Wc,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new s.A(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new s.A(`${r.dataType}dataloading`,r))}),this._interactions=new Zc(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",c)).fire(new s.A("move",c)),this.fire(new s.A("resize",c)),t&&this.fire(new s.A("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(s.aG.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=s.cx?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<s.cx&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=s.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(s.cd.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(s.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){const u=p=>{let m=[];if(Array.isArray(t)){const y=t.filter(v=>this.getLayer(v));m=y.length?this.queryRenderedFeatures(p,{layers:y}):[]}else m=this.queryRenderedFeatures(p,{target:t});return m};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:y=>{const v=u(y.point);v.length?p||(p=!0,r.call(this,new As(c,this,y.originalEvent,{features:v}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:v=>{u(v.point).length?p=!0:p&&(p=!1,r.call(this,new As(c,this,v.originalEvent)))},mouseout:v=>{p&&(p=!1,r.call(this,new As(c,this,v.originalEvent)))}}}}{const p=m=>{const y=u(m.point);y.length&&(m.features=y,r.call(this,m),delete m.features)};return{listener:r,targets:t,delegates:{[c]:p}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let m=0;m<p.length;m++){const y=p[m];if(y.listener===r&&Eh(y.targets,t)){for(const v in y.delegates)this.off(v,y.delegates[v]);return p.splice(m,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof s.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const m=this.style.queryRenderedFeatures(c,void 0,this.transform),y=this.style.queryRenderedFeatureset(c,void 0,this.transform);return m.concat(y)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const m of t.layers)if(!this._isValidId(m)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),r&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(r,u)=>{if(r){const p=typeof r=="string"?r:r instanceof Error?r.message:r.error;s.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=s.l({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Ys(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.d9(c)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:u=!1,stretchX:p,stretchY:m,content:y}={}){this._lazyInitEmptyStyle();const v=s.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:T,height:A,data:C}=s.q.getImageData(t);this.style.addImage(v,{data:new s.r({width:T,height:A},C),pixelRatio:r,stretchX:p,stretchY:m,content:y,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:A}=t,C=t;this.style.addImage(v,{data:new s.r({width:T,height:A},new Uint8Array(C.data)),pixelRatio:r,stretchX:p,stretchY:m,content:y,sdf:u,usvg:!1,version:0,userImage:C}),C.onAdd&&C.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=s.I.from(c),u=this.style.getImage(r);if(!u)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:m,height:y,data:v}=p;if(m===void 0||y===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||y!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${m}, ${y})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const T=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let A=!1;u.usvg?(u.data=new s.r({width:m,height:y},new Uint8Array(v)),u.usvg=!1,u.icon=void 0,A=!0):u.data.replace(v,T),this.style.updateImage(r,u,A)}hasImage(c){return c?!!this.style&&!!this.style.getImage(s.I.from(c)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(s.I.from(c))}loadImage(c,t){s.o(this._requestManager.transformRequest(c,s.R.Image),(r,u)=>{t(r,u instanceof HTMLImageElement?s.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(c=>c.name)}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch(r=>this.fire(new s.z(new Error("Failed to add import",r)))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.cd.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,u,p,m=this._container;for(;m&&(!u||!p);){const y=window.getComputedStyle(m).transform;y&&y!=="none"&&(r=y.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(u=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(p=r[3])),m=m.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Re("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Re("div","mapboxgl-canvas-container",c);this._canvas=Re("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Re("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Re("div",`mapboxgl-ctrl-${p}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=s.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=s.l({},He.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(Zn(t,!0),this.painter=new gh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new s.A("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,u=s.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,C=this.transform.pitch,R=s.q.now(),P=new s.aa(A,{now:R,fadeDuration:m,pitch:C,transition:this.style.transition});this.style.update(P)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let y=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),y=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):y=this._updateAverageElevation(u);const v=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),v&&(this._placementDirty=v.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Y.mark(X.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const A=s.q.now()-u;p.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const C=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:A,gpuTime:C}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(A);this.fire(new s.A("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(A);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:C}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(T||this._repaint)this.triggerRepaint();else{const A=this.idle();if(A&&(y=this._updateAverageElevation(u,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,Y.mark(X.fullLoad),this._performanceMetricsCollection&&Br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=c;const y=Math.abs(p-m);if(y>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(m),r(m);this._averageElevation.easeTo(m,c,300)}else if(y>1e-4)return this._averageElevation.jumpTo(m),r(m)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){Sr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===yi||c.status===401)){const t=this.painter.context.gl;Zn(t,!1),this._logoControl instanceof Wc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Qn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ai(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,u=r.createFramebuffer();function p(m){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,m,0);const y=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,y),y}return r.bindFramebuffer(r.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,r){let u=r[1]-r[0];const p=c.length/4;for(let m=0;m<t.length;m++){const y=t[m];let v=0;for(let T=0;T<y.length;T+=4)y[T]===c[T]&&y[T+1]===c[T+1]&&y[T+2]===c[T+2]&&y[T+3]===c[T+3]&&(v+=1);u+=(r[m+2]-r[m+1])*(1-v/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Rr.delete(this.painter.context.gl),zi.remove(),Wn.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return s.bt(t,(r,u)=>r._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){s.eJ(c,t)}get version(){return W}},NavigationControl:class{constructor(c={}){this.options=s.l({},xy,c),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Re("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Re("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=Re("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xc(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=Re("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends s.E{constructor(c={}){super();const t=navigator.geolocation;this.options=s.l({geolocation:t},Yc,c),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=tl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",c)),this._finish()}}_updateCamera(c){const t=new s.cd(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,u=this._map.getBearing(),p=s.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new s.cd(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=s.c6(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Re("button","mapboxgl-ctrl-geolocate",this._container),Re("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Re("div","mapboxgl-user-location"),this._dotElement.appendChild(Re("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Re("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Re("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Th,ScaleControl:class{constructor(c={}){this.options=s.l({},ql,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,r]),m=t.unproject([u+c,r]),y=p.distanceTo(m);if(this.options.unit==="imperial"){const v=3.2808*y;v>5280?this._setScale(c,v/5280,"mile"):this._setScale(c,v,"foot")}else this.options.unit==="nautical"?this._setScale(c,y/1852,"nautical-mile"):y>=1e3?this._setScale(c,y/1e3,"kilometer"):this._setScale(c,y,"meter")}_setScale(c,t,r){this._map._requestDomTask(()=>{const u=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let v=m/y;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(T){const A=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*A)/A}(v),y*v}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(u):`${u}&nbsp;${Wo[r]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Re("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Re("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(c){super(),this.options=s.l(Object.create(go),c),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=s.cd.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let u;for(r.innerHTML=c;u=r.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Re("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=Re("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,u=this._pos;if(!t||!r||!u)return"bottom";const p=r.offsetWidth,m=r.offsetHeight,y=u.x<p/2,v=u.x>t.transform.width-p/2;if(u.y+c<m)return y?"top-left":v?"top-right":"top";if(u.y>t.transform.height-m){if(y)return"bottom-left";if(v)return"bottom-right"}return y?"left":v?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let u=this._container;if(u||(u=this._container=Re("div","mapboxgl-popup",t.getContainer()),this._tip=Re("div","mapboxgl-popup-tip",u),u.appendChild(r)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Um(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof s.P?c:t.project(this._lngLat,this._altitude),m=xa(this.options.offset),y=this._anchor=this._getAnchor(m.y),v=xa(this.options.offset,y),T=p.add(v).round();t._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${vf[y]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=s.eK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(_o);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:Kc,Style:Ys,LngLat:s.cd,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:Fu,Evented:s.E,config:s.e,prewarm:s.eP,clearPrewarmedResources:s.eQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(c){s.e.ACCESS_TOKEN=c},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(c){s.e.API_URL=c},get workerCount(){return s.eR.workerCount},set workerCount(c){s.eR.workerCount=c},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){s.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){s.eS(c)},get workerUrl(){return s.eT.workerUrl},set workerUrl(c){s.eT.workerUrl=c},get workerClass(){return s.eT.workerClass},set workerClass(c){s.eT.workerClass=c},get workerParams(){return s.eT.workerParams},set workerParams(c){s.eT.workerParams=c},get dracoUrl(){return s.eU()},set dracoUrl(c){s.eV(c)},get meshoptUrl(){return s.eW()},set meshoptUrl(c){s.eX(c)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var k=M;return k})}(Xg)),Xg.exports}var d4=h4();const $g=vR(d4),o0=({sedes:a})=>{const h=hl("(max-width : 1050px)"),{programTab:_}=it.useContext(Tu),[w,M]=it.useState(0),O=it.useMemo(()=>a.filter((s,W)=>W===w),[w]),k=it.useRef("");return it.useEffect(()=>{$g.accessToken="pk.eyJ1IjoibGYyMzYiLCJhIjoiY2xkNzNjdzdmMDNjbTNwcWlub29sbm83MSJ9.J-EYlfNOsrDlJkzsKJteUw";const s=new $g.Map({container:k.current,style:"mapbox://styles/mapbox/streets-v12",center:O[0].location,zoom:16,hash:!1,projection:{name:"globe"}}),X=new $g.Marker({color:"red"}).setLngLat(O[0].location).addTo(s).getElement();return X.style.cursor="pointer",X.addEventListener("click",()=>{window.open(O[0].map,"_blank")}),s.addControl(new $g.FullscreenControl),()=>s.remove()},[w,O]),Ae.jsx(zn,{sx:{},children:Ae.jsxs(nr,{container:!0,columns:12,sx:{display:"flex",minHeight:h?"auto":"90.5vh",flexDirection:"column",ml:h?3:20,mr:h?3:20,mt:h?2:5,mb:h?0:-3},children:[Ae.jsxs(nr,{size:h?12:6,sx:{mb:2,position:"relative"},children:[Ae.jsx(z_,{sectionId:"Sedes"}),Ae.jsxs(Kh,{component:Hs.div,initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut"},viewport:{once:!0},sx:{fontFamily:"sans-serif",fontWeight:700,fontSize:h?"25px":"33px",color:"text.primary",width:h?"80%":"50%",m:"auto"},children:["SEDES ",_.label]})]}),Ae.jsxs(nr,{container:!0,size:12,children:[Ae.jsx(nr,{size:h?12:6,sx:{display:"flex",flexDirection:"column",justifyContent:"center",minHeight:h?"auto":"75vh",gap:h?4:20,mb:h?3:0},children:a.map((s,W)=>Ae.jsx(zn,{sx:{boxShadow:"0px 2px 10px 5px rgba(1,18,38, 0.15)",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderTopRightRadius:h?10:5,borderBottomRightRadius:h?10:0,transform:W===w?"scale(1.05)":"scale(1)",transition:"transform 0.3s ease",":hover":{cursor:"pointer",transform:"scale(1.05)",transition:"transform 0.3s ease"},zIndex:1},onClick:()=>M(W),children:Ae.jsxs(nr,{container:!0,size:12,children:[Ae.jsx(nr,{size:h?12:6,sx:{p:h?2:2.5,backgroundColor:"#ffffff",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:w===W?"4px solid #50736c":"",borderTopRightRadius:h?10:5,borderBottomRightRadius:h?10:0},children:Ae.jsx(Jn,{fontFamily:"sans-serif",fontSize:h?"16px":"17px",fontWeight:"bold",sx:{color:"text.primary"},children:s.title})}),!h&&Ae.jsx(nr,{size:6,sx:{backgroundColor:"#50736c"},children:Ae.jsx(zn,{sx:{backgroundColor:"white",height:"100%",width:"20%",borderBottomRightRadius:"100px"}})})]})},s.id))}),Ae.jsx(nr,{size:h?12:6,sx:{backgroundColor:"#50736c",height:"100%",minHeight:"auto",borderRadius:3,p:h?1:2,zIndex:2,boxShadow:"0 8px 10px 0 rgba(1,18,38, 0.15)"},children:Ae.jsxs(zn,{sx:{backgroundColor:"white",height:"auto",p:2,textAlign:"center",position:"relative",overflow:"hidden"},children:[Ae.jsx(Jn,{component:Hs.div,initial:{opacity:0},animate:{opacity:1},transition:{duration:1,ease:"easeOut"},fontSize:h?"17px":"20px",color:"background.default",fontWeight:"bold",children:O[0].place},O[0].place),Ae.jsx(Jn,{component:Hs.div,initial:{opacity:0},animate:{opacity:1},transition:{duration:1,delay:.5,ease:"easeInOut"},fontSize:h?"17px":"20px",color:"secondary.main",fontWeight:"bold",mb:1,children:O[0].address},O[0].address),Ae.jsx(Kh,{sx:{width:h?"70%":"50%",ml:"auto",mr:"auto",mb:2}}),Ae.jsx(zn,{ref:k,sx:{display:"flex",justifyContent:"center",verticalAlign:"center",width:"100%",height:h?"56vh":"62.5dvh",borderRadius:2,boxShadow:2,overflow:"hidden"}})]})})]})]})})},f4=()=>{const{programTab:a}=it.useContext(Tu);return Ae.jsxs(Ae.Fragment,{children:[a.id===2&&Ae.jsx(o0,{sedes:a4}),a.id===1&&Ae.jsx(o0,{sedes:l4}),a.id===0&&Ae.jsx(o0,{sedes:c4})]})},p4=Ra(Ae.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"})),SS={nombre:!1,telefono:!1,correo:!1,asunto:!1,descripcion:!1},m4=({...a},h,_)=>{let w=!0;return a.descripcion===""&&(_({...h,descripcion:!0}),w=!1),a.asunto===""&&(_({...h,asunto:!0}),w=!1),a.correo===""&&(_({...h,correo:!0}),w=!1),(a.telefono===""||a.telefono.length<10)&&(_({...h,telefono:!0}),w=!1),a.nombre===""&&(_({...h,nombre:!0}),w=!1),w};function SI(a,h){return function(){return a.apply(h,arguments)}}const{toString:g4}=Object.prototype,{getPrototypeOf:$v}=Object,{iterator:L_,toStringTag:EI}=Symbol,k_=(a=>h=>{const _=g4.call(h);return a[_]||(a[_]=_.slice(8,-1).toLowerCase())})(Object.create(null)),ea=a=>(a=a.toLowerCase(),h=>k_(h)===a),O_=a=>h=>typeof h===a,{isArray:hd}=Array,Sp=O_("undefined");function _4(a){return a!==null&&!Sp(a)&&a.constructor!==null&&!Sp(a.constructor)&&so(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const AI=ea("ArrayBuffer");function y4(a){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(a):h=a&&a.buffer&&AI(a.buffer),h}const x4=O_("string"),so=O_("function"),II=O_("number"),F_=a=>a!==null&&typeof a=="object",v4=a=>a===!0||a===!1,Kg=a=>{if(k_(a)!=="object")return!1;const h=$v(a);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(EI in a)&&!(L_ in a)},b4=ea("Date"),w4=ea("File"),T4=ea("Blob"),S4=ea("FileList"),E4=a=>F_(a)&&so(a.pipe),A4=a=>{let h;return a&&(typeof FormData=="function"&&a instanceof FormData||so(a.append)&&((h=k_(a))==="formdata"||h==="object"&&so(a.toString)&&a.toString()==="[object FormData]"))},I4=ea("URLSearchParams"),[C4,M4,P4,R4]=["ReadableStream","Request","Response","Headers"].map(ea),D4=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Op(a,h,{allOwnKeys:_=!1}={}){if(a===null||typeof a>"u")return;let w,M;if(typeof a!="object"&&(a=[a]),hd(a))for(w=0,M=a.length;w<M;w++)h.call(null,a[w],w,a);else{const O=_?Object.getOwnPropertyNames(a):Object.keys(a),k=O.length;let s;for(w=0;w<k;w++)s=O[w],h.call(null,a[s],s,a)}}function CI(a,h){h=h.toLowerCase();const _=Object.keys(a);let w=_.length,M;for(;w-- >0;)if(M=_[w],h===M.toLowerCase())return M;return null}const gu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,MI=a=>!Sp(a)&&a!==gu;function k0(){const{caseless:a}=MI(this)&&this||{},h={},_=(w,M)=>{const O=a&&CI(h,M)||M;Kg(h[O])&&Kg(w)?h[O]=k0(h[O],w):Kg(w)?h[O]=k0({},w):hd(w)?h[O]=w.slice():h[O]=w};for(let w=0,M=arguments.length;w<M;w++)arguments[w]&&Op(arguments[w],_);return h}const z4=(a,h,_,{allOwnKeys:w}={})=>(Op(h,(M,O)=>{_&&so(M)?a[O]=SI(M,_):a[O]=M},{allOwnKeys:w}),a),L4=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),k4=(a,h,_,w)=>{a.prototype=Object.create(h.prototype,w),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:h.prototype}),_&&Object.assign(a.prototype,_)},O4=(a,h,_,w)=>{let M,O,k;const s={};if(h=h||{},a==null)return h;do{for(M=Object.getOwnPropertyNames(a),O=M.length;O-- >0;)k=M[O],(!w||w(k,a,h))&&!s[k]&&(h[k]=a[k],s[k]=!0);a=_!==!1&&$v(a)}while(a&&(!_||_(a,h))&&a!==Object.prototype);return h},F4=(a,h,_)=>{a=String(a),(_===void 0||_>a.length)&&(_=a.length),_-=h.length;const w=a.indexOf(h,_);return w!==-1&&w===_},B4=a=>{if(!a)return null;if(hd(a))return a;let h=a.length;if(!II(h))return null;const _=new Array(h);for(;h-- >0;)_[h]=a[h];return _},N4=(a=>h=>a&&h instanceof a)(typeof Uint8Array<"u"&&$v(Uint8Array)),V4=(a,h)=>{const w=(a&&a[L_]).call(a);let M;for(;(M=w.next())&&!M.done;){const O=M.value;h.call(a,O[0],O[1])}},j4=(a,h)=>{let _;const w=[];for(;(_=a.exec(h))!==null;)w.push(_);return w},U4=ea("HTMLFormElement"),$4=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(_,w,M){return w.toUpperCase()+M}),ES=(({hasOwnProperty:a})=>(h,_)=>a.call(h,_))(Object.prototype),G4=ea("RegExp"),PI=(a,h)=>{const _=Object.getOwnPropertyDescriptors(a),w={};Op(_,(M,O)=>{let k;(k=h(M,O,a))!==!1&&(w[O]=k||M)}),Object.defineProperties(a,w)},H4=a=>{PI(a,(h,_)=>{if(so(a)&&["arguments","caller","callee"].indexOf(_)!==-1)return!1;const w=a[_];if(so(w)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not rewrite read-only method '"+_+"'")})}})},q4=(a,h)=>{const _={},w=M=>{M.forEach(O=>{_[O]=!0})};return hd(a)?w(a):w(String(a).split(h)),_},W4=()=>{},Z4=(a,h)=>a!=null&&Number.isFinite(a=+a)?a:h;function X4(a){return!!(a&&so(a.append)&&a[EI]==="FormData"&&a[L_])}const K4=a=>{const h=new Array(10),_=(w,M)=>{if(F_(w)){if(h.indexOf(w)>=0)return;if(!("toJSON"in w)){h[M]=w;const O=hd(w)?[]:{};return Op(w,(k,s)=>{const W=_(k,M+1);!Sp(W)&&(O[s]=W)}),h[M]=void 0,O}}return w};return _(a,0)},Y4=ea("AsyncFunction"),J4=a=>a&&(F_(a)||so(a))&&so(a.then)&&so(a.catch),RI=((a,h)=>a?setImmediate:h?((_,w)=>(gu.addEventListener("message",({source:M,data:O})=>{M===gu&&O===_&&w.length&&w.shift()()},!1),M=>{w.push(M),gu.postMessage(_,"*")}))(`axios@${Math.random()}`,[]):_=>setTimeout(_))(typeof setImmediate=="function",so(gu.postMessage)),Q4=typeof queueMicrotask<"u"?queueMicrotask.bind(gu):typeof process<"u"&&process.nextTick||RI,eN=a=>a!=null&&so(a[L_]),mt={isArray:hd,isArrayBuffer:AI,isBuffer:_4,isFormData:A4,isArrayBufferView:y4,isString:x4,isNumber:II,isBoolean:v4,isObject:F_,isPlainObject:Kg,isReadableStream:C4,isRequest:M4,isResponse:P4,isHeaders:R4,isUndefined:Sp,isDate:b4,isFile:w4,isBlob:T4,isRegExp:G4,isFunction:so,isStream:E4,isURLSearchParams:I4,isTypedArray:N4,isFileList:S4,forEach:Op,merge:k0,extend:z4,trim:D4,stripBOM:L4,inherits:k4,toFlatObject:O4,kindOf:k_,kindOfTest:ea,endsWith:F4,toArray:B4,forEachEntry:V4,matchAll:j4,isHTMLForm:U4,hasOwnProperty:ES,hasOwnProp:ES,reduceDescriptors:PI,freezeMethods:H4,toObjectSet:q4,toCamelCase:$4,noop:W4,toFiniteNumber:Z4,findKey:CI,global:gu,isContextDefined:MI,isSpecCompliantForm:X4,toJSONObject:K4,isAsyncFn:Y4,isThenable:J4,setImmediate:RI,asap:Q4,isIterable:eN};function hn(a,h,_,w,M){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",h&&(this.code=h),_&&(this.config=_),w&&(this.request=w),M&&(this.response=M,this.status=M.status?M.status:null)}mt.inherits(hn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:mt.toJSONObject(this.config),code:this.code,status:this.status}}});const DI=hn.prototype,zI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{zI[a]={value:a}});Object.defineProperties(hn,zI);Object.defineProperty(DI,"isAxiosError",{value:!0});hn.from=(a,h,_,w,M,O)=>{const k=Object.create(DI);return mt.toFlatObject(a,k,function(W){return W!==Error.prototype},s=>s!=="isAxiosError"),hn.call(k,a.message,h,_,w,M),k.cause=a,k.name=a.name,O&&Object.assign(k,O),k};const tN=null;function O0(a){return mt.isPlainObject(a)||mt.isArray(a)}function LI(a){return mt.endsWith(a,"[]")?a.slice(0,-2):a}function AS(a,h,_){return a?a.concat(h).map(function(M,O){return M=LI(M),!_&&O?"["+M+"]":M}).join(_?".":""):h}function iN(a){return mt.isArray(a)&&!a.some(O0)}const nN=mt.toFlatObject(mt,{},null,function(h){return/^is[A-Z]/.test(h)});function B_(a,h,_){if(!mt.isObject(a))throw new TypeError("target must be an object");h=h||new FormData,_=mt.toFlatObject(_,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Re,Ue){return!mt.isUndefined(Ue[Re])});const w=_.metaTokens,M=_.visitor||Y,O=_.dots,k=_.indexes,W=(_.Blob||typeof Blob<"u"&&Blob)&&mt.isSpecCompliantForm(h);if(!mt.isFunction(M))throw new TypeError("visitor must be a function");function X(He){if(He===null)return"";if(mt.isDate(He))return He.toISOString();if(!W&&mt.isBlob(He))throw new hn("Blob is not supported. Use a Buffer instead.");return mt.isArrayBuffer(He)||mt.isTypedArray(He)?W&&typeof Blob=="function"?new Blob([He]):Buffer.from(He):He}function Y(He,Re,Ue){let et=He;if(He&&!Ue&&typeof He=="object"){if(mt.endsWith(Re,"{}"))Re=w?Re:Re.slice(0,-2),He=JSON.stringify(He);else if(mt.isArray(He)&&iN(He)||(mt.isFileList(He)||mt.endsWith(Re,"[]"))&&(et=mt.toArray(He)))return Re=LI(Re),et.forEach(function(ot,Ct){!(mt.isUndefined(ot)||ot===null)&&h.append(k===!0?AS([Re],Ct,O):k===null?Re:Re+"[]",X(ot))}),!1}return O0(He)?!0:(h.append(AS(Ue,Re,O),X(He)),!1)}const fe=[],Ie=Object.assign(nN,{defaultVisitor:Y,convertValue:X,isVisitable:O0});function je(He,Re){if(!mt.isUndefined(He)){if(fe.indexOf(He)!==-1)throw Error("Circular reference detected in "+Re.join("."));fe.push(He),mt.forEach(He,function(et,vt){(!(mt.isUndefined(et)||et===null)&&M.call(h,et,mt.isString(vt)?vt.trim():vt,Re,Ie))===!0&&je(et,Re?Re.concat(vt):[vt])}),fe.pop()}}if(!mt.isObject(a))throw new TypeError("data must be an object");return je(a),h}function IS(a){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(w){return h[w]})}function Gv(a,h){this._pairs=[],a&&B_(a,this,h)}const kI=Gv.prototype;kI.append=function(h,_){this._pairs.push([h,_])};kI.toString=function(h){const _=h?function(w){return h.call(this,w,IS)}:IS;return this._pairs.map(function(M){return _(M[0])+"="+_(M[1])},"").join("&")};function rN(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function OI(a,h,_){if(!h)return a;const w=_&&_.encode||rN;mt.isFunction(_)&&(_={serialize:_});const M=_&&_.serialize;let O;if(M?O=M(h,_):O=mt.isURLSearchParams(h)?h.toString():new Gv(h,_).toString(w),O){const k=a.indexOf("#");k!==-1&&(a=a.slice(0,k)),a+=(a.indexOf("?")===-1?"?":"&")+O}return a}class CS{constructor(){this.handlers=[]}use(h,_,w){return this.handlers.push({fulfilled:h,rejected:_,synchronous:w?w.synchronous:!1,runWhen:w?w.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){mt.forEach(this.handlers,function(w){w!==null&&h(w)})}}const FI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},sN=typeof URLSearchParams<"u"?URLSearchParams:Gv,oN=typeof FormData<"u"?FormData:null,aN=typeof Blob<"u"?Blob:null,lN={isBrowser:!0,classes:{URLSearchParams:sN,FormData:oN,Blob:aN},protocols:["http","https","file","blob","url","data"]},Hv=typeof window<"u"&&typeof document<"u",F0=typeof navigator=="object"&&navigator||void 0,cN=Hv&&(!F0||["ReactNative","NativeScript","NS"].indexOf(F0.product)<0),uN=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",hN=Hv&&window.location.href||"http://localhost",dN=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Hv,hasStandardBrowserEnv:cN,hasStandardBrowserWebWorkerEnv:uN,navigator:F0,origin:hN},Symbol.toStringTag,{value:"Module"})),Bs={...dN,...lN};function fN(a,h){return B_(a,new Bs.classes.URLSearchParams,Object.assign({visitor:function(_,w,M,O){return Bs.isNode&&mt.isBuffer(_)?(this.append(w,_.toString("base64")),!1):O.defaultVisitor.apply(this,arguments)}},h))}function pN(a){return mt.matchAll(/\w+|\[(\w*)]/g,a).map(h=>h[0]==="[]"?"":h[1]||h[0])}function mN(a){const h={},_=Object.keys(a);let w;const M=_.length;let O;for(w=0;w<M;w++)O=_[w],h[O]=a[O];return h}function BI(a){function h(_,w,M,O){let k=_[O++];if(k==="__proto__")return!0;const s=Number.isFinite(+k),W=O>=_.length;return k=!k&&mt.isArray(M)?M.length:k,W?(mt.hasOwnProp(M,k)?M[k]=[M[k],w]:M[k]=w,!s):((!M[k]||!mt.isObject(M[k]))&&(M[k]=[]),h(_,w,M[k],O)&&mt.isArray(M[k])&&(M[k]=mN(M[k])),!s)}if(mt.isFormData(a)&&mt.isFunction(a.entries)){const _={};return mt.forEachEntry(a,(w,M)=>{h(pN(w),M,_,0)}),_}return null}function gN(a,h,_){if(mt.isString(a))try{return(h||JSON.parse)(a),mt.trim(a)}catch(w){if(w.name!=="SyntaxError")throw w}return(_||JSON.stringify)(a)}const Fp={transitional:FI,adapter:["xhr","http","fetch"],transformRequest:[function(h,_){const w=_.getContentType()||"",M=w.indexOf("application/json")>-1,O=mt.isObject(h);if(O&&mt.isHTMLForm(h)&&(h=new FormData(h)),mt.isFormData(h))return M?JSON.stringify(BI(h)):h;if(mt.isArrayBuffer(h)||mt.isBuffer(h)||mt.isStream(h)||mt.isFile(h)||mt.isBlob(h)||mt.isReadableStream(h))return h;if(mt.isArrayBufferView(h))return h.buffer;if(mt.isURLSearchParams(h))return _.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let s;if(O){if(w.indexOf("application/x-www-form-urlencoded")>-1)return fN(h,this.formSerializer).toString();if((s=mt.isFileList(h))||w.indexOf("multipart/form-data")>-1){const W=this.env&&this.env.FormData;return B_(s?{"files[]":h}:h,W&&new W,this.formSerializer)}}return O||M?(_.setContentType("application/json",!1),gN(h)):h}],transformResponse:[function(h){const _=this.transitional||Fp.transitional,w=_&&_.forcedJSONParsing,M=this.responseType==="json";if(mt.isResponse(h)||mt.isReadableStream(h))return h;if(h&&mt.isString(h)&&(w&&!this.responseType||M)){const k=!(_&&_.silentJSONParsing)&&M;try{return JSON.parse(h)}catch(s){if(k)throw s.name==="SyntaxError"?hn.from(s,hn.ERR_BAD_RESPONSE,this,null,this.response):s}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Bs.classes.FormData,Blob:Bs.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};mt.forEach(["delete","get","head","post","put","patch"],a=>{Fp.headers[a]={}});const _N=mt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yN=a=>{const h={};let _,w,M;return a&&a.split(`
`).forEach(function(k){M=k.indexOf(":"),_=k.substring(0,M).trim().toLowerCase(),w=k.substring(M+1).trim(),!(!_||h[_]&&_N[_])&&(_==="set-cookie"?h[_]?h[_].push(w):h[_]=[w]:h[_]=h[_]?h[_]+", "+w:w)}),h},MS=Symbol("internals");function ap(a){return a&&String(a).trim().toLowerCase()}function Yg(a){return a===!1||a==null?a:mt.isArray(a)?a.map(Yg):String(a)}function xN(a){const h=Object.create(null),_=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let w;for(;w=_.exec(a);)h[w[1]]=w[2];return h}const vN=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function a0(a,h,_,w,M){if(mt.isFunction(w))return w.call(this,h,_);if(M&&(h=_),!!mt.isString(h)){if(mt.isString(w))return h.indexOf(w)!==-1;if(mt.isRegExp(w))return w.test(h)}}function bN(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,_,w)=>_.toUpperCase()+w)}function wN(a,h){const _=mt.toCamelCase(" "+h);["get","set","has"].forEach(w=>{Object.defineProperty(a,w+_,{value:function(M,O,k){return this[w].call(this,h,M,O,k)},configurable:!0})})}let oo=class{constructor(h){h&&this.set(h)}set(h,_,w){const M=this;function O(s,W,X){const Y=ap(W);if(!Y)throw new Error("header name must be a non-empty string");const fe=mt.findKey(M,Y);(!fe||M[fe]===void 0||X===!0||X===void 0&&M[fe]!==!1)&&(M[fe||W]=Yg(s))}const k=(s,W)=>mt.forEach(s,(X,Y)=>O(X,Y,W));if(mt.isPlainObject(h)||h instanceof this.constructor)k(h,_);else if(mt.isString(h)&&(h=h.trim())&&!vN(h))k(yN(h),_);else if(mt.isObject(h)&&mt.isIterable(h)){let s={},W,X;for(const Y of h){if(!mt.isArray(Y))throw TypeError("Object iterator must return a key-value pair");s[X=Y[0]]=(W=s[X])?mt.isArray(W)?[...W,Y[1]]:[W,Y[1]]:Y[1]}k(s,_)}else h!=null&&O(_,h,w);return this}get(h,_){if(h=ap(h),h){const w=mt.findKey(this,h);if(w){const M=this[w];if(!_)return M;if(_===!0)return xN(M);if(mt.isFunction(_))return _.call(this,M,w);if(mt.isRegExp(_))return _.exec(M);throw new TypeError("parser must be boolean|regexp|function")}}}has(h,_){if(h=ap(h),h){const w=mt.findKey(this,h);return!!(w&&this[w]!==void 0&&(!_||a0(this,this[w],w,_)))}return!1}delete(h,_){const w=this;let M=!1;function O(k){if(k=ap(k),k){const s=mt.findKey(w,k);s&&(!_||a0(w,w[s],s,_))&&(delete w[s],M=!0)}}return mt.isArray(h)?h.forEach(O):O(h),M}clear(h){const _=Object.keys(this);let w=_.length,M=!1;for(;w--;){const O=_[w];(!h||a0(this,this[O],O,h,!0))&&(delete this[O],M=!0)}return M}normalize(h){const _=this,w={};return mt.forEach(this,(M,O)=>{const k=mt.findKey(w,O);if(k){_[k]=Yg(M),delete _[O];return}const s=h?bN(O):String(O).trim();s!==O&&delete _[O],_[s]=Yg(M),w[s]=!0}),this}concat(...h){return this.constructor.concat(this,...h)}toJSON(h){const _=Object.create(null);return mt.forEach(this,(w,M)=>{w!=null&&w!==!1&&(_[M]=h&&mt.isArray(w)?w.join(", "):w)}),_}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([h,_])=>h+": "+_).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(h){return h instanceof this?h:new this(h)}static concat(h,..._){const w=new this(h);return _.forEach(M=>w.set(M)),w}static accessor(h){const w=(this[MS]=this[MS]={accessors:{}}).accessors,M=this.prototype;function O(k){const s=ap(k);w[s]||(wN(M,k),w[s]=!0)}return mt.isArray(h)?h.forEach(O):O(h),this}};oo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);mt.reduceDescriptors(oo.prototype,({value:a},h)=>{let _=h[0].toUpperCase()+h.slice(1);return{get:()=>a,set(w){this[_]=w}}});mt.freezeMethods(oo);function l0(a,h){const _=this||Fp,w=h||_,M=oo.from(w.headers);let O=w.data;return mt.forEach(a,function(s){O=s.call(_,O,M.normalize(),h?h.status:void 0)}),M.normalize(),O}function NI(a){return!!(a&&a.__CANCEL__)}function dd(a,h,_){hn.call(this,a??"canceled",hn.ERR_CANCELED,h,_),this.name="CanceledError"}mt.inherits(dd,hn,{__CANCEL__:!0});function VI(a,h,_){const w=_.config.validateStatus;!_.status||!w||w(_.status)?a(_):h(new hn("Request failed with status code "+_.status,[hn.ERR_BAD_REQUEST,hn.ERR_BAD_RESPONSE][Math.floor(_.status/100)-4],_.config,_.request,_))}function TN(a){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return h&&h[1]||""}function SN(a,h){a=a||10;const _=new Array(a),w=new Array(a);let M=0,O=0,k;return h=h!==void 0?h:1e3,function(W){const X=Date.now(),Y=w[O];k||(k=X),_[M]=W,w[M]=X;let fe=O,Ie=0;for(;fe!==M;)Ie+=_[fe++],fe=fe%a;if(M=(M+1)%a,M===O&&(O=(O+1)%a),X-k<h)return;const je=Y&&X-Y;return je?Math.round(Ie*1e3/je):void 0}}function EN(a,h){let _=0,w=1e3/h,M,O;const k=(X,Y=Date.now())=>{_=Y,M=null,O&&(clearTimeout(O),O=null),a.apply(null,X)};return[(...X)=>{const Y=Date.now(),fe=Y-_;fe>=w?k(X,Y):(M=X,O||(O=setTimeout(()=>{O=null,k(M)},w-fe)))},()=>M&&k(M)]}const g_=(a,h,_=3)=>{let w=0;const M=SN(50,250);return EN(O=>{const k=O.loaded,s=O.lengthComputable?O.total:void 0,W=k-w,X=M(W),Y=k<=s;w=k;const fe={loaded:k,total:s,progress:s?k/s:void 0,bytes:W,rate:X||void 0,estimated:X&&s&&Y?(s-k)/X:void 0,event:O,lengthComputable:s!=null,[h?"download":"upload"]:!0};a(fe)},_)},PS=(a,h)=>{const _=a!=null;return[w=>h[0]({lengthComputable:_,total:a,loaded:w}),h[1]]},RS=a=>(...h)=>mt.asap(()=>a(...h)),AN=Bs.hasStandardBrowserEnv?((a,h)=>_=>(_=new URL(_,Bs.origin),a.protocol===_.protocol&&a.host===_.host&&(h||a.port===_.port)))(new URL(Bs.origin),Bs.navigator&&/(msie|trident)/i.test(Bs.navigator.userAgent)):()=>!0,IN=Bs.hasStandardBrowserEnv?{write(a,h,_,w,M,O){const k=[a+"="+encodeURIComponent(h)];mt.isNumber(_)&&k.push("expires="+new Date(_).toGMTString()),mt.isString(w)&&k.push("path="+w),mt.isString(M)&&k.push("domain="+M),O===!0&&k.push("secure"),document.cookie=k.join("; ")},read(a){const h=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return h?decodeURIComponent(h[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function CN(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function MN(a,h){return h?a.replace(/\/?\/$/,"")+"/"+h.replace(/^\/+/,""):a}function jI(a,h,_){let w=!CN(h);return a&&(w||_==!1)?MN(a,h):h}const DS=a=>a instanceof oo?{...a}:a;function wu(a,h){h=h||{};const _={};function w(X,Y,fe,Ie){return mt.isPlainObject(X)&&mt.isPlainObject(Y)?mt.merge.call({caseless:Ie},X,Y):mt.isPlainObject(Y)?mt.merge({},Y):mt.isArray(Y)?Y.slice():Y}function M(X,Y,fe,Ie){if(mt.isUndefined(Y)){if(!mt.isUndefined(X))return w(void 0,X,fe,Ie)}else return w(X,Y,fe,Ie)}function O(X,Y){if(!mt.isUndefined(Y))return w(void 0,Y)}function k(X,Y){if(mt.isUndefined(Y)){if(!mt.isUndefined(X))return w(void 0,X)}else return w(void 0,Y)}function s(X,Y,fe){if(fe in h)return w(X,Y);if(fe in a)return w(void 0,X)}const W={url:O,method:O,data:O,baseURL:k,transformRequest:k,transformResponse:k,paramsSerializer:k,timeout:k,timeoutMessage:k,withCredentials:k,withXSRFToken:k,adapter:k,responseType:k,xsrfCookieName:k,xsrfHeaderName:k,onUploadProgress:k,onDownloadProgress:k,decompress:k,maxContentLength:k,maxBodyLength:k,beforeRedirect:k,transport:k,httpAgent:k,httpsAgent:k,cancelToken:k,socketPath:k,responseEncoding:k,validateStatus:s,headers:(X,Y,fe)=>M(DS(X),DS(Y),fe,!0)};return mt.forEach(Object.keys(Object.assign({},a,h)),function(Y){const fe=W[Y]||M,Ie=fe(a[Y],h[Y],Y);mt.isUndefined(Ie)&&fe!==s||(_[Y]=Ie)}),_}const UI=a=>{const h=wu({},a);let{data:_,withXSRFToken:w,xsrfHeaderName:M,xsrfCookieName:O,headers:k,auth:s}=h;h.headers=k=oo.from(k),h.url=OI(jI(h.baseURL,h.url,h.allowAbsoluteUrls),a.params,a.paramsSerializer),s&&k.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):"")));let W;if(mt.isFormData(_)){if(Bs.hasStandardBrowserEnv||Bs.hasStandardBrowserWebWorkerEnv)k.setContentType(void 0);else if((W=k.getContentType())!==!1){const[X,...Y]=W?W.split(";").map(fe=>fe.trim()).filter(Boolean):[];k.setContentType([X||"multipart/form-data",...Y].join("; "))}}if(Bs.hasStandardBrowserEnv&&(w&&mt.isFunction(w)&&(w=w(h)),w||w!==!1&&AN(h.url))){const X=M&&O&&IN.read(O);X&&k.set(M,X)}return h},PN=typeof XMLHttpRequest<"u",RN=PN&&function(a){return new Promise(function(_,w){const M=UI(a);let O=M.data;const k=oo.from(M.headers).normalize();let{responseType:s,onUploadProgress:W,onDownloadProgress:X}=M,Y,fe,Ie,je,He;function Re(){je&&je(),He&&He(),M.cancelToken&&M.cancelToken.unsubscribe(Y),M.signal&&M.signal.removeEventListener("abort",Y)}let Ue=new XMLHttpRequest;Ue.open(M.method.toUpperCase(),M.url,!0),Ue.timeout=M.timeout;function et(){if(!Ue)return;const ot=oo.from("getAllResponseHeaders"in Ue&&Ue.getAllResponseHeaders()),Dt={data:!s||s==="text"||s==="json"?Ue.responseText:Ue.response,status:Ue.status,statusText:Ue.statusText,headers:ot,config:a,request:Ue};VI(function(hi){_(hi),Re()},function(hi){w(hi),Re()},Dt),Ue=null}"onloadend"in Ue?Ue.onloadend=et:Ue.onreadystatechange=function(){!Ue||Ue.readyState!==4||Ue.status===0&&!(Ue.responseURL&&Ue.responseURL.indexOf("file:")===0)||setTimeout(et)},Ue.onabort=function(){Ue&&(w(new hn("Request aborted",hn.ECONNABORTED,a,Ue)),Ue=null)},Ue.onerror=function(){w(new hn("Network Error",hn.ERR_NETWORK,a,Ue)),Ue=null},Ue.ontimeout=function(){let Ct=M.timeout?"timeout of "+M.timeout+"ms exceeded":"timeout exceeded";const Dt=M.transitional||FI;M.timeoutErrorMessage&&(Ct=M.timeoutErrorMessage),w(new hn(Ct,Dt.clarifyTimeoutError?hn.ETIMEDOUT:hn.ECONNABORTED,a,Ue)),Ue=null},O===void 0&&k.setContentType(null),"setRequestHeader"in Ue&&mt.forEach(k.toJSON(),function(Ct,Dt){Ue.setRequestHeader(Dt,Ct)}),mt.isUndefined(M.withCredentials)||(Ue.withCredentials=!!M.withCredentials),s&&s!=="json"&&(Ue.responseType=M.responseType),X&&([Ie,He]=g_(X,!0),Ue.addEventListener("progress",Ie)),W&&Ue.upload&&([fe,je]=g_(W),Ue.upload.addEventListener("progress",fe),Ue.upload.addEventListener("loadend",je)),(M.cancelToken||M.signal)&&(Y=ot=>{Ue&&(w(!ot||ot.type?new dd(null,a,Ue):ot),Ue.abort(),Ue=null)},M.cancelToken&&M.cancelToken.subscribe(Y),M.signal&&(M.signal.aborted?Y():M.signal.addEventListener("abort",Y)));const vt=TN(M.url);if(vt&&Bs.protocols.indexOf(vt)===-1){w(new hn("Unsupported protocol "+vt+":",hn.ERR_BAD_REQUEST,a));return}Ue.send(O||null)})},DN=(a,h)=>{const{length:_}=a=a?a.filter(Boolean):[];if(h||_){let w=new AbortController,M;const O=function(X){if(!M){M=!0,s();const Y=X instanceof Error?X:this.reason;w.abort(Y instanceof hn?Y:new dd(Y instanceof Error?Y.message:Y))}};let k=h&&setTimeout(()=>{k=null,O(new hn(`timeout ${h} of ms exceeded`,hn.ETIMEDOUT))},h);const s=()=>{a&&(k&&clearTimeout(k),k=null,a.forEach(X=>{X.unsubscribe?X.unsubscribe(O):X.removeEventListener("abort",O)}),a=null)};a.forEach(X=>X.addEventListener("abort",O));const{signal:W}=w;return W.unsubscribe=()=>mt.asap(s),W}},zN=function*(a,h){let _=a.byteLength;if(_<h){yield a;return}let w=0,M;for(;w<_;)M=w+h,yield a.slice(w,M),w=M},LN=async function*(a,h){for await(const _ of kN(a))yield*zN(_,h)},kN=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const h=a.getReader();try{for(;;){const{done:_,value:w}=await h.read();if(_)break;yield w}}finally{await h.cancel()}},zS=(a,h,_,w)=>{const M=LN(a,h);let O=0,k,s=W=>{k||(k=!0,w&&w(W))};return new ReadableStream({async pull(W){try{const{done:X,value:Y}=await M.next();if(X){s(),W.close();return}let fe=Y.byteLength;if(_){let Ie=O+=fe;_(Ie)}W.enqueue(new Uint8Array(Y))}catch(X){throw s(X),X}},cancel(W){return s(W),M.return()}},{highWaterMark:2})},N_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",$I=N_&&typeof ReadableStream=="function",ON=N_&&(typeof TextEncoder=="function"?(a=>h=>a.encode(h))(new TextEncoder):async a=>new Uint8Array(await new Response(a).arrayBuffer())),GI=(a,...h)=>{try{return!!a(...h)}catch{return!1}},FN=$I&&GI(()=>{let a=!1;const h=new Request(Bs.origin,{body:new ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type");return a&&!h}),LS=64*1024,B0=$I&&GI(()=>mt.isReadableStream(new Response("").body)),__={stream:B0&&(a=>a.body)};N_&&(a=>{["text","arrayBuffer","blob","formData","stream"].forEach(h=>{!__[h]&&(__[h]=mt.isFunction(a[h])?_=>_[h]():(_,w)=>{throw new hn(`Response type '${h}' is not supported`,hn.ERR_NOT_SUPPORT,w)})})})(new Response);const BN=async a=>{if(a==null)return 0;if(mt.isBlob(a))return a.size;if(mt.isSpecCompliantForm(a))return(await new Request(Bs.origin,{method:"POST",body:a}).arrayBuffer()).byteLength;if(mt.isArrayBufferView(a)||mt.isArrayBuffer(a))return a.byteLength;if(mt.isURLSearchParams(a)&&(a=a+""),mt.isString(a))return(await ON(a)).byteLength},NN=async(a,h)=>{const _=mt.toFiniteNumber(a.getContentLength());return _??BN(h)},VN=N_&&(async a=>{let{url:h,method:_,data:w,signal:M,cancelToken:O,timeout:k,onDownloadProgress:s,onUploadProgress:W,responseType:X,headers:Y,withCredentials:fe="same-origin",fetchOptions:Ie}=UI(a);X=X?(X+"").toLowerCase():"text";let je=DN([M,O&&O.toAbortSignal()],k),He;const Re=je&&je.unsubscribe&&(()=>{je.unsubscribe()});let Ue;try{if(W&&FN&&_!=="get"&&_!=="head"&&(Ue=await NN(Y,w))!==0){let Dt=new Request(h,{method:"POST",body:w,duplex:"half"}),Vt;if(mt.isFormData(w)&&(Vt=Dt.headers.get("content-type"))&&Y.setContentType(Vt),Dt.body){const[hi,Kt]=PS(Ue,g_(RS(W)));w=zS(Dt.body,LS,hi,Kt)}}mt.isString(fe)||(fe=fe?"include":"omit");const et="credentials"in Request.prototype;He=new Request(h,{...Ie,signal:je,method:_.toUpperCase(),headers:Y.normalize().toJSON(),body:w,duplex:"half",credentials:et?fe:void 0});let vt=await fetch(He);const ot=B0&&(X==="stream"||X==="response");if(B0&&(s||ot&&Re)){const Dt={};["status","statusText","headers"].forEach(Ei=>{Dt[Ei]=vt[Ei]});const Vt=mt.toFiniteNumber(vt.headers.get("content-length")),[hi,Kt]=s&&PS(Vt,g_(RS(s),!0))||[];vt=new Response(zS(vt.body,LS,hi,()=>{Kt&&Kt(),Re&&Re()}),Dt)}X=X||"text";let Ct=await __[mt.findKey(__,X)||"text"](vt,a);return!ot&&Re&&Re(),await new Promise((Dt,Vt)=>{VI(Dt,Vt,{data:Ct,headers:oo.from(vt.headers),status:vt.status,statusText:vt.statusText,config:a,request:He})})}catch(et){throw Re&&Re(),et&&et.name==="TypeError"&&/Load failed|fetch/i.test(et.message)?Object.assign(new hn("Network Error",hn.ERR_NETWORK,a,He),{cause:et.cause||et}):hn.from(et,et&&et.code,a,He)}}),N0={http:tN,xhr:RN,fetch:VN};mt.forEach(N0,(a,h)=>{if(a){try{Object.defineProperty(a,"name",{value:h})}catch{}Object.defineProperty(a,"adapterName",{value:h})}});const kS=a=>`- ${a}`,jN=a=>mt.isFunction(a)||a===null||a===!1,HI={getAdapter:a=>{a=mt.isArray(a)?a:[a];const{length:h}=a;let _,w;const M={};for(let O=0;O<h;O++){_=a[O];let k;if(w=_,!jN(_)&&(w=N0[(k=String(_)).toLowerCase()],w===void 0))throw new hn(`Unknown adapter '${k}'`);if(w)break;M[k||"#"+O]=w}if(!w){const O=Object.entries(M).map(([s,W])=>`adapter ${s} `+(W===!1?"is not supported by the environment":"is not available in the build"));let k=h?O.length>1?`since :
`+O.map(kS).join(`
`):" "+kS(O[0]):"as no adapter specified";throw new hn("There is no suitable adapter to dispatch the request "+k,"ERR_NOT_SUPPORT")}return w},adapters:N0};function c0(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new dd(null,a)}function OS(a){return c0(a),a.headers=oo.from(a.headers),a.data=l0.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),HI.getAdapter(a.adapter||Fp.adapter)(a).then(function(w){return c0(a),w.data=l0.call(a,a.transformResponse,w),w.headers=oo.from(w.headers),w},function(w){return NI(w)||(c0(a),w&&w.response&&(w.response.data=l0.call(a,a.transformResponse,w.response),w.response.headers=oo.from(w.response.headers))),Promise.reject(w)})}const qI="1.9.0",V_={};["object","boolean","number","function","string","symbol"].forEach((a,h)=>{V_[a]=function(w){return typeof w===a||"a"+(h<1?"n ":" ")+a}});const FS={};V_.transitional=function(h,_,w){function M(O,k){return"[Axios v"+qI+"] Transitional option '"+O+"'"+k+(w?". "+w:"")}return(O,k,s)=>{if(h===!1)throw new hn(M(k," has been removed"+(_?" in "+_:"")),hn.ERR_DEPRECATED);return _&&!FS[k]&&(FS[k]=!0,console.warn(M(k," has been deprecated since v"+_+" and will be removed in the near future"))),h?h(O,k,s):!0}};V_.spelling=function(h){return(_,w)=>(console.warn(`${w} is likely a misspelling of ${h}`),!0)};function UN(a,h,_){if(typeof a!="object")throw new hn("options must be an object",hn.ERR_BAD_OPTION_VALUE);const w=Object.keys(a);let M=w.length;for(;M-- >0;){const O=w[M],k=h[O];if(k){const s=a[O],W=s===void 0||k(s,O,a);if(W!==!0)throw new hn("option "+O+" must be "+W,hn.ERR_BAD_OPTION_VALUE);continue}if(_!==!0)throw new hn("Unknown option "+O,hn.ERR_BAD_OPTION)}}const Jg={assertOptions:UN,validators:V_},Ea=Jg.validators;let vu=class{constructor(h){this.defaults=h||{},this.interceptors={request:new CS,response:new CS}}async request(h,_){try{return await this._request(h,_)}catch(w){if(w instanceof Error){let M={};Error.captureStackTrace?Error.captureStackTrace(M):M=new Error;const O=M.stack?M.stack.replace(/^.+\n/,""):"";try{w.stack?O&&!String(w.stack).endsWith(O.replace(/^.+\n.+\n/,""))&&(w.stack+=`
`+O):w.stack=O}catch{}}throw w}}_request(h,_){typeof h=="string"?(_=_||{},_.url=h):_=h||{},_=wu(this.defaults,_);const{transitional:w,paramsSerializer:M,headers:O}=_;w!==void 0&&Jg.assertOptions(w,{silentJSONParsing:Ea.transitional(Ea.boolean),forcedJSONParsing:Ea.transitional(Ea.boolean),clarifyTimeoutError:Ea.transitional(Ea.boolean)},!1),M!=null&&(mt.isFunction(M)?_.paramsSerializer={serialize:M}:Jg.assertOptions(M,{encode:Ea.function,serialize:Ea.function},!0)),_.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?_.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:_.allowAbsoluteUrls=!0),Jg.assertOptions(_,{baseUrl:Ea.spelling("baseURL"),withXsrfToken:Ea.spelling("withXSRFToken")},!0),_.method=(_.method||this.defaults.method||"get").toLowerCase();let k=O&&mt.merge(O.common,O[_.method]);O&&mt.forEach(["delete","get","head","post","put","patch","common"],He=>{delete O[He]}),_.headers=oo.concat(k,O);const s=[];let W=!0;this.interceptors.request.forEach(function(Re){typeof Re.runWhen=="function"&&Re.runWhen(_)===!1||(W=W&&Re.synchronous,s.unshift(Re.fulfilled,Re.rejected))});const X=[];this.interceptors.response.forEach(function(Re){X.push(Re.fulfilled,Re.rejected)});let Y,fe=0,Ie;if(!W){const He=[OS.bind(this),void 0];for(He.unshift.apply(He,s),He.push.apply(He,X),Ie=He.length,Y=Promise.resolve(_);fe<Ie;)Y=Y.then(He[fe++],He[fe++]);return Y}Ie=s.length;let je=_;for(fe=0;fe<Ie;){const He=s[fe++],Re=s[fe++];try{je=He(je)}catch(Ue){Re.call(this,Ue);break}}try{Y=OS.call(this,je)}catch(He){return Promise.reject(He)}for(fe=0,Ie=X.length;fe<Ie;)Y=Y.then(X[fe++],X[fe++]);return Y}getUri(h){h=wu(this.defaults,h);const _=jI(h.baseURL,h.url,h.allowAbsoluteUrls);return OI(_,h.params,h.paramsSerializer)}};mt.forEach(["delete","get","head","options"],function(h){vu.prototype[h]=function(_,w){return this.request(wu(w||{},{method:h,url:_,data:(w||{}).data}))}});mt.forEach(["post","put","patch"],function(h){function _(w){return function(O,k,s){return this.request(wu(s||{},{method:h,headers:w?{"Content-Type":"multipart/form-data"}:{},url:O,data:k}))}}vu.prototype[h]=_(),vu.prototype[h+"Form"]=_(!0)});let $N=class WI{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let _;this.promise=new Promise(function(O){_=O});const w=this;this.promise.then(M=>{if(!w._listeners)return;let O=w._listeners.length;for(;O-- >0;)w._listeners[O](M);w._listeners=null}),this.promise.then=M=>{let O;const k=new Promise(s=>{w.subscribe(s),O=s}).then(M);return k.cancel=function(){w.unsubscribe(O)},k},h(function(O,k,s){w.reason||(w.reason=new dd(O,k,s),_(w.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const _=this._listeners.indexOf(h);_!==-1&&this._listeners.splice(_,1)}toAbortSignal(){const h=new AbortController,_=w=>{h.abort(w)};return this.subscribe(_),h.signal.unsubscribe=()=>this.unsubscribe(_),h.signal}static source(){let h;return{token:new WI(function(M){h=M}),cancel:h}}};function GN(a){return function(_){return a.apply(null,_)}}function HN(a){return mt.isObject(a)&&a.isAxiosError===!0}const V0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(V0).forEach(([a,h])=>{V0[h]=a});function ZI(a){const h=new vu(a),_=SI(vu.prototype.request,h);return mt.extend(_,vu.prototype,h,{allOwnKeys:!0}),mt.extend(_,h,null,{allOwnKeys:!0}),_.create=function(M){return ZI(wu(a,M))},_}const Wr=ZI(Fp);Wr.Axios=vu;Wr.CanceledError=dd;Wr.CancelToken=$N;Wr.isCancel=NI;Wr.VERSION=qI;Wr.toFormData=B_;Wr.AxiosError=hn;Wr.Cancel=Wr.CanceledError;Wr.all=function(h){return Promise.all(h)};Wr.spread=GN;Wr.isAxiosError=HN;Wr.mergeConfig=wu;Wr.AxiosHeaders=oo;Wr.formToJSON=a=>BI(mt.isHTMLForm(a)?new FormData(a):a);Wr.getAdapter=HI.getAdapter;Wr.HttpStatusCode=V0;Wr.default=Wr;const{Axios:fV,AxiosError:pV,CanceledError:mV,isCancel:gV,CancelToken:_V,VERSION:yV,all:xV,Cancel:vV,isAxiosError:bV,spread:wV,toFormData:TV,AxiosHeaders:SV,HttpStatusCode:EV,formToJSON:AV,getAdapter:IV,mergeConfig:CV}=Wr,qN=Wr.create({baseURL:"http://10.30.13.82:9191",headers:{"Content-Type":"application/json",Accept:"application/json"}}),WN=async({...a})=>{try{return(await qN.post("/api/contact/mail",{nombre:a.nombre.toUpperCase(),telefono:a.telefono,correo:a.correo,asunto:a.asunto.toUpperCase(),descripcion:a.descripcion})).data}catch(h){return{error:h}}},ZN=Ra(Ae.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"})),BS={nombre:"",telefono:"",correo:"",asunto:"",descripcion:""},u0=/^[A-Za-z\s]*$/,XN=/^\d*$/,KN=/^[A-Za-z0-9._@-]*$/,YN=()=>{const a=hl("(max-width : 1050px)"),[h,_]=it.useState(BS),[w,M]=it.useState(SS),[O,k]=it.useState(!1),s=async()=>{if(m4(h,w,M)){k(!0);const X=await WN(h);X.data?(k(!1),gp.fire({icon:"success",title:"Éxito",text:"Tu solicitud ha sido enviada",showConfirmButton:!0,confirmButtonColor:"#d37c6b"}),_(BS),M(SS)):X.error&&(k(!1),gp.fire({icon:"error",title:"Error",text:"No se ha podido procesar su solicitud. Intente más tarde",showConfirmButton:!0,confirmButtonColor:"#d37c6b"}))}};return Ae.jsxs(nr,{container:!0,sx:{pb:a?"2vh":"7.5vh",position:"relative",mt:a?2:0,zIndex:10},children:[Ae.jsx(nr,{size:a?12:6,sx:{height:"auto",pb:a?"2vh":0,display:a?"none":"flex",justifyContent:"center",alignItems:"center"},children:Ae.jsxs(zn,{sx:{width:"80%",pl:10},children:[Ae.jsx(Jn,{fontSize:"20px",fontFamily:"sans-serif",textAlign:"justify",fontWeight:500,letterSpacing:1,children:"Para cualquier consulta relacionada al evento, por favor completa el formulario de contacto o comunícate con la subdirección de Enseñanza del Centro de Alta Especialidad Dr. Rafael Lucio al teléfono 228-814-4500 Ext. 1116."}),Ae.jsx(Jn,{fontSize:"20px",fontFamily:"sans-serif",textAlign:"justify",fontWeight:500,letterSpacing:1,children:"Nos comprometemos a atender tu solicitud a la mayor brevedad posible. Gracias por tu interés."})]})}),Ae.jsxs(nr,{size:a?12:6,sx:{textAlign:"center",height:"auto"},children:[Ae.jsxs(zn,{sx:{mt:"4vh",visibility:"visible"},children:[Ae.jsx(z_,{sectionId:"Contacto"}),Ae.jsx(Kh,{component:Hs.div,initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut"},viewport:{once:!0},sx:{fontFamily:"sans-serif",fontWeight:700,fontSize:a?"25px":"33px",color:"secondary.main",width:a?"80%":"50%",m:"auto"},children:"CONTACTO"})]}),Ae.jsxs(zn,{sx:{width:a?"90%":"75%",m:"auto",pl:{md:10},pr:{md:10},pb:a?5:0},children:[Ae.jsxs(zn,{sx:{width:a?"100%":"auto",m:"auto",mt:2,display:a?"block":"none"},children:[Ae.jsx(Jn,{fontSize:a?"18px":"20px",fontFamily:"sans-serif",textAlign:"justify",children:"Para cualquier consulta relacionada al evento, por favor completa el formulario de contacto o comunícate con la subdirección de Enseñanza del Centro de Alta Especialidad Dr. Rafael Lucio al teléfono 228-814-4500 Ext. 1116."}),Ae.jsx(Jn,{fontSize:a?"18px":"20px",fontFamily:"sans-serif",textAlign:"justify",children:"Nos comprometemos a atender tu solicitud a la mayor brevedad posible. Gracias por tu interés."})]}),Ae.jsx(zn,{sx:{width:a?"100%":"auto",height:"auto",borderRadius:5,mt:3,boxShadow:"0 8px 10px 0 rgba(1,18,38, 0.15)"},children:Ae.jsxs(nr,{container:!0,sx:{height:"100%",overflow:"hidden",flexDirection:a?"column":"row"},children:[Ae.jsx(nr,{size:12,sx:{height:"15%",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(90deg, rgba(83,115,109,1) 0%, rgba(19,50,44,1) 48%, rgba(36,70,63,1) 100%);",borderTopLeftRadius:18,borderTopRightRadius:15,pt:3,pb:3},children:Ae.jsx(p4,{sx:{width:"auto",height:"60px",color:"white"}})}),Ae.jsxs(nr,{size:12,sx:{p:5,height:"85%",display:"flex",flexDirection:"column",gap:4},children:[Ae.jsxs(zn,{children:[Ae.jsxs(Jn,{fontWeight:"bold",sx:{textAlign:"left"},children:["Nombre ",Ae.jsx("b",{style:{color:"red"},children:"*"})," "]}),Ae.jsx(sp,{value:h.nombre,sx:{width:"100%","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c3c3c3"},"&:hover fieldset":{borderColor:"background.default"},"&.Mui-focused fieldset":{border:"1px solid",borderColor:"background.default"}}},size:"small",onChange:W=>_({...h,nombre:u0.test(W.target.value)?W.target.value:h.nombre}),error:h.nombre===""&&w.nombre&&!0,helperText:h.nombre===""&&w.nombre&&"Este campo es necesario"})]}),Ae.jsxs(zn,{children:[Ae.jsxs(Jn,{fontWeight:"bold",sx:{textAlign:"left"},children:["Teléfono ",Ae.jsx("b",{style:{color:"red"},children:"*"})," "]}),Ae.jsx(sp,{value:h.telefono,sx:{width:"100%","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c3c3c3"},"&:hover fieldset":{borderColor:"background.default"},"&.Mui-focused fieldset":{border:"1px solid",borderColor:"background.default"}}},size:"small",onChange:W=>_({...h,telefono:XN.test(W.target.value)?W.target.value:h.telefono}),error:w.telefono&&h.telefono.length<10&&!0,helperText:w.telefono&&h.telefono.length<10&&"Este campo es necesario",slotProps:{htmlInput:{maxLength:10}}})]}),Ae.jsxs(zn,{children:[Ae.jsxs(Jn,{fontWeight:"bold",sx:{textAlign:"left"},children:["Correo ",Ae.jsx("b",{style:{color:"red"},children:"*"})," "]}),Ae.jsx(sp,{value:h.correo,sx:{width:"100%","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c3c3c3"},"&:hover fieldset":{borderColor:"background.default"},"&.Mui-focused fieldset":{border:"1px solid",borderColor:"background.default"}}},size:"small",onChange:W=>_({...h,correo:KN.test(W.target.value)?W.target.value:h.correo}),error:h.correo===""&&w.correo&&!0,helperText:h.correo===""&&w.correo&&"Este campo es necesario"})]}),Ae.jsxs(zn,{children:[Ae.jsxs(Jn,{fontWeight:"bold",sx:{textAlign:"left"},children:["Asunto ",Ae.jsx("b",{style:{color:"red"},children:"*"})]}),Ae.jsx(sp,{value:h.asunto,sx:{width:"100%","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c3c3c3"},"&:hover fieldset":{borderColor:"background.default"},"&.Mui-focused fieldset":{border:"1px solid",borderColor:"background.default"}}},size:"small",onChange:W=>_({...h,asunto:u0.test(W.target.value)?W.target.value:h.asunto}),error:h.asunto===""&&w.asunto&&!0,helperText:h.asunto===""&&w.asunto&&"Este campo es necesario"})]}),Ae.jsxs(zn,{children:[Ae.jsxs(Jn,{fontWeight:"bold",sx:{textAlign:"left"},children:["Descripción ",Ae.jsx("b",{style:{color:"red"},children:"*"})," "]}),Ae.jsx(sp,{value:h.descripcion,sx:{width:"100%","& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#c3c3c3"},"&:hover fieldset":{borderColor:"background.default"},"&.Mui-focused fieldset":{border:"1px solid",borderColor:"background.default"}}},size:"medium",multiline:!0,onChange:W=>_({...h,descripcion:u0.test(W.target.value)?W.target.value:h.descripcion}),error:h.descripcion===""&&w.descripcion&&!0,helperText:h.descripcion===""&&w.descripcion&&"Este campo es necesario"})]}),Ae.jsxs(zn,{sx:{position:"relative"},children:[Ae.jsx(qS,{disabled:O,onClick:s,variant:"outlined",startIcon:Ae.jsx(ZN,{}),sx:{color:"black",borderColor:"#db897b"},children:"Enviar"}),O&&Ae.jsx(bR,{size:24,sx:{color:"#da8777",position:"absolute",top:"54%",left:"51%",marginTop:"-12px",marginLeft:"-12px"}})]})]})]})})]})]}),Ae.jsx("img",{alt:"medic2",style:{position:"absolute",display:a?"none":"block",filter:"drop-shadow(0px 0px 9px grey)",bottom:0,right:"34.5%",maxWidth:"45%",height:"auto",zIndex:0},src:"./contactMedic.webp"})]})},JN=()=>{const{modalProgramData:a,setModalProgramData:h}=it.useContext(Tu),_=()=>{h({isOpen:!1,img:""})};return Ae.jsx(Ae.Fragment,{children:Ae.jsx(KR,{open:a.isOpen,onClose:_,"aria-labelledby":"responsive-dialog-title",fullWidth:!0,maxWidth:"lg",scroll:"body",slotProps:{paper:{sx:{boxShadow:"none",background:"transparent",p:0,m:0}}},sx:{backdropFilter:"blur(5px)"},children:Ae.jsx(tD,{children:Ae.jsx("img",{loading:"lazy",alt:"algo",style:{transition:"all 0.3s ease",filter:"drop-shadow(0px 0px 5px grey)",width:"100%",height:"100%"},src:a.img})})})})},QN=Ra(Ae.jsx("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"})),NS=({programas:a})=>{const h=hl("(max-width : 1050px)"),{setModalProgramData:_}=it.useContext(Tu),[w,M]=it.useState(null),O=(s,W)=>{M(W);const X=document.createElement("a");X.download="JORNADAS.pdf",X.href=s,X.target="_blank",X.click(),X.remove();const Y=setTimeout(()=>{M(null)},1e3);return()=>clearTimeout(Y)},k=s=>{_({isOpen:!0,img:s})};return Ae.jsx(Ae.Fragment,{children:Ae.jsx(Ez,{columns:h?1:3,spacing:h?2:5,sx:{width:"100%",margin:"auto"},children:a.map((s,W)=>Ae.jsxs(zn,{component:Hs.div,initial:{opacity:0},animate:{opacity:1},transition:{delay:W*.1,duration:.5},sx:{display:"flex",flexDirection:"column",gap:2},children:[Ae.jsx(Jn,{sx:{m:"auto",fontFamily:"sans-serif",fontSize:"20px",fontWeight:700,color:"background.default",textAlign:"center"},children:s.title}),Ae.jsx(zn,{component:"img",src:s.img,loading:"lazy",alt:s.altImgText,sx:{cursor:"pointer",transition:"transform 0.3s ease",filter:"drop-shadow(0px 0px 5px grey)",":hover":{transform:"scale(1.03)",transition:"transform 0.3s ease"}},onClick:()=>k(s.img)}),s.onDowload&&Ae.jsx(zn,{sx:{display:"flex",justifyContent:"center"},children:Ae.jsx(qS,{loading:w===s.buttonText,onClick:()=>O(s.onDowload,s.buttonText),variant:"contained",endIcon:Ae.jsx(QN,{}),sx:{backgroundColor:"background.default",color:"primary.main",":hover":{backgroundColor:"primary.main",color:"background.default"},width:"100%"},children:s.buttonText})}),h&&W!==a.indexOf(a[a.length-1])&&Ae.jsx(Kh,{sx:{width:"50%",m:"auto",mt:1,mb:1,border:"ridge"}})]},s.buttonText))})})},eV=()=>{const a=hl("(max-width : 1050px)");return Ae.jsxs(nr,{container:!0,columns:12,sx:{display:"flex",justifyContent:"center",height:"77vh",mb:a?4:10},children:[Ae.jsx(Jn,{component:Hs.div,initial:{clipPath:"inset(0 100% 0 0)",opacity:0},whileInView:{clipPath:"inset(0 0% 0 0)",opacity:1},transition:{duration:.8,ease:"easeOut",delay:.4},viewport:{once:!0},sx:{position:"absolute",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",mt:a?"41vh":"38.5vh",fontSize:a?"11vw":"5vw",fontWeight:"bold",backgroundImage:"linear-gradient(45deg, #afd5cd, #13322c)",backgroundClip:"text",color:"transparent",zIndex:1},children:"PRÓXIMAMENTE"}),a?Ae.jsx(zn,{component:Hs.div,initial:{opacity:0},whileInView:{opacity:1},transition:{delay:.1,duration:.5,ease:"easeOut"},viewport:{once:!0},sx:{width:"100%",position:"relative",overflow:"hidden"},children:Ae.jsx("img",{width:"100%",height:"100%",style:{position:"absolute",bottom:0,filter:"drop-shadow(0px 0px 3.5px grey)",zIndex:2},src:"./incoming.webp"})}):Ae.jsx(zn,{component:Hs.div,initial:{opacity:0},whileInView:{opacity:1},transition:{delay:.1,duration:.5,ease:"easeOut"},viewport:{once:!0},sx:{zIndex:2,position:"relative",display:"flex",justifyContent:"center"},children:Ae.jsx(zn,{component:"img",loading:"eager",src:"./incoming.webp",sx:{height:"100%",width:"auto",overflow:"hidden",filter:"drop-shadow(0px 0px 9px grey)",mt:2,position:"absolute"}})})]})},tV=()=>{const a=hl("(max-width : 1050px)"),{programTab:h,setProgramTab:_}=it.useContext(Tu),w=(M,O)=>{const k=V2.find(s=>s.id===O);k&&_(k)};return Ae.jsxs(nr,{container:!0,columns:12,sx:{display:"flex",minHeight:"auto",flexDirection:"column",ml:a?3:20,mr:a?3:20,mt:2},children:[Ae.jsxs(nr,{size:12,sx:{mb:2,mt:0,position:"relative"},children:[Ae.jsx(z_,{sectionId:"Programa"}),Ae.jsx(Kh,{component:Hs.div,initial:{opacity:0,y:50},whileInView:{opacity:1,y:0},transition:{duration:.85,ease:"easeInOut"},viewport:{once:!0},sx:{fontFamily:"sans-serif",fontWeight:700,fontSize:a?"25px":"33px",color:"text.primary",width:a?"80%":"50%",m:"auto"},children:"PROGRAMA"})]}),Ae.jsx(nr,{size:12,sx:{display:"flex",justifyContent:"center",mb:1},children:Ae.jsx(mz,{value:h.id,onChange:w,variant:"fullWidth",scrollButtons:"auto","aria-label":"scrollable auto tabs example",sx:{backgroundColor:"background.default",borderRadius:2,width:a?"100%":"50%","& .MuiTabs-indicator":{backgroundColor:"text.secondary"}},children:V2.slice().reverse().map(M=>Ae.jsx(KD,{value:M.id,sx:{width:"100%",color:"primary.main","&.Mui-selected":{color:"text.secondary"}},label:M.label},M.id))})}),Ae.jsxs(nr,{size:12,sx:{mt:2,height:"100%"},children:[h.id===0&&Ae.jsx(NS,{programas:wR}),h.id===1&&Ae.jsx(NS,{programas:TR}),h.id===2&&Ae.jsx(eV,{})]}),Ae.jsx(JN,{})]})},XI=64,KI=54,iV=v_.memo(o4),nV=v_.memo(tV),rV=v_.memo(f4),sV=v_.memo(YN),oV=()=>{const a=hl("(max-width : 1050px)"),{triggerRelocation:h,activeSection:_}=it.useContext(Tu);return it.useEffect(()=>{if(_){const w=document.getElementById(_);w&&h===!0&&window.scrollTo({top:w.offsetTop-(a?KI:XI),behavior:"smooth"})}},[_]),Ae.jsxs(HS,{children:[Ae.jsx(zn,{component:"section",id:"Inicio",sx:{backgroundColor:"#ffffff"},children:Ae.jsx(iV,{})}),Ae.jsx(zn,{component:"section",id:"Programa",sx:{backgroundColor:"#ffffff"},children:Ae.jsx(nV,{})}),Ae.jsx(zn,{component:"section",id:"Sedes",sx:{backgroundColor:"#ffffff"},children:Ae.jsx(rV,{})}),Ae.jsx(zn,{component:"section",id:"Contacto",sx:{backgroundColor:"#ffffff"},children:Ae.jsx(sV,{})})]})},MV=Object.freeze(Object.defineProperty({__proto__:null,default:oV,navBarHeigth:XI,navBarHeigthResponsive:KI},Symbol.toStringTag,{value:"Module"}));export{LR as A,BR as C,GR as D,$0 as F,MV as H,G0 as I,JD as K,KS as S,mz as T,j2 as a,YD as b,SR as c,sp as d,SD as e,id as f,cV as g,lD as h,Yh as i,KR as j,tD as k,dD as l,UR as m,gp as n,ZN as o,KI as p,XI as q,KD as r,qN as s,Hs as t,nd as u,uu as v,Sa as w,np as x};
